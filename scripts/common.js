/**
 * Interface for reading and writing to a blob (arbitrary string representation)
 * 
 * @exports Blobber
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * Vector variable to contain all vector operations and definitions where a
 * vector is represented as a javascript array
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * Matrix variable contains functions and interfaces for matrix/vector
 * operations.
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * No Description
 *
 * @exports RLEBlobber
 * @implements Blobber
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * No Description
 *
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * Game is an object which represents a running game, thereby storing the teams
 * and the time at which the game started.
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * A Result represents the outcome of a game with two teams, usually including
 * one to three players.
 * 
 * @param team1
 *          Array of player ids of the first team. Creates an internal copy.
 * @param team2
 *          Array of player ids of the second team. Creates an internal copy.
 * @param points1
 *          {Integer} Points of the first team
 * @param points2
 *          {Integer} Points of the second team
 * @return the newly constructed Result object
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * A correction ties a wrong game result to a new game result. This structure is
 * intended for secure storage only, hence the copying efforts. Since
 * corrections should be sparse, the copying shouldn't matter.
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * Ranking is an interface for different ranking methods. The most important
 * assumption is about the player ids: They're required to be close-packed
 * integer values starting at 0.
 * 
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * Provide functions to define, store, read and write options objects of
 * arbitrary type. Can be used by other code to maintain their internal set of
 * options
 * 
 * Undefined behavior (most likely infinite loops) on nesting loops
 * 
 * @exports Options
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * Tournament is an interface for generalized management of tournaments. It
 * assumes unique player ids for every tournament, so the use of global ids is
 * encouraged.
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * KO tournament
 * 
 * Complies to Tournament and Blobber interfaces
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * Implementation of the swiss tournament system where there's only one player.
 * If you need teams, first consider to enter a team as a single player before
 * rewriting for multi-player teams, which are only useful for random teams.
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */

/**
 * An object which contains some, if not all exported objects of the ui to avoid
 * circular loading dependencies.
 *
 * FIXME: Show all shared objects as dependencies in the code reference
 * 
 * @export Shared
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * A Toast is a small text which is visible for a short period of time before
 * disappearing.
 * 
 * You can supply a jquery object handle as str if you want to
 * insert an html node instead of text.
 * 
 * Toast duration can be set at Toast construction or controlled via a close()
 * function
 * 
 * @exports Toast
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * Strings for Toasts, headers, default contents and whatever you can think of.
 * 
 * TODO (in the reference:) show where and how each string is used
 * 
 * @exports Strings
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * Options object, which contains options such as database keys, points, etc.
 * 
 * @exports Options
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * Managed list of registered teams
 * 
 * @exports Team
 * @implements ./csver
 * @implements ../backend/blobber
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * A list of all subtournaments, their teams, types, ids, rankings, and
 * relationships after splitting or merging
 * 
 * @exports Tournaments 
 * @implements ../backend/blobber
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * History of game results and votes for all tournaments.
 * 
 * @implements ../backend/blobber
 * @exports History
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * Logic for viewing/hiding tabs.
 * 
 * Tabs are automatically read from the DOM during object construction.
 * 
 * @exports Tabs
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * Initializes and returns the Tabs singleton, which manages the tab logic.
 * 
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * wrapper around the backend options interface, to minimize confusion between
 * them and the ./options object.
 * 
 * TODO rename to further reduce naming confusion
 * 
 * @exports Opts
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * Tab Interface
 * 
 * @expost Tab
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * An event emitter class
 * 
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * An abstract model class
 * 
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * An abstract view class
 * 
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * An abstract controller class
 * 
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * Box Controller for catching collapse-by-click events
 * 
 * @exports BoxController
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * BoxView for collapsing boxes on click events
 * 
 * @exports BoxView
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * Model, View and Controller of the ranking tab
 * 
 * This tab shows all results in tabulated form and is supposed to provide some
 * kind of sorting functionality
 * 
 * @exports Tab_Ranking
 * @implements ./tab
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/*! @source http://purl.eligrey.com/github/Blob.js/blob/master/Blob.js */

/**
 * Storage object, which binds storage keys to actual objects for storage and
 * retrieval from a local storage
 * 
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * No Description
 * 
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * Maintain a sorted list of possible player names for autocompletion
 * 
 * @exports Players
 * @implements ../backend/blobber
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/*!
 * typeahead.js 0.10.2
 * https://github.com/twitter/typeahead.js
 * Copyright 2013-2014 Twitter, Inc. and other contributors; Licensed MIT
 */

/**
 * Autocomplete playernames using typeahead.js
 * 
 * @exports Autocomplete
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * Model, View and Controller of the teams tab
 * 
 * This tab allows registration, deletion, renaming and printing of teams or
 * individual players
 * 
 * @exports Tab_Teams
 * @implements ./tab
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * Model, View and Controller for the games tab.
 * 
 * This tab views the games, allows input of game results and submits them to
 * the respective tournaments
 * 
 * @exports Tab_Games
 * @implements ./tab
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * GlobalRanking, an object to determine the global ranking for every player by
 * its current tournament id and its rank within the tournament.
 * 
 * If two players are equally ranked, the lowest ID is first.
 * 
 * @exports GlobalRanking
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * A data object which contains vote permission presets for swiss tournaments
 * 
 * @exports SwissPerms
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * Model, View and Controller of the "new" tab, which manages the tournaments.
 * 
 * This tab allows allocating teams to (sub)tournaments, setting their rules and
 * starting/closing them
 * 
 * @exports Tab_New
 * @implements ./tab
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * some debugging functions, such as stack trace and whether it's a dev version
 * 
 * @exports Debug
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * Model, View and Controller of the debugging tab.
 *
 * @exports Tab_Debug
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * CSV export of tournament rankings
 * 
 * @exports Ranking
 * @implements ./csver
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * A singular object which represents the whole tournament state for the purpose
 * of being read from and written to storage.
 * 
 * @exports State
 * @implements ../backend/blobber
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * Model, View and Controller of the settings tab
 *
 * This tab allows viewing and changing various settings of the program.
 *
 * @exports Tab_Settings
 * @implements ./tab
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * Wrap all tabs into a single object for centralized updates
 * 
 * @exports Alltabs
 * @implements ./tab
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * Save button logic which initiates a file download of the current state for later loading
 * 
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * Print button logic, which triggers printing the current tab to paper.
 * 
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * Clears all stored data when the user visits the '#reset' target.
 * 
 * This is intended as a fallback solution when loading fails or old saves are
 * no longer compatible. Do not use this for clearing the storage, because the
 * page will be reloaded unnecessarily.
 * 
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * create BoxViews for every div.box
 * 
 * TODO remove this file in favor of subviewed boxes
 * 
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * Manage the application cache and notify about available and finished updates
 *
 * The exported Update() function allows manually triggering an update check.
 * Updates are automatically checked for on every pageload.
 * 
 * @export Update
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * Supports Online(), which returns true if the browser is online.
 * 
 * Also notifies if the user wants to leave the page while offline, but cannot
 * re-open it because it's not in the cache
 * 
 * @exports Online
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * Logic of the reload button, which forces an update of the tab it's in
 * 
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * detect features and warn users when they're leaving the page if data will be lost
 * 
 * @exports FeatureDetect
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * Interface for writing a proper CSV file.
 * 
 * No validation included
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * A model for listed content, which may be extended for practical use cases
 * 
 * @exports ListModel
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * ListView for viewing information in a tabular representation
 * 
 * @exports ListView
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * Manage the state and visibility of the splash screen
 * 
 * @exports Splash
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * A model for table content, which may be extended for practical use cases
 * 
 * @exports TableModel
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * TableView for viewing information in a tabular representation
 * 
 * @exports TableView
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

/**
 * common.js: loads each requirejs-compatible script file (except tests) and
 * configures requirejs to load libraries as shims
 *
 * This file is automatically generated as part of the build process.
 * Do not attempt manual changes
 * @author Erik E. Lorenz <erik.e.lorenz@gmail.com>
 * @license MIT License
 * @see LICENSE
 */

define("backend/blobber",[],function(){var t={Interface:{toBlob:function(){},fromBlob:function(){}}};return t}),define("backend/vector",[],function(){var t;return t={copy:function(t){var e,n,i;for(e=[],n=t.length,i=0;n>i;i+=1)t[i]&&(e[i]=t[i]);return e},dot:function(t,e,n){var i,s;for(n=n||Math.max(t.length,e.length),i=0,s=0;n>s;s+=1)i+=(t[s]||0)*(e[s]||0);return i},fill:function(t){var e,n;for(e=t.length,n=0;e>n;n+=1)t[n]=t[n]||0;return t},scale:function(t,e){var n,i;for(n=t.length,i=0;n>i;i+=1)t[i]&&(t[i]*=e);return t},sum:function(t){var e,n,i;for(e=0,n=t.length,i=0;n>i;i+=1)e+=t[i]||0;return e}}}),define("backend/matrix",{Interface:{size:0,clear:function(){return this},clone:function(){var t=null;return t},erase:function(){return this},extend:function(){return this},get:function(){return 0},set:function(){return this}},equalSize:function(t,e){return t.size===e.size&&void 0!==t.size&&null!==t.size},getRow:function(t,e){var n,i,s;for(n=[],i=t.size,s=0;i>s;s+=1)n[s]=t.get(e,s);return n},getCol:function(t,e){var n,i,s;for(n=[],i=t.size,s=0;i>s;s+=1)n[s]=t.get(s,e);return n},rowSum:function(t,e){var n,i,s;for(n=0,i=t.size,s=0;i>s;s+=1)n+=t.get(e,s);return n},rowSums:function(t){var e,n,i;for(e=[],n=t.size,i=0;n>i;i+=1)e[i]=this.rowSum(t,i);return e},mult:function(t,e,n){var i,s,o,r,a;if(i=t.size,0!==n.size&&n.clear(),!this.equalSize(t,e))return void 0;for(n.extend(i),o=0;i>o;o+=1)for(r=0;i>r;r+=1){for(s=0,a=0;i>a;a+=1)s+=t.get(o,a)*e.get(a,r);n.set(o,r,s)}return n},multVec:function(t,e){var n,i,s,o;for(n=[],i=t.size,s=0;i>s;s+=1)for(n[s]=0,o=0;i>o;o+=1)n[s]+=t.get(s,o)*(e[o]||0);return n},colSum:function(t,e){var n,i,s;for(n=0,i=t.size,s=0;i>s;s+=1)n+=t.get(s,e);return n},colSums:function(t){var e,n,i;for(e=[],n=t.size,i=0;n>i;i+=1)e[i]=this.colSum(t,i);return e},transpose:function(t){var e,n,i,s;for(e=t.size,n=0;e>n;n+=1)for(i=0;n>i;i+=1)s=t.get(n,i),t.set(n,i,t.get(i,n)),t.set(i,n,s);return t},vecMult:function(t,e){var n,i,s,o;for(n=[],i=e.size,s=0;i>s;s+=1)for(n[s]=0,o=0;i>o;o+=1)n[s]+=(t[o]||0)*e.get(o,s);return n}}),define("backend/rleblobber",[],function(){function t(t){return{}.toString.call(t).match(/\s([a-zA-Z]+)/)[1].toLowerCase()}var e=function(t){return this.array=t,this};return e.prototype.getArray=function(){return this.array},e.prototype.toBlob=function(){return e.toBlob(this.array)},e.prototype.fromBlob=function(t){this.array=e.fromBlob(t)},e.toBlob=function(n){var i,s,o,r,a;switch(t(n)){case"array":break;case"number":return n.toString();default:return void console.error("cannot parse content of type "+t(n))}for(o="",s=-1,i=0;i<n.length;i+=1){if(r=n[i],a=null!=r&&0!=r,s>-1){if(!a)continue;0===s?o="[":o+=",",o+=i-s==1?"n":"n"+(i-s),s=-1}a?(o+=0!=i?",":"[",o+=e.toBlob(r),s=-1):s=i}return o.length&&(o+="]"),o},e.fromBlob=function(e){var n,i,s,o,r,a,u,l;if("string"!=t(e))return void console.error('RLEBlobber.fromBlob: input is no string, but of type "'+t(e)+"'");if(0==e.length)return[];for(i=[],o="",n=void 0,a=!1,u=0,s=0;s<e.length;++s)switch(r=e[s]){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"+":case"-":case"e":case".":o+=r;break;case"n":if(a)return void console.error('unexpected sequence of multiple "n" characters in RLEBlobber.fromBlob input');a=!0;break;case"[":l=[],i.length>0&&(n[n.length+u]=l),u=0,i.push(l),n=i[i.length-1];break;case",":if(0==o.length)a&&(u+=1);else{if(o=Number(o),isNaN(o))return void console.error("invalid number or character sequence in RLEBlobber.fromBlob input");a?u+=o:(n[n.length+u]=o,u=0)}a=!1,o="";break;case"]":if(!a)if(0==o.length);else{if(o=Number(o),isNaN(o))return void console.error("invalid number or character sequence in RLEBlobber.fromBlob input");n[n.length+u]=o,u=0}if(1==i.length)return s==e.length-1?n:void console.error('unbalanced closing "]" in RLEBlobber input');i.pop(),n=i[i.length-1],0==n[n.length-1].length&&(n[n.length-1]=void 0),o="",a=!1;break;default:return void console.error('RLEBlobber fromBlob: unexpected character "'+r+'" in sparse array blob')}return void console.error("unexpected end of input. Unbalanced brackets")},e}),define("backend/halfmatrix",["./rleblobber"],function(t){var e=function(t,e){return t=t||0,this.setType(t),this.size=e||0,this.array=[],this};return e.empty=0,e.mirrored=1,e.negated=-1,e.prototype.setType=function(t){switch(t){case e.empty:this.get=this.getEmpty,this.set=this.setEmpty;break;case e.mirrored:this.get=this.getMirrored,this.set=this.setMirrored;break;case e.negated:this.get=this.getNegated,this.set=this.setNegated;break;default:return void 0}return this.type=t,this},e.prototype.clear=function(t){return this.array=[],this.size=t||0,this},e.prototype.clone=function(){var t,n,i,s,o,r,a;switch(this.get){case e.prototype.getMirrored:n=1;break;case e.prototype.getNegated:n=-1;break;default:n=0}for(t=this.size,i=new e(n,t),s=this.array,o=i.array,r=0;t>r;r+=1)if(s[r])for(a=0;r>=a;a+=1)s[r][a]&&(o[r]||(o[r]=[]),o[r][a]=s[r][a]);return i},e.prototype.erase=function(t){var e,n,i;if(t>=this.size||0>t)return this;for(n=this.array,e=n.length,n.splice(t,1),i=0;e>i;i+=1)n[i]&&n[i].splice(t,1);return this.size-=1,this},e.prototype.extend=function(t){return 0>=t?this:(t=t||1,this.size+=t,this)},e.prototype.getEmpty=function(t,e){return e>t?0:this.array[t]?this.array[t][e]||0:0},e.prototype.getMirrored=function(t,e){return e>t?this.get(e,t):this.array[t]?this.array[t][e]||0:0},e.prototype.getNegated=function(t,e){return e>t?-this.get(e,t):this.array[t]?this.array[t][e]||0:0},e.prototype.setMirrored=function(t,e,n){return e>t?this.set(e,t,n):this.setEmpty(t,e,n)},e.prototype.setNegated=function(t,e,n){return e>t?this.set(e,t,-n):this.setEmpty(t,e,n)},e.prototype.setEmpty=function(t,e,n){var i;return e>t?this:(i=this.array[t],n?(i||(i=this.array[t]=[]),i[e]=n):i&&delete i[e],this)},e.prototype.toBlob=function(){var e;return e={type:this.type,size:this.size,array:t.toBlob(this.array)},JSON.stringify(e)},e.prototype.fromBlob=function(e){var n;n=JSON.parse(e),this.size=n.size,this.array=t.fromBlob(n.array),this.setType(n.type)},e}),define("backend/buchholzranking",["./vector","./matrix","./halfmatrix"],function(t,e,n){var i=function(t){for(this.wins=[],this.netto=[],this.byes=[],this.corrections=[],this.games=new n(n.mirrored,t);this.netto.length<t;)this.netto.push(0),this.wins.push(0),this.byes.push(0)};return i.prototype.size=function(){return this.netto.length},i.prototype.resize=function(t){var e=this.size();if(e>t)for(this.netto.splice(t),this.wins.splice(t),this.byes.splice(t);this.games.size>t;)this.games.erase(t);else for(this.games.extend(t-e);t>e;e+=1)this.netto.push(0),this.wins.push(0),this.byes.push(0);return this},i.prototype.get=function(){var t,n,i,s,o;for(i=this.netto,s=this.wins,o=e.multVec(this.games,s),t=[],n=0;n<i.length;n+=1)t[n]=n;return t.sort(function(t,e){return s[e]-s[t]||o[e]-o[t]||i[e]-i[t]}),{buchholz:o,byes:this.byes,netto:i,ranking:t,size:i.length,wins:s}},i.prototype.add=function(t){var e,n,i,s,o,r;return n=this.netto,i=this.wins,s=this.games,e=t.getNetto(),o=t.getTeam(1),r=t.getTeam(2),o.map(function(t){n[t]+=e,e>0&&(i[t]+=1),r.map(function(e){s.set(t,e,s.get(t,e)+1)})}),r.map(function(t){n[t]-=e,0>e&&(i[t]+=1)}),this},i.prototype.remove=function(t){var e,n,i,s,o,r;return n=this.netto,i=this.wins,s=this.games,e=t.getNetto(),o=t.getTeam(1),r=t.getTeam(2),o.map(function(t){n[t]-=e,e>0&&(i[t]-=1),r.map(function(e){s.set(t,e,s.get(t,e)-1)})}),r.map(function(t){n[t]+=e,0>e&&(i[t]-=1)}),this},i.prototype.correct=function(t){return this.added(t.pre.getGame())?(this.remove(t.pre),this.add(t.post),this.corrections.push(t.copy()),this):void 0},i.prototype.grantBye=function(t){var e,n,i,s;"number"==typeof t&&(t=[t]),e=this.netto,n=this.wins,i=this.byes,s=this.size(),t.forEach(function(t){s>t&&(e[t]+=6,n[t]+=1,i[t]+=1)},this)},i.prototype.revokeBye=function(t){var e,n,i;"number"==typeof t&&(t=[t]),e=this.netto,n=this.wins,b=this.byes,i=this.size(),t.forEach(function(t){i>t&&b[t]>0&&(e[t]-=6,n[t]-=1,b[t]-=1)},this)},i.prototype.added=function(t){var e,n,i,s,o,r,a;for(a=!1,o=void 0,r=function(t){o.forEach(function(e){this.games.get(t,e)<=0&&(a=!0)},this)},e=t.teams.length,n=0;e>n;n+=1){for(s=t.teams[n],i=n+1;e>i&&(o=t.teams[i],s.forEach(r,this),!a);i+=1);if(a)break}return!a},i.prototype.getCorrections=function(){return this.corrections.map(function(t){return t.copy()},this)},i.prototype.toBlob=function(){var t;return t={byes:this.byes,corrections:this.corrections,games:this.games.toBlob(),netto:this.netto,wins:this.wins},JSON.stringify(t)},i.prototype.fromBlob=function(t){function e(t){return Correction.copy(t)}var n;n=JSON.parse(t),this.byes=n.byes,this.netto=n.netto,this.wins=n.wins,this.games.fromBlob(n.games),this.corrections=n.corrections.map(e)},i}),define("backend/game",[],function(){var t=function(t,e,n){this.teams=[],this.starttime=0,this.id=n||0,void 0!==t&&void 0!==e&&"number"==typeof t&&"number"==typeof e&&(this.add(0,t),this.add(1,e))};return t.prototype.add=function(t,e){return"number"!=typeof t||"number"!=typeof e?void 0:(void 0===this.teams[t]?this.teams[t]=[e]:-1===this.teams[t].indexOf(e)&&this.teams[t].push(e),this)},t.prototype.start=function(t){this.starttime=t||(new Date).getTime()},t.prototype.equals=function(t){var e,n,i,s;if(void 0===t||t.prototype!==this.prototype)return!1;if(this.teams.length!==t.teams.length&&0!==this.teams.length)return!1;for(e=0;e<this.teams.length;e+=1){if(i=this.teams[e],s=t.teams[e],void 0===i||void 0===s||i.length!==s.length||0===i.length)return!1;for(n=0;n<i.length;n+=1)if(-1===s.indexOf(i[n]))return!1}return!0},t.prototype.copy=function(){var e;return e=new t,this.teams.forEach(function(t,n){t.forEach(function(t){e.add(n,t)},this)},this),e.starttime=this.starttime,e.id=this.id,e},t.copy=function(e){function n(t){return t.slice()}var i;return i=new t,i.teams=e.teams.map(n),i.starttime=e.starttime,i},t}),define("backend/result",["./game"],function(t){var e=function(t,e,n,i){"number"==typeof t&&(t=[t]),"number"==typeof e&&(e=[e]),this.team1=t.slice(),this.team2=e.slice(),this.points1=n,this.points2=i};return e.prototype.getTeam=function(t){switch(t){case 1:return this.team1;case 2:return this.team2;default:return void 0}},e.prototype.getPoints=function(t){switch(t){case 1:return this.points1;case 2:return this.points2;default:return void 0}},e.prototype.setPoints=function(t,e){switch(t){case 1:this.points1=e;break;case 2:this.points2=e;break;default:return void 0}return this},e.prototype.getNetto=function(){return this.points1-this.points2},e.prototype.copy=function(){return new e(this.team1,this.team2,this.points1,this.points2)},e.prototype.getGame=function(){var e=new t;return this.team1.forEach(function(t){e.add(0,t)},this),this.team2.forEach(function(t){e.add(1,t)},this),e},e.copy=function(t){return new e(t.team1,t.team2,t.points1,t.points2)},e}),define("backend/correction",["./result"],function(t){var e;return e=function(t,e){this.pre=t.copy(),this.post=e.copy()},e.prototype.copy=function(){return new e(this.pre,this.post)},e.copy=function(n){return new e(t.copy(n.pre),t.copy(n.post))},e}),define("backend/finebuchholzranking",["./vector","./matrix","./halfmatrix","./result","./correction","./rleblobber"],function(t,e,n,i,s,o){var r=function(t){for(this.wins=[],this.netto=[],this.byes=[],this.corrections=[],this.games=new n(n.mirrored,t),this.length=0;this.length<t;)this.netto.push(0),this.wins.push(0),this.byes.push(0),this.length+=1};return r.prototype.size=function(){return this.length},r.prototype.resize=function(t){var e=this.size();if(e>t)for(this.netto.splice(t),this.wins.splice(t),this.byes.splice(t);this.games.size>t;)this.games.erase(t);else for(this.games.extend(t-e);t>e;e+=1)this.netto.push(0),this.wins.push(0),this.byes.push(0);return this.length=t,this},r.prototype.get=function(){var t,n,i,s,o,r,a;i=this.netto,s=this.wins,a=e.rowSums(this.games);for(n in this.byes)this.byes[n]&&(a[n]+=this.byes[n]);for(o=e.multVec(this.games,s),r=e.multVec(this.games,o),t=[],n=0;n<i.length;n+=1)t[n]=n;return t.sort(function(t,e){return s[e]-s[t]||o[e]-o[t]||r[e]-r[t]||i[e]-i[t]||t-e}),{buchholz:o,byes:this.byes,finebuchholz:r,games:a,netto:i,ranking:t,size:i.length,wins:s}},r.prototype.add=function(t){var e,n,i,s,o,r;return n=this.netto,i=this.wins,s=this.games,e=t.getNetto(),o=t.getTeam(1),r=t.getTeam(2),o.map(function(t){n[t]+=e,e>0&&(i[t]+=1),r.map(function(e){s.set(t,e,s.get(t,e)+1)})}),r.map(function(t){n[t]-=e,0>e&&(i[t]+=1)}),this},r.prototype.remove=function(t){var e,n,i,s,o,r;return n=this.netto,i=this.wins,s=this.games,e=t.getNetto(),o=t.getTeam(1),r=t.getTeam(2),o.forEach(function(t){n[t]-=e,e>0&&(i[t]-=1),r.map(function(e){s.set(t,e,s.get(t,e)-1)})},this),r.forEach(function(t){n[t]+=e,0>e&&(i[t]-=1)},this),this},r.prototype.correct=function(t){return this.added(t.pre.getGame())?(this.remove(t.pre),this.add(t.post),this.corrections.push(t.copy()),this):void console.error("correction not applicable!")},r.prototype.grantBye=function(t){var e,n,i,s;"number"==typeof t&&(t=[t]),e=this.netto,n=this.wins,i=this.byes,s=this.size(),t.forEach(function(t){s>t&&(e[t]+=6,n[t]+=1,i[t]+=1)},this)},r.prototype.revokeBye=function(t){var e,n,i;"number"==typeof t&&(t=[t]),e=this.netto,n=this.wins,b=this.byes,i=this.size(),t.forEach(function(t){i>t&&b[t]>0&&(e[t]-=6,n[t]-=1,b[t]-=1)},this)},r.prototype.added=function(t){var e,n,i,s,o,r,a;for(a=!1,o=void 0,r=function(t){o.forEach(function(e){this.games.get(t,e)<=0&&(a=!0)},this)},e=t.teams.length,n=0;e>n;n+=1){for(s=t.teams[n],i=n+1;e>i&&(o=t.teams[i],s.forEach(r,this),!a);i+=1);if(a)break}return!a},r.prototype.getCorrections=function(){return this.corrections.map(function(t){return t.copy()},this)},r.prototype.toBlob=function(){var t;return t={byes:o.toBlob(this.byes),corrections:this.corrections,games:this.games.toBlob(),netto:o.toBlob(this.netto),wins:o.toBlob(this.wins),length:this.length},JSON.stringify(t)},r.prototype.fromBlob=function(t){function e(t){return s.copy(t)}var n,i;for(n=JSON.parse(t),this.length=n.length,this.byes=o.fromBlob(n.byes),this.netto=o.fromBlob(n.netto),this.wins=o.fromBlob(n.wins),this.games.fromBlob(n.games),i=0;i<this.length;i+=1)this.byes[i]=this.byes[i]||0,this.netto[i]=this.netto[i]||0,this.wins[i]=this.wins[i]||0;this.corrections=n.corrections.map(e)},r}),define("backend/fullmatrix",[],function(){var t=function(t){return this.size=t||0,this.array=[],this};return t.prototype.size=0,t.prototype.clear=function(t){return this.array=[],this.size=t||0,this},t.prototype.clone=function(){var e,n,i,s,o,r;for(e=this.size,n=new t(e),i=this.array,s=n.array,o=0;e>o;o+=1)if(i[o])for(r=0;e>r;r+=1)i[o][r]&&(s[o]||(s[o]=[]),s[o][r]=i[o][r]);return n},t.prototype.erase=function(t){var e,n,i;if(t>=this.size||0>t)return this;for(e=this.array,n=e.length,e.splice(t,1),i=0;n>i;i+=1)e[i]&&e[i].splice(t,1);return this.size-=1,this},t.prototype.extend=function(t){return 0>=t?this:(t=t||1,this.size+=t,this)},t.prototype.get=function(t,e){return this.array[t]?this.array[t][e]||0:0},t.prototype.set=function(t,e,n){var i;return i=this.array[t],n?(i||(i=this.array[t]=[]),i[e]=n):i&&delete i[e],this},t}),define("backend/map",[],function(){var t=function(){this.map=[]};return t.prototype.insert=function(t){var e;return e=this.find(t),-1!==e?e:(this.map.push(t),this.map.length-1)},t.prototype.erase=function(t){this.map.splice(t,1)},t.prototype.remove=function(t){var e;e=this.find(t),-1!==e&&this.erase(e)},t.prototype.clear=function(){return this.map=[],this},t.prototype.at=function(t){return this.map[t]},t.prototype.find=function(t){return this.map.indexOf(t)},t.prototype.size=function(){return this.map.length},t.prototype.toBlob=function(){return JSON.stringify(this.map)},t.prototype.fromBlob=function(t){this.map=JSON.parse(t)},t}),define("backend/ranking",["./blobber"],function(t){return{Interface:{size:function(){return 0},resize:function(){return this},get:function(){return{ranking:[]}},add:function(){return this},remove:function(){return this},correct:function(){return this},getCorrections:function(){return[]},added:function(){return!0},grantBye:function(){},revokeBye:function(){}},Extends:[t]}}),define("backend/options",[],function(){function t(t){return{}.toString.call(t).match(/\s([a-zA-Z]+)/)[1].toLowerCase()}function e(n){var i,s;switch(t(n)){case"object":s={};break;case"array":s=[];break;default:return n}for(i in n)s[i]=e(n[i]);return s}var n,i;return n={Interface:{getOptions:function(){return{}},setOptions:function(){return!0}}},i=function(){this.options={}},i.prototype.toBlob=function(){return JSON.stringify(this.options)},i.prototype.fromBlob=function(t){var e=JSON.parse(t);return this.setOptions(e),this},i.prototype.getOptions=function(){return e(this.options)},i.getOptions=function(t){return i.prototype.getOptions.call(t)},i.prototype.setOptions=function(n){var i;if("object"!==t(n))return console.error("Options.setOptions: invalid argument type"),!1;for(i in n)if(void 0===typeof this.options[i])return console.error("Options.setOptions: unknown key: "+i),!1;for(i in n)this.options[i]=e(n[i]);return!0},i.setOptions=function(t,e){return i.prototype.setOptions.call(t,e)},i.Interface=n,i}),define("backend/tournament",["./map","./ranking","./game","./blobber","./options"],function(t,e,n,i,s){return{Interface:{addPlayer:function(t){return this.players.insert(t),this},start:function(){return this},end:function(){return this.getRanking()},finishGame:function(){return this},getGames:function(){return[]},getRanking:function(){return{place:[],ids:[],mydata:[],mydata2:[],mydata3:0}},rankingChanged:function(){return!0},getState:function(){return-1},correct:function(){return!0},getCorrections:function(){return[]},getType:function(){return""}},Extends:[i,s.Interface],STATE:{PREPARING:0,RUNNING:1,FINISHED:2,FAILURE:-1}}}),define("backend/random",[],function(){var t=function(t,e){var n;void 0!==t&&void 0!==e?(this.x=t,this.c=e):(n=new Date,this.x=65535&n.getTime(),this.c=n.getTime()>>16&65535)};return t.prototype.maxInt=65536,t.prototype.nextInt=function(t){return void 0!==t?Math.floor(this.nextDouble()*t):(this.x=65184*this.x+this.c,this.c=this.x>>16,this.x=65535&this.x,this.x)},t.prototype.nextDouble=function(){return this.nextInt()/this.maxInt},t.prototype.pick=function(t){return t[this.nextInt(t.length)]},t.prototype.pickAndRemove=function(t){return t.splice(this.nextInt(t.length),1)[0]},t}),define("backend/kotournament",["./tournament","./map","./random","./game","./options"],function(t,e,n,i,s){function o(t){return 2*t+1}function r(t){return Math.floor((t-1)/2)}function a(t){return Math.floor(Math.log(t+1)/Math.LN2)}function u(t){return t>0?Math.ceil(Math.log(t)/Math.LN2)+1:0}function l(t){return 1<<t}function c(t){return u(t)-1}function h(t){return l(t+1)-1}function d(t){return l(t)-1}function p(t){var e,n,i,s,o;if(2>t)return void 0;for(o=0,e=c(t),n=1<<e,i=[],s=0;t>s;)i.push(s),s+=1,t-s>n-t-o?(i.push(s),s+=1):(i.push(void 0),o+=1);return i}function f(t,e){var n,i,s;for(n=p(t,e),i=[],s=0;t>s;s+=1)i.push(s);for(s=0;s<n.length;s+=1)n[s]&&(n[s]=y.pickAndRemove(i));return n}function m(t){var e,n,i,s,o;if(e=[],o=1<<t,i=o-1,n=o>>1,s=0,4>o)for(;o>s;s+=1)e.push(s);else for(;e.length<o;)e.push(s),e.push(i-s),e.push(s+n),e.push(i-s-n),s+=2;return e}function g(t,e){var n,i,s;for(n=p(t,e),i=m(c(n.length)),s=0;s<i.length;s+=1)i[s]=n[i[s]];return i}function v(t,e){var n,s,a;s=r(e),this.gameid[t]=s,-1!==s&&(n=o(s)===e,a=this.gameid.indexOf(s),a===t&&(a=this.gameid.indexOf(s,t+1)),a>-1&&this.games.push(new i(n?t:a,n?a:t,s)))}var b,y,P;return y=new n,b=function(){this.players=new e,this.games=[],this.gameid=[],this.state=t.STATE.PREPARING,this.options={firstround:"set"}},b.OPTIONS={firstround:{order:"order",set:"set",random:"random"}},b.prototype.addPlayer=function(e){return this.state!==t.STATE.PREPARING?void 0:(this.players.insert(e),this)},P={},P[b.OPTIONS.firstround.order]=p,P[b.OPTIONS.firstround.set]=g,P[b.OPTIONS.firstround.random]=f,b.prototype.start=function(){var e,n,s,o,r,a;if(this.players.size<2)return void 0;if(this.state!==t.STATE.PREPARING)return void 0;for(r=c(this.players.size()),n=P[this.options.firstround](this.players.size(),this.options.byeOrder),a=d(r-1),e=0;e<n.length;e+=2,a+=1){if(s=n[e],o=n[e+1],void 0===s&&void 0===o)return this.gameid=[],this.games=[],void console.error("cannot have a game where both players are byevotes");void 0!==s?void 0!==o?(this.games.push(new i(s,o,a)),this.gameid[s]=this.gameid[o]=a):v.call(this,s,a):v.call(this,o,a)}return this.state=t.STATE.RUNNING,!0},b.prototype.end=function(){return this.state!==t.STATE.FINISHED?void 0:this.getRanking()},b.prototype.finishGame=function(e,n){var i,s,o,r,a;if(this.state!==t.STATE.RUNNING)return void 0;if(1!==e.teams[0].length||1!==e.teams[1].length)return void 0;if(i=this.players.find(e.teams[0][0]),s=this.players.find(e.teams[1][0]),-1===i||-1===s)return void 0;if(this.gameid[i]!==this.gameid[s])return void 0;if(o=this.gameid[i],n[0]>n[1])a=i;else{if(!(n[0]<n[1]))return void 0;a=s}for(r=0;r<=this.games.length;r+=1){if(r==this.games.length)return void 0;if(this.games[r].teams[0][0]===i&&this.games[r].teams[1][0]===s){this.games.splice(r,1);break}}return v.call(this,a,o),0===this.games.length&&(this.state=t.STATE.FINISHED),this},b.prototype.getGames=function(){var t=[];return this.games.forEach(function(e,n){t[n]=new i(this.players.at(e.teams[0][0]),this.players.at(e.teams[1][0]),e.id)},this),t},b.prototype.getRanking=function(){var t,e,n;for(e=[],t=[];t.length<this.players.size();)e[t.length]=h(a(this.gameid[t.length])),t.push(t.length);return t.sort(function(t,n){return e[t]-e[n]||t-n}),n=this.players.size(),{place:t.map(function(t){return Math.min(n-1,e[t])}),ids:t.map(function(t){return this.players.at(t)},this),round:1}},b.prototype.rankingChanged=function(){return!0},b.prototype.getState=function(){return this.state},b.prototype.correct=function(){return!1},b.prototype.toBlob=function(){var t;return t={players:this.players.toBlob(),games:this.games,gameid:this.gameid,state:this.state,options:this.getOptions()},JSON.stringify(t)},b.prototype.fromBlob=function(t){var e;e=JSON.parse(t),this.players.fromBlob(e.players),this.games=e.games,this.gameid=e.gameid,this.state=e.state,this.setOptions(e.options)},b.prototype.getOptions=s.prototype.getOptions,b.prototype.setOptions=s.prototype.setOptions,b.prototype.getType=function(){return"ko"},b.prototype.getCorrections=function(){return[]},b}),define("backend/nettoranking",[],function(){var t=function(t){for(this.wins=[],this.netto=[],this.byes=[],this.corrections=[];this.netto.length<t;)this.netto.push(0),this.wins.push(0),this.byes.push(0)};return t.prototype.size=function(){return this.netto.length},t.prototype.resize=function(t){var e=this.size();if(e>t)this.netto.splice(t),this.wins.splice(t),this.byes.splice(t);else for(;t>e;e+=1)this.netto.push(0),this.wins.push(0),this.byes.push(0);return this},t.prototype.get=function(){var t,e,n,i;for(n=this.netto,i=this.wins,t=[],e=0;e<n.length;e+=1)t[e]=e;return t.sort(function(t,e){return i[e]-i[t]||n[e]-n[t]}),{byes:this.byes,netto:n,ranking:t,size:n.length,wins:i}},t.prototype.add=function(t){var e,n,i;return n=this.netto,i=this.wins,e=t.getNetto(),t.getTeam(1).map(function(t){n[t]+=e,e>0&&(i[t]+=1)}),t.getTeam(2).map(function(t){n[t]-=e,0>e&&(i[t]+=1)}),this},t.prototype.remove=function(t){var e,n,i;return n=this.netto,i=this.wins,e=t.getNetto(),t.getTeam(1).map(function(t){n[t]-=e,e>0&&(i[t]-=1)}),t.getTeam(2).map(function(t){n[t]+=e,0>e&&(i[t]-=1)}),this},t.prototype.correct=function(t){return this.added(t.pre.getGame())?(this.remove(t.pre),this.add(t.post),this.corrections.push(t.copy()),this):void 0},t.prototype.grantBye=function(t){var e,n,i,s;"number"==typeof t&&(t=[t]),e=this.netto,n=this.wins,i=this.byes,s=this.size(),t.forEach(function(t){s>t&&(e[t]+=6,n[t]+=1,i[t]+=1)},this)},t.prototype.revokeBye=function(t){var e,n,i;"number"==typeof t&&(t=[t]),e=this.netto,n=this.wins,b=this.byes,i=this.size(),t.forEach(function(t){i>t&&b[t]>0&&(e[t]-=6,n[t]-=1,b[t]-=1)},this)},t.prototype.getCorrections=function(){return this.corrections.map(function(t){return t.copy()},this)},t.prototype.added=function(t){var e,n,i;return e=!1,n=!1,i=this.wins.length,t.teams.forEach(function(t){var s=!1;n||t.forEach(function(t){return t>=i||0>t?void(n=!0):void(this.wins[t]<=0&&(s=!0,this.netto[t]>=0&&(n=!0)))},this),s||(e=!0)},this),!n&&e},t.prototype.toBlob=function(){var t;return t={byes:this.byes,corrections:this.corrections,netto:this.netto,wins:this.wins},JSON.stringify(t)},t.prototype.fromBlob=function(t){function e(t){return Correction.copy(t)}var n;n=JSON.parse(t),this.byes=n.byes,this.netto=n.netto,this.wins=n.wins,this.corrections=n.corrections.map(e)},t}),define("backend/swisstournament",["./tournament","./map","./finebuchholzranking","./game","./result","./random","./correction","./options","./rleblobber"],function(t,e,n,i,s,o,r,a,u){function l(){var t={up:[],down:[],bye:void 0};return this.roundvotes.upvotes.forEach(function(e){t.up.push(this.players.at(e))},this),this.roundvotes.downvotes.forEach(function(e){t.down.push(this.players.at(e))},this),void 0!==this.roundvotes.byevote&&(t.bye=this.players.at(this.roundvotes.byevote)),t}function c(){var e,n,s,o,r,a,u,l,c,h;if(this.state===t.STATE.RUNNING)return void 0;if(0!==this.games.length)return void 0;if(r=this.players.size(),s=void 0,r%2===1){for(n=[],o=0;r>o;o+=1)P.call(this,o)&&n.push(o);if(0==n.length)return void console.error("All players got byes");s=this.rng.pick(n)}for(h=50,l=[];h>0;){for(c=20*r,h-=1,e=[],o=0;r>o;o+=1)o!==s&&e.push(o);for(;e.length>0;)if(a=this.rng.pickAndRemove(e),u=this.rng.pickAndRemove(e),E.call(this,a,u)?l.push(new i(a,u,l.length)):(e.push(a),e.push(u)),c-=1,0>=c){l=[];break}if(l.length)break}return 0===l.length?void console.warn("Failed to find non-repeating games"):(m.call(this),this.games=l,void 0!==s&&(x.call(this,s),this.roundvotes.byevote=s),this)}function h(){var e,n,s,o,r,a,u,l,c,h,d;if(this.state===t.STATE.RUNNING)return void 0;if(0!==this.games.length)return void 0;if(n=[],e=[],a=this.players.size(),d=this.getRanking().ids,!d||a!==d.length)return void console.error("swisstournament halves: lengths of sorted ids and players differ");for(o=void 0,r=0;a-e.length-n.length>1;)e.push(d[r]),n.push(d[a-r-1]),r+=1;switch(a-e.length-n.length){case 0:break;case 1:n.push(r);break;default:return void console.error("swisstournament halves: too many players left. Aborting")}if(e.length!=n.length&&e.length!=n.length-1)return void console.error("Swisstournament: Halves aren't of a valid size. Aborting");if(a%2===1){s=[];for(r in n)r=n[r],P.call(this,r)&&s.push(r);if(0==s.length)return void console.error("All players got byes");o=this.rng.pick(s),n.splice(n.indexOf(o),1)}for(h=25*a,c=[];n.length>0;)if(u=this.rng.pickAndRemove(n),l=this.rng.pickAndRemove(e),E.call(this,u,l)?c.push(new i(u,l,c.length)):(n.push(u),e.push(l)),h-=1,0>=h)return void console.warn("Failed to find non-repeating games");return m.call(this),this.games=c,void 0!==o&&(x.call(this,o),this.roundvotes.byevote=o),this}function d(){var e,n,s,o,r;if(this.state===t.STATE.RUNNING)return void 0;if(0!==this.games.length)return void console.error("there are still games running");if(o=25*this.players.size(),e=f.call(this),void 0===e)return void console.error("cannot form consistent wingroups");if(n=g.call(this,e),void 0===n)return void console.warn("wingroups: missing downvotes");for(s=[],r=0;r<e.length&&(void 0===e[r]||0===e[r].length);r+=1);return r===e.length?void console.warn("no lowest win group detected, meaning that there are no players"):(e.forEach(function(t,e){var a,u,l;if(!(0>=o))for(u=n.downvotes[e],e===r&&(u=n.byevote),void 0!==u&&t.splice(t.indexOf(u),1),u=n.downvotes[e+1],void 0!==u&&u!=n.downvotes[e]&&(a=[],t.forEach(function(t){y.call(this,t)&&E.call(this,u,t)&&a.push(t)},this),l=this.rng.pick(a),s.push(new i(u,l,s.length)),t.splice(t.indexOf(l),1),n.upvotes[e]=l);t.length>1;)if(u=this.rng.pick(t),l=this.rng.pick(t),u!==l&&(E.call(this,u,l)&&(s.push(new i(u,l,s.length)),t.splice(t.indexOf(u),1),t.splice(t.indexOf(l),1)),o-=1,0>=o))return void console.warn("newRoundByWins: timeout reached. Key players have already been matched")},this),0>=o?void 0:void 0===p.call(this,n)?void(this.games=[]):(this.games=s,this))}function p(t){var e,n,i,s;return e=0,i=!0,t.downvotes.forEach(function(t){void 0!==t&&(e+=1),b.call(this,t)||(i=!1)},this),n=0,s=!0,t.upvotes.forEach(function(t){void 0!==t&&(n+=1),y.call(this,t)||(s=!1)},this),e===n&&i&&s&&(void 0===t.byevote||P.call(this,t.byevote))?(x.call(this,t.byevote),t.downvotes.forEach(function(t){w.call(this,t)},this),t.upvotes.forEach(function(t){j.call(this,t)},this),this.roundvotes=t,this):void 0}function f(){var t,e,n,i,s,o;for(t=[],o=-1,lowest=-1,e=this.ranking.get(),i=this.players.size(),n=0;i>n;n+=1)s=e.wins[n]||0,s>o&&(o=s),void 0===t[s]&&(t[s]=[]),t[s].push(n);for(s=0;o>=s;s+=1)t[s]||(console.warn("wingroup #"+s+" is empty"),t[s]=[]);return t}function m(){this.roundvotes={upvotes:[],downvotes:[],byevote:void 0}}function g(t){var e,n,i,s,o,r,a;for(e=void 0,o=!1,n=[],s=[],a=0;a<t.length&&(void 0===t[a]||0===t[a].length);a+=1);if(a===t.length)return void console.error("no lowest win group detected, meaning that there are not players");for(r=function(t){b.call(this,t)&&s.push(t)},i=t.length-1;i>a;i-=1)if(t[i].length+(o?1:0)&1){if(s=[],t[i].forEach(r,this),0===t[i].length&&o&&s.push(n[i+1]),0===s.length)return void console.warn("no player in wingroup "+i+" can be downvoted");n[i]=this.rng.pick(s),o=!0}else o=!1;if(t[a].length+(o?1:0)&1){if(s=[],r=function(t){P.call(this,t)&&s.push(t)},t[a].forEach(r,this),0===s.length)return void console.warn("no candidate wingroup "+i+" can be byevoted");e=this.rng.pick(s)}return{byevote:e,downvotes:n,upvotes:[]}}function v(t,e){return"number"!=typeof t?!1:t>=this.players.size()?!1:!e.up&&this.upvote[t]?!1:!e.down&&this.downvote[t]?!1:!e.bye&&this.byevote[t]?!1:!0}function b(t){return v.call(this,t,this.options.permissions.down)}function y(t){return v.call(this,t,this.options.permissions.up)}function P(t){return v.call(this,t,this.options.permissions.bye)}function w(t){return b.call(this,t)&&(isNaN(this.downvote[t])?this.downvote[t]=1:this.downvote[t]+=1),this}function j(t){return y.call(this,t)&&(isNaN(this.upvote[t])?this.upvote[t]=1:this.upvote[t]+=1),this}function x(t){return P.call(this,t)&&(isNaN(this.byevote[t])?this.byevote[t]=1:this.byevote[t]+=1,this.ranking.grantBye(t)),this}function E(t,e){return t<this.players.size()&&e<this.players.size()&&t!==e&&this.ranking.added(new i(t,e))===!1}var C;return C=function(){this.players=new e,this.ranking=new n,this.state=t.STATE.PREPARING,this.games=[],this.upvote=[],this.downvote=[],this.byevote=[],this.rng=new o,this.round=0,this.roundvotes={upvotes:[],downvotes:[],byevote:void 0},this.rnkbuffer,this.rkch=!0,this.options={mode:"wins",permissions:{up:{up:!1,down:!0,bye:!0},down:{up:!0,down:!1,bye:!0},bye:{up:!0,down:!0,bye:!1}}}},C.prototype.addPlayer=function(e){return this.state!==t.STATE.PREPARING?void 0:(this.players.insert(e),this.ranking.resize(this.players.size()),this.rkch=!0,this)},C.prototype.start=function(){var e;if(this.state===t.STATE.RUNNING)return void 0;if(this.players.size()<2)return void 0;switch(e=!1,this.options.mode){case"wins":e=d.call(this)===this;break;case"random":e=c.call(this)===this;break;case"halves":e=h.call(this)===this;break;default:return void console.error("swiss: undefined round mode: "+this.options.mode)}return e?(this.state=t.STATE.RUNNING,this.round+=1,this.rkch=!0,!0):void 0},C.prototype.end=function(){return this.state!==t.STATE.RUNNING?void 0:0!==this.games.length?void 0:(this.state=t.STATE.FINISHED,this.getRanking())},C.prototype.finishGame=function(e,n){var o,r;if(this.state!==t.STATE.RUNNING)return void 0;if(1!==e.teams[0].length||1!==e.teams[1].length)return void 0;for(e=new i(this.players.find(e.teams[0][0]),this.players.find(e.teams[1][0]),e.id),r=!0,o=0;o<this.games.length;o+=1)if(e.equals(this.games[o])){r=!1;
break}return r===!0?void 0:(this.games.splice(o,1),0===this.games.length&&(this.state=t.STATE.FINISHED),this.ranking.add(new s(e.teams[0],e.teams[1],n[0],n[1])),this.rkch=!0,this)},C.prototype.getGames=function(){var t=[];return this.games.forEach(function(e,n){t[n]=new i(this.players.at(e.teams[0][0]),this.players.at(e.teams[1][0]),e.id)},this),t},C.prototype.getRanking=function(){var t,e,n;return this.rankingChanged()&&(e={place:[],ids:[],games:[],wins:[],buchholz:[],finebuchholz:[],netto:[],roundupvote:[],rounddownvote:[],roundbyevote:[],upvote:[],downvote:[],byevote:[],round:this.round},t=this.ranking.get(),this.rkch=!1,n=l.call(this),t.ranking.forEach(function(i,s){var o;o=this.players.at(i),e.place[s]=s,e.ids[s]=o,e.buchholz[s]=t.buchholz[i],e.finebuchholz[s]=t.finebuchholz[i],e.netto[s]=t.netto[i],e.games[s]=t.games[i],e.wins[s]=t.wins[i],e.roundupvote[s]=-1!==n.up.indexOf(o)?1:0,e.rounddownvote[s]=-1!==n.down.indexOf(o)?1:0,e.roundbyevote[s]=n.bye===o?1:0,e.upvote[s]=this.upvote[this.players.find(o)]||0,e.downvote[s]=this.downvote[this.players.find(o)]||0,e.byevote[s]=this.byevote[this.players.find(o)]||0},this),this.rnkbuffer=e),this.rnkbuffer},C.prototype.correct=function(t,e,n){var o,a;return t=new i(this.players.find(t.teams[0][0]),this.players.find(t.teams[1][0]),t.id),o=new s(t.teams[0],t.teams[1],e[0],e[1]),a=new s(t.teams[0],t.teams[1],n[0],n[1]),this.ranking.correct(new r(o,a))?(this.rkch=!0,this):void 0},C.prototype.getCorrections=function(){return this.ranking.getCorrections().map(function(t){var e;return e=t.pre.getGame(),e=t.post.getGame().equals(e)?new i(this.players.at(e.teams[0][0]),this.players.at(e.teams[1][0])):void 0,{game:e,oldpoints:[t.pre.points1,t.pre.points2],newpoints:[t.post.points1,t.post.points2]}},this)},C.prototype.toBlob=function(){var t;return t={byevote:u.toBlob(this.byevote),downvote:u.toBlob(this.downvote),games:this.games,players:this.players.toBlob(),ranking:this.ranking.toBlob(),round:this.round,roundvotes:this.roundvotes,state:this.state,upvote:u.toBlob(this.upvote)},JSON.stringify(t)},C.prototype.fromBlob=function(t){function e(t){return i.copy(t)}var n=JSON.parse(t);return this.byevote=u.fromBlob(n.byevote),this.downvote=u.fromBlob(n.downvote),this.round=n.round,this.roundvotes=n.roundvotes,this.state=n.state,this.upvote=u.fromBlob(n.upvote),this.games=n.games.map(e),this.players.fromBlob(n.players),this.ranking.fromBlob(n.ranking),this.rkch=!0,this},C.prototype.getState=function(){return this.state},C.prototype.rankingChanged=function(){return this.rkch},C.prototype.getOptions=a.prototype.getOptions,C.prototype.setOptions=a.prototype.setOptions,C.prototype.getType=function(){return"swiss"},C.MODES=["wins","halves","random"],C}),!function(t,e){if("object"==typeof exports)module.exports=e(require,exports,module);else if("function"==typeof define&&define.amd)define("lib/extend",["require","exports","module"],e);else{var n=function(e){return t[e]},i=t,s={exports:i};t.extend=e(n,i,s)}}(this,function(t,e,n){function i(t,e){function n(){}return n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.superclass=e.prototype,t.superconstructor=e,t}return i.isSubclass=function(t,e){if("function"==typeof e&&"function"==typeof t)for(var n=t;n=n.superconstructor;)if(n===e)return!0;return!1},n.exports=i,i});var saveAs=saveAs||"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(t){if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var e=t.document,n=e.createElementNS("http://www.w3.org/1999/xhtml","a"),i="download"in n,s=function(n){var i=e.createEvent("MouseEvents");i.initMouseEvent("click",!0,!1,t,0,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(i)},o=t.webkitRequestFileSystem,r=t.requestFileSystem||o||t.mozRequestFileSystem,a=function(e){(t.setImmediate||t.setTimeout)(function(){throw e},0)},u=0,l=function(e){var n=function(){"string"==typeof e?(t.URL||t.webkitURL||t).revokeObjectURL(e):e.remove()};t.chrome?n():setTimeout(n,10)},c=function(t,e,n){e=[].concat(e);for(var i=e.length;i--;){var s=t["on"+e[i]];if("function"==typeof s)try{s.call(t,n||t)}catch(o){a(o)}}},h=function(e,a){var h,d,p,f=this,m=e.type,g=!1,v=function(){c(f,["writestart","progress","write","writeend"])},b=function(){(g||!h)&&(h=(t.URL||t.webkitURL||t).createObjectURL(e)),d?d.location.href=h:void 0==t.open(h,"_blank")&&"undefined"!=typeof safari&&(t.location.href=h),f.readyState=f.DONE,v(),l(h)},y=function(t){return function(){return f.readyState!==f.DONE?t.apply(this,arguments):void 0}},P={create:!0,exclusive:!1};f.readyState=f.INIT,a||(a="download"),i?(h=(t.URL||t.webkitURL||t).createObjectURL(e),n.href=h,n.download=a,s(n),f.readyState=f.DONE,v(),l(h)):(t.chrome&&m&&"application/octet-stream"!==m&&(p=e.slice||e.webkitSlice,e=p.call(e,0,e.size,"application/octet-stream"),g=!0),o&&"download"!==a&&(a+=".download"),("application/octet-stream"===m||o)&&(d=t),r?(u+=e.size,r(t.TEMPORARY,u,y(function(t){t.root.getDirectory("saved",P,y(function(t){var n=function(){t.getFile(a,P,y(function(t){t.createWriter(y(function(n){n.onwriteend=function(e){d.location.href=t.toURL(),f.readyState=f.DONE,c(f,"writeend",e),l(t)},n.onerror=function(){var t=n.error;t.code!==t.ABORT_ERR&&b()},["writestart","progress","write","abort"].forEach(function(t){n["on"+t]=f["on"+t]}),n.write(e),f.abort=function(){n.abort(),f.readyState=f.DONE},f.readyState=f.WRITING}),b)}),b)};t.getFile(a,{create:!1},y(function(t){t.remove(),n()}),y(function(t){t.code===t.NOT_FOUND_ERR?n():b()}))}),b)}),b)):b())},d=h.prototype;return d.abort=function(){this.readyState=this.DONE,c(this,"abort")},d.readyState=d.INIT=0,d.WRITING=1,d.DONE=2,d.error=d.onwritestart=d.onprogress=d.onwrite=d.onabort=d.onerror=d.onwriteend=null,function(t,e){return new h(t,e)}}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&null!==module?module.exports=saveAs:"undefined"!=typeof define&&null!==define&&null!=define.amd&&define("lib/FileSaver",[],function(){return saveAs}),define("lib/implements",[],function(){function t(t){return{}.toString.call(t).match(/\s([a-zA-Z]+)/)[1].toLowerCase()}function e(t,e){return-1!==t.indexOf(e)?void 0:(t=t.slice(),t.push(e),t)}function n(){return{i:[],o:[]}}function i(t,e,n){var i;for(i=0;i<t.i.length;i+=1)if(t.i[i]===e&&t.o[i]===n)return void 0;return t={i:t.i.slice(),o:t.o.slice()},t.i.push(e),t.o.push(n),t}function s(t,n,i){var s,o,a;if(i=e(i,t)){o=Object.keys(t);for(s in o)s=o[s],a=t[s],r(a,n,i)}}function o(n,i,s){var o,a;if(s=e(s,n)){if(n.constructor!==Array)return void i.push([s.length," array.Interface = [] is not an array: ",t(n)].join(""));a=0;for(o in n)o=n[o],a+=1,r(o,i,s);a!==n.length&&i.push([s.length," intf.Interface array is not compact"].join("")),0===a&&i.push([s.length," intf.Interface array cannot be empty"].join(""))}}function r(e,n,i){switch(t(e)){case"object":c(e,n,i);break;case"function":case"number":case"string":case"date":case"regexp":case"boolean":break;case"array":o(e,n,i);break;default:n.push([i.length," invalid type for interface object: ",t(e)].join(""))}}function a(t){return/^[A-Z][A-Z0-9]*$/.test(t)}function u(t){return/^[a-z][a-zA-Z0-9]*/.test(t)}function l(n,i,s){var o,r,u;if(s=e(s,n))switch(t(n)){case"object":o=Object.keys(n);for(r in o)r=o[r],a(r)===!1&&i.push([s.length," nested constant is not all caps:",r].join("")),l(n[r],i,s);break;case"array":for(u in n)u=n[u],l(u,i,s);break;case"number":case"string":case"date":case"regexp":case"boolean":case"undefined":break;default:i.push([s.length," invalid type for a constant: ",t(n)].join(""))}}function c(n,i,r){var c,d,p;if(r=e(r,n))if(p=t(n),"object"===p)if(c=Object.keys(n),-1===c.indexOf("Interface"))i.push([r.length," intf.Interface: not found"].join(""));else for(d in c)switch(d=c[d]){case"Interface":switch(p=t(n.Interface)){case"object":s(n.Interface,i,r);break;case"array":o(n.Interface,i,r);break;default:i.push([r.length," invalid type for intf.Interface: ",p].join(""))}break;case"Extends":case"Requires":h(n[d],i,r);break;default:a(d)===!0?l(n[d],i,r):u(d)===!0?"function"!==t(n[d])&&i.push([r.length,"invalid type for global function ",d,":",t(n[d]),". Did you mean ",d.toUpperCase(),"?"].join("")):i.push([r.length,"invalid name: ",d,". Is neither CONSTANTNAME nor functionName"].join(""))}else i.push([r.length," intf is no object, but of type ",p].join(""))}function h(e,n,i){var s,o,r;if(o=t(e),"array"!==o)n.push([i.length," array of interfaces is no array, but ",o].join(""));else{r=0;for(s in e)s=e[s],c(s,n,i),s&&"object"!==t(s.Interface)&&n.push([i.length," Extend and Require can only contain objects, no arrays"].join("")),r+=1;e.length!==r&&n.push([i.length," array of interfaces is not compact"].join(""))}}function d(t){var e,n;return e=[],n=[],c(t,e,n),e.join("\n")}function p(t){var e,n;e=[];for(n in t)n=t[n],-1===e.indexOf(n)&&e.push(n);return e}function f(t,e){var n,i,s;for(n={a:[],b:[],shared:[]},t=p(t).sort(),e=p(e).sort(),i=t.length-1,s=e.length-1;i>=0;i-=1){for(;t[i]<e[s]&&s>=0;s-=1)n.b.push(e[s]);s>=0&&t[i]===e[s]?(n.shared.push(t[i]),s-=1):n.a.push(t[i])}for(;s>=0;s-=1)n.b.push(e[s]);return n.a.reverse(),n.b.reverse(),n}function m(e){var n,i,s,o;if(o=void 0===e.prototype&&"function"===t(e),i=void 0!==e.prototype&&"function"===t(e),s=void 0!==e.constructor&&"object"===t(e))n=Object.keys(e),e!==e.constructor.prototype&&(n=p(n.concat(m(e.constructor))));else if(i)n=m(e.prototype);else{if(!o)return void 0;n=Object.keys(e)}return n}function g(t,n){var n,i,s,o;if(n=n||[],n=e(n,t),void 0===n)return[];if(o=Object.keys(t.Interface),t.Extends)for(i in t.Extends){i=t.Extends[i],s=g(i,n);for(subkey in s)subkey=s[subkey],-1===o.indexOf(subkey)&&o.push(subkey)}return o}function v(t,n,i){var s,o,r;if(i=i||[],!t)return void 0;if(i=e(i,t),void 0===i)return void 0;if(t.Interface&&void 0!==t.Interface[n])return t.Interface[n];if(t.Extends)for(s=t.Extends.length;s>=0;s-=1)if(o=t.Extends[s],r=v(o,n,i),void 0!==r)return r;return void 0}function b(e,n,s,o,r){var a,u,l,c,h,d;if(r=i(r,e,n),void 0!==r){switch(otype){case"function":case"object":break;default:return void o.push([r.i.length," invalid type of obj: ",type].join(""))}if(a=g(e).sort(),u=m(n).sort(),l=f(a,u),l.i=l.a,l.o=l.b,0!==l.i.length)for(c in l.i)c=l.i[c],o.push([r.i.length," missing key: ",c].join(""));if(0!==l.o.length&&(s.noMoreMembers||s.noMoreFuncs))for(c in l.o)c=l.o[c],s.noMoreMembers&&"function"!==t(n[c])&&o.push([r.i.length," extra member: ",c].join("")),s.noMoreFuncs&&"function"===t(n[c])&&o.push([r.i.length," extra function: ",c].join(""));for(c in l.shared)switch(c=l.shared[c],h=t(v(e,c)),d=t(void 0!==n.prototype?n.prototype[c]:n[c]),!0){case h===d:case"object"===h&&("function"===d||"array"===d):s.recurse&&"object"===h?"array"===t(e.Interface[c].Interface)?y(e.Interface[c].Interface,n[c],s,o,r):b(e.Interface[c],n[c],s,o,r):s.recurse&&"array"===h&&y(e.Interface[c],n[c],s,o,r);break;default:o.push([r.i.length," type mismatch of ",c,": ",d," != ",h].join(""))}}}function y(e,n,s,o,r){var a,u,l,c,h,d,p;if(critital=!1,r=i(r,e,n),void 0!==r&&(a=t(e),u=t(n),"array"!==a&&(o.push([r.i.length," intf.Interface array is no array, but a ",a].join("")),d=!0),"array"!==u&&(o.push([r.i.length," array matching: object is no array, but a ",u].join("")),d=!0),!d))for(c in n){h=n[c],u=t(h),found=!1;for(l in e){switch(l=e[l],a=t(l),p=[],a){case"object":b(l,h,options,p,r),found=0===p.length;break;case"array":y(l,h,s,p,r),found=0===p.length;break;default:found=a===u}if(found)break}found||o.push([r.i.length," Interface array doesn't contain match for element at index ",c,": ",h].join(""))}}function P(e,i,s,o){var r,a,u,l,h;u=!1,r={noMoreFuncs:!1,noMoreMembers:!1,recurse:!1,testIntf:!1},s=s||"",s.split("");for(a in s)switch(a=s[a]){case"i":r.testIntf=!0;break;case"r":r.recurse=!0;break;case"f":r.noMoreFuncs=!0;break;case"m":r.noMoreMembers=!0;break;default:o.push(['unknown character in opts "',s,'": ',a].join("")),u=!0}u||(h=e&&t(e.Interface),e?"object"!==h&&"array"!==h?(o.push(["Interface.match(): invalid type of intf: ",t(e)].join("")),u=!0):r.testIntf&&(u=o.length,c(e,o,[]),u=o.length!==u):(o.push("missing interface to match against"),u=!0),otype=t(i),i||i==={}?"object"!==otype&&"function"!==otype&&"array"!==otype&&(o.push(["object has invalid type: ",t(i)].join("")),u=!0):(o.push("missing object for matching"),u=!0)),u||(l=n(),"object"===h?b(e,i,r,o,l):"array"===h&&y(e.Interface,i,s,o,l))}function w(t,e,n){var i;return i=[],P(t,e,n,i),i.join("\n")}function j(){var t,e;t=[];for(e in arguments)t.push(arguments[e]);return{Interface:{},Extends:t}}var x;return x=function(){switch(arguments.length){case 0:return{Interface:{},Extends:[],Requires:[]};case 1:return d(arguments[0]);case 2:return w(arguments[0],arguments[1]);case 3:return w(arguments[0],arguments[1],arguments[2]);default:return["Interface(): invalid number of arguments: ",arguments.length].join("")}},x.prototype=void 0,x.validate=d,x.match=w,x.combine=j,x.selfInterface={Interface:{validate:function(){},match:function(){},combine:function(){},selfInterface:{Interface:{}}}},x}),!function(){"undefined"==typeof Math.sgn&&(Math.sgn=function(t){return 0==t?0:t>0?1:-1});var t={subtract:function(t,e){return{x:t.x-e.x,y:t.y-e.y}},dotProduct:function(t,e){return t.x*e.x+t.y*e.y},square:function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},scale:function(t,e){return{x:t.x*e,y:t.y*e}}},e=64,n=Math.pow(2,-e-1),i=function(e,n){for(var i=[],s=o(e,n),a=n.length-1,u=2*a-1,l=r(s,u,i,0),h=t.subtract(e,n[0]),d=t.square(h),p=0,f=0;l>f;f++){h=t.subtract(e,c(n,a,i[f],null,null));var m=t.square(h);d>m&&(d=m,p=i[f])}return h=t.subtract(e,n[a]),m=t.square(h),d>m&&(d=m,p=1),{location:p,distance:d}},s=function(t,e){var n=i(t,e);return{point:c(e,e.length-1,n.location,null,null),location:n.location}},o=function(e,n){for(var i=n.length-1,s=2*i-1,o=[],r=[],a=[],u=[],l=[[1,.6,.3,.1],[.4,.6,.6,.4],[.1,.3,.6,1]],c=0;i>=c;c++)o[c]=t.subtract(n[c],e);for(var c=0;i-1>=c;c++)r[c]=t.subtract(n[c+1],n[c]),r[c]=t.scale(r[c],3);for(var h=0;i-1>=h;h++)for(var d=0;i>=d;d++)a[h]||(a[h]=[]),a[h][d]=t.dotProduct(r[h],o[d]);for(c=0;s>=c;c++)u[c]||(u[c]=[]),u[c].y=0,u[c].x=parseFloat(c)/s;for(var p=i,f=i-1,m=0;p+f>=m;m++){var g=Math.max(0,m-f),v=Math.min(m,p);for(c=g;v>=c;c++)j=m-c,u[c+j].y+=a[j][c]*l[j][c]}return u},r=function(t,n,i,s){var o,h,d=[],p=[],f=[],m=[];switch(a(t,n)){case 0:return 0;case 1:if(s>=e)return i[0]=(t[0].x+t[n].x)/2,1;if(u(t,n))return i[0]=l(t,n),1}c(t,n,.5,d,p),o=r(d,n,f,s+1),h=r(p,n,m,s+1);for(var g=0;o>g;g++)i[g]=f[g];for(var g=0;h>g;g++)i[g+o]=m[g];return o+h},a=function(t,e){var n,i,s=0;n=i=Math.sgn(t[0].y);for(var o=1;e>=o;o++)n=Math.sgn(t[o].y),n!=i&&s++,i=n;return s},u=function(t,e){var i,s,o,r,a,u,l,c,h,d,p,f,m,g,v,b;u=t[0].y-t[e].y,l=t[e].x-t[0].x,c=t[0].x*t[e].y-t[e].x*t[0].y;for(var y=max_distance_below=0,P=1;e>P;P++){var w=u*t[P].x+l*t[P].y+c;w>y?y=w:max_distance_below>w&&(max_distance_below=w)}return p=0,f=1,m=0,g=u,v=l,b=c-y,h=p*v-g*f,d=1/h,s=(f*b-v*m)*d,g=u,v=l,b=c-max_distance_below,h=p*v-g*f,d=1/h,o=(f*b-v*m)*d,r=Math.min(s,o),a=Math.max(s,o),i=a-r,n>i?1:0},l=function(t,e){var n=1,i=0,s=t[e].x-t[0].x,o=t[e].y-t[0].y,r=t[0].x-0,a=t[0].y-0,u=s*i-o*n,l=1/u,c=(s*a-o*r)*l;return 0+n*c},c=function(t,e,n,i,s){for(var o=[[]],r=0;e>=r;r++)o[0][r]=t[r];for(var a=1;e>=a;a++)for(var r=0;e-a>=r;r++)o[a]||(o[a]=[]),o[a][r]||(o[a][r]={}),o[a][r].x=(1-n)*o[a-1][r].x+n*o[a-1][r+1].x,o[a][r].y=(1-n)*o[a-1][r].y+n*o[a-1][r+1].y;if(null!=i)for(r=0;e>=r;r++)i[r]=o[r][0];if(null!=s)for(r=0;e>=r;r++)s[r]=o[e-r][r];return o[e][0]},h={},d=function(t){var e=h[t];if(!e){e=[];var n=function(){return function(e){return Math.pow(e,t)}},i=function(){return function(e){return Math.pow(1-e,t)}},s=function(t){return function(){return t}},o=function(){return function(t){return t}},r=function(){return function(t){return 1-t}},a=function(t){return function(e){for(var n=1,i=0;i<t.length;i++)n*=t[i](e);return n}};e.push(new n);for(var u=1;t>u;u++){for(var l=[new s(t)],c=0;t-u>c;c++)l.push(new o);for(var c=0;u>c;c++)l.push(new r);e.push(new a(l))}e.push(new i),h[t]=e}return e},p=function(t,e){for(var n=d(t.length-1),i=0,s=0,o=0;o<t.length;o++)i+=t[o].x*n[o](e),s+=t[o].y*n[o](e);return{x:i,y:s}},f=function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},m=function(t){return t[0].x==t[1].x&&t[0].y==t[1].y},g=function(t,e,n){if(m(t))return{point:t[0],location:e};for(var i=p(t,e),s=0,o=e,r=n>0?1:-1,a=null;s<Math.abs(n);)o+=.005*r,a=p(t,o),s+=f(a,i),i=a;return{point:a,location:o}},v=function(t){if(m(t))return 0;for(var e=p(t,0),n=0,i=0,s=1,o=null;1>i;)i+=.005*s,o=p(t,i),n+=f(o,e),e=o;return n},b=function(t,e,n){return g(t,e,n).point},y=function(t,e,n){return g(t,e,n).location},P=function(t,e){var n=p(t,e),i=p(t.slice(0,t.length-1),e),s=i.y-n.y,o=i.x-n.x;return 0==s?1/0:Math.atan(s/o)},w=function(t,e,n){var i=g(t,e,n);return i.location>1&&(i.location=1),i.location<0&&(i.location=0),P(t,i.location)},x=function(t,e,n,i){i=null==i?0:i;var s=g(t,e,i),o=P(t,s.location),r=Math.atan(-1/o),a=n/2*Math.sin(r),u=n/2*Math.cos(r);return[{x:s.point.x+u,y:s.point.y+a},{x:s.point.x-u,y:s.point.y-a}]};window.jsBezier={distanceFromCurve:i,gradientAtPoint:P,gradientAtPointAlongCurveFrom:w,nearestPointOnCurve:s,pointOnCurve:p,pointAlongCurveFrom:b,perpendicularToCurveAt:x,locationAlongCurveFrom:y,getLength:v}}(),function(){var t=this.Biltong={},e=function(t){return"[object Array]"===Object.prototype.toString.call(t)},n=function(t,n,i){return t=e(t)?t:[t.x,t.y],n=e(n)?n:[n.x,n.y],i(t,n)},i=t.gradient=function(t,e){return n(t,e,function(t,e){return e[0]==t[0]?e[1]>t[1]?1/0:-1/0:e[1]==t[1]?e[0]>t[0]?0:-0:(e[1]-t[1])/(e[0]-t[0])})},s=(t.normal=function(t,e){return-1/i(t,e)},t.lineLength=function(t,e){return n(t,e,function(t,e){return Math.sqrt(Math.pow(e[1]-t[1],2)+Math.pow(e[0]-t[0],2))})},t.quadrant=function(t,e){return n(t,e,function(t,e){return e[0]>t[0]?e[1]>t[1]?2:1:e[0]==t[0]?e[1]>t[1]?2:1:e[1]>t[1]?3:4})}),o=(t.theta=function(t,e){return n(t,e,function(t,e){var n=i(t,e),o=Math.atan(n),r=s(t,e);return(4==r||3==r)&&(o+=Math.PI),0>o&&(o+=2*Math.PI),o})},t.intersects=function(t,e){var n=t.x,i=t.x+t.w,s=t.y,o=t.y+t.h,r=e.x,a=e.x+e.w,u=e.y,l=e.y+e.h;return r>=n&&i>=r&&u>=s&&o>=u||a>=n&&i>=a&&u>=s&&o>=u||r>=n&&i>=r&&l>=s&&o>=l||a>=n&&i>=r&&l>=s&&o>=l||n>=r&&a>=n&&s>=u&&l>=s||i>=r&&a>=i&&s>=u&&l>=s||n>=r&&a>=n&&o>=u&&l>=o||i>=r&&a>=n&&o>=u&&l>=o},t.encloses=function(t,e,n){var i=t.x,s=t.x+t.w,o=t.y,r=t.y+t.h,a=e.x,u=e.x+e.w,l=e.y,c=e.y+e.h,h=function(t,e,i,s){return n?e>=t&&i>=s:e>t&&i>s};return h(i,a,s,u)&&h(o,l,r,c)},[null,[1,-1],[1,1],[-1,1],[-1,-1]]),r=[null,[-1,-1],[-1,1],[1,1],[1,-1]];t.pointOnLine=function(t,e,n){var a=i(t,e),u=s(t,e),l=n>0?o[u]:r[u],c=Math.atan(a),h=Math.abs(n*Math.sin(c))*l[1],d=Math.abs(n*Math.cos(c))*l[0];return{x:t.x+d,y:t.y+h}},t.perpendicularLineTo=function(t,e,n){var s=i(t,e),o=Math.atan(-1/s),r=n/2*Math.sin(o),a=n/2*Math.cos(o);return[{x:e.x+a,y:e.y+r},{x:e.x-a,y:e.y-r}]}}.call(this),function(){var t=function(t){return"[object Array]"===Object.prototype.toString.call(t)},e=function(t){return"[object Number]"===Object.prototype.toString.call(t)},n=function(t){return"string"==typeof t},i=function(t){return"boolean"==typeof t},s=function(t){return null==t},o=function(t){return null==t?!1:"[object Object]"===Object.prototype.toString.call(t)},r=function(t){return"[object Date]"===Object.prototype.toString.call(t)},a=function(t){return"[object Function]"===Object.prototype.toString.call(t)},u=function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},l=this,c=l.jsPlumbUtil={isArray:t,isString:n,isBoolean:i,isNull:s,isObject:o,isDate:r,isFunction:a,isEmpty:u,isNumber:e,clone:function(e){if(n(e))return""+e;if(i(e))return!!e;if(r(e))return new Date(e.getTime());if(a(e))return e;if(t(e)){for(var s=[],u=0;u<e.length;u++)s.push(this.clone(e[u]));return s}if(o(e)){var l={};for(var c in e)l[c]=this.clone(e[c]);return l}return e},merge:function(e,s,r){var a,u,l={};for(r=r||[],u=0;u<r.length;u++)l[r[u]]=!0;var c=this.clone(e);for(u in s)if(null==c[u])c[u]=s[u];else if(n(s[u])||i(s[u]))l[u]?(a=[],a.push.apply(a,t(c[u])?c[u]:[c[u]]),a.push.apply(a,t(s[u])?s[u]:[s[u]]),c[u]=a):c[u]=s[u];else if(t(s[u]))a=[],t(c[u])&&a.push.apply(a,c[u]),a.push.apply(a,s[u]),c[u]=a;else if(o(s[u])){o(c[u])||(c[u]={});for(var h in s[u])c[u][h]=s[u][h]}return c},replace:function(t,e,n){var i=t,s=i;return e.replace(/([^\.])+/g,function(t,e,i,o){var r=t.match(/([^\[0-9]+){1}(\[)([0-9+])/),a=i+t.length>=o.length,u=function(){return s[r[1]]||function(){return s[r[1]]=[],s[r[1]]}()};if(a)r?u()[r[3]]=n:s[t]=n;else if(r){var l=u();s=l[r[3]]||function(){return l[r[3]]={},l[r[3]]}()}else s=s[t]||function(){return s[t]={},s[t]}()}),t},functionChain:function(t,e,n){for(var i=0;i<n.length;i++){var s=n[i][0][n[i][1]].apply(n[i][0],n[i][2]);if(s===e)return s}return t},populate:function(e,i){var s=function(t){var e=t.match(/(\${.*?})/g);if(null!=e)for(var n=0;n<e.length;n++){var s=i[e[n].substring(2,e[n].length-1)]||"";null!=s&&(t=t.replace(e[n],s))}return t},r=function(e){if(null!=e){if(n(e))return s(e);if(t(e)){for(var i=[],a=0;a<e.length;a++)i.push(r(e[a]));return i}if(o(e)){var u={};for(var l in e)u[l]=r(e[l]);return u}return e}};return r(e)},convertStyle:function(t,e){if("transparent"===t)return t;var n=t,i=function(t){return 1==t.length?"0"+t:t},s=function(t){return i(Number(t).toString(16))},o=/(rgb[a]?\()(.*)(\))/;if(t.match(o)){var r=t.match(o)[2].split(",");n="#"+s(r[0])+s(r[1])+s(r[2]),e||4!=r.length||(n+=s(r[3]))}return n},findWithFunction:function(t,e){if(t)for(var n=0;n<t.length;n++)if(e(t[n]))return n;return-1},indexOf:function(t,e){return t.indexOf?t.indexOf(e):c.findWithFunction(t,function(t){return t==e})},removeWithFunction:function(t,e){var n=c.findWithFunction(t,e);return n>-1&&t.splice(n,1),-1!=n},remove:function(t,e){var n=c.indexOf(t,e);return n>-1&&t.splice(n,1),-1!=n},addWithFunction:function(t,e,n){-1==c.findWithFunction(t,n)&&t.push(e)},addToList:function(t,e,n,i){var s=t[e];return null==s&&(s=[],t[e]=s),s[i?"unshift":"push"](n),s},extend:function(e,n){var i;for(n=t(n)?n:[n],i=0;i<n.length;i++)for(var s in n[i].prototype)n[i].prototype.hasOwnProperty(s)&&(e.prototype[s]=n[i].prototype[s]);var o=function(t,e){return function(){for(i=0;i<n.length;i++)n[i].prototype[t]&&n[i].prototype[t].apply(this,arguments);return e.apply(this,arguments)}},r=function(t){for(var n in t)e.prototype[n]=o(n,t[n])};if(arguments.length>2)for(i=2;i<arguments.length;i++)r(arguments[i]);return e},uuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=0|16*Math.random(),n="x"==t?e:8|3&e;return n.toString(16)})},logEnabled:!0,log:function(){if(c.logEnabled&&"undefined"!=typeof console)try{var t=arguments[arguments.length-1];console.log(t)}catch(e){}},wrap:function(t,e,n){return t=t||function(){},e=e||function(){},function(){var i=null;try{i=e.apply(this,arguments)}catch(s){c.log("jsPlumb function failed : "+s)}if(null==n||i!==n)try{i=t.apply(this,arguments)}catch(s){c.log("wrapped function failed : "+s)}return i}}};c.EventGenerator=function(){var t={},e=!1,n={ready:!0};this.bind=function(e,n,i){return c.addToList(t,e,n,i),this},this.fire=function(i,s,o){if(!e&&t[i]){var r=t[i].length,a=0,u=!1,l=null;if(!this.shouldFireEvent||this.shouldFireEvent(i,s,o))for(;!u&&r>a&&l!==!1;){if(n[i])t[i][a].apply(this,[s,o]);else try{l=t[i][a].apply(this,[s,o])}catch(h){c.log("jsPlumb: fire failed for event "+i+" : "+h)}a++,(null==t||null==t[i])&&(u=!0)}}return this},this.unbind=function(e){return e?delete t[e]:t={},this},this.getListener=function(e){return t[e]},this.setSuspendEvents=function(t){e=t},this.isSuspendEvents=function(){return e},this.cleanupListeners=function(){for(var e in t)t[e]=null}},c.EventGenerator.prototype={cleanup:function(){this.cleanupListeners()}},Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),n=this,i=function(){},s=function(){return n.apply(this instanceof i&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return i.prototype=this.prototype,s.prototype=new i,s})}.call(this),function(){var t=this,e=t.jsPlumbUtil;e.ieVersion=/MSIE\s([\d.]+)/.test(navigator.userAgent)?new Number(RegExp.$1):-1,e.oldIE=e.ieVersion>-1&&e.ieVersion<9,e.matchesSelector=function(t,e,n){n=n||t.parentNode;for(var i=n.querySelectorAll(e),s=0;s<i.length;s++)if(i[s]===t)return!0;return!1},e.consume=function(t,e){t.stopPropagation?t.stopPropagation():t.returnValue=!1,!e&&t.preventDefault&&t.preventDefault()},e.sizeElement=function(t,e,n,i,s){t&&(t.style.height=s+"px",t.height=s,t.style.width=i+"px",t.width=i,t.style.left=e+"px",t.style.top=n+"px")}}.call(this),function(){var t=this,e=!!window.SVGAngle||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"),n=function(){if(void 0===n.vml){var t=document.body.appendChild(document.createElement("div"));t.innerHTML='<v:shape id="vml_flag1" adj="1" />';var e=t.firstChild;null!=e&&null!=e.style?(e.style.behavior="url(#default#VML)",n.vml=e?"object"==typeof e.adj:!0):n.vml=!1,t.parentNode.removeChild(t)}return n.vml},i=function(){var t=-1;if("Microsoft Internet Explorer"==navigator.appName){var e=navigator.userAgent,n=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");null!=n.exec(e)&&(t=parseFloat(RegExp.$1))}return t}(),s=i>-1&&9>i,o=function(t,e){if(null==t)return[0,0];var n=c(t),i=l(n,0);return[i[e+"X"],i[e+"Y"]]},r=function(t){return null==t?[0,0]:s?[t.clientX+document.documentElement.scrollLeft,t.clientY+document.documentElement.scrollTop]:o(t,"page")},a=function(t){return o(t,"screen")},u=function(t){return o(t,"client")},l=function(t,e){return t.item?t.item(e):t[e]},c=function(t){return t.touches&&t.touches.length>0?t.touches:t.changedTouches&&t.changedTouches.length>0?t.changedTouches:t.targetTouches&&t.targetTouches.length>0?t.targetTouches:[t]},h=function(t){var e={},n=[],i={},s={},o={};this.register=function(r){var a=t.getId(r),u=jsPlumbAdapter.getOffset(r,t);e[a]||(e[a]=r,n.push(r),i[a]={});var l=function(e){if(e)for(var n=0;n<e.childNodes.length;n++)if(3!=e.childNodes[n].nodeType&&8!=e.childNodes[n].nodeType){var r=jsPlumb.getElementObject(e.childNodes[n]),c=t.getId(e.childNodes[n],null,!0);if(c&&s[c]&&s[c]>0){var h=jsPlumbAdapter.getOffset(r,t);i[a][c]={id:c,offset:{left:h.left-u.left,top:h.top-u.top}},o[c]=a}l(e.childNodes[n])}};l(r)},this.updateOffsets=function(e){if(null!=e){var n=jsPlumb.getDOMElement(e),s=t.getId(n),r=i[s],a=jsPlumbAdapter.getOffset(n,t);if(r)for(var u in r){var l=jsPlumb.getElementObject(u),c=jsPlumbAdapter.getOffset(l,t);i[s][u]={id:u,offset:{left:c.left-a.left,top:c.top-a.top}},o[u]=s}}},this.endpointAdded=function(n){var r=document.body,a=t.getId(n),u=jsPlumbAdapter.getOffset(n,t),l=n.parentNode;for(s[a]=s[a]?s[a]+1:1;null!=l&&l!=r;){var c=t.getId(l,null,!0);if(c&&e[c]){var h=jsPlumbAdapter.getOffset(l,t);null==i[c][a]&&(i[c][a]={id:a,offset:{left:u.left-h.left,top:u.top-h.top}},o[a]=c);break}l=l.parentNode}},this.endpointDeleted=function(t){if(s[t.elementId]&&(s[t.elementId]--,s[t.elementId]<=0))for(var e in i)i[e]&&(delete i[e][t.elementId],delete o[t.elementId])},this.changeId=function(t,e){i[e]=i[t],i[t]={},o[e]=o[t],o[t]=null},this.getElementsForDraggable=function(t){return i[t]},this.elementRemoved=function(t){var e=o[t];e&&(delete i[e][t],delete o[t])},this.reset=function(){e={},n=[],i={},s={}},this.dragEnded=function(e){var n=t.getId(e),i=o[n];i&&this.updateOffsets(i)},this.setParent=function(e,n,s,r){var a=o[n];if(a){i[r]||(i[r]={}),i[r][n]=i[a][n],delete i[a][n];var u=jsPlumbAdapter.getOffset(s,t),l=jsPlumbAdapter.getOffset(e,t);i[r][n].offset={left:l.left-u.left,top:l.top-u.top},o[n]=r}},this.getDragAncestor=function(e){var n=jsPlumb.getDOMElement(e),i=t.getId(n),s=o[i];return s?jsPlumb.getDOMElement(s):null}};window.console||(window.console={time:function(){},timeEnd:function(){},group:function(){},groupEnd:function(){},log:function(){}});var d=function(t){return null==t?null:t.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},p=function(t,e){e=d(e),"undefined"!=typeof t.className.baseVal?t.className.baseVal=e:t.className=e},f=function(t){return"undefined"==typeof t.className.baseVal?t.className:t.className.baseVal},m=function(t,e,n){for(var i=jsPlumbUtil.isArray(n)?n:n.split(/\s+/),s=f(t),o=s.split(/\s+/),r=0;r<i.length;r++)if(e)-1==jsPlumbUtil.indexOf(o,i[r])&&o.push(i[r]);else{var a=jsPlumbUtil.indexOf(o,i[r]);-1!=a&&o.splice(a,1)}p(t,o.join(" "))},g=function(t,e){if(null!=t)if("string"==typeof t)e(jsPlumb.getDOMElement(t));else if(null!=t.length)for(var n=0;n<t.length;n++)e(jsPlumb.getDOMElement(t[n]));else e(t)};window.jsPlumbAdapter={headless:!1,pageLocation:r,screenLocation:a,clientLocation:u,getAttribute:function(t,e){return t.getAttribute(e)},setAttribute:function(t,e,n){t.setAttribute(e,n)},appendToRoot:function(t){document.body.appendChild(t)},getRenderModes:function(){return["svg","vml"]},isRenderModeAvailable:function(t){return{svg:e,vml:n()}[t]},getDragManager:function(t){return new h(t)},setRenderMode:function(t){var e;if(t){t=t.toLowerCase();var n=this.isRenderModeAvailable("svg"),i=this.isRenderModeAvailable("vml");"svg"===t&&n?e="svg":i&&(e="vml")}return e},addClass:function(t,e){g(t,function(t){m(t,!0,e)})},hasClass:function(t,e){return t=jsPlumb.getDOMElement(t),t.classList?t.classList.contains(e):-1!=f(t).indexOf(e)},removeClass:function(t,e){g(t,function(t){m(t,!1,e)})},setClass:function(t,e){g(t,function(t){p(t,e)})},setPosition:function(t,e){t.style.left=e.left+"px",t.style.top=e.top+"px"},getPosition:function(t){var e=function(e){var n=t.style[e];return n?n.substring(0,n.length-2):0};return{left:e("left"),top:e("top")}},getOffset:function(t,e,n){t=jsPlumb.getDOMElement(t);for(var i=e.getContainer(),s=t.offsetLeft,o=t.offsetTop,r=n||null!=i&&t.offsetParent!=i?t.offsetParent:null;null!=r;)s+=r.offsetLeft,o+=r.offsetTop,r=n?r.offsetParent:r.offsetParent==i?null:r.offsetParent;return{left:s,top:o}},getPositionOnElement:function(t,e,n){var i="undefined"!=typeof e.getBoundingClientRect?e.getBoundingClientRect():{left:0,top:0,width:0,height:0},s=document.body,o=document.documentElement,r=(e.offsetParent,window.pageYOffset||o.scrollTop||s.scrollTop),a=window.pageXOffset||o.scrollLeft||s.scrollLeft,u=o.clientTop||s.clientTop||0,l=o.clientLeft||s.clientLeft||0,c=0,h=0,d=i.top+r-u+c*n,p=i.left+a-l+h*n,f=jsPlumbAdapter.pageLocation(t),m=i.width||e.offsetWidth*n,g=i.height||e.offsetHeight*n,v=(f[0]-p)/m,b=(f[1]-d)/g;return[v,b]},getAbsolutePosition:function(t){var e=function(e){var n=t.style[e];return n?parseFloat(n.substring(0,n.length-2)):void 0};return[e("left"),e("top")]},setAbsolutePosition:function(e,n,i,s){i?t.jsPlumb.animate(e,{left:"+="+(n[0]-i[0]),top:"+="+(n[1]-i[1])},s):(e.style.left=n[0]+"px",e.style.top=n[1]+"px")}}}.call(this),function(){var t=jsPlumbUtil,e=function(t,e,n){return jsPlumbAdapter.getOffset(t,e,n)},n=function(){return""+(new Date).getTime()},i=function(t){if(t._jsPlumb.paintStyle&&t._jsPlumb.hoverPaintStyle){var e={};P.extend(e,t._jsPlumb.paintStyle),P.extend(e,t._jsPlumb.hoverPaintStyle),delete t._jsPlumb.hoverPaintStyle,e.gradient&&t._jsPlumb.paintStyle.fillStyle&&delete e.gradient,t._jsPlumb.hoverPaintStyle=e}},s=["click","dblclick","mouseenter","mouseout","mousemove","mousedown","mouseup","contextmenu"],o={mouseout:"mouseleave",mouseexit:"mouseleave"},r=function(t,e,n,i){var s=t.getAttachedElements();if(s)for(var o=0,r=s.length;r>o;o++)i&&i==s[o]||s[o].setHover(e,!0,n)},a=function(t){return null==t?null:t.split(" ")},u=function(e,n,i){if(e.getDefaultType){for(var s=e.getTypeDescriptor(),o=t.merge({},e.getDefaultType()),r=0,a=e._jsPlumb.types.length;a>r;r++)o=t.merge(o,e._jsPlumb.instance.getType(e._jsPlumb.types[r],s),["cssClass"]);n&&(o=t.populate(o,n)),e.applyType(o,i),i||e.repaint()}},l=window.jsPlumbUIComponent=function(e){jsPlumbUtil.EventGenerator.apply(this,arguments);
var n=this,i=arguments,r=n.idPrefix,a=r+(new Date).getTime();if(this._jsPlumb={instance:e._jsPlumb,parameters:e.parameters||{},paintStyle:null,hoverPaintStyle:null,paintStyleInUse:null,hover:!1,beforeDetach:e.beforeDetach,beforeDrop:e.beforeDrop,overlayPlacements:[],hoverClass:e.hoverClass||e._jsPlumb.Defaults.HoverClass,types:[]},this.getId=function(){return a},e.events)for(var u in e.events)n.bind(u,e.events[u]);this.clone=function(){var t={};return this.constructor.apply(t,i),t}.bind(this),this.isDetachAllowed=function(e){var n=!0;if(this._jsPlumb.beforeDetach)try{n=this._jsPlumb.beforeDetach(e)}catch(i){t.log("jsPlumb: beforeDetach callback failed",i)}return n},this.isDropAllowed=function(e,n,i,s,o,r,a){var u=this._jsPlumb.instance.checkCondition("beforeDrop",{sourceId:e,targetId:n,scope:i,connection:s,dropEndpoint:o,source:r,target:a});if(this._jsPlumb.beforeDrop)try{u=this._jsPlumb.beforeDrop({sourceId:e,targetId:n,scope:i,connection:s,dropEndpoint:o,source:r,target:a})}catch(l){t.log("jsPlumb: beforeDrop callback failed",l)}return u};var l=[],c=function(t,e,n){l.push([t,e,n]),t.bind(e,n)},h=[],d=function(t,e,n,i){var s=o[n]||n,r=function(t){i&&i(t)===!1||e.fire(s,e,t)};h.push([t,n,r,e]),e._jsPlumb.instance.on(t,n,r)},p=function(t,e,n,i){o[e]||e,i._jsPlumb.instance.off(t,e,n)};this.setListenerComponent=function(t){for(var e=0;e<h.length;e++)h[e][3]=t},this.bindListeners=function(t,e,n){c(t,"click",function(t,n){e.fire("click",e,n)}),c(t,"dblclick",function(t,n){e.fire("dblclick",e,n)}),c(t,"contextmenu",function(t,n){e.fire("contextmenu",e,n)}),c(t,"mouseleave",function(t,i){e.isHover()&&(n(!1),e.fire("mouseleave",e,i))}),c(t,"mouseenter",function(t,i){e.isHover()||(n(!0),e.fire("mouseenter",e,i))}),c(t,"mousedown",function(t,n){e.fire("mousedown",e,n)}),c(t,"mouseup",function(t,n){e.fire("mouseup",e,n)})},this.unbindListeners=function(){for(var t=0;t<l.length;t++){var e=l[t];e[0].unbind(e[1],e[2])}l=null},this.attachListeners=function(t,e,n){n=n||{};for(var i=0,o=s.length;o>i;i++)d(t,e,s[i],n[s[i]])},this.detachListeners=function(){for(var t=0;t<h.length;t++)p(h[t][0],h[t][1],h[t][2],h[t][3]);h=null},this.reattachListenersForElement=function(t){if(arguments.length>1){for(var e=0,n=s.length;n>e;e++)p(t,s[e]);for(e=1,n=arguments.length;n>e;e++)this.attachListeners(t,arguments[e])}}},c=function(t,e){var n=t._jsPlumb.types[e],i=t._jsPlumb.instance.getType(n,t.getTypeDescriptor());null!=i&&i.cssClass&&t.canvas&&t._jsPlumb.instance.removeClass(t.canvas,i.cssClass)};jsPlumbUtil.extend(l,jsPlumbUtil.EventGenerator,{getParameter:function(t){return this._jsPlumb.parameters[t]},setParameter:function(t,e){this._jsPlumb.parameters[t]=e},getParameters:function(){return this._jsPlumb.parameters},setParameters:function(t){this._jsPlumb.parameters=t},addClass:function(t){jsPlumbAdapter.addClass(this.canvas,t)},removeClass:function(t){jsPlumbAdapter.removeClass(this.canvas,t)},setType:function(t,e,n){this.clearTypes(),this._jsPlumb.types=a(t)||[],u(this,e,n)},getType:function(){return this._jsPlumb.types},reapplyTypes:function(t,e){u(this,t,e)},hasType:function(t){return-1!=jsPlumbUtil.indexOf(this._jsPlumb.types,t)},addType:function(t,e,n){var i=a(t),s=!1;if(null!=i){for(var o=0,r=i.length;r>o;o++)this.hasType(i[o])||(this._jsPlumb.types.push(i[o]),s=!0);s&&u(this,e,n)}},removeType:function(e,n){var i=a(e),s=!1,o=function(e){var n=t.indexOf(this._jsPlumb.types,e);return-1!=n?(c(this,n),this._jsPlumb.types.splice(n,1),!0):!1}.bind(this);if(null!=i){for(var r=0,l=i.length;l>r;r++)s=o(i[r])||s;s&&u(this,null,n)}},clearTypes:function(t){for(var e=this._jsPlumb.types.length,n=0;e>n;n++)c(this,0),this._jsPlumb.types.splice(0,1);u(this,{},t)},toggleType:function(t,e,n){var i=a(t);if(null!=i){for(var s=0,o=i.length;o>s;s++){var r=jsPlumbUtil.indexOf(this._jsPlumb.types,i[s]);-1!=r?(c(this,r),this._jsPlumb.types.splice(r,1)):this._jsPlumb.types.push(i[s])}u(this,e,n)}},applyType:function(t,e){if(this.setPaintStyle(t.paintStyle,e),this.setHoverPaintStyle(t.hoverPaintStyle,e),t.parameters)for(var n in t.parameters)this.setParameter(n,t.parameters[n])},setPaintStyle:function(t,e){this._jsPlumb.paintStyle=t,this._jsPlumb.paintStyleInUse=this._jsPlumb.paintStyle,i(this),e||this.repaint()},getPaintStyle:function(){return this._jsPlumb.paintStyle},setHoverPaintStyle:function(t,e){this._jsPlumb.hoverPaintStyle=t,i(this),e||this.repaint()},getHoverPaintStyle:function(){return this._jsPlumb.hoverPaintStyle},cleanup:function(){this.unbindListeners(),this.detachListeners()},destroy:function(){this.cleanupListeners(),this.clone=null,this._jsPlumb=null},isHover:function(){return this._jsPlumb.hover},setHover:function(t,e,i){if(this._jsPlumb&&!this._jsPlumb.instance.currentlyDragging&&!this._jsPlumb.instance.isHoverSuspended()){if(this._jsPlumb.hover=t,null!=this.canvas){if(null!=this._jsPlumb.instance.hoverClass){var s=t?"addClass":"removeClass";this._jsPlumb.instance[s](this.canvas,this._jsPlumb.instance.hoverClass)}null!=this._jsPlumb.hoverClass&&this._jsPlumb.instance[s](this.canvas,this._jsPlumb.hoverClass)}null!=this._jsPlumb.hoverPaintStyle&&(this._jsPlumb.paintStyleInUse=t?this._jsPlumb.hoverPaintStyle:this._jsPlumb.paintStyle,this._jsPlumb.instance.isSuspendDrawing()||(i=i||n(),this.repaint({timestamp:i,recalc:!1}))),this.getAttachedElements&&!e&&r(this,t,n(),this)}}});var h="__label",d=function(t,e){for(var n=-1,i=0,s=t._jsPlumb.overlays.length;s>i;i++)if(e===t._jsPlumb.overlays[i].id){n=i;break}return n},p=function(t,e){var n={cssClass:e.cssClass,labelStyle:t.labelStyle,id:h,component:t,_jsPlumb:t._jsPlumb.instance},i=P.extend(n,e);return new(P.Overlays[t._jsPlumb.instance.getRenderMode()].Label)(i)},f=function(e,n){var i=null;if(t.isArray(n)){var s=n[0],o=P.extend({component:e,_jsPlumb:e._jsPlumb.instance},n[1]);3==n.length&&P.extend(o,n[2]),i=new(P.Overlays[e._jsPlumb.instance.getRenderMode()][s])(o)}else i=n.constructor==String?new(P.Overlays[e._jsPlumb.instance.getRenderMode()][n])({component:e,_jsPlumb:e._jsPlumb.instance}):n;e._jsPlumb.overlays.push(i)},m=function(t,e){var n=t.defaultOverlayKeys||[],i=e.overlays,s=function(e){return t._jsPlumb.instance.Defaults[e]||P.Defaults[e]||[]};i||(i=[]);for(var o=0,r=n.length;r>o;o++)i.unshift.apply(i,s(n[o]));return i},g=window.OverlayCapableJsPlumbUIComponent=function(t){l.apply(this,arguments),this._jsPlumb.overlays=[];var e=m(this,t);if(e)for(var n=0,i=e.length;i>n;n++)f(this,e[n]);if(t.label){var s=t.labelLocation||this.defaultLabelLocation||.5,o=t.labelStyle||this._jsPlumb.instance.Defaults.LabelStyle;this._jsPlumb.overlays.push(p(this,{label:t.label,location:s,labelStyle:o}))}this.setListenerComponent=function(t){if(this._jsPlumb)for(var e=0;e<this._jsPlumb.overlays.length;e++)this._jsPlumb.overlays[e].setListenerComponent(t)}};jsPlumbUtil.extend(g,l,{applyType:function(t,e){if(this.removeAllOverlays(e),t.overlays)for(var n=0,i=t.overlays.length;i>n;n++)this.addOverlay(t.overlays[n],!0)},setHover:function(t){if(this._jsPlumb&&!this._jsPlumb.instance.isConnectionBeingDragged())for(var e=0,n=this._jsPlumb.overlays.length;n>e;e++)this._jsPlumb.overlays[e][t?"addClass":"removeClass"](this._jsPlumb.instance.hoverClass)},addOverlay:function(t,e){f(this,t),e||this.repaint()},getOverlay:function(t){var e=d(this,t);return e>=0?this._jsPlumb.overlays[e]:null},getOverlays:function(){return this._jsPlumb.overlays},hideOverlay:function(t){var e=this.getOverlay(t);e&&e.hide()},hideOverlays:function(){for(var t=0,e=this._jsPlumb.overlays.length;e>t;t++)this._jsPlumb.overlays[t].hide()},showOverlay:function(t){var e=this.getOverlay(t);e&&e.show()},showOverlays:function(){for(var t=0,e=this._jsPlumb.overlays.length;e>t;t++)this._jsPlumb.overlays[t].show()},removeAllOverlays:function(t){for(var e=0,n=this._jsPlumb.overlays.length;n>e;e++)this._jsPlumb.overlays[e].cleanup&&this._jsPlumb.overlays[e].cleanup();this._jsPlumb.overlays.splice(0,this._jsPlumb.overlays.length),this._jsPlumb.overlayPositions=null,t||this.repaint()},removeOverlay:function(t){var e=d(this,t);if(-1!=e){var n=this._jsPlumb.overlays[e];n.cleanup&&n.cleanup(),this._jsPlumb.overlays.splice(e,1),this._jsPlumb.overlayPositions&&delete this._jsPlumb.overlayPositions[t]}},removeOverlays:function(){for(var t=0,e=arguments.length;e>t;t++)this.removeOverlay(arguments[t])},moveParent:function(t){this.bgCanvas&&(this.bgCanvas.parentNode.removeChild(this.bgCanvas),t.appendChild(this.bgCanvas)),this.canvas.parentNode.removeChild(this.canvas),t.appendChild(this.canvas);for(var e=0;e<this._jsPlumb.overlays.length;e++)this._jsPlumb.overlays[e].isAppendedAtTopLevel&&(this._jsPlumb.overlays[e].canvas.parentNode.removeChild(this._jsPlumb.overlays[e].canvas),t.appendChild(this._jsPlumb.overlays[e].canvas))},getLabel:function(){var t=this.getOverlay(h);return null!=t?t.getLabel():null},getLabelOverlay:function(){return this.getOverlay(h)},setLabel:function(t){var e=this.getOverlay(h);if(e)t.constructor==String||t.constructor==Function?e.setLabel(t):(t.label&&e.setLabel(t.label),t.location&&e.setLocation(t.location));else{var n=t.constructor==String||t.constructor==Function?{label:t}:t;e=p(this,n),this._jsPlumb.overlays.push(e)}this._jsPlumb.instance.isSuspendDrawing()||this.repaint()},cleanup:function(){for(var t=0;t<this._jsPlumb.overlays.length;t++)this._jsPlumb.overlays[t].cleanup(),this._jsPlumb.overlays[t].destroy();this._jsPlumb.overlays.splice(0),this._jsPlumb.overlayPositions=null},setVisible:function(t){this[t?"showOverlays":"hideOverlays"]()},setAbsoluteOverlayPosition:function(t,e){this._jsPlumb.overlayPositions=this._jsPlumb.overlayPositions||{},this._jsPlumb.overlayPositions[t.id]=e},getAbsoluteOverlayPosition:function(t){return this._jsPlumb.overlayPositions?this._jsPlumb.overlayPositions[t.id]:null}});var v=0,b=function(){var t=v+1;return v++,t},y=window.jsPlumbInstance=function(i){this.Defaults={Anchor:"BottomCenter",Anchors:[null,null],ConnectionsDetachable:!0,ConnectionOverlays:[],Connector:"Bezier",Container:null,DoNotThrowErrors:!1,DragOptions:{},DropOptions:{},Endpoint:"Dot",EndpointOverlays:[],Endpoints:[null,null],EndpointStyle:{fillStyle:"#456"},EndpointStyles:[null,null],EndpointHoverStyle:null,EndpointHoverStyles:[null,null],HoverPaintStyle:null,LabelStyle:{color:"black"},LogEnabled:!1,Overlays:[],MaxConnections:1,PaintStyle:{lineWidth:8,strokeStyle:"#456"},ReattachConnections:!1,RenderMode:"svg",Scope:"jsPlumb_DefaultScope"},i&&P.extend(this.Defaults,i),this.logEnabled=this.Defaults.LogEnabled,this._connectionTypes={},this._endpointTypes={},jsPlumbUtil.EventGenerator.apply(this);var s=this,o=b(),r=s.bind,a={},u=1,c=function(t){var e=s.getDOMElement(t);return{el:e,id:jsPlumbUtil.isString(t)&&null==e?t:K(e)}};this.getInstanceIndex=function(){return o},this.setZoom=function(t,e){return jsPlumbUtil.oldIE||(u=t,s.fire("zoom",u),e&&s.repaintEverything()),!jsPlumbUtil.oldIE},this.getZoom=function(){return u};for(var h in this.Defaults)a[h]=this.Defaults[h];var d;this.setContainer=function(t){t=this.getDOMElement(t),this.select().each(function(e){e.moveParent(t)}),this.selectEndpoints().each(function(e){e.moveParent(t)}),d=t},this.getContainer=function(){return d},this.bind=function(t,e){"ready"===t&&f?e():r.apply(s,[t,e])},s.importDefaults=function(t){for(var e in t)s.Defaults[e]=t[e];return t.Container&&this.setContainer(t.Container),s},s.restoreDefaults=function(){return s.Defaults=P.extend({},a),s};var p=null,f=!1,m=[],g={},v={},y={},w={},j={},x={},E=!1,C=[],S=!1,_=null,k=this.Defaults.Scope,D=null,A=1,I=function(){return""+A++},O=function(t,e){d?d.appendChild(t):e?P.getDOMElement(e).appendChild(t):s.appendToRoot(t)},T=function(t){return t._nodes?t._nodes:t},$=function(t,e,i,o){if(!jsPlumbAdapter.headless&&!S){var r=K(t),a=s.dragManager.getElementsForDraggable(r);null==i&&(i=n());var u=Y({elId:r,offset:e,recalc:!1,timestamp:i});if(a)for(var l in a)Y({elId:a[l].id,offset:{left:u.o.left+a[l].offset.left,top:u.o.top+a[l].offset.top},recalc:!1,timestamp:i});if(s.anchorManager.redraw(r,e,i,null,o),a)for(var c in a)s.anchorManager.redraw(a[c].id,e,i,a[c].offset,o,!0)}},M=function(e,n){var i,o,r,a=null;if(t.isArray(e)){a=[];for(var u=0,l=e.length;l>u;u++)i=s.getElementObject(e[u]),r=s.getDOMElement(i),o=s.getAttribute(r,"id"),a.push(n.apply(s,[r,o]))}else i=s.getDOMElement(e),o=s.getId(i),a=n.apply(s,[i,o]);return a},N=function(t){return v[t]},R=function(e,n,i){if(!jsPlumbAdapter.headless){var o=null==n?!1:n;if(o&&P.isDragSupported(e,s)&&!P.isAlreadyDraggable(e,s)){var r=i||s.Defaults.DragOptions;r=P.extend({},r);var a=P.dragEvents.drag,u=P.dragEvents.stop,l=P.dragEvents.start,c=s.getDOMElement(e),h=s.dragManager.getDragAncestor(c),d={left:0,top:0},p=d,f=!1;r[l]=t.wrap(r[l],function(){return p=null!=h?jsPlumbAdapter.getOffset(h,s):d,s.setHoverSuspended(!0),s.select({source:e}).addClass(s.elementDraggingClass+" "+s.sourceElementDraggingClass,!0),s.select({target:e}).addClass(s.elementDraggingClass+" "+s.targetElementDraggingClass,!0),s.setConnectionBeingDragged(!0),r.canDrag?i.canDrag():void 0},!1),r[a]=t.wrap(r[a],function(){var t=s.getUIPosition(arguments,s.getZoom());t.left+=p.left,t.top+=p.top,$(e,t,null,!0),f&&s.addClass(e,"jsPlumb_dragged"),f=!0}),r[u]=t.wrap(r[u],function(){var t=s.getUIPosition(arguments,s.getZoom(),!0);$(e,t),f=!1,s.removeClass(e,"jsPlumb_dragged"),s.setHoverSuspended(!1),s.select({source:e}).removeClass(s.elementDraggingClass+" "+s.sourceElementDraggingClass,!0),s.select({target:e}).removeClass(s.elementDraggingClass+" "+s.targetElementDraggingClass,!0),s.setConnectionBeingDragged(!1),s.dragManager.dragEnded(e)});var m=K(e);x[m]=!0;var g=x[m];r.disabled=null==g?!1:!g,s.initDraggable(e,r,!1),s.dragManager.register(e)}}},L=function(e,n){var i=P.extend({},e);if(n&&P.extend(i,n),i.source&&(i.source.endpoint?i.sourceEndpoint=i.source:i.source=s.getDOMElement(i.source)),i.target&&(i.target.endpoint?i.targetEndpoint=i.target:i.target=s.getDOMElement(i.target)),e.uuids&&(i.sourceEndpoint=N(e.uuids[0]),i.targetEndpoint=N(e.uuids[1])),i.sourceEndpoint&&i.sourceEndpoint.isFull())return void t.log(s,"could not add connection; source endpoint is full");if(i.targetEndpoint&&i.targetEndpoint.isFull())return void t.log(s,"could not add connection; target endpoint is full");if(!i.type&&i.sourceEndpoint&&(i.type=i.sourceEndpoint.connectionType),i.sourceEndpoint&&i.sourceEndpoint.connectorOverlays){i.overlays=i.overlays||[];for(var o=0,r=i.sourceEndpoint.connectorOverlays.length;r>o;o++)i.overlays.push(i.sourceEndpoint.connectorOverlays[o])}!i["pointer-events"]&&i.sourceEndpoint&&i.sourceEndpoint.connectorPointerEvents&&(i["pointer-events"]=i.sourceEndpoint.connectorPointerEvents);var a,u,l,c=function(t,e){var n=P.extend({},t);for(var i in e)e[i]&&(n[i]=e[i]);return n},h=function(t,e,n){return s.addEndpoint(t,c(u.def,{anchor:i.anchors?i.anchors[n]:i.anchor,endpoint:i.endpoints?i.endpoints[n]:i.endpoint,paintStyle:i.endpointStyles?i.endpointStyles[n]:i.endpointStyle,hoverPaintStyle:i.endpointHoverStyles?i.endpointHoverStyles[n]:i.endpointHoverStyle}))};if(i.target&&!i.target.endpoint&&!i.targetEndpoint&&!i.newConnection&&(a=K(i.target),u=this.targetEndpointDefinitions[a])){if(!u.enabled)return;u.isTarget=!0,l=null!=u.endpoint&&u.endpoint._jsPlumb?u.endpoint:h(i.target,u.def,1),u.uniqueEndpoint&&(u.endpoint=l),i.targetEndpoint=l,l._doNotDeleteOnDetach=!1,l._deleteOnDetach=!0}if(i.source&&!i.source.endpoint&&!i.sourceEndpoint&&!i.newConnection&&(a=K(i.source),u=this.sourceEndpointDefinitions[a])){if(!u.enabled)return;l=null!=u.endpoint&&u.endpoint._jsPlumb?u.endpoint:h(i.source,u.def,0),u.uniqueEndpoint&&(u.endpoint=l),i.sourceEndpoint=l,l._doNotDeleteOnDetach=!1,l._deleteOnDetach=!0}return i}.bind(s),U=function(t){var e=s.Defaults.ConnectionType||s.getDefaultConnectionType();s.Defaults.EndpointType||P.Endpoint,t._jsPlumb=s,t.newConnection=U,t.newEndpoint=F,t.endpointsByUUID=v,t.endpointsByElement=g,t.finaliseConnection=B;var n=new e(t);return n.id="con_"+I(),z("click","click",n),z("dblclick","dblclick",n),z("contextmenu","contextmenu",n),n.isDetachable()&&(n.endpoints[0].initDraggable(),n.endpoints[1].initDraggable()),n},B=function(t,e,n,i){if(e=e||{},t.suspendedEndpoint||m.push(t),t.endpoints[0].isTemporarySource=!1,(null==t.suspendedEndpoint||i)&&s.anchorManager.newConnection(t),$(t.source),!e.doNotFireConnectionEvent&&e.fireEvent!==!1){var o={connection:t,source:t.source,target:t.target,sourceId:t.sourceId,targetId:t.targetId,sourceEndpoint:t.endpoints[0],targetEndpoint:t.endpoints[1]};s.fire("connection",o,n)}},z=function(t,e,n){n.bind(t,function(t,i){s.fire(e,n,i)})},F=function(t){var e=s.Defaults.EndpointType||P.Endpoint,n=P.extend({},t);n._jsPlumb=s,n.newConnection=U,n.newEndpoint=F,n.endpointsByUUID=v,n.endpointsByElement=g,n.finaliseConnection=B,n.fireDetachEvent=Z,n.fireMoveEvent=te,n.floatingConnections=j,n.elementId=K(n.source);var i=new e(n);return i.id="ep_"+I(),z("click","endpointClick",i),z("dblclick","endpointDblClick",i),z("contextmenu","contextmenu",i),jsPlumbAdapter.headless||s.dragManager.endpointAdded(n.source),i},H=function(t,e,n){var i=g[t];if(i&&i.length)for(var s=0,o=i.length;o>s;s++){for(var r=0,a=i[s].connections.length;a>r;r++){var u=e(i[s].connections[r]);if(u)return}n&&n(i[s])}},V=function(t,e){return M(t,function(t,n){x[n]=e,this.isDragSupported(t)&&this.setElementDraggable(t,e)})},q=function(t,e,n){e="block"===e;var i=null;n&&(i=e?function(t){t.setVisible(!0,!0,!0)}:function(t){t.setVisible(!1,!0,!0)});var s=c(t);H(s.id,function(t){if(e&&n){var i=t.sourceId===s.id?1:0;t.endpoints[i].isVisible()&&t.setVisible(!0)}else t.setVisible(e)},i)},W=function(t){return M(t,function(t,e){var n=null==x[e]?!1:x[e];return n=!n,x[e]=n,this.setDraggable(t,n),n})},G=function(t,e){var n=null;e&&(n=function(t){var e=t.isVisible();t.setVisible(!e)}),H(t,function(t){var e=t.isVisible();t.setVisible(!e)},n)},Y=this.updateOffset=function(t){var n,i=t.timestamp,o=t.recalc,r=t.offset,a=t.elId;return S&&!i&&(i=_),!o&&i&&i===w[a]?{o:t.offset||y[a],s:C[a]}:(o||!r?(n=document.getElementById(a),null!=n&&(C[a]=s.getSize(n),y[a]=e(n,s),w[a]=i)):(y[a]=r,null==C[a]&&(n=document.getElementById(a),null!=n&&(C[a]=s.getSize(n))),w[a]=i),y[a]&&!y[a].right&&(y[a].right=y[a].left+C[a][0],y[a].bottom=y[a].top+C[a][1],y[a].width=C[a][0],y[a].height=C[a][1],y[a].centerx=y[a].left+y[a].width/2,y[a].centery=y[a].top+y[a].height/2),{o:y[a],s:C[a]})},X=function(t){var e=y[t];return e?{o:e,s:C[t]}:Y({elId:t})},K=function(t,e,n){if(jsPlumbUtil.isString(t))return t;if(null==t)return null;var i=s.getAttribute(t,"id");return i&&"undefined"!==i||(2==arguments.length&&void 0!==arguments[1]?i=e:(1==arguments.length||3==arguments.length&&!arguments[2])&&(i="jsPlumb_"+o+"_"+I()),n||s.setAttribute(t,"id",i)),i};this.setConnectionBeingDragged=function(t){E=t},this.isConnectionBeingDragged=function(){return E},this.connectorClass="_jsPlumb_connector",this.hoverClass="_jsPlumb_hover",this.endpointClass="_jsPlumb_endpoint",this.endpointConnectedClass="_jsPlumb_endpoint_connected",this.endpointFullClass="_jsPlumb_endpoint_full",this.endpointDropAllowedClass="_jsPlumb_endpoint_drop_allowed",this.endpointDropForbiddenClass="_jsPlumb_endpoint_drop_forbidden",this.overlayClass="_jsPlumb_overlay",this.draggingClass="_jsPlumb_dragging",this.elementDraggingClass="_jsPlumb_element_dragging",this.sourceElementDraggingClass="_jsPlumb_source_element_dragging",this.targetElementDraggingClass="_jsPlumb_target_element_dragging",this.endpointAnchorClassPrefix="_jsPlumb_endpoint_anchor",this.hoverSourceClass="_jsPlumb_source_hover",this.hoverTargetClass="_jsPlumb_target_hover",this.dragSelectClass="_jsPlumb_drag_select",this.Anchors={},this.Connectors={svg:{},vml:{}},this.Endpoints={svg:{},vml:{}},this.Overlays={svg:{},vml:{}},this.ConnectorRenderers={},this.SVG="svg",this.VML="vml",this.addEndpoint=function(e,n,i){i=i||{};var o=P.extend({},i);P.extend(o,n),o.endpoint=o.endpoint||s.Defaults.Endpoint,o.paintStyle=o.paintStyle||s.Defaults.EndpointStyle,e=T(e);for(var r=[],a=t.isArray(e)||null!=e.length&&!t.isString(e)?e:[e],u=0,l=a.length;l>u;u++){var c=s.getDOMElement(a[u]),h=K(c);o.source=c,ge(o.source),Y({elId:h,timestamp:_});var d=F(o);o.parentAnchor&&(d.parentAnchor=o.parentAnchor),t.addToList(g,h,d);var p=y[h],f=C[h],m=d.anchor.compute({xy:[p.left,p.top],wh:f,element:d,timestamp:_}),v={anchorLoc:m,timestamp:_};S&&(v.recalc=!1),S||d.paint(v),r.push(d),d._doNotDeleteOnDetach=!0}return 1==r.length?r[0]:r},this.addEndpoints=function(e,n,i){for(var o=[],r=0,a=n.length;a>r;r++){var u=s.addEndpoint(e,n[r],i);t.isArray(u)?Array.prototype.push.apply(o,u):o.push(u)}return o},this.animate=function(e,n,i){i=i||{};var o=this.getElementObject(e),r=this.getDOMElement(e),a=K(r),u=P.animEvents.step,l=P.animEvents.complete;i[u]=t.wrap(i[u],function(){s.repaint(a)}),i[l]=t.wrap(i[l],function(){s.repaint(a)}),s.doAnimate(o,n,i)},this.checkCondition=function(e,n){var i=s.getListener(e),o=!0;if(i&&i.length>0)try{for(var r=0,a=i.length;a>r;r++)o=o&&i[r](n)}catch(u){t.log(s,"cannot check condition ["+e+"]"+u)}return o},this.checkASyncCondition=function(e,n,i,o){var r=s.getListener(e);if(r&&r.length>0)try{r[0](n,i,o)}catch(a){t.log(s,"cannot asynchronously check condition ["+e+"]"+a)}},this.connect=function(t,e){var n,i=L(t,e);return i&&(ge(i.source),n=U(i),B(n,i)),n};var J=[{el:"source",elId:"sourceId",epDefs:"sourceEndpointDefinitions"},{el:"target",elId:"targetId",epDefs:"targetEndpointDefinitions"}],Q=function(t,e,n,i){var s,o,r,a=J[n],u=t[a.elId],l=(t[a.el],t.endpoints[n]),c={index:n,originalSourceId:0===n?u:t.sourceId,newSourceId:t.sourceId,originalTargetId:1==n?u:t.targetId,newTargetId:t.targetId,connection:t};if(e.constructor==P.Endpoint)s=e,s.addConnection(t);else if(o=K(e),r=this[a.epDefs][o],o===t[a.elId])s=null;else if(r){if(!r.enabled)return;s=null!=r.endpoint&&r.endpoint._jsPlumb?r.endpoint:this.addEndpoint(e,r.def),r.uniqueEndpoint&&(r.endpoint=s),s._doNotDeleteOnDetach=!1,s._deleteOnDetach=!0,s.addConnection(t)}else s=t.makeEndpoint(0===n,e,o),s._doNotDeleteOnDetach=!1,s._deleteOnDetach=!0;return null!=s&&(l.detachFromConnection(t),t.endpoints[n]=s,t[a.el]=s.element,t[a.elId]=s.elementId,c[0===n?"newSourceId":"newTargetId"]=s.elementId,te(c),i||t.repaint()),c}.bind(this);this.setSource=function(t,e,n){var i=Q(t,e,0,n);this.anchorManager.sourceChanged(i.originalSourceId,i.newSourceId,t)},this.setTarget=function(t,e,n){var i=Q(t,e,1,n);this.anchorManager.updateOtherEndpoint(i.originalSourceId,i.originalTargetId,i.newTargetId,t)},this.deleteEndpoint=function(t,e){var n=s.setSuspendDrawing(!0),i="string"==typeof t?v[t]:t;return i&&s.deleteObject({endpoint:i}),n||s.setSuspendDrawing(!1,e),s},this.deleteEveryEndpoint=function(){var t=s.setSuspendDrawing(!0);for(var e in g){var n=g[e];if(n&&n.length)for(var i=0,o=n.length;o>i;i++)s.deleteEndpoint(n[i],!0)}return g={},v={},s.anchorManager.reset(),s.dragManager.reset(),t||s.setSuspendDrawing(!1),s};var Z=function(t,e,n){var i=s.Defaults.ConnectionType||s.getDefaultConnectionType(),o=t.constructor==i,r=o?{connection:t,source:t.source,target:t.target,sourceId:t.sourceId,targetId:t.targetId,sourceEndpoint:t.endpoints[0],targetEndpoint:t.endpoints[1]}:t;e&&s.fire("connectionDetached",r,n),s.anchorManager.connectionDetached(r)},te=function(t,e){s.fire("connectionMoved",t,e)};this.unregisterEndpoint=function(t){t._jsPlumb.uuid&&(v[t._jsPlumb.uuid]=null),s.anchorManager.deleteEndpoint(t);for(var e in g){var n=g[e];if(n){for(var i=[],o=0,r=n.length;r>o;o++)n[o]!=t&&i.push(n[o]);g[e]=i}g[e].length<1&&delete g[e]}},this.detach=function(){if(0!==arguments.length){var t=s.Defaults.ConnectionType||s.getDefaultConnectionType(),e=arguments[0].constructor==t,n=2==arguments.length&&e?arguments[1]||{}:arguments[0],i=n.fireEvent!==!1,o=n.forceDetach,r=e?arguments[0]:n.connection;if(r)(o||jsPlumbUtil.functionChain(!0,!1,[[r.endpoints[0],"isDetachAllowed",[r]],[r.endpoints[1],"isDetachAllowed",[r]],[r,"isDetachAllowed",[r]],[s,"checkCondition",["beforeDetach",r]]]))&&r.endpoints[0].detach(r,!1,!0,i);else{var a=P.extend({},n);if(a.uuids)N(a.uuids[0]).detachFrom(N(a.uuids[1]),i);else if(a.sourceEndpoint&&a.targetEndpoint)a.sourceEndpoint.detachFrom(a.targetEndpoint);else{var u=K(s.getDOMElement(a.source)),l=K(s.getDOMElement(a.target));H(u,function(t){(t.sourceId==u&&t.targetId==l||t.targetId==u&&t.sourceId==l)&&s.checkCondition("beforeDetach",t)&&t.endpoints[0].detach(t,!1,!0,i)})}}}},this.detachAllConnections=function(t,e){e=e||{},t=s.getDOMElement(t);var n=K(t),i=g[n];if(i&&i.length)for(var o=0,r=i.length;r>o;o++)i[o].detachAll(e.fireEvent!==!1);return s},this.detachEveryConnection=function(t){return t=t||{},s.doWhileSuspended(function(){for(var e in g){var n=g[e];if(n&&n.length)for(var i=0,s=n.length;s>i;i++)n[i].detachAll(t.fireEvent!==!1)}m.splice(0)}),s},this.deleteObject=function(t){var e={endpoints:{},connections:{},endpointCount:0,connectionCount:0},n=t.fireEvent!==!1,i=t.deleteAttachedObjects!==!1,o=function(t){if(null!=t&&null==e.connections[t.id]&&(null!=t._jsPlumb&&t.setHover(!1),e.connections[t.id]=t,e.connectionCount++,i))for(var n=0;n<t.endpoints.length;n++)t.endpoints[n]._deleteOnDetach&&r(t.endpoints[n])},r=function(t){if(null!=t&&null==e.endpoints[t.id]&&(null!=t._jsPlumb&&t.setHover(!1),e.endpoints[t.id]=t,e.endpointCount++,i))for(var n=0;n<t.connections.length;n++){var s=t.connections[n];o(s)}};t.connection?o(t.connection):r(t.endpoint);for(var a in e.connections){var u=e.connections[a];u._jsPlumb&&(jsPlumbUtil.removeWithFunction(m,function(t){return u.id==t.id}),Z(u,n,t.originalEvent),u.endpoints[0].detachFromConnection(u),u.endpoints[1].detachFromConnection(u),u.cleanup(),u.destroy())}for(var l in e.endpoints){var c=e.endpoints[l];c._jsPlumb&&(s.unregisterEndpoint(c),c.cleanup(),c.destroy())}return e},this.draggable=function(t,e){var n,i,o;if("object"==typeof t&&t.length)for(n=0,i=t.length;i>n;n++)o=s.getDOMElement(t[n]),o&&R(o,!0,e);else if(t._nodes)for(n=0,i=t._nodes.length;i>n;n++)o=s.getDOMElement(t._nodes[n]),o&&R(o,!0,e);else o=s.getDOMElement(t),o&&R(o,!0,e);return s};var ee=function(t,e,n,i){for(var s=0,o=t.length;o>s;s++)t[s][e].apply(t[s],n);return i(t)},ne=function(t,e,n){for(var i=[],s=0,o=t.length;o>s;s++)i.push([t[s][e].apply(t[s],n),t[s]]);return i},ie=function(t,e,n){return function(){return ee(t,e,arguments,n)}},se=function(t,e){return function(){return ne(t,e,arguments)}},oe=function(t,e){var n=[];if(t)if("string"==typeof t){if("*"===t)return t;n.push(t)}else if(e)n=t;else if(t.length)for(var i=0,s=t.length;s>i;i++)n.push(c(t[i]).id);else n.push(c(t).id);return n},re=function(t,e,n){return"*"===t?!0:t.length>0?-1!=jsPlumbUtil.indexOf(t,e):!n};this.getConnections=function(t,e){t?t.constructor==String&&(t={scope:t}):t={};for(var n=t.scope||s.getDefaultScope(),i=oe(n,!0),o=oe(t.source),r=oe(t.target),a=!e&&i.length>1?{}:[],u=function(t,n){if(!e&&i.length>1){var s=a[t];null==s&&(s=a[t]=[]),s.push(n)}else a.push(n)},l=0,c=m.length;c>l;l++){var h=m[l];re(i,h.scope)&&re(o,h.sourceId)&&re(r,h.targetId)&&u(h.scope,h)}return a};var ae=function(t,e){return function(n){for(var i=0,s=t.length;s>i;i++)n(t[i]);return e(t)}},ue=function(t){return function(e){return t[e]}},le=function(t,e){var n,i,s={length:t.length,each:ae(t,e),get:ue(t)},o=["setHover","removeAllOverlays","setLabel","addClass","addOverlay","removeOverlay","removeOverlays","showOverlay","hideOverlay","showOverlays","hideOverlays","setPaintStyle","setHoverPaintStyle","setSuspendEvents","setParameter","setParameters","setVisible","repaint","addType","toggleType","removeType","removeClass","setType","bind","unbind"],r=["getLabel","getOverlay","isHover","getParameter","getParameters","getPaintStyle","getHoverPaintStyle","isVisible","hasType","getType","isSuspendEvents"];for(n=0,i=o.length;i>n;n++)s[o[n]]=ie(t,o[n],e);for(n=0,i=r.length;i>n;n++)s[r[n]]=se(t,r[n]);return s},ce=function(t){var e=le(t,ce);return P.extend(e,{setDetachable:ie(t,"setDetachable",ce),setReattach:ie(t,"setReattach",ce),setConnector:ie(t,"setConnector",ce),detach:function(){for(var e=0,n=t.length;n>e;e++)s.detach(t[e])},isDetachable:se(t,"isDetachable"),isReattach:se(t,"isReattach")})},he=function(t){var e=le(t,he);return P.extend(e,{setEnabled:ie(t,"setEnabled",he),setAnchor:ie(t,"setAnchor",he),isEnabled:se(t,"isEnabled"),detachAll:function(){for(var e=0,n=t.length;n>e;e++)t[e].detachAll()},remove:function(){for(var e=0,n=t.length;n>e;e++)s.deleteObject({endpoint:t[e]})}})};this.select=function(t){return t=t||{},t.scope=t.scope||"*",ce(t.connections||s.getConnections(t,!0))},this.selectEndpoints=function(t){t=t||{},t.scope=t.scope||"*";var e=!t.element&&!t.source&&!t.target,n=e?"*":oe(t.element),i=e?"*":oe(t.source),s=e?"*":oe(t.target),o=oe(t.scope,!0),r=[];for(var a in g){var u=re(n,a,!0),l=re(i,a,!0),c="*"!=i,h=re(s,a,!0),d="*"!=s;if(u||l||h)t:for(var p=0,f=g[a].length;f>p;p++){var m=g[a][p];if(re(o,m.scope,!0)){var v=c&&i.length>0&&!m.isSource,b=d&&s.length>0&&!m.isTarget;if(v||b)continue t;r.push(m)}}}return he(r)},this.getAllConnections=function(){return m},this.getDefaultScope=function(){return k},this.getEndpoint=N,this.getEndpoints=function(t){return g[c(t).id]},this.getDefaultEndpointType=function(){return P.Endpoint},this.getDefaultConnectionType=function(){return P.Connection},this.getId=K,this.getOffset=function(t){return y[t],Y({elId:t})},this.appendElement=O;var de=!1;this.isHoverSuspended=function(){return de},this.setHoverSuspended=function(t){de=t};var pe=function(t){return function(){return jsPlumbAdapter.isRenderModeAvailable(t)}};this.isSVGAvailable=pe("svg"),this.isVMLAvailable=pe("vml"),this.hide=function(t,e){return q(t,"none",e),s},this.idstamp=I,this.connectorsInitialized=!1;var fe=[],me=["svg","vml"];this.registerConnectorType=function(t,e){fe.push([t,e])};var ge=function(t){if(!d&&t){var e=s.getDOMElement(t);e.offsetParent&&(d=e.offsetParent)}},ve=function(){s.Defaults.Container&&(d=s.getDOMElement(s.Defaults.Container))};this.init=function(){var t=function(t,e,n){P.Connectors[t][e]=function(){n.apply(this,arguments),P.ConnectorRenderers[t].apply(this,arguments)},jsPlumbUtil.extend(P.Connectors[t][e],[n,P.ConnectorRenderers[t]])};if(!P.connectorsInitialized){for(var e=0;e<fe.length;e++)for(var n=0;n<me.length;n++)t(me[n],fe[e][1],fe[e][0]);P.connectorsInitialized=!0}f||(ve(),s.anchorManager=new P.AnchorManager({jsPlumbInstance:s}),s.setRenderMode(s.Defaults.RenderMode),f=!0,s.fire("ready",s))}.bind(this),this.log=p,this.jsPlumbUIComponent=l,this.makeAnchor=function(){var e,n=function(t,e){if(P.Anchors[t])return new P.Anchors[t](e);if(!s.Defaults.DoNotThrowErrors)throw{msg:"jsPlumb: unknown anchor type '"+t+"'"}};if(0===arguments.length)return null;var i=arguments[0],o=arguments[1],r=arguments[2],a=null;if(i.compute&&i.getOrientation)return i;if("string"==typeof i)a=n(arguments[0],{elementId:o,jsPlumbInstance:s});else if(t.isArray(i))if(t.isArray(i[0])||t.isString(i[0]))2==i.length&&t.isObject(i[1])?t.isString(i[0])?(e=P.extend({elementId:o,jsPlumbInstance:s},i[1]),a=n(i[0],e)):(e=P.extend({elementId:o,jsPlumbInstance:s,anchors:i[0]},i[1]),a=new P.DynamicAnchor(e)):a=new P.DynamicAnchor({anchors:i,selector:null,elementId:o,jsPlumbInstance:r});else{var u={x:i[0],y:i[1],orientation:i.length>=4?[i[2],i[3]]:[0,0],offsets:i.length>=6?[i[4],i[5]]:[0,0],elementId:o,jsPlumbInstance:r,cssClass:7==i.length?i[6]:null};a=new P.Anchor(u),a.clone=function(){return new P.Anchor(u)}}return a.id||(a.id="anchor_"+I()),a},this.makeAnchors=function(e,n,i){for(var o=[],r=0,a=e.length;a>r;r++)"string"==typeof e[r]?o.push(P.Anchors[e[r]]({elementId:n,jsPlumbInstance:i})):t.isArray(e[r])&&o.push(s.makeAnchor(e[r],n,i));return o},this.makeDynamicAnchor=function(t,e){return new P.DynamicAnchor({anchors:t,selector:e,elementId:null,jsPlumbInstance:s})},this.targetEndpointDefinitions={};var be=function(t,e,n){t.paintStyle=t.paintStyle||n.Defaults.EndpointStyles[e]||n.Defaults.EndpointStyle,t.hoverPaintStyle=t.hoverPaintStyle||n.Defaults.EndpointHoverStyles[e]||n.Defaults.EndpointHoverStyle,t.anchor=t.anchor||n.Defaults.Anchors[e]||n.Defaults.Anchor,t.endpoint=t.endpoint||n.Defaults.Endpoints[e]||n.Defaults.Endpoint
};this.sourceEndpointDefinitions={};var ye=function(t,e,n,i,s){for(var o=t.target||t.srcElement,r=!1,a=i.getSelector(e,n),u=0;u<a.length;u++)if(a[u]==o){r=!0;break}return s?!r:r};this.makeTarget=function(n,i,o){var r=P.extend({_jsPlumb:this},o);P.extend(r,i),be(r,1,this);var a=r.scope||s.Defaults.Scope,u=!(r.deleteEndpointsOnDetach===!1),h=r.maxConnections||-1,d=r.onMaxConnections,p=function(n){var i=c(n),s=i.id,o=new l(r),p=P.extend({},r.dropOptions||{});ge(s),this.targetEndpointDefinitions[s]={def:r,uniqueEndpoint:r.uniqueEndpoint,maxConnections:h,enabled:!0};var f=function(){this.currentlyDragging=!1;var t=this.getDropEvent(arguments),n=this.select({target:s}).length,a=this.getDOMElement(this.getDragObject(arguments)),l=this.getAttribute(a,"dragId"),c=this.getAttribute(a,"originalScope"),h=j[l];if(null!=h){var p=h.endpoints[0].isFloating()?0:1,f=h.endpoints[0],m=(r.endpoint?P.extend({},r.endpoint):{},this.targetEndpointDefinitions[s]);if(!m.enabled||m.maxConnections>0&&n>=m.maxConnections)return d&&d({element:i.el,connection:h},t),!1;if(f.anchor.locked=!1,c&&this.setDragScope(a,c),null==h.suspendedEndpoint&&!h.pending)return!1;var g=o.isDropAllowed(0===p?s:h.sourceId,0===p?h.targetId:s,h.scope,h,null,0===p?i.el:h.source,0===p?h.target:i.el);if(h.suspendedEndpoint){h[p?"targetId":"sourceId"]=h.suspendedEndpoint.elementId,h[p?"target":"source"]=h.suspendedEndpoint.element,h.endpoints[p]=h.suspendedEndpoint;var v=(h.suspendedEndpoint.getElement(),h.suspendedEndpoint.elementId);te({index:p,originalSourceId:0===p?v:h.sourceId,newSourceId:0===p?s:h.sourceId,originalTargetId:1==p?v:h.targetId,newTargetId:1==p?s:h.targetId,connection:h},t)}if(g){var b=this.getElementObject(i.el),y=m.endpoint;if((null==y||null==y._jsPlumb)&&(y=this.addEndpoint(b,r)),r.uniqueEndpoint&&(m.endpoint=y),y._doNotDeleteOnDetach=!1,y._deleteOnDetach=!0,h.isDetachable()&&y.initDraggable(),null!=y.anchor.positionFinder){var w=this.getUIPosition(arguments,this.getZoom()),x=e(b,this),E=this.getSize(b),C=y.anchor.positionFinder(w,x,E,y.anchor.constructorParams);y.anchor.x=C[0],y.anchor.y=C[1]}h[p?"target":"source"]=y.element,h[p?"targetId":"sourceId"]=y.elementId,h.endpoints[p].detachFromConnection(h),h.endpoints[p]._deleteOnDetach&&(h.endpoints[p].deleteAfterDragStop=!0),y.addConnection(h),h.endpoints[p]=y,h.deleteEndpointsOnDetach=u,1==p?this.anchorManager.updateOtherEndpoint(h.sourceId,h.suspendedElementId,h.targetId,h):this.anchorManager.sourceChanged(h.suspendedEndpoint.elementId,h.sourceId,h),B(h,null,t),h.pending=!1}else h.suspendedEndpoint&&(h.isReattach()?(h.setHover(!1),h.floatingAnchorIndex=null,h.suspendedEndpoint.addConnection(h),this.repaint(f.elementId)):h.deleteConnectionNow=!0)}}.bind(this),m=P.dragEvents.drop;p.scope=p.scope||a,p[m]=t.wrap(p[m],f),r.allowLoopback===!1&&(p.canDrop=function(t){var e=t.getDragElement()._jsPlumbRelatedElement;return e!=i.el}),this.initDroppable(this.getElementObject(i.el),p,!0)}.bind(this);n=T(n);for(var f=n.length&&n.constructor!=String?n:[n],m=0,g=f.length;g>m;m++)p(f[m]);return this},this.unmakeTarget=function(t,e){var n=c(t);return P.destroyDroppable(n.el),e||delete this.targetEndpointDefinitions[n.id],this},this.makeSource=function(n,i,o){var r=P.extend({},o);P.extend(r,i),be(r,0,this);var a=r.maxConnections||1,l=r.onMaxConnections,h=function(n){var i=n.id,o=this.getElementObject(n.el),c=this.getDOMElement(o),h=function(){return null==r.parent?null:"parent"===r.parent?n.el.parentNode:s.getDOMElement(r.parent)},p=null!=r.parent?this.getId(h()):i;ge(p),this.sourceEndpointDefinitions[p]={def:r,uniqueEndpoint:r.uniqueEndpoint,maxConnections:a,enabled:!0};var f=P.dragEvents.stop,m=P.dragEvents.drag,g=P.extend({},r.dragOptions||{}),v=g.drag,b=g.stop,y=null,w=!1;g.scope=g.scope||r.scope,g[m]=t.wrap(g[m],function(){v&&v.apply(this,arguments),w=!1}),g[f]=t.wrap(g[f],function(){if(b&&b.apply(this,arguments),this.currentlyDragging=!1,null!=y._jsPlumb){var t=r.anchor||this.Defaults.Anchor,n=y.anchor,s=y.connections[0],o=this.makeAnchor(t,i,this),a=y.element;if(null!=o.positionFinder){var u=e(a,this),l=this.getSize(a),c={left:u.left+n.x*l[0],top:u.top+n.y*l[1]},p=o.positionFinder(c,u,l,o.constructorParams);o.x=p[0],o.y=p[1]}if(y.setAnchor(o,!0),r.parent){var f=h();if(f){var m=r.container||d;y.setElement(f,m)}}y.repaint(),this.repaint(y.elementId),this.repaint(s.targetId)}}.bind(this));var j=function(t){var e=this.getOriginalEvent(t),n=this.sourceEndpointDefinitions[p];if(i=this.getId(this.getDOMElement(o)),n.enabled){if(r.filter){var d=jsPlumbUtil.isString(r.filter)?ye(e,o,r.filter,this,r.filterExclude):r.filter(e,o);if(d===!1)return}var f=this.select({source:p}).length;if(n.maxConnections>=0&&n.uniqueEndpoint&&f>=n.maxConnections)return l&&l({element:o,maxConnections:a},t),!1;var m=jsPlumbAdapter.getPositionOnElement(e,c,u),v=m;r.parent&&(v=jsPlumbAdapter.getPositionOnElement(e,h(),u));var b={};P.extend(b,r),b.isTemporarySource=!0,b.anchor=[m[0],m[1],0,0],b.parentAnchor=[v[0],v[1],0,0],b.dragOptions=g,y=this.addEndpoint(i,b),w=!0,y.endpointWillMoveTo=r.parent?h():null,y._doNotDeleteOnDetach=!1,y._deleteOnDetach=!0;var j=function(){w&&(w=!1,s.deleteEndpoint(y))};s.registerListener(y.canvas,"mouseup",j),s.registerListener(o,"mouseup",j),s.trigger(y.canvas,"mousedown",t),jsPlumbUtil.consume(t)}}.bind(this);this.registerListener(o,"mousedown",j),this.sourceEndpointDefinitions[p].trigger=j,r.filter&&jsPlumbUtil.isString(r.filter)&&s.setDragFilter(o,r.filter)}.bind(this);n=T(n);for(var p=n.length&&n.constructor!=String?n:[n],f=0,m=p.length;m>f;f++)h(c(p[f]));return this},this.unmakeSource=function(t,e){var n=c(t),i=this.sourceEndpointDefinitions[n.id].trigger;return i&&s.unregisterListener(n.el,"mousedown",i),e||delete this.sourceEndpointDefinitions[n.id],this},this.unmakeEverySource=function(){for(var t in this.sourceEndpointDefinitions)s.unmakeSource(t,!0);return this.sourceEndpointDefinitions={},this},this.unmakeEveryTarget=function(){for(var t in this.targetEndpointDefinitions)s.unmakeTarget(t,!0);return this.targetEndpointDefinitions={},this};var Pe=function(e,n,i,s){var o="source"==e?this.sourceEndpointDefinitions:this.targetEndpointDefinitions;if(n=T(n),t.isString(n))o[n].enabled=s?!o[n].enabled:i;else if(n.length)for(var r=0,a=n.length;a>r;r++){var u=c(n[r]);o[u.id]&&(o[u.id].enabled=s?!o[u.id].enabled:i)}else{var l=c(n).id;o[l].enabled=s?!o[l].enabled:i}return this}.bind(this),we=function(e,n){return e=T(e),t.isString(e)||!e.length?n.apply(this,[e]):e.length?n.apply(this,[e[0]]):void 0}.bind(this);this.toggleSourceEnabled=function(t){return Pe("source",t,null,!0),this.isSourceEnabled(t)},this.setSourceEnabled=function(t,e){return Pe("source",t,e)},this.isSource=function(t){return we(t,function(t){return null!=this.sourceEndpointDefinitions[c(t).id]})},this.isSourceEnabled=function(t){return we(t,function(t){var e=this.sourceEndpointDefinitions[c(t).id];return e&&e.enabled===!0})},this.toggleTargetEnabled=function(t){return Pe("target",t,null,!0),this.isTargetEnabled(t)},this.isTarget=function(t){return we(t,function(t){return null!=this.targetEndpointDefinitions[c(t).id]})},this.isTargetEnabled=function(t){return we(t,function(t){var e=this.targetEndpointDefinitions[c(t).id];return e&&e.enabled===!0})},this.setTargetEnabled=function(t,e){return Pe("target",t,e)},this.ready=function(t){s.bind("ready",t)},this.repaint=function(t,e,n){if("object"==typeof t&&t.length)for(var i=0,o=t.length;o>i;i++)$(t[i],e,n);else $(t,e,n);return s},this.repaintEverything=function(t){var e=n();for(var i in g)$(i,null,e,t);return this},this.removeAllEndpoints=function(t,e){var n=function(t){var i,o,r=c(t),a=g[r.id];if(a)for(i=0,o=a.length;o>i;i++)s.deleteEndpoint(a[i]);if(delete g[r.id],e&&r.el&&3!=r.el.nodeType&&8!=r.el.nodeType)for(i=0,o=r.el.childNodes.length;o>i;i++)n(r.el.childNodes[i])};return n(t),this},this.remove=function(t,e){var n=c(t);return s.doWhileSuspended(function(){s.removeAllEndpoints(n.id,!0),s.dragManager.elementRemoved(n.id),delete j[n.id],s.anchorManager.clearFor(n.id),s.anchorManager.removeFloatingConnection(n.id)},e===!1),n.el&&s.removeElement(n.el),s};var je={},xe=function(){for(var t in je)for(var e=0,n=je[t].length;n>e;e++){var i=je[t][e];s.off(i.el,i.event,i.listener)}je={}};this.registerListener=function(t,e,n){s.on(t,e,n),jsPlumbUtil.addToList(je,e,{el:t,event:e,listener:n})},this.unregisterListener=function(t,e,n){s.off(t,e,n),jsPlumbUtil.removeWithFunction(je,function(t){return t.type==e&&t.listener==n})},this.reset=function(){s.deleteEveryEndpoint(),s.unbind(),this.targetEndpointDefinitions={},this.sourceEndpointDefinitions={},m.splice(0),xe(),s.anchorManager.reset(),jsPlumbAdapter.headless||s.dragManager.reset()},this.setDefaultScope=function(t){return k=t,s},this.setDraggable=V,this.setId=function(t,e,n){var i;jsPlumbUtil.isString(t)?i=t:(t=this.getDOMElement(t),i=this.getId(t));var s=this.getConnections({source:i,scope:"*"},!0),o=this.getConnections({target:i,scope:"*"},!0);e=""+e,n?t=this.getDOMElement(e):(t=this.getDOMElement(i),this.setAttribute(t,"id",e)),g[e]=g[i]||[];for(var r=0,a=g[e].length;a>r;r++)g[e][r].setElementId(e),g[e][r].setReferenceElement(t);delete g[i],this.anchorManager.changeId(i,e),this.dragManager&&this.dragManager.changeId(i,e);var u=function(n,i,s){for(var o=0,r=n.length;r>o;o++)n[o].endpoints[i].setElementId(e),n[o].endpoints[i].setReferenceElement(t),n[o][s+"Id"]=e,n[o][s]=t};u(s,0,"source"),u(o,1,"target"),this.repaint(e)},this.setDebugLog=function(t){p=t},this.setSuspendDrawing=function(t,e){var n=S;return S=t,_=t?(new Date).getTime():null,e&&this.repaintEverything(),n},this.isSuspendDrawing=function(){return S},this.getSuspendedAt=function(){return _},this.doWhileSuspended=function(e,n){var i=this.isSuspendDrawing();i||this.setSuspendDrawing(!0);try{e()}catch(s){t.log("Function run while suspended failed",s)}i||this.setSuspendDrawing(!1,!n)},this.getOffset=function(t){return y[t]},this.getCachedData=X,this.timestamp=n,this.setRenderMode=function(t){if(t!==P.SVG&&t!==P.VML)throw new TypeError("Render mode ["+t+"] not supported");return D=jsPlumbAdapter.setRenderMode(t)},this.getRenderMode=function(){return D},this.show=function(t,e){return q(t,"block",e),s},this.toggleVisible=G,this.toggleDraggable=W,this.addListener=this.bind,jsPlumbAdapter.headless||(s.dragManager=jsPlumbAdapter.getDragManager(s),s.recalculateOffsets=s.dragManager.updateOffsets)};jsPlumbUtil.extend(y,jsPlumbUtil.EventGenerator,{setAttribute:function(t,e,n){this.setAttribute(t,e,n)},getAttribute:function(t,e){return this.getAttribute(P.getDOMElement(t),e)},registerConnectionType:function(t,e){this._connectionTypes[t]=P.extend({},e)},registerConnectionTypes:function(t){for(var e in t)this._connectionTypes[e]=P.extend({},t[e])},registerEndpointType:function(t,e){this._endpointTypes[t]=P.extend({},e)},registerEndpointTypes:function(t){for(var e in t)this._endpointTypes[e]=P.extend({},t[e])},getType:function(t,e){return"connection"===e?this._connectionTypes[t]:this._endpointTypes[t]},setIdChanged:function(t,e){this.setId(t,e,!0)},setParent:function(t,e){var n=this.getElementObject(t),i=this.getDOMElement(n),s=this.getId(i),o=this.getElementObject(e),r=this.getDOMElement(o),a=this.getId(r);i.parentNode.removeChild(i),r.appendChild(i),this.dragManager.setParent(n,s,o,a)},getSize:function(t){return[t.offsetWidth,t.offsetHeight]},getWidth:function(t){return t.offsetWidth},getHeight:function(t){return t.offsetHeight},extend:function(t,e,n){var i;if(n)for(i=0;i<n.length;i++)t[n[i]]=e[n[i]];else for(i in e)t[i]=e[i];return t}},jsPlumbAdapter);var P=new y;"undefined"!=typeof window&&(window.jsPlumb=P),P.getInstance=function(t){var e=new y(t);return e.init(),e},"function"==typeof define&&(define("jsplumb",[],function(){return P}),define("jsplumbinstance",[],function(){return P.getInstance()})),"undefined"!=typeof exports&&(exports.jsPlumb=P)}(),function(){var t=function(t,e){var n=!1;return{drag:function(){if(n)return n=!1,!0;var i=jsPlumb.getUIPosition(arguments,e.getZoom());t.element&&(jsPlumbAdapter.setPosition(t.element,i),e.repaint(t.element,i))},stopDrag:function(){n=!0}}},e=function(t,e){var n=document.createElement("div");n.style.position="absolute";var i=e.getContainer()||document.body;i.appendChild(n);var s=e.getId(n);e.updateOffset({elId:s}),t.id=s,t.element=n},n=function(t,e,n,i,s,o,r){var a=new jsPlumb.FloatingAnchor({reference:e,referenceCanvas:i,jsPlumbInstance:o});return r({paintStyle:t,endpoint:n,anchor:a,source:s,scope:"__floating"})},i=["connectorStyle","connectorHoverStyle","connectorOverlays","connector","connectionType","connectorClass","connectorHoverClass"],s=function(t,e){var n=0;if(null!=e)for(var i=0;i<t.connections.length;i++)if(t.connections[i].sourceId==e||t.connections[i].targetId==e){n=i;break}return t.connections[n]},o=function(t,e){return jsPlumbUtil.findWithFunction(e.connections,function(e){return e.id==t.id})};jsPlumb.Endpoint=function(r){var a=r._jsPlumb,u=(jsPlumbAdapter.getAttribute,jsPlumb.getElementObject),l=jsPlumbUtil,c=r.newConnection,h=r.newEndpoint,d=r.finaliseConnection,p=(r.fireDetachEvent,r.fireMoveEvent),f=r.floatingConnections;this.idPrefix="_jsplumb_e_",this.defaultLabelLocation=[.5,.5],this.defaultOverlayKeys=["Overlays","EndpointOverlays"],OverlayCapableJsPlumbUIComponent.apply(this,arguments),this.getDefaultType=function(){return{parameters:{},scope:null,maxConnections:this._jsPlumb.instance.Defaults.MaxConnections,paintStyle:this._jsPlumb.instance.Defaults.EndpointStyle||jsPlumb.Defaults.EndpointStyle,endpoint:this._jsPlumb.instance.Defaults.Endpoint||jsPlumb.Defaults.Endpoint,hoverPaintStyle:this._jsPlumb.instance.Defaults.EndpointHoverStyle||jsPlumb.Defaults.EndpointHoverStyle,overlays:this._jsPlumb.instance.Defaults.EndpointOverlays||jsPlumb.Defaults.EndpointOverlays,connectorStyle:r.connectorStyle,connectorHoverStyle:r.connectorHoverStyle,connectorClass:r.connectorClass,connectorHoverClass:r.connectorHoverClass,connectorOverlays:r.connectorOverlays,connector:r.connector,connectorTooltip:r.connectorTooltip}},this._jsPlumb.enabled=!(r.enabled===!1),this._jsPlumb.visible=!0,this.element=jsPlumb.getDOMElement(r.source),this._jsPlumb.uuid=r.uuid,this._jsPlumb.floatingEndpoint=null;var m=null;this._jsPlumb.uuid&&(r.endpointsByUUID[this._jsPlumb.uuid]=this),this.elementId=r.elementId,this._jsPlumb.connectionCost=r.connectionCost,this._jsPlumb.connectionsDirected=r.connectionsDirected,this._jsPlumb.currentAnchorClass="",this._jsPlumb.events={};var g=function(){jsPlumbAdapter.removeClass(this.element,a.endpointAnchorClassPrefix+"_"+this._jsPlumb.currentAnchorClass),this.removeClass(a.endpointAnchorClassPrefix+"_"+this._jsPlumb.currentAnchorClass),this._jsPlumb.currentAnchorClass=this.anchor.getCssClass(),this.addClass(a.endpointAnchorClassPrefix+"_"+this._jsPlumb.currentAnchorClass),jsPlumbAdapter.addClass(this.element,a.endpointAnchorClassPrefix+"_"+this._jsPlumb.currentAnchorClass)}.bind(this);this.setAnchor=function(t,e){return this._jsPlumb.instance.continuousAnchorFactory.clear(this.elementId),this.anchor=this._jsPlumb.instance.makeAnchor(t,this.elementId,a),g(),this.anchor.bind("anchorChanged",function(t){this.fire("anchorChanged",{endpoint:this,anchor:t}),g()}.bind(this)),e||this._jsPlumb.instance.repaint(this.elementId),this};var v=r.anchor?r.anchor:r.anchors?r.anchors:a.Defaults.Anchor||"Top";this.setAnchor(v,!0);var b=function(t){this.connections.length>0?this.connections[0].setHover(t,!1):this.setHover(t)}.bind(this);r._transient||this._jsPlumb.instance.anchorManager.add(this,this.elementId),this.setEndpoint=function(t){null!=this.endpoint&&(this.endpoint.cleanup(),this.endpoint.destroy());var e=function(t,e){var n=a.getRenderMode();if(jsPlumb.Endpoints[n][t])return new jsPlumb.Endpoints[n][t](e);if(!a.Defaults.DoNotThrowErrors)throw{msg:"jsPlumb: unknown endpoint type '"+t+"'"}},n={_jsPlumb:this._jsPlumb.instance,cssClass:r.cssClass,container:r.container,tooltip:r.tooltip,connectorTooltip:r.connectorTooltip,endpoint:this};l.isString(t)?this.endpoint=e(t,n):l.isArray(t)?(n=l.merge(t[1],n),this.endpoint=e(t[0],n)):this.endpoint=t.clone(),jsPlumb.extend({},n),this.endpoint.clone=function(){return l.isString(t)?e(t,n):l.isArray(t)?(n=l.merge(t[1],n),e(t[0],n)):void 0}.bind(this),this.type=this.endpoint.type,this.bindListeners(this.endpoint,this,b)},this.setEndpoint(r.endpoint||a.Defaults.Endpoint||jsPlumb.Defaults.Endpoint||"Dot"),this.setPaintStyle(r.paintStyle||r.style||a.Defaults.EndpointStyle||jsPlumb.Defaults.EndpointStyle,!0),this.setHoverPaintStyle(r.hoverPaintStyle||a.Defaults.EndpointHoverStyle||jsPlumb.Defaults.EndpointHoverStyle,!0),this._jsPlumb.paintStyleInUse=this.getPaintStyle(),jsPlumb.extend(this,r,i),this.isSource=r.isSource||!1,this.isTemporarySource=r.isTemporarySource||!1,this.isTarget=r.isTarget||!1,this._jsPlumb.maxConnections=r.maxConnections||a.Defaults.MaxConnections,this.canvas=this.endpoint.canvas,this.addClass(a.endpointAnchorClassPrefix+"_"+this._jsPlumb.currentAnchorClass),jsPlumbAdapter.addClass(this.element,a.endpointAnchorClassPrefix+"_"+this._jsPlumb.currentAnchorClass),this.connections=r.connections||[],this.connectorPointerEvents=r["connector-pointer-events"],this.scope=r.scope||a.getDefaultScope(),this.timestamp=null,this.reattachConnections=r.reattach||a.Defaults.ReattachConnections,this.connectionsDetachable=a.Defaults.ConnectionsDetachable,(r.connectionsDetachable===!1||r.detachable===!1)&&(this.connectionsDetachable=!1),this.dragAllowedWhenFull=r.dragAllowedWhenFull!==!1,r.onMaxConnections&&this.bind("maxConnections",r.onMaxConnections),this.addConnection=function(t){this.connections.push(t),this[(this.connections.length>0?"add":"remove")+"Class"](a.endpointConnectedClass),this[(this.isFull()?"add":"remove")+"Class"](a.endpointFullClass)},this.detachFromConnection=function(t,e,n){e=null==e?o(t,this):e,e>=0&&(this.connections.splice(e,1),this[(this.connections.length>0?"add":"remove")+"Class"](a.endpointConnectedClass),this[(this.isFull()?"add":"remove")+"Class"](a.endpointFullClass)),!n&&this._deleteOnDetach&&0===this.connections.length&&a.deleteObject({endpoint:this,fireEvent:!1,deleteAttachedObjects:!1})},this.detach=function(t,e,n,i,s,r,u){var l=null==u?o(t,this):u,c=!1;return i=i!==!1,l>=0&&(n||t._forceDetach||t.isDetachable()&&t.isDetachAllowed(t)&&this.isDetachAllowed(t)&&a.checkCondition("beforeDetach",t))&&(a.deleteObject({connection:t,fireEvent:!e&&i,originalEvent:s,deleteAttachedObjects:!1}),c=!0),c},this.detachAll=function(t,e){for(;this.connections.length>0;)this.detach(this.connections[0],!1,!0,t!==!1,e,this,0);return this},this.detachFrom=function(t,e,n){for(var i=[],s=0;s<this.connections.length;s++)(this.connections[s].endpoints[1]==t||this.connections[s].endpoints[0]==t)&&i.push(this.connections[s]);for(var o=0;o<i.length;o++)this.detach(i[o],!1,!0,e,n);return this},this.getElement=function(){return this.element},this.setElement=function(t){var e=this._jsPlumb.instance.getId(t),n=this.elementId;return l.removeWithFunction(r.endpointsByElement[this.elementId],function(t){return t.id==this.id}.bind(this)),this.element=jsPlumb.getDOMElement(t),this.elementId=a.getId(this.element),a.anchorManager.rehomeEndpoint(this,n,this.element),a.dragManager.endpointAdded(this.element),l.addToList(r.endpointsByElement,e,this),this},this.makeInPlaceCopy=function(){var t=this.anchor.getCurrentLocation({element:this}),e=this.anchor.getOrientation(this),n=this.anchor.getCssClass(),i={bind:function(){},compute:function(){return[t[0],t[1]]},getCurrentLocation:function(){return[t[0],t[1]]},getOrientation:function(){return e},getCssClass:function(){return n}};return h({dropOptions:r.dropOptions,anchor:i,source:this.element,paintStyle:this.getPaintStyle(),endpoint:r.hideOnDrag?"Blank":this.endpoint,_transient:!0,scope:this.scope})},this.connectorSelector=function(){var t=this.connections[0];return this.isTarget&&t?t:this.connections.length<this._jsPlumb.maxConnections||-1==this._jsPlumb.maxConnections?null:t},this.setStyle=this.setPaintStyle,this.paint=function(t){t=t||{};var e=t.timestamp,n=!(t.recalc===!1);if(!e||this.timestamp!==e){var i=a.updateOffset({elId:this.elementId,timestamp:e}),o=t.offset?t.offset.o:i.o;if(null!=o){var r=t.anchorPoint,u=t.connectorPaintStyle;if(null==r){var l=t.dimensions||i.s,c={xy:[o.left,o.top],wh:l,element:this,timestamp:e};if(n&&this.anchor.isDynamic&&this.connections.length>0){var h=s(this,t.elementWithPrecedence),d=h.endpoints[0]==this?1:0,p=0===d?h.sourceId:h.targetId,f=a.getCachedData(p),m=f.o,g=f.s;c.txy=[m.left,m.top],c.twh=g,c.tElement=h.endpoints[d]}r=this.anchor.compute(c)}this.endpoint.compute(r,this.anchor.getOrientation(this),this._jsPlumb.paintStyleInUse,u||this.paintStyleInUse),this.endpoint.paint(this._jsPlumb.paintStyleInUse,this.anchor),this.timestamp=e;for(var v=0;v<this._jsPlumb.overlays.length;v++){var b=this._jsPlumb.overlays[v];b.isVisible()&&(this._jsPlumb.overlayPlacements[v]=b.draw(this.endpoint,this._jsPlumb.paintStyleInUse),b.paint(this._jsPlumb.overlayPlacements[v]))}}}},this.repaint=this.paint;var y=!1;this.initDraggable=function(){if(!y&&jsPlumb.isDragSupported(this.element)){var i={id:null,element:null},s=null,o=!1,d=null,p=t(i,a),g=function(){s=this.connectorSelector();var t=!0;if(this.isEnabled()||(t=!1),null!=s||this.isSource||this.isTemporarySource||(t=!1),this.isSource&&this.isFull()&&!this.dragAllowedWhenFull&&(t=!1),null==s||s.isDetachable()||(t=!1),t===!1)return a.stopDrag&&a.stopDrag(this.canvas),p.stopDrag(),!1;for(var g=0;g<this.connections.length;g++)this.connections[g].setHover(!1);this.addClass("endpointDrag"),a.setConnectionBeingDragged(!0),s&&!this.isFull()&&this.isSource&&(s=null),a.updateOffset({elId:this.elementId}),m=this.makeInPlaceCopy(),m.referenceEndpoint=this,m.paint(),e(i,a);var v=u(m.canvas),b=jsPlumbAdapter.getOffset(v,this._jsPlumb.instance),y=u(this.canvas);if(jsPlumbAdapter.setPosition(i.element,b),this.parentAnchor&&(this.anchor=a.makeAnchor(this.parentAnchor,this.elementId,a)),a.setAttribute(this.canvas,"dragId",i.id),a.setAttribute(this.canvas,"elId",this.elementId),this._jsPlumb.floatingEndpoint=n(this.getPaintStyle(),this.anchor,this.endpoint,this.canvas,i.element,a,h),this.canvas.style.visibility="hidden",null==s)this.anchor.locked=!0,this.setHover(!1,!1),s=c({sourceEndpoint:this,targetEndpoint:this._jsPlumb.floatingEndpoint,source:this.endpointWillMoveTo||this.element,target:i.element,anchors:[this.anchor,this._jsPlumb.floatingEndpoint.anchor],paintStyle:r.connectorStyle,hoverPaintStyle:r.connectorHoverStyle,connector:r.connector,overlays:r.connectorOverlays,type:this.connectionType,cssClass:this.connectorClass,hoverClass:this.connectorHoverClass}),s.pending=!0,s.addClass(a.draggingClass),this._jsPlumb.floatingEndpoint.addClass(a.draggingClass),a.fire("connectionDrag",s);else{o=!0,s.setHover(!1);var P=s.endpoints[0].id==this.id?0:1;s.floatingAnchorIndex=P,this.detachFromConnection(s,null,!0);var w=a.getDragScope(y);a.setAttribute(this.canvas,"originalScope",w);var j=a.getDropScope(y);a.setDragScope(y,j),a.fire("connectionDrag",s),0===P?(d=[s.source,s.sourceId,y,w],s.source=i.element,s.sourceId=i.id):(d=[s.target,s.targetId,y,w],s.target=i.element,s.targetId=i.id),s.endpoints[0===P?1:0].anchor.locked=!0,s.suspendedEndpoint=s.endpoints[P],s.suspendedElement=s.endpoints[P].getElement(),s.suspendedElementId=s.endpoints[P].elementId,s.suspendedElementType=0===P?"source":"target",s.suspendedEndpoint.setHover(!1),this._jsPlumb.floatingEndpoint.referenceEndpoint=s.suspendedEndpoint,s.endpoints[P]=this._jsPlumb.floatingEndpoint,s.addClass(a.draggingClass),this._jsPlumb.floatingEndpoint.addClass(a.draggingClass)}f[i.id]=s,a.anchorManager.addFloatingConnection(i.id,s),l.addToList(r.endpointsByElement,i.id,this._jsPlumb.floatingEndpoint),a.currentlyDragging=!0}.bind(this),v=r.dragOptions||{},b={},P=jsPlumb.dragEvents.start,w=jsPlumb.dragEvents.stop,j=jsPlumb.dragEvents.drag;v=jsPlumb.extend(b,v),v.scope=v.scope||this.scope,v[P]=l.wrap(v[P],g,!1),v[j]=l.wrap(v[j],p.drag),v[w]=l.wrap(v[w],function(){if(a.setConnectionBeingDragged(!1),s&&null!=s.endpoints){var t=a.getDropEvent(arguments),e=null==s.floatingAnchorIndex?1:s.floatingAnchorIndex;if(s.endpoints[0===e?1:0].anchor.locked=!1,s.removeClass(a.draggingClass),this._jsPlumb&&(s.deleteConnectionNow||s.endpoints[e]==this._jsPlumb.floatingEndpoint)&&o&&s.suspendedEndpoint){0===e?(s.source=d[0],s.sourceId=d[1]):(s.target=d[0],s.targetId=d[1]);var n=this._jsPlumb.floatingEndpoint;a.setDragScope(d[2],d[3]),s.endpoints[e]=s.suspendedEndpoint,s.isReattach()||s._forceReattach||s._forceDetach||!s.endpoints[0===e?1:0].detach(s,!1,!1,!0,t)?(s.setHover(!1),s.floatingAnchorIndex=null,s._forceDetach=null,s._forceReattach=null,this._jsPlumb.floatingEndpoint.detachFromConnection(s),s.suspendedEndpoint.addConnection(s),a.repaint(d[1])):a.deleteObject({endpoint:n})}a.remove(i.element,!1),a.deleteObject({endpoint:m}),this.deleteAfterDragStop?a.deleteObject({endpoint:this}):this._jsPlumb&&(this._jsPlumb.floatingEndpoint=null,this.canvas.style.visibility="visible",this.anchor.locked=!1,this.paint({recalc:!1})),a.fire("connectionDragStop",s,t),a.currentlyDragging=!1,s=null}}.bind(this));var x=u(this.canvas);a.initDraggable(x,v,!0),this.canvas._jsPlumbRelatedElement=this.element,y=!0}},(this.isSource||this.isTarget||this.isTemporarySource)&&this.initDraggable();var P=function(t,e,n,i){if((this.isTarget||e)&&jsPlumb.isDropSupported(this.element)){var s=r.dropOptions||a.Defaults.DropOptions||jsPlumb.Defaults.DropOptions;s=jsPlumb.extend({},s),s.scope=s.scope||this.scope;var o=jsPlumb.dragEvents.drop,u=jsPlumb.dragEvents.over,c=jsPlumb.dragEvents.out,h=function(){this.removeClass(a.endpointDropAllowedClass),this.removeClass(a.endpointDropForbiddenClass);var t=a.getDropEvent(arguments),e=a.getDOMElement(a.getDragObject(arguments)),n=a.getAttribute(e,"dragId"),s=(a.getAttribute(e,"elId"),a.getAttribute(e,"originalScope")),o=f[n];if(null!=o){var r=o.suspendedEndpoint&&(o.suspendedEndpoint.id==this.id||this.referenceEndpoint&&o.suspendedEndpoint.id==this.referenceEndpoint.id);if(r)return void(o._forceReattach=!0);var u=null==o.floatingAnchorIndex?1:o.floatingAnchorIndex;s&&a.setDragScope(e,s);var l=null!=i?i.isEnabled():!0;if(this.isFull()&&this.fire("maxConnections",{endpoint:this,connection:o,maxConnections:this._jsPlumb.maxConnections},t),!this.isFull()&&(0!==u||this.isSource)&&(1!=u||this.isTarget)&&l){var c=!0;o.suspendedEndpoint&&o.suspendedEndpoint.id!=this.id&&(0===u?(o.source=o.suspendedEndpoint.element,o.sourceId=o.suspendedEndpoint.elementId):(o.target=o.suspendedEndpoint.element,o.targetId=o.suspendedEndpoint.elementId),o.isDetachAllowed(o)&&o.endpoints[u].isDetachAllowed(o)&&o.suspendedEndpoint.isDetachAllowed(o)&&a.checkCondition("beforeDetach",o)||(c=!1)),0===u?(o.source=this.element,o.sourceId=this.elementId):(o.target=this.element,o.targetId=this.elementId);var h=function(){o.floatingAnchorIndex=null},m=function(){o.pending=!1,o.endpoints[u].detachFromConnection(o),o.suspendedEndpoint&&o.suspendedEndpoint.detachFromConnection(o),o.endpoints[u]=this,this.addConnection(o);var e=this.getParameters();for(var n in e)o.setParameter(n,e[n]);if(o.suspendedEndpoint){var i=(o.suspendedEndpoint.getElement(),o.suspendedEndpoint.elementId);p({index:u,originalSourceId:0===u?i:o.sourceId,newSourceId:0===u?this.elementId:o.sourceId,originalTargetId:1==u?i:o.targetId,newTargetId:1==u?this.elementId:o.targetId,originalSourceEndpoint:0===u?o.suspendedEndpoint:o.endpoints[0],newSourceEndpoint:0===u?this:o.endpoints[0],originalTargetEndpoint:1==u?o.suspendedEndpoint:o.endpoints[1],newTargetEndpoint:1==u?this:o.endpoints[1],connection:o},t)}else e.draggable&&jsPlumb.initDraggable(this.element,dragOptions,!0,a);1==u?a.anchorManager.updateOtherEndpoint(o.sourceId,o.suspendedElementId,o.targetId,o):a.anchorManager.sourceChanged(o.suspendedEndpoint.elementId,o.sourceId,o),d(o,null,t),h()}.bind(this),g=function(){o.suspendedEndpoint&&(o.endpoints[u]=o.suspendedEndpoint,o.setHover(!1),o._forceDetach=!0,0===u?(o.source=o.suspendedEndpoint.element,o.sourceId=o.suspendedEndpoint.elementId):(o.target=o.suspendedEndpoint.element,o.targetId=o.suspendedEndpoint.elementId),o.suspendedEndpoint.addConnection(o),o.endpoints[0].repaint(),o.repaint(),a.repaint(o.sourceId),o._forceDetach=!1),h()};c=c&&this.isDropAllowed(o.sourceId,o.targetId,o.scope,o,this),c?m():g()}a.currentlyDragging=!1}}.bind(this);s[o]=l.wrap(s[o],h),s[u]=l.wrap(s[u],function(){var t=jsPlumb.getDragObject(arguments),e=a.getAttribute(jsPlumb.getDOMElement(t),"dragId"),n=f[e];if(null!=n){var i=null==n.floatingAnchorIndex?1:n.floatingAnchorIndex,s=this.isTarget&&0!==n.floatingAnchorIndex||n.suspendedEndpoint&&this.referenceEndpoint&&this.referenceEndpoint.id==n.suspendedEndpoint.id;if(s){var o=a.checkCondition("checkDropAllowed",{sourceEndpoint:n.endpoints[i],targetEndpoint:this,connection:n});this[(o?"add":"remove")+"Class"](a.endpointDropAllowedClass),this[(o?"remove":"add")+"Class"](a.endpointDropForbiddenClass),n.endpoints[i].anchor.over(this.anchor,this)}}}.bind(this)),s[c]=l.wrap(s[c],function(){var t=jsPlumb.getDragObject(arguments),e=null==t?null:a.getAttribute(jsPlumb.getDOMElement(t),"dragId"),n=e?f[e]:null;if(null!=n){var i=null==n.floatingAnchorIndex?1:n.floatingAnchorIndex,s=this.isTarget&&0!==n.floatingAnchorIndex||n.suspendedEndpoint&&this.referenceEndpoint&&this.referenceEndpoint.id==n.suspendedEndpoint.id;s&&(this.removeClass(a.endpointDropAllowedClass),this.removeClass(a.endpointDropForbiddenClass),n.endpoints[i].anchor.out())}}.bind(this)),a.initDroppable(t,s,!0,n)}}.bind(this);return this.anchor.isFloating||P(u(this.canvas),!0,!(r._transient||this.anchor.isFloating),this),r.type&&this.addType(r.type,r.data,a.isSuspendDrawing()),this},jsPlumbUtil.extend(jsPlumb.Endpoint,OverlayCapableJsPlumbUIComponent,{getTypeDescriptor:function(){return"endpoint"},isVisible:function(){return this._jsPlumb.visible},setVisible:function(t,e,n){if(this._jsPlumb.visible=t,this.canvas&&(this.canvas.style.display=t?"block":"none"),this[t?"showOverlays":"hideOverlays"](),!e)for(var i=0;i<this.connections.length;i++)if(this.connections[i].setVisible(t),!n){var s=this===this.connections[i].endpoints[0]?1:0;1==this.connections[i].endpoints[s].connections.length&&this.connections[i].endpoints[s].setVisible(t,!0,!0)}},getAttachedElements:function(){return this.connections},applyType:function(t){null!=t.maxConnections&&(this._jsPlumb.maxConnections=t.maxConnections),t.scope&&(this.scope=t.scope),jsPlumb.extend(this,t,i),t.anchor&&(this.anchor=this._jsPlumb.instance.makeAnchor(t.anchor)),null!=t.cssClass&&this.canvas&&this._jsPlumb.instance.addClass(this.canvas,t.cssClass)},isEnabled:function(){return this._jsPlumb.enabled},setEnabled:function(t){this._jsPlumb.enabled=t},cleanup:function(){jsPlumbAdapter.removeClass(this.element,this._jsPlumb.instance.endpointAnchorClassPrefix+"_"+this._jsPlumb.currentAnchorClass),this.anchor=null,this.endpoint.cleanup(),this.endpoint.destroy(),this.endpoint=null;var t=jsPlumb.getElementObject(this.canvas);this._jsPlumb.instance.destroyDraggable(t),this._jsPlumb.instance.destroyDroppable(t)},setHover:function(t){this.endpoint&&this._jsPlumb&&!this._jsPlumb.instance.isConnectionBeingDragged()&&this.endpoint.setHover(t)},isFull:function(){return!(this.isFloating()||this._jsPlumb.maxConnections<1||this.connections.length<this._jsPlumb.maxConnections)},isFloating:function(){return null!=this.anchor&&this.anchor.isFloating},getConnectionCost:function(){return this._jsPlumb.connectionCost},setConnectionCost:function(t){this._jsPlumb.connectionCost=t},areConnectionsDirected:function(){return this._jsPlumb.connectionsDirected},setConnectionsDirected:function(t){this._jsPlumb.connectionsDirected=t},setElementId:function(t){this.elementId=t,this.anchor.elementId=t},setReferenceElement:function(t){this.element=jsPlumb.getDOMElement(t)},setDragAllowedWhenFull:function(t){this.dragAllowedWhenFull=t},equals:function(t){return this.anchor.equals(t.anchor)
},getUuid:function(){return this._jsPlumb.uuid},computeAnchor:function(t){return this.anchor.compute(t)}})}(),function(){var t=function(t,e,n,i){if(!t.Defaults.DoNotThrowErrors&&null==jsPlumb.Connectors[e][n])throw{msg:"jsPlumb: unknown connector type '"+n+"'"};return new jsPlumb.Connectors[e][n](i)},e=function(t,e,n){return t?n.makeAnchor(t,e,n):null};jsPlumb.Connection=function(t){var e=(t.newConnection,t.newEndpoint),n=(jsPlumb.getElementObject,jsPlumbUtil);this.connector=null,this.idPrefix="_jsplumb_c_",this.defaultLabelLocation=.5,this.defaultOverlayKeys=["Overlays","ConnectionOverlays"],this.previousConnection=t.previousConnection,this.source=jsPlumb.getDOMElement(t.source),this.target=jsPlumb.getDOMElement(t.target),t.sourceEndpoint&&(this.source=t.sourceEndpoint.endpointWillMoveTo||t.sourceEndpoint.getElement()),t.targetEndpoint&&(this.target=t.targetEndpoint.getElement()),OverlayCapableJsPlumbUIComponent.apply(this,arguments),this.sourceId=this._jsPlumb.instance.getId(this.source),this.targetId=this._jsPlumb.instance.getId(this.target),this.scope=t.scope,this.endpoints=[],this.endpointStyles=[];var i=this._jsPlumb.instance;this._jsPlumb.visible=!0,this._jsPlumb.editable=t.editable===!0,this._jsPlumb.params={cssClass:t.cssClass,container:t.container,"pointer-events":t["pointer-events"],editorParams:t.editorParams},this._jsPlumb.lastPaintedAt=null,this.getDefaultType=function(){return{parameters:{},scope:null,detachable:this._jsPlumb.instance.Defaults.ConnectionsDetachable,rettach:this._jsPlumb.instance.Defaults.ReattachConnections,paintStyle:this._jsPlumb.instance.Defaults.PaintStyle||jsPlumb.Defaults.PaintStyle,connector:this._jsPlumb.instance.Defaults.Connector||jsPlumb.Defaults.Connector,hoverPaintStyle:this._jsPlumb.instance.Defaults.HoverPaintStyle||jsPlumb.Defaults.HoverPaintStyle,overlays:this._jsPlumb.instance.Defaults.ConnectorOverlays||jsPlumb.Defaults.ConnectorOverlays}},this.makeEndpoint=function(n,s,o,r){return o=o||this._jsPlumb.instance.getId(s),this.prepareEndpoint(i,e,this,r,n?0:1,t,s,o)};var s=this.makeEndpoint(!0,this.source,this.sourceId,t.sourceEndpoint),o=this.makeEndpoint(!1,this.target,this.targetId,t.targetEndpoint);s&&n.addToList(t.endpointsByElement,this.sourceId,s),o&&n.addToList(t.endpointsByElement,this.targetId,o),this.scope||(this.scope=this.endpoints[0].scope),null!=t.deleteEndpointsOnDetach?(this.endpoints[0]._deleteOnDetach=t.deleteEndpointsOnDetach,this.endpoints[1]._deleteOnDetach=t.deleteEndpointsOnDetach):(this.endpoints[0]._doNotDeleteOnDetach||(this.endpoints[0]._deleteOnDetach=!0),this.endpoints[1]._doNotDeleteOnDetach||(this.endpoints[1]._deleteOnDetach=!0)),this.setConnector(this.endpoints[0].connector||this.endpoints[1].connector||t.connector||i.Defaults.Connector||jsPlumb.Defaults.Connector,!0,!0),t.path&&this.connector.setPath(t.path),this.setPaintStyle(this.endpoints[0].connectorStyle||this.endpoints[1].connectorStyle||t.paintStyle||i.Defaults.PaintStyle||jsPlumb.Defaults.PaintStyle,!0),this.setHoverPaintStyle(this.endpoints[0].connectorHoverStyle||this.endpoints[1].connectorHoverStyle||t.hoverPaintStyle||i.Defaults.HoverPaintStyle||jsPlumb.Defaults.HoverPaintStyle,!0),this._jsPlumb.paintStyleInUse=this.getPaintStyle();var r=i.getSuspendedAt();if(i.updateOffset({elId:this.sourceId,timestamp:r}),i.updateOffset({elId:this.targetId,timestamp:r}),!i.isSuspendDrawing()){var a=i.getCachedData(this.sourceId),u=a.o,l=a.s,c=i.getCachedData(this.targetId),h=c.o,d=c.s,p=r||i.timestamp(),f=this.endpoints[0].anchor.compute({xy:[u.left,u.top],wh:l,element:this.endpoints[0],elementId:this.endpoints[0].elementId,txy:[h.left,h.top],twh:d,tElement:this.endpoints[1],timestamp:p});this.endpoints[0].paint({anchorLoc:f,timestamp:p}),f=this.endpoints[1].anchor.compute({xy:[h.left,h.top],wh:d,element:this.endpoints[1],elementId:this.endpoints[1].elementId,txy:[u.left,u.top],twh:l,tElement:this.endpoints[0],timestamp:p}),this.endpoints[1].paint({anchorLoc:f,timestamp:p})}this._jsPlumb.detachable=i.Defaults.ConnectionsDetachable,t.detachable===!1&&(this._jsPlumb.detachable=!1),this.endpoints[0].connectionsDetachable===!1&&(this._jsPlumb.detachable=!1),this.endpoints[1].connectionsDetachable===!1&&(this._jsPlumb.detachable=!1),this._jsPlumb.reattach=t.reattach||this.endpoints[0].reattachConnections||this.endpoints[1].reattachConnections||i.Defaults.ReattachConnections,this._jsPlumb.cost=t.cost||this.endpoints[0].getConnectionCost(),this._jsPlumb.directed=t.directed,null==t.directed&&(this._jsPlumb.directed=this.endpoints[0].areConnectionsDirected());var m=jsPlumb.extend({},this.endpoints[1].getParameters());jsPlumb.extend(m,this.endpoints[0].getParameters()),jsPlumb.extend(m,this.getParameters()),this.setParameters(m);var g=[t.type,this.endpoints[0].connectionType,this.endpoints[1].connectionType].join(" ");/[^\s]/.test(g)&&this.addType(g,t.data,!0)},jsPlumbUtil.extend(jsPlumb.Connection,OverlayCapableJsPlumbUIComponent,{applyType:function(t,e){null!=t.detachable&&this.setDetachable(t.detachable),null!=t.reattach&&this.setReattach(t.reattach),t.scope&&(this.scope=t.scope),this.setConnector(t.connector,e),null!=t.cssClass&&this.canvas&&this._jsPlumb.instance.addClass(this.canvas,t.cssClass),t.anchor?(this.endpoints[0].anchor=this._jsPlumb.instance.makeAnchor(t.anchor),this.endpoints[1].anchor=this._jsPlumb.instance.makeAnchor(t.anchor)):t.anchors&&(this.endpoints[0].anchor=this._jsPlumb.instance.makeAnchor(t.anchors[0]),this.endpoints[1].anchor=this._jsPlumb.instance.makeAnchor(t.anchors[1]))},getTypeDescriptor:function(){return"connection"},getAttachedElements:function(){return this.endpoints},addClass:function(t,e){e&&(this.endpoints[0].addClass(t),this.endpoints[1].addClass(t),this.suspendedEndpoint&&this.suspendedEndpoint.addClass(t)),this.connector&&this.connector.addClass(t)},removeClass:function(t,e){e&&(this.endpoints[0].removeClass(t),this.endpoints[1].removeClass(t),this.suspendedEndpoint&&this.suspendedEndpoint.removeClass(t)),this.connector&&this.connector.removeClass(t)},isVisible:function(){return this._jsPlumb.visible},setVisible:function(t){this._jsPlumb.visible=t,this.connector&&this.connector.setVisible(t),this.repaint()},cleanup:function(){this.endpoints=null,this.source=null,this.target=null,null!=this.connector&&(this.connector.cleanup(),this.connector.destroy()),this.connector=null},isDetachable:function(){return this._jsPlumb.detachable===!0},setDetachable:function(t){this._jsPlumb.detachable=t===!0},isReattach:function(){return this._jsPlumb.reattach===!0},setReattach:function(t){this._jsPlumb.reattach=t===!0},setHover:function(t){this.connector&&this._jsPlumb&&!this._jsPlumb.instance.isConnectionBeingDragged()&&(this.connector.setHover(t),jsPlumbAdapter[t?"addClass":"removeClass"](this.source,this._jsPlumb.instance.hoverSourceClass),jsPlumbAdapter[t?"addClass":"removeClass"](this.target,this._jsPlumb.instance.hoverTargetClass))},getCost:function(){return this._jsPlumb.cost},setCost:function(t){this._jsPlumb.cost=t},isDirected:function(){return this._jsPlumb.directed===!0},getConnector:function(){return this.connector},setConnector:function(e,n,i){var s=jsPlumbUtil;null!=this.connector&&(this.connector.cleanup(),this.connector.destroy());var o={_jsPlumb:this._jsPlumb.instance,cssClass:this._jsPlumb.params.cssClass,container:this._jsPlumb.params.container,"pointer-events":this._jsPlumb.params["pointer-events"]},r=this._jsPlumb.instance.getRenderMode();s.isString(e)?this.connector=t(this._jsPlumb.instance,r,e,o):s.isArray(e)&&(this.connector=1==e.length?t(this._jsPlumb.instance,r,e[0],o):t(this._jsPlumb.instance,r,e[0],s.merge(e[1],o))),this.bindListeners(this.connector,this,function(t){this.setHover(t,!1)}.bind(this)),this.canvas=this.connector.canvas,this.bgCanvas=this.connector.bgCanvas,i||this.setListenerComponent(this.connector),this._jsPlumb.editable&&null!=jsPlumb.ConnectorEditors&&jsPlumb.ConnectorEditors[this.connector.type]&&this.connector.isEditable()?new jsPlumb.ConnectorEditors[this.connector.type]({connector:this.connector,connection:this,params:this._jsPlumb.params.editorParams||{}}):this._jsPlumb.editable=!1,n||this.repaint()},paint:function(t){if(!this._jsPlumb.instance.isSuspendDrawing()&&this._jsPlumb.visible){t=t||{};var e=(t.elId,t.ui),n=t.recalc,i=t.timestamp,s=!1,o=s?this.sourceId:this.targetId,r=s?this.targetId:this.sourceId,a=s?0:1,u=s?1:0;if(null==i||i!=this._jsPlumb.lastPaintedAt){var l=this._jsPlumb.instance.updateOffset({elId:r,offset:e,recalc:n,timestamp:i}).o,c=this._jsPlumb.instance.updateOffset({elId:o,timestamp:i}).o,h=this.endpoints[u],d=this.endpoints[a];t.clearEdits&&(this._jsPlumb.overlayPositions=null,h.anchor.clearUserDefinedLocation(),d.anchor.clearUserDefinedLocation(),this.connector.setEdited(!1));var p=h.anchor.getCurrentLocation({xy:[l.left,l.top],wh:[l.width,l.height],element:h,timestamp:i}),f=d.anchor.getCurrentLocation({xy:[c.left,c.top],wh:[c.width,c.height],element:d,timestamp:i});this.connector.resetBounds(),this.connector.compute({sourcePos:p,targetPos:f,sourceEndpoint:this.endpoints[u],targetEndpoint:this.endpoints[a],lineWidth:this._jsPlumb.paintStyleInUse.lineWidth,sourceInfo:l,targetInfo:c,clearEdits:t.clearEdits===!0});for(var m={minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},g=0;g<this._jsPlumb.overlays.length;g++){var v=this._jsPlumb.overlays[g];v.isVisible()&&(this._jsPlumb.overlayPlacements[g]=v.draw(this.connector,this._jsPlumb.paintStyleInUse,this.getAbsoluteOverlayPosition(v)),m.minX=Math.min(m.minX,this._jsPlumb.overlayPlacements[g].minX),m.maxX=Math.max(m.maxX,this._jsPlumb.overlayPlacements[g].maxX),m.minY=Math.min(m.minY,this._jsPlumb.overlayPlacements[g].minY),m.maxY=Math.max(m.maxY,this._jsPlumb.overlayPlacements[g].maxY))}var b=parseFloat(this._jsPlumb.paintStyleInUse.lineWidth||1)/2,y=parseFloat(this._jsPlumb.paintStyleInUse.lineWidth||0),P={xmin:Math.min(this.connector.bounds.minX-(b+y),m.minX),ymin:Math.min(this.connector.bounds.minY-(b+y),m.minY),xmax:Math.max(this.connector.bounds.maxX+(b+y),m.maxX),ymax:Math.max(this.connector.bounds.maxY+(b+y),m.maxY)};this.connector.paint(this._jsPlumb.paintStyleInUse,null,P);for(var w=0;w<this._jsPlumb.overlays.length;w++){var j=this._jsPlumb.overlays[w];j.isVisible()&&j.paint(this._jsPlumb.overlayPlacements[w],P)}}this._jsPlumb.lastPaintedAt=i}},repaint:function(t){t=t||{},this.paint({elId:this.sourceId,recalc:!(t.recalc===!1),timestamp:t.timestamp,clearEdits:t.clearEdits})},prepareEndpoint:function(t,n,i,s,o,r,a,u){var l;if(s)i.endpoints[o]=s,s.addConnection(i);else{r.endpoints||(r.endpoints=[null,null]);var c=r.endpoints[o]||r.endpoint||t.Defaults.Endpoints[o]||jsPlumb.Defaults.Endpoints[o]||t.Defaults.Endpoint||jsPlumb.Defaults.Endpoint;r.endpointStyles||(r.endpointStyles=[null,null]),r.endpointHoverStyles||(r.endpointHoverStyles=[null,null]);var h=r.endpointStyles[o]||r.endpointStyle||t.Defaults.EndpointStyles[o]||jsPlumb.Defaults.EndpointStyles[o]||t.Defaults.EndpointStyle||jsPlumb.Defaults.EndpointStyle;null==h.fillStyle&&null!=r.paintStyle&&(h.fillStyle=r.paintStyle.strokeStyle),null==h.outlineColor&&null!=r.paintStyle&&(h.outlineColor=r.paintStyle.outlineColor),null==h.outlineWidth&&null!=r.paintStyle&&(h.outlineWidth=r.paintStyle.outlineWidth);var d=r.endpointHoverStyles[o]||r.endpointHoverStyle||t.Defaults.EndpointHoverStyles[o]||jsPlumb.Defaults.EndpointHoverStyles[o]||t.Defaults.EndpointHoverStyle||jsPlumb.Defaults.EndpointHoverStyle;null!=r.hoverPaintStyle&&(null==d&&(d={}),null==d.fillStyle&&(d.fillStyle=r.hoverPaintStyle.strokeStyle));var p=r.anchors?r.anchors[o]:r.anchor?r.anchor:e(t.Defaults.Anchors[o],u,t)||e(jsPlumb.Defaults.Anchors[o],u,t)||e(t.Defaults.Anchor,u,t)||e(jsPlumb.Defaults.Anchor,u,t),f=r.uuids?r.uuids[o]:null;l=n({paintStyle:h,hoverPaintStyle:d,endpoint:c,connections:[i],uuid:f,anchor:p,source:a,scope:r.scope,reattach:r.reattach||t.Defaults.ReattachConnections,detachable:r.detachable||t.Defaults.ConnectionsDetachable}),i.endpoints[o]=l,r.drawEndpoints===!1&&l.setVisible(!1,!0,!0)}return l}})}(),function(){jsPlumb.AnchorManager=function(t){var e={},n={},i={},s={},o={},r={HORIZONTAL:"horizontal",VERTICAL:"vertical",DIAGONAL:"diagonal",IDENTITY:"identity"},a=["left","top","right","bottom"],u={},l=this,c={},h=t.jsPlumbInstance,d={},p=function(t,e,n,i,s,o){if(t===e)return{orientation:r.IDENTITY,a:["top","top"]};var u=Math.atan2(i.centery-n.centery,i.centerx-n.centerx),l=Math.atan2(n.centery-i.centery,n.centerx-i.centerx),c=[],h={};!function(t,e){for(var n=0;n<t.length;n++)h[t[n]]={left:[e[n].left,e[n].centery],right:[e[n].right,e[n].centery],top:[e[n].centerx,e[n].top],bottom:[e[n].centerx,e[n].bottom]}}(["source","target"],[n,i]);for(var d=0;d<a.length;d++)for(var p=0;p<a.length;p++)d!=p&&c.push({source:a[d],target:a[p],dist:Biltong.lineLength(h.source[a[d]],h.target[a[p]])});c.sort(function(t,e){return t.dist<e.dist?-1:t.dist>e.dist?1:0});for(var f=c[0].source,m=c[0].target,g=0;g<c.length&&(f=!s.isContinuous||s.isEdgeSupported(c[g].source)?c[g].source:null,m=!o.isContinuous||o.isEdgeSupported(c[g].target)?c[g].target:null,null==f||null==m);g++);return{a:[f,m],theta:u,theta2:l}},f=function(t,e,n,i,s,o,r){for(var a=[],u=e[s?0:1]/(i.length+1),l=0;l<i.length;l++){var c=(l+1)*u,h=o*e[s?1:0];r&&(c=e[s?0:1]-c);var d=s?c:h,p=n[0]+d,f=d/e[0],m=s?h:c,g=n[1]+m,v=m/e[1];a.push([p,g,f,v,i[l][1],i[l][2]])}return a},m=function(t){return function(e,n){var i=!0;return i=t?e[0][0]<n[0][0]:e[0][0]>n[0][0],i===!1?-1:1}},g=function(t,e){var n=t[0][0]<0?-Math.PI-t[0][0]:Math.PI-t[0][0],i=e[0][0]<0?-Math.PI-e[0][0]:Math.PI-e[0][0];return n>i?1:t[0][1]>e[0][1]?1:-1},v={top:function(t,e){return t[0]>e[0]?1:-1},right:m(!0),bottom:m(!0),left:g},b=function(t,e){return t.sort(e)},y=function(t,e){var n=h.getCachedData(t),s=n.s,r=n.o,a=function(e,n,s,r,a,u,l){if(r.length>0)for(var c=b(r,v[e]),h="right"===e||"top"===e,d=f(e,n,s,c,a,u,h),p=function(t,e){i[t.id]=[e[0],e[1],e[2],e[3]],o[t.id]=l},m=0;m<d.length;m++){var g=d[m][4],y=g.endpoints[0].elementId===t,P=g.endpoints[1].elementId===t;y?p(g.endpoints[0],d[m]):P&&p(g.endpoints[1],d[m])}};a("bottom",s,[r.left,r.top],e.bottom,!0,1,[0,1]),a("top",s,[r.left,r.top],e.top,!0,0,[0,-1]),a("left",s,[r.left,r.top],e.left,!1,0,[-1,0]),a("right",s,[r.left,r.top],e.right,!1,1,[1,0])};this.reset=function(){e={},u={},c={}},this.addFloatingConnection=function(t,e){d[t]=e},this.removeFloatingConnection=function(t){delete d[t]},this.newConnection=function(t){var e=t.sourceId,n=t.targetId,i=t.endpoints,s=!0,o=function(o,r,a,l,c){e==n&&a.isContinuous&&(t._jsPlumb.instance.removeElement(i[1].canvas),s=!1),jsPlumbUtil.addToList(u,l,[c,r,a.constructor==jsPlumb.DynamicAnchor])};o(0,i[0],i[0].anchor,n,t),s&&o(1,i[1],i[1].anchor,e,t)};var P=function(t){!function(t,e){if(t){var n=function(t){return t[4]==e};jsPlumbUtil.removeWithFunction(t.top,n),jsPlumbUtil.removeWithFunction(t.left,n),jsPlumbUtil.removeWithFunction(t.bottom,n),jsPlumbUtil.removeWithFunction(t.right,n)}}(c[t.elementId],t.id)};this.connectionDetached=function(t){var e=t.connection||t,n=t.sourceId,i=t.targetId,s=e.endpoints,o=function(t,e,n,i,s){null!=n&&n.constructor==jsPlumb.FloatingAnchor||jsPlumbUtil.removeWithFunction(u[i],function(t){return t[0].id==s.id})};o(1,s[1],s[1].anchor,n,e),o(0,s[0],s[0].anchor,i,e),P(e.endpoints[0]),P(e.endpoints[1]),l.redraw(e.sourceId),l.redraw(e.targetId)},this.add=function(t,n){jsPlumbUtil.addToList(e,n,t)},this.changeId=function(t,n){u[n]=u[t],e[n]=e[t],delete u[t],delete e[t]},this.getConnectionsFor=function(t){return u[t]||[]},this.getEndpointsFor=function(t){return e[t]||[]},this.deleteEndpoint=function(t){jsPlumbUtil.removeWithFunction(e[t.elementId],function(e){return e.id==t.id}),P(t)},this.clearFor=function(t){delete e[t],e[t]=[]};var w=function(e,n,i,s,o,r,a,u,l,c,h,d){var p=-1,f=-1,m=s.endpoints[a],g=m.id,v=[1,0][a],b=[[n,i],s,o,r,g],y=e[l],P=m._continuousAnchorEdge?e[m._continuousAnchorEdge]:null;if(P){var w=jsPlumbUtil.findWithFunction(P,function(t){return t[4]==g});if(-1!=w){P.splice(w,1);for(var j=0;j<P.length;j++)jsPlumbUtil.addWithFunction(h,P[j][1],function(t){return t.id==P[j][1].id}),jsPlumbUtil.addWithFunction(d,P[j][1].endpoints[a],function(t){return t.id==P[j][1].endpoints[a].id}),jsPlumbUtil.addWithFunction(d,P[j][1].endpoints[v],function(t){return t.id==P[j][1].endpoints[v].id})}}for(j=0;j<y.length;j++)1==t.idx&&y[j][3]===r&&-1==f&&(f=j),jsPlumbUtil.addWithFunction(h,y[j][1],function(t){return t.id==y[j][1].id}),jsPlumbUtil.addWithFunction(d,y[j][1].endpoints[a],function(t){return t.id==y[j][1].endpoints[a].id}),jsPlumbUtil.addWithFunction(d,y[j][1].endpoints[v],function(t){return t.id==y[j][1].endpoints[v].id});if(-1!=p)y[p]=b;else{var x=u?-1!=f?f:0:y.length;y.splice(x,0,b)}m._continuousAnchorEdge=l};this.updateOtherEndpoint=function(t,e,n,i){var s=jsPlumbUtil.findWithFunction(u[t],function(t){return t[0].id===i.id}),o=jsPlumbUtil.findWithFunction(u[e],function(t){return t[0].id===i.id});-1!=s&&(u[t][s][0]=i,u[t][s][1]=i.endpoints[1],u[t][s][2]=i.endpoints[1].anchor.constructor==jsPlumb.DynamicAnchor),o>-1&&(u[e].splice(o,1),jsPlumbUtil.addToList(u,n,[i,i.endpoints[0],i.endpoints[0].anchor.constructor==jsPlumb.DynamicAnchor]))},this.sourceChanged=function(t,e,n){if(t!==e){jsPlumbUtil.removeWithFunction(u[t],function(t){return t[0].id===n.id});var i=jsPlumbUtil.findWithFunction(u[n.targetId],function(t){return t[0].id===n.id});i>-1&&(u[n.targetId][i][0]=n,u[n.targetId][i][1]=n.endpoints[0],u[n.targetId][i][2]=n.endpoints[0].anchor.constructor==jsPlumb.DynamicAnchor),jsPlumbUtil.addToList(u,e,[n,n.endpoints[1],n.endpoints[1].anchor.constructor==jsPlumb.DynamicAnchor])}},this.rehomeEndpoint=function(t,n,i){var s=e[n]||[],o=h.getId(i);if(o!==n){var r=jsPlumbUtil.indexOf(s,t);if(r>-1){var a=s.splice(r,1)[0];l.add(a,o)}}for(var u=0;u<t.connections.length;u++)t.connections[u].sourceId==n?(t.connections[u].sourceId=t.elementId,t.connections[u].source=t.element,l.sourceChanged(n,t.elementId,t.connections[u])):t.connections[u].targetId==n&&(t.connections[u].targetId=t.elementId,t.connections[u].target=t.element,l.updateOtherEndpoint(t.connections[u].sourceId,n,t.elementId,t.connections[u]))},this.redraw=function(t,n,i,s,o,r){if(!h.isSuspendDrawing()){var a=e[t]||[],l=u[t]||[],f=[],m=[],g=[];i=i||h.timestamp(),s=s||{left:0,top:0},n&&(n={left:n.left+s.left,top:n.top+s.top});for(var v=h.updateOffset({elId:t,offset:n,recalc:!1,timestamp:i}),b={},P=0;P<l.length;P++){var j=l[P][0],x=j.sourceId,E=j.targetId,C=j.endpoints[0].anchor.isContinuous,S=j.endpoints[1].anchor.isContinuous;if(C||S){var _=x+"_"+E,k=b[_],D=j.sourceId==t?1:0;C&&!c[x]&&(c[x]={top:[],right:[],bottom:[],left:[]}),S&&!c[E]&&(c[E]={top:[],right:[],bottom:[],left:[]}),t!=E&&h.updateOffset({elId:E,timestamp:i}),t!=x&&h.updateOffset({elId:x,timestamp:i});var A=h.getCachedData(E),I=h.getCachedData(x);E==x&&(C||S)?w(c[x],-Math.PI/2,0,j,!1,E,0,!1,"top",x,f,m):(k||(k=p(x,E,I.o,A.o,j.endpoints[0].anchor,j.endpoints[1].anchor),b[_]=k),C&&w(c[x],k.theta,0,j,!1,E,0,!1,k.a[0],x,f,m),S&&w(c[E],k.theta2,-1,j,!0,x,1,!0,k.a[1],E,f,m)),C&&jsPlumbUtil.addWithFunction(g,x,function(t){return t===x}),S&&jsPlumbUtil.addWithFunction(g,E,function(t){return t===E}),jsPlumbUtil.addWithFunction(f,j,function(t){return t.id==j.id}),(C&&0===D||S&&1===D)&&jsPlumbUtil.addWithFunction(m,j.endpoints[D],function(t){return t.id==j.endpoints[D].id})}}for(P=0;P<a.length;P++)0===a[P].connections.length&&a[P].anchor.isContinuous&&(c[t]||(c[t]={top:[],right:[],bottom:[],left:[]}),w(c[t],-Math.PI/2,0,{endpoints:[a[P],a[P]],paint:function(){}},!1,t,0,!1,"top",t,f,m),jsPlumbUtil.addWithFunction(g,t,function(e){return e===t}));for(P=0;P<g.length;P++)y(g[P],c[g[P]]);for(P=0;P<a.length;P++)a[P].paint({timestamp:i,offset:v,dimensions:v.s,recalc:r!==!0});for(P=0;P<m.length;P++){var O=h.getCachedData(m[P].elementId);m[P].paint({timestamp:i,offset:O,dimensions:O.s})}for(P=0;P<l.length;P++){var T=l[P][1];if(T.anchor.constructor==jsPlumb.DynamicAnchor){T.paint({elementWithPrecedence:t,timestamp:i}),jsPlumbUtil.addWithFunction(f,l[P][0],function(t){return t.id==l[P][0].id});for(var $=0;$<T.connections.length;$++)T.connections[$]!==l[P][0]&&jsPlumbUtil.addWithFunction(f,T.connections[$],function(t){return t.id==T.connections[$].id})}else T.anchor.constructor==jsPlumb.Anchor&&jsPlumbUtil.addWithFunction(f,l[P][0],function(t){return t.id==l[P][0].id})}var M=d[t];for(M&&M.paint({timestamp:i,recalc:!1,elId:t}),P=0;P<f.length;P++){var N=i;f[P].paint({elId:t,timestamp:N,recalc:!1,clearEdits:o})}}};var j=function(t){jsPlumbUtil.EventGenerator.apply(this),this.type="Continuous",this.isDynamic=!0,this.isContinuous=!0;for(var e=t.faces||["top","right","bottom","left"],n=!(t.clockwise===!1),r={},a={top:"bottom",right:"left",left:"right",bottom:"top"},u={top:"right",right:"bottom",left:"top",bottom:"left"},l={top:"left",right:"top",left:"bottom",bottom:"right"},c=n?u:l,h=n?l:u,d=t.cssClass||"",p=0;p<e.length;p++)r[e[p]]=!0;this.verifyEdge=function(t){return r[t]?t:r[a[t]]?a[t]:r[c[t]]?c[t]:r[h[t]]?h[t]:t},this.isEdgeSupported=function(t){return r[t]===!0},this.compute=function(t){return s[t.element.id]||i[t.element.id]||[0,0]},this.getCurrentLocation=function(t){return s[t.element.id]||i[t.element.id]||[0,0]},this.getOrientation=function(t){return o[t.id]||[0,0]},this.clearUserDefinedLocation=function(){delete s[t.elementId]},this.setUserDefinedLocation=function(e){s[t.elementId]=e},this.getCssClass=function(){return d},this.setCssClass=function(t){d=t}};h.continuousAnchorFactory={get:function(t){var e=n[t.elementId];return e||(e=new j(t),n[t.elementId]=e),e},clear:function(t){delete n[t]}}},jsPlumb.Anchor=function(t){this.x=t.x||0,this.y=t.y||0,this.elementId=t.elementId,this.cssClass=t.cssClass||"",this.userDefinedLocation=null,this.orientation=t.orientation||[0,0],jsPlumbUtil.EventGenerator.apply(this),t.jsPlumbInstance,this.lastReturnValue=null,this.offsets=t.offsets||[0,0],this.timestamp=null,this.compute=function(t){var e=t.xy,n=t.wh,i=(t.element,t.timestamp);return t.clearUserDefinedLocation&&(this.userDefinedLocation=null),i&&i===self.timestamp?this.lastReturnValue:(this.lastReturnValue=null!=this.userDefinedLocation?this.userDefinedLocation:[e[0]+this.x*n[0]+this.offsets[0],e[1]+this.y*n[1]+this.offsets[1]],this.timestamp=i,this.lastReturnValue)},this.getCurrentLocation=function(t){return null==this.lastReturnValue||null!=t.timestamp&&this.timestamp!=t.timestamp?this.compute(t):this.lastReturnValue}},jsPlumbUtil.extend(jsPlumb.Anchor,jsPlumbUtil.EventGenerator,{equals:function(t){if(!t)return!1;var e=t.getOrientation(),n=this.getOrientation();return this.x==t.x&&this.y==t.y&&this.offsets[0]==t.offsets[0]&&this.offsets[1]==t.offsets[1]&&n[0]==e[0]&&n[1]==e[1]},getUserDefinedLocation:function(){return this.userDefinedLocation},setUserDefinedLocation:function(t){this.userDefinedLocation=t},clearUserDefinedLocation:function(){this.userDefinedLocation=null},getOrientation:function(){return this.orientation},getCssClass:function(){return this.cssClass}}),jsPlumb.FloatingAnchor=function(t){jsPlumb.Anchor.apply(this,arguments);var e=t.reference,n=(t.jsPlumbInstance,t.referenceCanvas),i=jsPlumb.getSize(n),s=0,o=0,r=null,a=null;this.orientation=null,this.x=0,this.y=0,this.isFloating=!0,this.compute=function(t){var e=t.xy,n=(t.element,[e[0]+i[0]/2,e[1]+i[1]/2]);return a=n,n},this.getOrientation=function(t){if(r)return r;var n=e.getOrientation(t);return[-1*Math.abs(n[0])*s,-1*Math.abs(n[1])*o]},this.over=function(t,e){r=t.getOrientation(e)},this.out=function(){r=null},this.getCurrentLocation=function(t){return null==a?this.compute(t):a}},jsPlumbUtil.extend(jsPlumb.FloatingAnchor,jsPlumb.Anchor);var t=function(t,e,n){return t.constructor==jsPlumb.Anchor?t:e.makeAnchor(t,n,e)};jsPlumb.DynamicAnchor=function(e){jsPlumb.Anchor.apply(this,arguments),this.isSelective=!0,this.isDynamic=!0,this.anchors=[],this.elementId=e.elementId,this.jsPlumbInstance=e.jsPlumbInstance;for(var n=0;n<e.anchors.length;n++)this.anchors[n]=t(e.anchors[n],this.jsPlumbInstance,this.elementId);this.addAnchor=function(e){this.anchors.push(t(e,this.jsPlumbInstance,this.elementId))},this.getAnchors=function(){return this.anchors},this.locked=!1;var i=this.anchors.length>0?this.anchors[0]:null,s=(this.anchors.length>0?0:-1,i),o=this,r=function(t,e,n,i,s){var o=i[0]+t.x*s[0],r=i[1]+t.y*s[1],a=i[0]+s[0]/2,u=i[1]+s[1]/2;return Math.sqrt(Math.pow(e-o,2)+Math.pow(n-r,2))+Math.sqrt(Math.pow(a-o,2)+Math.pow(u-r,2))},a=e.selector||function(t,e,n,i,s){for(var o=n[0]+i[0]/2,a=n[1]+i[1]/2,u=-1,l=1/0,c=0;c<s.length;c++){var h=r(s[c],o,a,t,e);l>h&&(u=c+0,l=h)}return s[u]};this.compute=function(t){var e=t.xy,n=t.wh,r=t.timestamp,u=t.txy,l=t.twh;t.clearUserDefinedLocation&&(userDefinedLocation=null),this.timestamp=r;var c=o.getUserDefinedLocation();return null!=c?c:this.locked||null==u||null==l?i.compute(t):(t.timestamp=null,i=a(e,n,u,l,this.anchors),this.x=i.x,this.y=i.y,i!=s&&this.fire("anchorChanged",i),s=i,i.compute(t))},this.getCurrentLocation=function(t){return this.getUserDefinedLocation()||(null!=i?i.getCurrentLocation(t):null)},this.getOrientation=function(t){return null!=i?i.getOrientation(t):[0,0]},this.over=function(t,e){null!=i&&i.over(t,e)},this.out=function(){null!=i&&i.out()},this.getCssClass=function(){return i&&i.getCssClass()||""}},jsPlumbUtil.extend(jsPlumb.DynamicAnchor,jsPlumb.Anchor);var e=function(t,e,n,i,s,o){jsPlumb.Anchors[s]=function(r){var a=r.jsPlumbInstance.makeAnchor([t,e,n,i,0,0],r.elementId,r.jsPlumbInstance);return a.type=s,o&&o(a,r),a}};e(.5,0,0,-1,"TopCenter"),e(.5,1,0,1,"BottomCenter"),e(0,.5,-1,0,"LeftMiddle"),e(1,.5,1,0,"RightMiddle"),e(.5,0,0,-1,"Top"),e(.5,1,0,1,"Bottom"),e(0,.5,-1,0,"Left"),e(1,.5,1,0,"Right"),e(.5,.5,0,0,"Center"),e(1,0,0,-1,"TopRight"),e(1,1,0,1,"BottomRight"),e(0,0,0,-1,"TopLeft"),e(0,1,0,1,"BottomLeft"),jsPlumb.Defaults.DynamicAnchors=function(t){return t.jsPlumbInstance.makeAnchors(["TopCenter","RightMiddle","BottomCenter","LeftMiddle"],t.elementId,t.jsPlumbInstance)},jsPlumb.Anchors.AutoDefault=function(t){var e=t.jsPlumbInstance.makeDynamicAnchor(jsPlumb.Defaults.DynamicAnchors(t));return e.type="AutoDefault",e};var n=function(t,e){jsPlumb.Anchors[t]=function(n){var i=n.jsPlumbInstance.makeAnchor(["Continuous",{faces:e}],n.elementId,n.jsPlumbInstance);return i.type=t,i}};jsPlumb.Anchors.Continuous=function(t){return t.jsPlumbInstance.continuousAnchorFactory.get(t)},n("ContinuousLeft",["left"]),n("ContinuousTop",["top"]),n("ContinuousBottom",["bottom"]),n("ContinuousRight",["right"]),e(0,0,0,0,"Assign",function(t,e){var n=e.position||"Fixed";t.positionFinder=n.constructor==String?e.jsPlumbInstance.AnchorPositionFinders[n]:n,t.constructorParams=e}),jsPlumbInstance.prototype.AnchorPositionFinders={Fixed:function(t,e,n){return[(t.left-e.left)/n[0],(t.top-e.top)/n[1]]},Grid:function(t,e,n,i){var s=t.left-e.left,o=t.top-e.top,r=n[0]/i.grid[0],a=n[1]/i.grid[1],u=Math.floor(s/r),l=Math.floor(o/a);return[(u*r+r/2)/n[0],(l*a+a/2)/n[1]]}},jsPlumb.Anchors.Perimeter=function(t){t=t||{};var e=t.anchorCount||60,n=t.shape;if(!n)throw new Error("no shape supplied to Perimeter Anchor type");var i=function(){for(var t=.5,n=2*Math.PI/e,i=0,s=[],o=0;e>o;o++){var r=t+t*Math.sin(i),a=t+t*Math.cos(i);s.push([r,a,0,0]),i+=n}return s},s=function(t){for(var n=e/t.length,i=[],s=function(t,s,o,r,a){n=e*a;for(var u=(o-t)/n,l=(r-s)/n,c=0;n>c;c++)i.push([t+u*c,s+l*c,0,0])},o=0;o<t.length;o++)s.apply(null,t[o]);return i},o=function(t){for(var e=[],n=0;n<t.length;n++)e.push([t[n][0],t[n][1],t[n][2],t[n][3],1/t.length]);return s(e)},r=function(){return o([[0,0,1,0],[1,0,1,1],[1,1,0,1],[0,1,0,0]])},a={Circle:i,Ellipse:i,Diamond:function(){return o([[.5,0,1,.5],[1,.5,.5,1],[.5,1,0,.5],[0,.5,.5,0]])},Rectangle:r,Square:r,Triangle:function(){return o([[.5,0,1,1],[1,1,0,1],[0,1,.5,0]])},Path:function(t){for(var e=t.points,n=[],i=0,o=0;o<e.length-1;o++){var r=Math.sqrt(Math.pow(e[o][2]-e[o][0])+Math.pow(e[o][3]-e[o][1]));i+=r,n.push([e[o][0],e[o][1],e[o+1][0],e[o+1][1],r])}for(var a=0;a<n.length;a++)n[a][4]=n[a][4]/i;return s(n)}},u=function(t,e){for(var n=[],i=e/180*Math.PI,s=0;s<t.length;s++){var o=t[s][0]-.5,r=t[s][1]-.5;n.push([.5+(o*Math.cos(i)-r*Math.sin(i)),.5+(o*Math.sin(i)+r*Math.cos(i)),t[s][2],t[s][3]])}return n};if(!a[n])throw new Error("Shape ["+n+"] is unknown by Perimeter Anchor type");var l=a[n](t);t.rotation&&(l=u(l,t.rotation));var c=t.jsPlumbInstance.makeDynamicAnchor(l);return c.type="Perimeter",c}}(),function(){jsPlumb.DOMElementComponent=jsPlumbUtil.extend(jsPlumb.jsPlumbUIComponent,function(){this.mousemove=this.dblclick=this.click=this.mousedown=this.mouseup=function(){}}),jsPlumb.Segments={AbstractSegment:function(t){this.params=t,this.findClosestPointOnPath=function(){return{d:1/0,x:null,y:null,l:null}},this.getBounds=function(){return{minX:Math.min(t.x1,t.x2),minY:Math.min(t.y1,t.y2),maxX:Math.max(t.x1,t.x2),maxY:Math.max(t.y1,t.y2)}}},Straight:function(t){var e,n,i,s,o,r,a,u=(jsPlumb.Segments.AbstractSegment.apply(this,arguments),function(){e=Math.sqrt(Math.pow(o-s,2)+Math.pow(a-r,2)),n=Biltong.gradient({x:s,y:r},{x:o,y:a}),i=-1/n});this.type="Straight",this.getLength=function(){return e},this.getGradient=function(){return n},this.getCoordinates=function(){return{x1:s,y1:r,x2:o,y2:a}},this.setCoordinates=function(t){s=t.x1,r=t.y1,o=t.x2,a=t.y2,u()},this.setCoordinates({x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2}),this.getBounds=function(){return{minX:Math.min(s,o),minY:Math.min(r,a),maxX:Math.max(s,o),maxY:Math.max(r,a)}},this.pointOnPath=function(t,n){if(0!==t||n){if(1!=t||n){var i=n?t>0?t:e+t:t*e;return Biltong.pointOnLine({x:s,y:r},{x:o,y:a},i)}return{x:o,y:a}}return{x:s,y:r}},this.gradientAtPoint=function(){return n},this.pointAlongPathFrom=function(t,e,n){var i=this.pointOnPath(t,n),u=0>=e?{x:s,y:r}:{x:o,y:a};return 0>=e&&Math.abs(e)>1&&(e*=-1),Biltong.pointOnLine(i,u,e)};var l=function(t,e,n){return n>=Math.min(t,e)&&n<=Math.max(t,e)},c=function(t,e,n){return Math.abs(n-t)<Math.abs(n-e)?t:e};this.findClosestPointOnPath=function(t,u){var h={d:1/0,x:null,y:null,l:null,x1:s,x2:o,y1:r,y2:a};if(0===n)h.y=r,h.x=l(s,o,t)?t:c(s,o,t);else if(1/0==n||n==-1/0)h.x=s,h.y=l(r,a,u)?u:c(r,a,u);else{var d=r-n*s,p=u-i*t,f=(p-d)/(n-i),m=n*f+d;h.x=l(s,o,f)?f:c(s,o,f),h.y=l(r,a,m)?m:c(r,a,m)}var g=Biltong.lineLength([h.x,h.y],[s,r]);return h.d=Biltong.lineLength([t,u],[h.x,h.y]),h.l=g/e,h}},Arc:function(t){var e=(jsPlumb.Segments.AbstractSegment.apply(this,arguments),function(e,n){return Biltong.theta([t.cx,t.cy],[e,n])}),n=function(t,e){if(t.anticlockwise){var n=t.startAngle<t.endAngle?t.startAngle+i:t.startAngle,s=Math.abs(n-t.endAngle);return n-s*e}var o=t.endAngle<t.startAngle?t.endAngle+i:t.endAngle,r=Math.abs(o-t.startAngle);return t.startAngle+r*e},i=2*Math.PI;this.radius=t.r,this.anticlockwise=t.ac,this.type="Arc",t.startAngle&&t.endAngle?(this.startAngle=t.startAngle,this.endAngle=t.endAngle,this.x1=t.cx+this.radius*Math.cos(t.startAngle),this.y1=t.cy+this.radius*Math.sin(t.startAngle),this.x2=t.cx+this.radius*Math.cos(t.endAngle),this.y2=t.cy+this.radius*Math.sin(t.endAngle)):(this.startAngle=e(t.x1,t.y1),this.endAngle=e(t.x2,t.y2),this.x1=t.x1,this.y1=t.y1,this.x2=t.x2,this.y2=t.y2),this.endAngle<0&&(this.endAngle+=i),this.startAngle<0&&(this.startAngle+=i),this.segment=Biltong.quadrant([this.x1,this.y1],[this.x2,this.y2]);var s=this.endAngle<this.startAngle?this.endAngle+i:this.endAngle;this.sweep=Math.abs(s-this.startAngle),this.anticlockwise&&(this.sweep=i-this.sweep);var o=2*Math.PI*this.radius,r=this.sweep/i,a=o*r;this.getLength=function(){return a},this.getBounds=function(){return{minX:t.cx-t.r,maxX:t.cx+t.r,minY:t.cy-t.r,maxY:t.cy+t.r}};var u=1e-10,l=function(t){var e=Math.floor(t),n=Math.ceil(t);return u>t-e?e:u>n-t?n:t};this.pointOnPath=function(e,i){if(0===e)return{x:this.x1,y:this.y1,theta:this.startAngle};if(1==e)return{x:this.x2,y:this.y2,theta:this.endAngle};i&&(e/=a);var s=n(this,e),o=t.cx+t.r*Math.cos(s),r=t.cy+t.r*Math.sin(s);return{x:l(o),y:l(r),theta:s}},this.gradientAtPoint=function(e,n){var i=this.pointOnPath(e,n),s=Biltong.normal([t.cx,t.cy],[i.x,i.y]);
return this.anticlockwise||1/0!=s&&s!=-1/0||(s*=-1),s},this.pointAlongPathFrom=function(e,n,i){var s=this.pointOnPath(e,i),r=2*(n/o)*Math.PI,a=this.anticlockwise?-1:1,u=s.theta+a*r,l=t.cx+this.radius*Math.cos(u),c=t.cy+this.radius*Math.sin(u);return{x:l,y:c}}},Bezier:function(t){var e=(jsPlumb.Segments.AbstractSegment.apply(this,arguments),[{x:t.x1,y:t.y1},{x:t.cp1x,y:t.cp1y},{x:t.cp2x,y:t.cp2y},{x:t.x2,y:t.y2}]),n={minX:Math.min(t.x1,t.x2,t.cp1x,t.cp2x),minY:Math.min(t.y1,t.y2,t.cp1y,t.cp2y),maxX:Math.max(t.x1,t.x2,t.cp1x,t.cp2x),maxY:Math.max(t.y1,t.y2,t.cp1y,t.cp2y)};this.type="Bezier";var i=function(t,e,n){return n&&(e=jsBezier.locationAlongCurveFrom(t,e>0?0:1,e)),e};this.pointOnPath=function(t,n){return t=i(e,t,n),jsBezier.pointOnCurve(e,t)},this.gradientAtPoint=function(t,n){return t=i(e,t,n),jsBezier.gradientAtPoint(e,t)},this.pointAlongPathFrom=function(t,n,s){return t=i(e,t,s),jsBezier.pointAlongCurveFrom(e,t,n)},this.getLength=function(){return jsBezier.getLength(e)},this.getBounds=function(){return n}}};var t=function(){this.resetBounds=function(){this.bounds={minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}},this.resetBounds()};jsPlumb.Connectors.AbstractConnector=function(e){t.apply(this,arguments);var n=[],i=0,s=[],o=[],r=e.stub||0,a=jsPlumbUtil.isArray(r)?r[0]:r,u=jsPlumbUtil.isArray(r)?r[1]:r,l=e.gap||0,c=jsPlumbUtil.isArray(l)?l[0]:l,h=jsPlumbUtil.isArray(l)?l[1]:l,d=null,p=!1,f=null;this.isEditable=function(){return!1},this.setEdited=function(t){p=t},this.getPath=function(){},this.setPath=function(){},this.findSegmentForPoint=function(t,e){for(var i={d:1/0,s:null,x:null,y:null,l:null},s=0;s<n.length;s++){var o=n[s].findClosestPointOnPath(t,e);o.d<i.d&&(i.d=o.d,i.l=o.l,i.x=o.x,i.y=o.y,i.s=n[s],i.x1=o.x1,i.x2=o.x2,i.y1=o.y1,i.y2=o.y2,i.index=s)}return i};var m=function(){for(var t=0,e=0;e<n.length;e++){var r=n[e].getLength();o[e]=r/i,s[e]=[t,t+=r/i]}},g=function(t,e){e&&(t=t>0?t/i:(i+t)/i);for(var r=s.length-1,a=1,u=0;u<s.length;u++)if(s[u][1]>=t){r=u,a=1==t?1:0===t?0:(t-s[u][0])/o[u];break}return{segment:n[r],proportion:a,index:r}},v=function(t,e,s){if(s.x1!=s.x2||s.y1!=s.y2){var o=new jsPlumb.Segments[e](s);n.push(o),i+=o.getLength(),t.updateBounds(o)}},b=function(){i=n.length=s.length=o.length=0};this.setSegments=function(t){d=[],i=0;for(var e=0;e<t.length;e++)d.push(t[e]),i+=t[e].getLength()};var y=function(t){this.lineWidth=t.lineWidth;var e=Biltong.quadrant(t.sourcePos,t.targetPos),n=t.targetPos[0]<t.sourcePos[0],i=t.targetPos[1]<t.sourcePos[1],s=t.lineWidth||1,o=t.sourceEndpoint.anchor.getOrientation(t.sourceEndpoint),r=t.targetEndpoint.anchor.getOrientation(t.targetEndpoint),l=n?t.targetPos[0]:t.sourcePos[0],d=i?t.targetPos[1]:t.sourcePos[1],p=Math.abs(t.targetPos[0]-t.sourcePos[0]),f=Math.abs(t.targetPos[1]-t.sourcePos[1]);if(0===o[0]&&0===o[1]||0===r[0]&&0===r[1]){var m=p>f?0:1,g=[1,0][m];o=[],r=[],o[m]=t.sourcePos[m]>t.targetPos[m]?-1:1,r[m]=t.sourcePos[m]>t.targetPos[m]?1:-1,o[g]=0,r[g]=0}var v=n?p+c*o[0]:c*o[0],b=i?f+c*o[1]:c*o[1],y=n?h*r[0]:p+h*r[0],P=i?h*r[1]:f+h*r[1],w=o[0]*r[0]+o[1]*r[1],j={sx:v,sy:b,tx:y,ty:P,lw:s,xSpan:Math.abs(y-v),ySpan:Math.abs(P-b),mx:(v+y)/2,my:(b+P)/2,so:o,to:r,x:l,y:d,w:p,h:f,segment:e,startStubX:v+o[0]*a,startStubY:b+o[1]*a,endStubX:y+r[0]*u,endStubY:P+r[1]*u,isXGreaterThanStubTimes2:Math.abs(v-y)>a+u,isYGreaterThanStubTimes2:Math.abs(b-P)>a+u,opposite:-1==w,perpendicular:0===w,orthogonal:1==w,sourceAxis:0===o[0]?"y":"x",points:[l,d,p,f,v,b,y,P]};return j.anchorOrientation=j.opposite?"opposite":j.orthogonal?"orthogonal":"perpendicular",j};return this.getSegments=function(){return n},this.updateBounds=function(t){var e=t.getBounds();this.bounds.minX=Math.min(this.bounds.minX,e.minX),this.bounds.maxX=Math.max(this.bounds.maxX,e.maxX),this.bounds.minY=Math.min(this.bounds.minY,e.minY),this.bounds.maxY=Math.max(this.bounds.maxY,e.maxY)},this.pointOnPath=function(t,e){var n=g(t,e);return n.segment&&n.segment.pointOnPath(n.proportion,!1)||[0,0]},this.gradientAtPoint=function(t,e){var n=g(t,e);return n.segment&&n.segment.gradientAtPoint(n.proportion,!1)||0},this.pointAlongPathFrom=function(t,e,n){var i=g(t,n);return i.segment&&i.segment.pointAlongPathFrom(i.proportion,e,!1)||[0,0]},this.compute=function(t){p||(f=y.call(this,t)),b(),this._compute(f,t),this.x=f.points[0],this.y=f.points[1],this.w=f.points[2],this.h=f.points[3],this.segment=f.segment,m()},{addSegment:v,prepareCompute:y,sourceStub:a,targetStub:u,maxStub:Math.max(a,u),sourceGap:c,targetGap:h,maxGap:Math.max(c,h)}},jsPlumbUtil.extend(jsPlumb.Connectors.AbstractConnector,t);var e=jsPlumb.Connectors.Straight=function(){this.type="Straight";var t=jsPlumb.Connectors.AbstractConnector.apply(this,arguments);this._compute=function(e){t.addSegment(this,"Straight",{x1:e.sx,y1:e.sy,x2:e.startStubX,y2:e.startStubY}),t.addSegment(this,"Straight",{x1:e.startStubX,y1:e.startStubY,x2:e.endStubX,y2:e.endStubY}),t.addSegment(this,"Straight",{x1:e.endStubX,y1:e.endStubY,x2:e.tx,y2:e.ty})}};jsPlumbUtil.extend(jsPlumb.Connectors.Straight,jsPlumb.Connectors.AbstractConnector),jsPlumb.registerConnectorType(e,"Straight"),jsPlumb.Endpoints.AbstractEndpoint=function(e){t.apply(this,arguments);var n=this.compute=function(){var t=this._compute.apply(this,arguments);return this.x=t[0],this.y=t[1],this.w=t[2],this.h=t[3],this.bounds.minX=this.x,this.bounds.minY=this.y,this.bounds.maxX=this.x+this.w,this.bounds.maxY=this.y+this.h,t};return{compute:n,cssClass:e.cssClass}},jsPlumbUtil.extend(jsPlumb.Endpoints.AbstractEndpoint,t),jsPlumb.Endpoints.Dot=function(t){this.type="Dot",jsPlumb.Endpoints.AbstractEndpoint.apply(this,arguments),t=t||{},this.radius=t.radius||10,this.defaultOffset=.5*this.radius,this.defaultInnerRadius=this.radius/3,this._compute=function(t,e,n){this.radius=n.radius||this.radius;var i=t[0]-this.radius,s=t[1]-this.radius,o=2*this.radius,r=2*this.radius;if(n.strokeStyle){var a=n.lineWidth||1;i-=a,s-=a,o+=2*a,r+=2*a}return[i,s,o,r,this.radius]}},jsPlumbUtil.extend(jsPlumb.Endpoints.Dot,jsPlumb.Endpoints.AbstractEndpoint),jsPlumb.Endpoints.Rectangle=function(t){this.type="Rectangle",jsPlumb.Endpoints.AbstractEndpoint.apply(this,arguments),t=t||{},this.width=t.width||20,this.height=t.height||20,this._compute=function(t,e,n){var i=n.width||this.width,s=n.height||this.height,o=t[0]-i/2,r=t[1]-s/2;return[o,r,i,s]}},jsPlumbUtil.extend(jsPlumb.Endpoints.Rectangle,jsPlumb.Endpoints.AbstractEndpoint);var n=function(){jsPlumb.DOMElementComponent.apply(this,arguments),this._jsPlumb.displayElements=[]};jsPlumbUtil.extend(n,jsPlumb.DOMElementComponent,{getDisplayElements:function(){return this._jsPlumb.displayElements},appendDisplayElement:function(t){this._jsPlumb.displayElements.push(t)}}),jsPlumb.Endpoints.Image=function(t){this.type="Image",n.apply(this,arguments),jsPlumb.Endpoints.AbstractEndpoint.apply(this,arguments);var e=t.onload,i=t.src||t.url,s=t.cssClass?" "+t.cssClass:"";this._jsPlumb.img=new Image,this._jsPlumb.ready=!1,this._jsPlumb.initialized=!1,this._jsPlumb.deleted=!1,this._jsPlumb.widthToUse=t.width,this._jsPlumb.heightToUse=t.height,this._jsPlumb.endpoint=t.endpoint,this._jsPlumb.img.onload=function(){null!=this._jsPlumb&&(this._jsPlumb.ready=!0,this._jsPlumb.widthToUse=this._jsPlumb.widthToUse||this._jsPlumb.img.width,this._jsPlumb.heightToUse=this._jsPlumb.heightToUse||this._jsPlumb.img.height,e&&e(this))}.bind(this),this._jsPlumb.endpoint.setImage=function(t,n){var i=t.constructor==String?t:t.src;e=n,this._jsPlumb.img.src=i,null!=this.canvas&&this.canvas.setAttribute("src",this._jsPlumb.img.src)}.bind(this),this._jsPlumb.endpoint.setImage(i,e),this._compute=function(t){return this.anchorPoint=t,this._jsPlumb.ready?[t[0]-this._jsPlumb.widthToUse/2,t[1]-this._jsPlumb.heightToUse/2,this._jsPlumb.widthToUse,this._jsPlumb.heightToUse]:[0,0,0,0]},this.canvas=document.createElement("img"),this.canvas.style.margin=0,this.canvas.style.padding=0,this.canvas.style.outline=0,this.canvas.style.position="absolute",this.canvas.className=this._jsPlumb.instance.endpointClass+s,this._jsPlumb.widthToUse&&this.canvas.setAttribute("width",this._jsPlumb.widthToUse),this._jsPlumb.heightToUse&&this.canvas.setAttribute("height",this._jsPlumb.heightToUse),this._jsPlumb.instance.appendElement(this.canvas),this.attachListeners(this.canvas,this),this.actuallyPaint=function(){if(!this._jsPlumb.deleted){this._jsPlumb.initialized||(this.canvas.setAttribute("src",this._jsPlumb.img.src),this.appendDisplayElement(this.canvas),this._jsPlumb.initialized=!0);var t=this.anchorPoint[0]-this._jsPlumb.widthToUse/2,e=this.anchorPoint[1]-this._jsPlumb.heightToUse/2;jsPlumbUtil.sizeElement(this.canvas,t,e,this._jsPlumb.widthToUse,this._jsPlumb.heightToUse)}},this.paint=function(t,e){null!=this._jsPlumb&&(this._jsPlumb.ready?this.actuallyPaint(t,e):window.setTimeout(function(){this.paint(t,e)}.bind(this),200))}},jsPlumbUtil.extend(jsPlumb.Endpoints.Image,[n,jsPlumb.Endpoints.AbstractEndpoint],{cleanup:function(){this._jsPlumb.deleted=!0,this.canvas&&this.canvas.parentNode.removeChild(this.canvas),this.canvas=null}}),jsPlumb.Endpoints.Blank=function(){jsPlumb.Endpoints.AbstractEndpoint.apply(this,arguments),this.type="Blank",n.apply(this,arguments),this._compute=function(t){return[t[0],t[1],10,0]},this.canvas=document.createElement("div"),this.canvas.style.display="block",this.canvas.style.width="1px",this.canvas.style.height="1px",this.canvas.style.background="transparent",this.canvas.style.position="absolute",this.canvas.className=this._jsPlumb.endpointClass,jsPlumb.appendElement(this.canvas),this.paint=function(){jsPlumbUtil.sizeElement(this.canvas,this.x,this.y,this.w,this.h)}},jsPlumbUtil.extend(jsPlumb.Endpoints.Blank,[jsPlumb.Endpoints.AbstractEndpoint,n],{cleanup:function(){this.canvas&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas)}}),jsPlumb.Endpoints.Triangle=function(t){this.type="Triangle",jsPlumb.Endpoints.AbstractEndpoint.apply(this,arguments),t=t||{},t.width=t.width||55,t.height=t.height||55,this.width=t.width,this.height=t.height,this._compute=function(t,e,n){var i=n.width||self.width,s=n.height||self.height,o=t[0]-i/2,r=t[1]-s/2;return[o,r,i,s]}};var i=jsPlumb.Overlays.AbstractOverlay=function(t){this.visible=!0,this.isAppendedAtTopLevel=!0,this.component=t.component,this.loc=null==t.location?.5:t.location,this.endpointLoc=null==t.endpointLocation?[.5,.5]:t.endpointLocation};i.prototype={cleanup:function(){this.component=null,this.canvas=null,this.endpointLoc=null},setVisible:function(t){this.visible=t,this.component.repaint()},isVisible:function(){return this.visible},hide:function(){this.setVisible(!1)},show:function(){this.setVisible(!0)},incrementLocation:function(t){this.loc+=t,this.component.repaint()},setLocation:function(t){this.loc=t,this.component.repaint()},getLocation:function(){return this.loc}},jsPlumb.Overlays.Arrow=function(t){this.type="Arrow",i.apply(this,arguments),this.isAppendedAtTopLevel=!1,t=t||{};var e=jsPlumbUtil,n=Biltong;this.length=t.length||20,this.width=t.width||20,this.id=t.id;var s=(t.direction||1)<0?-1:1,o=t.paintStyle||{lineWidth:1},r=t.foldback||.623;this.computeMaxSize=function(){return 1.5*self.width},this.draw=function(t,i){var a,u,l,c,h;if(t.pointAlongPathFrom){if(e.isString(this.loc)||this.loc>1||this.loc<0){var d=parseInt(this.loc,10),p=this.loc<0?1:0;a=t.pointAlongPathFrom(p,d,!1),u=t.pointAlongPathFrom(p,d-s*this.length/2,!1),l=n.pointOnLine(a,u,this.length)}else if(1==this.loc){if(a=t.pointOnPath(this.loc),u=t.pointAlongPathFrom(this.loc,-this.length),l=n.pointOnLine(a,u,this.length),-1==s){var f=l;l=a,a=f}}else if(0===this.loc){if(l=t.pointOnPath(this.loc),u=t.pointAlongPathFrom(this.loc,this.length),a=n.pointOnLine(l,u,this.length),-1==s){var m=l;l=a,a=m}}else a=t.pointAlongPathFrom(this.loc,s*this.length/2),u=t.pointOnPath(this.loc),l=n.pointOnLine(a,u,this.length);c=n.perpendicularLineTo(a,l,this.width),h=n.pointOnLine(a,l,r*this.length);var g={hxy:a,tail:c,cxy:h},v=o.strokeStyle||i.strokeStyle,b=o.fillStyle||i.strokeStyle,y=o.lineWidth||i.lineWidth,P={component:t,d:g,lineWidth:y,strokeStyle:v,fillStyle:b,minX:Math.min(a.x,c[0].x,c[1].x),maxX:Math.max(a.x,c[0].x,c[1].x),minY:Math.min(a.y,c[0].y,c[1].y),maxY:Math.max(a.y,c[0].y,c[1].y)};return P}return{component:t,minX:0,maxX:0,minY:0,maxY:0}}},jsPlumbUtil.extend(jsPlumb.Overlays.Arrow,i),jsPlumb.Overlays.PlainArrow=function(t){t=t||{};var e=jsPlumb.extend(t,{foldback:1});jsPlumb.Overlays.Arrow.call(this,e),this.type="PlainArrow"},jsPlumbUtil.extend(jsPlumb.Overlays.PlainArrow,jsPlumb.Overlays.Arrow),jsPlumb.Overlays.Diamond=function(t){t=t||{};var e=t.length||40,n=jsPlumb.extend(t,{length:e/2,foldback:2});jsPlumb.Overlays.Arrow.call(this,n),this.type="Diamond"},jsPlumbUtil.extend(jsPlumb.Overlays.Diamond,jsPlumb.Overlays.Arrow);var s=function(t,e){return(null==t._jsPlumb.cachedDimensions||e)&&(t._jsPlumb.cachedDimensions=t.getDimensions()),t._jsPlumb.cachedDimensions},o=function(t){jsPlumb.DOMElementComponent.apply(this,arguments),i.apply(this,arguments),this.id=t.id,this._jsPlumb.div=null,this._jsPlumb.initialised=!1,this._jsPlumb.component=t.component,this._jsPlumb.cachedDimensions=null,this._jsPlumb.create=t.create,this._jsPlumb.initiallyInvisible=t.visible===!1,this.getElement=function(){if(null==this._jsPlumb.div){var e=this._jsPlumb.div=jsPlumb.getDOMElement(this._jsPlumb.create(this._jsPlumb.component));e.style.position="absolute";var n=this._jsPlumb.instance.overlayClass+" "+(this.cssClass?this.cssClass:t.cssClass?t.cssClass:"");e.className=n,this._jsPlumb.instance.appendElement(e),this._jsPlumb.instance.getId(e),this.attachListeners(e,this),this.canvas=e,t.visible===!1&&(e.style.display="none")}return this._jsPlumb.div},this.draw=function(t,e,n){var i=s(this);if(null!=i&&2==i.length){var o={x:0,y:0};if(n)o={x:n[0],y:n[1]};else if(t.pointOnPath){var r=this.loc,a=!1;(jsPlumbUtil.isString(this.loc)||this.loc<0||this.loc>1)&&(r=parseInt(this.loc,10),a=!0),o=t.pointOnPath(r,a)}else{var u=this.loc.constructor==Array?this.loc:this.endpointLoc;o={x:u[0]*t.w,y:u[1]*t.h}}var l=o.x-i[0]/2,c=o.y-i[1]/2;return{component:t,d:{minx:l,miny:c,td:i,cxy:o},minX:l,maxX:l+i[0],minY:c,maxY:c+i[1]}}return{minX:0,maxX:0,minY:0,maxY:0}}};jsPlumbUtil.extend(o,[jsPlumb.DOMElementComponent,i],{getDimensions:function(){return jsPlumb.getSize(this.getElement())},setVisible:function(t){this._jsPlumb.div.style.display=t?"block":"none",t&&this._jsPlumb.initiallyInvisible&&(s(this,!0),this.component.repaint(),this._jsPlumb.initiallyInvisible=!1)},clearCachedDimensions:function(){this._jsPlumb.cachedDimensions=null},cleanup:function(){null!=this._jsPlumb.div&&this._jsPlumb.instance.removeElement(this._jsPlumb.div)},computeMaxSize:function(){var t=s(this);return Math.max(t[0],t[1])},reattachListeners:function(t){this._jsPlumb.div&&this.reattachListenersForElement(this._jsPlumb.div,this,t)},paint:function(t){this._jsPlumb.initialised||(this.getElement(),t.component.appendDisplayElement(this._jsPlumb.div),this.attachListeners(this._jsPlumb.div,t.component),this._jsPlumb.initialised=!0),this._jsPlumb.div.style.left=t.component.x+t.d.minx+"px",this._jsPlumb.div.style.top=t.component.y+t.d.miny+"px"}}),jsPlumb.Overlays.Custom=function(){this.type="Custom",o.apply(this,arguments)},jsPlumbUtil.extend(jsPlumb.Overlays.Custom,o),jsPlumb.Overlays.GuideLines=function(){var t=this;t.length=50,t.lineWidth=5,this.type="GuideLines",i.apply(this,arguments),jsPlumb.jsPlumbUIComponent.apply(this,arguments),this.draw=function(e){var n=e.pointAlongPathFrom(t.loc,t.length/2),i=e.pointOnPath(t.loc),s=Biltong.pointOnLine(n,i,t.length),o=Biltong.perpendicularLineTo(n,s,40),r=Biltong.perpendicularLineTo(s,n,20);return{connector:e,head:n,tail:s,headLine:r,tailLine:o,minX:Math.min(n.x,s.x,r[0].x,r[1].x),minY:Math.min(n.y,s.y,r[0].y,r[1].y),maxX:Math.max(n.x,s.x,r[0].x,r[1].x),maxY:Math.max(n.y,s.y,r[0].y,r[1].y)}}},jsPlumb.Overlays.Label=function(t){this.labelStyle=t.labelStyle,this.cssClass=null!=this.labelStyle?this.labelStyle.cssClass:null;var e=jsPlumb.extend({create:function(){return document.createElement("div")}},t);if(jsPlumb.Overlays.Custom.call(this,e),this.type="Label",this.label=t.label||"",this.labelText=null,this.labelStyle){var n=this.getElement();if(this.labelStyle.font=this.labelStyle.font||"12px sans-serif",n.style.font=this.labelStyle.font,n.style.color=this.labelStyle.color||"black",this.labelStyle.fillStyle&&(n.style.background=this.labelStyle.fillStyle),this.labelStyle.borderWidth>0){var i=this.labelStyle.borderStyle?this.labelStyle.borderStyle:"black";n.style.border=this.labelStyle.borderWidth+"px solid "+i}this.labelStyle.padding&&(n.style.padding=this.labelStyle.padding)}},jsPlumbUtil.extend(jsPlumb.Overlays.Label,jsPlumb.Overlays.Custom,{cleanup:function(){this.div=null,this.label=null,this.labelText=null,this.cssClass=null,this.labelStyle=null},getLabel:function(){return this.label},setLabel:function(t){this.label=t,this.labelText=null,this.clearCachedDimensions(),this.update(),this.component.repaint()},getDimensions:function(){return this.update(),o.prototype.getDimensions.apply(this,arguments)},update:function(){if("function"==typeof this.label){var t=this.label(this);this.getElement().innerHTML=t.replace(/\r\n/g,"<br/>")}else null==this.labelText&&(this.labelText=this.label,this.getElement().innerHTML=this.labelText.replace(/\r\n/g,"<br/>"))}})}(),function(){var t=function(t){this.type="Flowchart",t=t||{},t.stub=null==t.stub?30:t.stub;var e,n=jsPlumb.Connectors.AbstractConnector.apply(this,arguments),i=null==t.midpoint?.5:t.midpoint,s=[],o=(t.grid,t.alwaysRespectStubs),r=null,a=null,u=null,l=null!=t.cornerRadius?t.cornerRadius:0,c=function(t){return 0>t?-1:0===t?0:1},h=function(t,e,n,i){if(a!=e||u!=n){var s=null==a?i.sx:a,o=null==u?i.sy:u,r=s==e?"v":"h",l=c(e-s),h=c(n-o);a=e,u=n,t.push([s,o,e,n,r,l,h])}},d=function(t){return Math.sqrt(Math.pow(t[0]-t[2],2)+Math.pow(t[1]-t[3],2))},p=function(t){var e=[];return e.push.apply(e,t),e},f=function(t,e,i){for(var s,o,r=0;r<e.length-1;r++){if(s=s||p(e[r]),o=p(e[r+1]),l>0&&s[4]!=o[4]){var a=Math.min(l,d(s),d(o));s[2]-=s[5]*a,s[3]-=s[6]*a,o[0]+=o[5]*a,o[1]+=o[6]*a;var u=s[6]==o[5]&&1==o[5]||s[6]==o[5]&&0===o[5]&&s[5]!=o[6]||s[6]==o[5]&&-1==o[5],c=o[1]>s[3]?1:-1,h=o[0]>s[2]?1:-1,f=c==h,m=f&&u||!f&&!u?o[0]:s[2],g=f&&u||!f&&!u?s[3]:o[1];n.addSegment(t,"Straight",{x1:s[0],y1:s[1],x2:s[2],y2:s[3]}),n.addSegment(t,"Arc",{r:a,x1:s[2],y1:s[3],x2:o[0],y2:o[1],cx:m,cy:g,ac:u})}else{var v=s[2]==s[0]?0:s[2]>s[0]?i.lw/2:-(i.lw/2),b=s[3]==s[1]?0:s[3]>s[1]?i.lw/2:-(i.lw/2);n.addSegment(t,"Straight",{x1:s[0]-v,y1:s[1]-b,x2:s[2]+v,y2:s[3]+b})}s=o}null!=o&&n.addSegment(t,"Straight",{x1:o[0],y1:o[1],x2:o[2],y2:o[3]})};this.setSegments=function(t){r=t},this.isEditable=function(){return!0},this.getOriginalSegments=function(){return r||s},this._compute=function(t,l){if(l.clearEdits&&(r=null),null!=r)return void f(this,r,t);s=[],a=null,u=null,e=null;var c=t.startStubX+(t.endStubX-t.startStubX)*i,d=t.startStubY+(t.endStubY-t.startStubY)*i,p={x:[0,1],y:[1,0]},m=function(){return[t.startStubX,t.startStubY,t.endStubX,t.endStubY]},g={perpendicular:m,orthogonal:m,opposite:function(e){var n=t,i="x"==e?0:1,s={x:function(){return 1==n.so[i]&&(n.startStubX>n.endStubX&&n.tx>n.startStubX||n.sx>n.endStubX&&n.tx>n.sx)||-1==n.so[i]&&(n.startStubX<n.endStubX&&n.tx<n.startStubX||n.sx<n.endStubX&&n.tx<n.sx)},y:function(){return 1==n.so[i]&&(n.startStubY>n.endStubY&&n.ty>n.startStubY||n.sy>n.endStubY&&n.ty>n.sy)||-1==n.so[i]&&(n.startStubY<n.endStubY&&n.ty<n.startStubY||n.sy<n.endStubY&&n.ty<n.sy)}};return!o&&s[e]()?{x:[(t.sx+t.tx)/2,t.startStubY,(t.sx+t.tx)/2,t.endStubY],y:[t.startStubX,(t.sy+t.ty)/2,t.endStubX,(t.sy+t.ty)/2]}[e]:[t.startStubX,t.startStubY,t.endStubX,t.endStubY]}},v={perpendicular:function(e){var n=t,i={x:[[[1,2,3,4],null,[2,1,4,3]],null,[[4,3,2,1],null,[3,4,1,2]]],y:[[[3,2,1,4],null,[2,3,4,1]],null,[[4,1,2,3],null,[1,4,3,2]]]},s={x:[[n.startStubX,n.endStubX],null,[n.endStubX,n.startStubX]],y:[[n.startStubY,n.endStubY],null,[n.endStubY,n.startStubY]]},o={x:[[c,n.startStubY],[c,n.endStubY]],y:[[n.startStubX,d],[n.endStubX,d]]},r={x:[[n.endStubX,n.startStubY]],y:[[n.startStubX,n.endStubY]]},a={x:[[n.startStubX,n.endStubY],[n.endStubX,n.endStubY]],y:[[n.endStubX,n.startStubY],[n.endStubX,n.endStubY]]},u={x:[[n.startStubX,d],[n.endStubX,d],[n.endStubX,n.endStubY]],y:[[c,n.startStubY],[c,n.endStubY],[n.endStubX,n.endStubY]]},l={x:[n.startStubY,n.endStubY],y:[n.startStubX,n.endStubX]},h=p[e][0],f=p[e][1],m=n.so[h]+1,g=n.to[f]+1,v=-1==n.to[f]&&l[e][1]<l[e][0]||1==n.to[f]&&l[e][1]>l[e][0],b=s[e][m][0],y=s[e][m][1],P=i[e][m][g];return n.segment==P[3]||n.segment==P[2]&&v?o[e]:n.segment==P[2]&&b>y?r[e]:n.segment==P[2]&&y>=b||n.segment==P[1]&&!v?u[e]:n.segment==P[0]||n.segment==P[1]&&v?a[e]:void 0},orthogonal:function(e,n,i,s,o){var r=t,a={x:-1==r.so[0]?Math.min(n,s):Math.max(n,s),y:-1==r.so[1]?Math.min(n,s):Math.max(n,s)}[e];return{x:[[a,i],[a,o],[s,o]],y:[[i,a],[o,a],[o,s]]}[e]},opposite:function(e,i,s,o){var r=t,a={x:"y",y:"x"}[e],u={x:"height",y:"width"}[e],h=r["is"+e.toUpperCase()+"GreaterThanStubTimes2"];if(l.sourceEndpoint.elementId==l.targetEndpoint.elementId){var p=s+(1-l.sourceEndpoint.anchor[a])*l.sourceInfo[u]+n.maxStub;return{x:[[i,p],[o,p]],y:[[p,i],[p,o]]}[e]}return!h||1==r.so[y]&&i>o||-1==r.so[y]&&o>i?{x:[[i,d],[o,d]],y:[[c,i],[c,o]]}[e]:1==r.so[y]&&o>i||-1==r.so[y]&&i>o?{x:[[c,r.sy],[c,r.ty]],y:[[r.sx,d],[r.tx,d]]}[e]:void 0}},b=g[t.anchorOrientation](t.sourceAxis),y="x"==t.sourceAxis?0:1,P="x"==t.sourceAxis?1:0,w=b[y],j=b[P],x=b[y+2],E=b[P+2];h(s,b[0],b[1],t);var C=v[t.anchorOrientation](t.sourceAxis,w,j,x,E);if(C)for(var S=0;S<C.length;S++)h(s,C[S][0],C[S][1],t);h(s,b[2],b[3],t),h(s,t.tx,t.ty,t),f(this,s,t)},this.getPath=function(){for(var t=null,e=null,n=[],i=r||s,o=0;o<i.length;o++){var a=i[o],u=a[4],l="v"==u?3:2;null!=t&&e===u?t[l]=a[l]:(a[0]!=a[2]||a[1]!=a[3])&&(n.push({start:[a[0],a[1]],end:[a[2],a[3]]}),t=a,e=a[4])}return n},this.setPath=function(t){r=[];for(var e=0;e<t.length;e++){var n=t[e].start[0],i=t[e].start[1],s=t[e].end[0],o=t[e].end[1],a=n==s?"v":"h",u=c(s-n),l=c(o-i);r.push([n,i,s,o,a,u,l])}}};jsPlumbUtil.extend(t,jsPlumb.Connectors.AbstractConnector),jsPlumb.registerConnectorType(t,"Flowchart")}(),function(){var t=function(t,e,n,i){return n>=t&&e>=i?1:n>=t&&i>=e?2:t>=n&&i>=e?3:4},e=function(t,e,n,i,s,o,r,a,u){return u>=a?[t,e]:1===n?i[3]<=0&&s[3]>=1?[t+(i[2]<.5?-1*o:o),e]:i[2]>=1&&s[2]<=0?[t,e+(i[3]<.5?-1*r:r)]:[t+-1*o,e+-1*r]:2===n?i[3]>=1&&s[3]<=0?[t+(i[2]<.5?-1*o:o),e]:i[2]>=1&&s[2]<=0?[t,e+(i[3]<.5?-1*r:r)]:[t+1*o,e+-1*r]:3===n?i[3]>=1&&s[3]<=0?[t+(i[2]<.5?-1*o:o),e]:i[2]<=0&&s[2]>=1?[t,e+(i[3]<.5?-1*r:r)]:[t+-1*o,e+-1*r]:4===n?i[3]<=0&&s[3]>=1?[t+(i[2]<.5?-1*o:o),e]:i[2]<=0&&s[2]>=1?[t,e+(i[3]<.5?-1*r:r)]:[t+1*o,e+-1*r]:void 0},n=function(n){n=n||{},this.type="StateMachine";var i=jsPlumb.Connectors.AbstractConnector.apply(this,arguments),s=n.curviness||10,o=n.margin||5,r=n.proximityLimit||80,a=n.orientation&&"clockwise"===n.orientation,u=n.loopbackRadius||25,l=n.showLoopback!==!1;this._compute=function(n,c){var h=Math.abs(c.sourcePos[0]-c.targetPos[0]),d=Math.abs(c.sourcePos[1]-c.targetPos[1]);if(Math.min(c.sourcePos[0],c.targetPos[0]),Math.min(c.sourcePos[1],c.targetPos[1]),l&&c.sourceEndpoint.elementId===c.targetEndpoint.elementId){var p=c.sourcePos[0],f=(c.sourcePos[0],c.sourcePos[1]-o),m=(c.sourcePos[1]-o,p),g=f-u,v=2*u,b=2*u,y=m-u,P=g-u;n.points[0]=y,n.points[1]=P,n.points[2]=v,n.points[3]=b,i.addSegment(this,"Arc",{loopback:!0,x1:p-y+4,y1:f-P,startAngle:0,endAngle:2*Math.PI,r:u,ac:!a,x2:p-y-4,y2:f-P,cx:m-y,cy:g-P})}else{var w=c.sourcePos[0]<c.targetPos[0]?0:h,j=c.sourcePos[1]<c.targetPos[1]?0:d,x=c.sourcePos[0]<c.targetPos[0]?h:0,E=c.sourcePos[1]<c.targetPos[1]?d:0;0===c.sourcePos[2]&&(w-=o),1===c.sourcePos[2]&&(w+=o),0===c.sourcePos[3]&&(j-=o),1===c.sourcePos[3]&&(j+=o),0===c.targetPos[2]&&(x-=o),1===c.targetPos[2]&&(x+=o),0===c.targetPos[3]&&(E-=o),1===c.targetPos[3]&&(E+=o);var C=(w+x)/2,S=(j+E)/2,_=-1*C/S,k=Math.atan(_),D=(1/0==_||_==-1/0?0:Math.abs(s/2*Math.sin(k)),1/0==_||_==-1/0?0:Math.abs(s/2*Math.cos(k)),t(w,j,x,E)),A=Math.sqrt(Math.pow(x-w,2)+Math.pow(E-j,2)),I=e(C,S,D,c.sourcePos,c.targetPos,s,s,A,r);i.addSegment(this,"Bezier",{x1:x,y1:E,x2:w,y2:j,cp1x:I[0],cp1y:I[1],cp2x:I[0],cp2y:I[1]})}}};jsPlumb.registerConnectorType(n,"StateMachine")}(),function(){var t=function(t){t=t||{};var e=jsPlumb.Connectors.AbstractConnector.apply(this,arguments),n=(t.stub||50,t.curviness||150),i=10;this.type="Bezier",this.getCurviness=function(){return n},this._findControlPoint=function(t,e,s,o,r){var a=o.anchor.getOrientation(o),u=r.anchor.getOrientation(r),l=a[0]!=u[0]||a[1]==u[1],c=[];return l?(c.push(0===u[0]?s[0]<e[0]?t[0]+i:t[0]-i:t[0]+n*u[0]),c.push(0===u[1]?s[1]<e[1]?t[1]+i:t[1]-i:t[1]+n*a[1])):(c.push(0===a[0]?e[0]<s[0]?t[0]+i:t[0]-i:t[0]-n*a[0]),c.push(0===a[1]?e[1]<s[1]?t[1]+i:t[1]-i:t[1]+n*u[1])),c},this._compute=function(t,n){var i=n.sourcePos,s=n.targetPos,o=Math.abs(i[0]-s[0]),r=Math.abs(i[1]-s[1]),a=i[0]<s[0]?o:0,u=i[1]<s[1]?r:0,l=i[0]<s[0]?0:o,c=i[1]<s[1]?0:r,h=this._findControlPoint([a,u],i,s,n.sourceEndpoint,n.targetEndpoint),d=this._findControlPoint([l,c],s,i,n.targetEndpoint,n.sourceEndpoint);e.addSegment(this,"Bezier",{x1:a,y1:u,x2:l,y2:c,cp1x:h[0],cp1y:h[1],cp2x:d[0],cp2y:d[1]})}};jsPlumbUtil.extend(t,jsPlumb.Connectors.AbstractConnector),jsPlumb.registerConnectorType(t,"Bezier")}(),function(){var t={joinstyle:"stroke-linejoin","stroke-linejoin":"stroke-linejoin","stroke-dashoffset":"stroke-dashoffset","stroke-linecap":"stroke-linecap"},e="stroke-dasharray",n="dashstyle",i="linearGradient",s="radialGradient",o="defs",r="fill",a="stop",u="stroke",l="stroke-width",c="style",h="none",d="jsplumb_gradient_",p="lineWidth",f={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml"},m=function(t,e){for(var n in e)t.setAttribute(n,""+e[n])},g=function(t,e){var n=document.createElementNS(f.svg,t);return e=e||{},e.version="1.1",e.xmlns=f.xhtml,m(n,e),n},v=function(t){return"position:absolute;left:"+t[0]+"px;top:"+t[1]+"px"},b=function(t){for(var e=0;e<t.childNodes.length;e++)(t.childNodes[e].tagName==o||t.childNodes[e].tagName==i||t.childNodes[e].tagName==s)&&t.removeChild(t.childNodes[e])},y=function(t,e,n,l,c){var h=d+c._jsPlumb.instance.idstamp();b(t);var p;p=n.gradient.offset?g(s,{id:h}):g(i,{id:h,gradientUnits:"userSpaceOnUse"});var f=g(o);t.appendChild(f),f.appendChild(p);for(var m=0;m<n.gradient.stops.length;m++){var v=1==c.segment||2==c.segment?m:n.gradient.stops.length-1-m,y=jsPlumbUtil.convertStyle(n.gradient.stops[v][1],!0),P=g(a,{offset:Math.floor(100*n.gradient.stops[m][0])+"%","stop-color":y});p.appendChild(P)}var w=n.strokeStyle?u:r;e.setAttribute(w,"url(#"+h+")")},P=function(i,s,o,a,d){if(s.setAttribute(r,o.fillStyle?jsPlumbUtil.convertStyle(o.fillStyle,!0):h),s.setAttribute(u,o.strokeStyle?jsPlumbUtil.convertStyle(o.strokeStyle,!0):h),o.gradient?y(i,s,o,a,d):(b(i),s.setAttribute(c,"")),o.lineWidth&&s.setAttribute(l,o.lineWidth),o[n]&&o[p]&&!o[e]){var f=-1==o[n].indexOf(",")?" ":",",m=o[n].split(f),g="";m.forEach(function(t){g+=Math.floor(t*o.lineWidth)+f}),s.setAttribute(e,g)}else o[e]&&s.setAttribute(e,o[e]);for(var v in t)o[v]&&s.setAttribute(t[v],o[v])},w=function(t,e,n){t.childNodes.length>n?t.insertBefore(e,t.childNodes[n]):t.appendChild(e)};jsPlumbUtil.svg={node:g,attr:m,pos:v};var j=function(t){var e=t.pointerEventsSpec||"all",n={};jsPlumb.jsPlumbUIComponent.apply(this,t.originalArgs),this.canvas=null,this.path=null,this.svg=null,this.bgCanvas=null;var i=t.cssClass+" "+(t.originalArgs[0].cssClass||""),s={style:"",width:0,height:0,"pointer-events":e,position:"absolute"};this.svg=g("svg",s),t.useDivWrapper?(this.canvas=document.createElement("div"),this.canvas.style.position="absolute",jsPlumbUtil.sizeElement(this.canvas,0,0,1,1),this.canvas.className=i):(m(this.svg,{"class":i}),this.canvas=this.svg),t._jsPlumb.appendElement(this.canvas,t.originalArgs[0].parent),t.useDivWrapper&&this.canvas.appendChild(this.svg);var o=[this.canvas];return this.getDisplayElements=function(){return o},this.appendDisplayElement=function(t){o.push(t)},this.paint=function(e,i,s){if(null!=e){var o,r=[this.x,this.y],a=[this.w,this.h];null!=s&&(s.xmin<0&&(r[0]+=s.xmin),s.ymin<0&&(r[1]+=s.ymin),a[0]=s.xmax+(s.xmin<0?-s.xmin:0),a[1]=s.ymax+(s.ymin<0?-s.ymin:0)),t.useDivWrapper?(jsPlumbUtil.sizeElement(this.canvas,r[0],r[1],a[0],a[1]),r[0]=0,r[1]=0,o=v([0,0])):o=v([r[0],r[1]]),n.paint.apply(this,arguments),m(this.svg,{style:o,width:a[0],height:a[1]})}},{renderer:n}};jsPlumbUtil.extend(j,jsPlumb.jsPlumbUIComponent,{cleanup:function(){this.canvas&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this.svg=null,this.canvas=null,this.bgCanvas=null,this.path=null,this.group=null},setVisible:function(t){this.canvas&&(this.canvas.style.display=t?"block":"none"),this.bgCanvas&&(this.bgCanvas.style.display=t?"block":"none")}}),jsPlumb.ConnectorRenderers.svg=function(t){var e=this,n=j.apply(this,[{cssClass:t._jsPlumb.connectorClass,originalArgs:arguments,pointerEventsSpec:"none",_jsPlumb:t._jsPlumb}]);n.renderer.paint=function(n,i,s){var o=e.getSegments(),r="",a=[0,0];if(s.xmin<0&&(a[0]=-s.xmin),s.ymin<0&&(a[1]=-s.ymin),o.length>0){for(var u=0;u<o.length;u++)r+=jsPlumb.Segments.svg.SegmentRenderer.getPath(o[u]),r+=" ";var l={d:r,transform:"translate("+a[0]+","+a[1]+")","pointer-events":t["pointer-events"]||"visibleStroke"},c=null,h=[e.x,e.y,e.w,e.h],d={mouseenter:function(t){var n=t.relatedTarget;return null==n||n!=e.path&&n!=e.bgPath},mouseout:function(t){var n=t.relatedTarget;return null==n||n!=e.path&&n!=e.bgPath}};if(n.outlineColor){var p=n.outlineWidth||1,f=n.lineWidth+2*p;c=jsPlumb.extend({},n),c.strokeStyle=jsPlumbUtil.convertStyle(n.outlineColor),c.lineWidth=f,null==e.bgPath?(e.bgPath=g("path",l),w(e.svg,e.bgPath,0),e.attachListeners(e.bgPath,e,d)):m(e.bgPath,l),P(e.svg,e.bgPath,c,h,e)}null==e.path?(e.path=g("path",l),w(e.svg,e.path,n.outlineColor?1:0),e.attachListeners(e.path,e,d)):m(e.path,l),P(e.svg,e.path,n,h,e)}},this.reattachListeners=function(){this.bgPath&&this.reattachListenersForElement(this.bgPath,this),this.path&&this.reattachListenersForElement(this.path,this)}},jsPlumbUtil.extend(jsPlumb.ConnectorRenderers.svg,j),jsPlumb.Segments.svg={SegmentRenderer:{getPath:function(t){return{Straight:function(){var e=t.getCoordinates();return"M "+e.x1+" "+e.y1+" L "+e.x2+" "+e.y2},Bezier:function(){var e=t.params;return"M "+e.x1+" "+e.y1+" C "+e.cp1x+" "+e.cp1y+" "+e.cp2x+" "+e.cp2y+" "+e.x2+" "+e.y2},Arc:function(){var e=t.params,n=t.sweep>Math.PI?1:0,i=t.anticlockwise?0:1;return"M"+t.x1+" "+t.y1+" A "+t.radius+" "+e.r+" 0 "+n+","+i+" "+t.x2+" "+t.y2}}[t.type]()}}};var x=window.SvgEndpoint=function(t){var e=j.apply(this,[{cssClass:t._jsPlumb.endpointClass,originalArgs:arguments,pointerEventsSpec:"all",useDivWrapper:!0,_jsPlumb:t._jsPlumb}]);e.renderer.paint=function(t){var e=jsPlumb.extend({},t);e.outlineColor&&(e.strokeWidth=e.outlineWidth,e.strokeStyle=jsPlumbUtil.convertStyle(e.outlineColor,!0)),null==this.node?(this.node=this.makeNode(e),this.svg.appendChild(this.node),this.attachListeners(this.node,this)):null!=this.updateNode&&this.updateNode(this.node),P(this.svg,this.node,e,[this.x,this.y,this.w,this.h],this),v(this.node,[this.x,this.y])}.bind(this)};jsPlumbUtil.extend(x,j,{reattachListeners:function(){this.node&&this.reattachListenersForElement(this.node,this)}}),jsPlumb.Endpoints.svg.Dot=function(){jsPlumb.Endpoints.Dot.apply(this,arguments),x.apply(this,arguments),this.makeNode=function(){return g("circle",{cx:this.w/2,cy:this.h/2,r:this.radius})},this.updateNode=function(t){m(t,{cx:this.w/2,cy:this.h/2,r:this.radius})}},jsPlumbUtil.extend(jsPlumb.Endpoints.svg.Dot,[jsPlumb.Endpoints.Dot,x]),jsPlumb.Endpoints.svg.Rectangle=function(){jsPlumb.Endpoints.Rectangle.apply(this,arguments),x.apply(this,arguments),this.makeNode=function(){return g("rect",{width:this.w,height:this.h})},this.updateNode=function(t){m(t,{width:this.w,height:this.h})
}},jsPlumbUtil.extend(jsPlumb.Endpoints.svg.Rectangle,[jsPlumb.Endpoints.Rectangle,x]),jsPlumb.Endpoints.svg.Image=jsPlumb.Endpoints.Image,jsPlumb.Endpoints.svg.Blank=jsPlumb.Endpoints.Blank,jsPlumb.Overlays.svg.Label=jsPlumb.Overlays.Label,jsPlumb.Overlays.svg.Custom=jsPlumb.Overlays.Custom;var E=function(t,e){t.apply(this,e),jsPlumb.jsPlumbUIComponent.apply(this,e),this.isAppendedAtTopLevel=!1,this.path=null,this.paint=function(t,i){if(t.component.svg&&i){null==this.path&&(this.path=g("path",{"pointer-events":"all"}),t.component.svg.appendChild(this.path),this.canvas=t.component.svg,this.attachListeners(this.path,t.component),this.attachListeners(this.path,this));var s=e&&1==e.length?e[0].cssClass||"":"",o=[0,0];i.xmin<0&&(o[0]=-i.xmin),i.ymin<0&&(o[1]=-i.ymin),m(this.path,{d:n(t.d),"class":s,stroke:t.strokeStyle?t.strokeStyle:null,fill:t.fillStyle?t.fillStyle:null,transform:"translate("+o[0]+","+o[1]+")"})}};var n=function(t){return"M"+t.hxy.x+","+t.hxy.y+" L"+t.tail[0].x+","+t.tail[0].y+" L"+t.cxy.x+","+t.cxy.y+" L"+t.tail[1].x+","+t.tail[1].y+" L"+t.hxy.x+","+t.hxy.y};this.reattachListeners=function(){this.path&&this.reattachListenersForElement(this.path,this)}};jsPlumbUtil.extend(E,[jsPlumb.jsPlumbUIComponent,jsPlumb.Overlays.AbstractOverlay],{cleanup:function(){null!=this.path&&this._jsPlumb.instance.removeElement(this.path)},setVisible:function(t){null!=this.path&&(this.path.style.display=t?"block":"none")}}),jsPlumb.Overlays.svg.Arrow=function(){E.apply(this,[jsPlumb.Overlays.Arrow,arguments])},jsPlumbUtil.extend(jsPlumb.Overlays.svg.Arrow,[jsPlumb.Overlays.Arrow,E]),jsPlumb.Overlays.svg.PlainArrow=function(){E.apply(this,[jsPlumb.Overlays.PlainArrow,arguments])},jsPlumbUtil.extend(jsPlumb.Overlays.svg.PlainArrow,[jsPlumb.Overlays.PlainArrow,E]),jsPlumb.Overlays.svg.Diamond=function(){E.apply(this,[jsPlumb.Overlays.Diamond,arguments])},jsPlumbUtil.extend(jsPlumb.Overlays.svg.Diamond,[jsPlumb.Overlays.Diamond,E]),jsPlumb.Overlays.svg.GuideLines=function(){var t,e,n=null,i=this;jsPlumb.Overlays.GuideLines.apply(this,arguments),this.paint=function(o,r){null==n&&(n=g("path"),o.connector.svg.appendChild(n),i.attachListeners(n,o.connector),i.attachListeners(n,i),t=g("path"),o.connector.svg.appendChild(t),i.attachListeners(t,o.connector),i.attachListeners(t,i),e=g("path"),o.connector.svg.appendChild(e),i.attachListeners(e,o.connector),i.attachListeners(e,i));var a=[0,0];r.xmin<0&&(a[0]=-r.xmin),r.ymin<0&&(a[1]=-r.ymin),m(n,{d:s(o.head,o.tail),stroke:"red",fill:null,transform:"translate("+a[0]+","+a[1]+")"}),m(t,{d:s(o.tailLine[0],o.tailLine[1]),stroke:"blue",fill:null,transform:"translate("+a[0]+","+a[1]+")"}),m(e,{d:s(o.headLine[0],o.headLine[1]),stroke:"green",fill:null,transform:"translate("+a[0]+","+a[1]+")"})};var s=function(t,e){return"M "+t.x+","+t.y+" L"+e.x+","+e.y}},jsPlumbUtil.extend(jsPlumb.Overlays.svg.GuideLines,jsPlumb.Overlays.GuideLines)}(),function(){var t={"stroke-linejoin":"joinstyle",joinstyle:"joinstyle",endcap:"endcap",miterlimit:"miterlimit"},e=null;if(document.createStyleSheet&&document.namespaces){var n=[".jsplumb_vml","jsplumb\\:textbox","jsplumb\\:oval","jsplumb\\:rect","jsplumb\\:stroke","jsplumb\\:shape","jsplumb\\:group"],i="behavior:url(#default#VML);position:absolute;";e=document.createStyleSheet();for(var s=0;s<n.length;s++)e.addRule(n[s],i);document.namespaces.add("jsplumb","urn:schemas-microsoft-com:vml")}jsPlumb.vml={};var o=1e3,r=function(t,e){for(var n in e)t[n]=e[n]},a=function(t,e,n,i,s,o){n=n||{};var a=document.createElement("jsplumb:"+t);return o?s.appendElement(a,i):i.appendChild(a),a.className=(n["class"]?n["class"]+" ":"")+"jsplumb_vml",u(a,e),r(a,n),a},u=function(t,e,n){t.style.left=e[0]+"px",t.style.top=e[1]+"px",t.style.width=e[2]+"px",t.style.height=e[3]+"px",t.style.position="absolute",n&&(t.style.zIndex=n)},l=jsPlumb.vml.convertValue=function(t){return Math.floor(t*o)},c=function(t,e,n,i){"transparent"===e?i.setOpacity(n,"0.0"):i.setOpacity(n,"1.0")},h=function(t,e,n,i){var s={};if(e.strokeStyle){s.stroked="true";var o=jsPlumbUtil.convertStyle(e.strokeStyle,!0);s.strokecolor=o,c(s,o,"stroke",n),s.strokeweight=e.lineWidth+"px"}else s.stroked="false";if(e.fillStyle){s.filled="true";var u=jsPlumbUtil.convertStyle(e.fillStyle,!0);s.fillcolor=u,c(s,u,"fill",n)}else s.filled="false";if(e.dashstyle)null==n.strokeNode?n.strokeNode=a("stroke",[0,0,0,0],{dashstyle:e.dashstyle},t,i):n.strokeNode.dashstyle=e.dashstyle;else if(e["stroke-dasharray"]&&e.lineWidth){for(var l=-1==e["stroke-dasharray"].indexOf(",")?" ":",",h=e["stroke-dasharray"].split(l),d="",p=0;p<h.length;p++)d+=Math.floor(h[p]/e.lineWidth)+l;null==n.strokeNode?n.strokeNode=a("stroke",[0,0,0,0],{dashstyle:d},t,i):n.strokeNode.dashstyle=d}r(t,s)},d=function(){var t=this;jsPlumb.jsPlumbUIComponent.apply(this,arguments),this.opacityNodes={stroke:null,fill:null},this.initOpacityNodes=function(e){t.opacityNodes.stroke=a("stroke",[0,0,1,1],{opacity:"0.0"},e,t._jsPlumb.instance),t.opacityNodes.fill=a("fill",[0,0,1,1],{opacity:"0.0"},e,t._jsPlumb.instance)},this.setOpacity=function(e,n){var i=t.opacityNodes[e];i&&(i.opacity=""+n)};var e=[];this.getDisplayElements=function(){return e},this.appendDisplayElement=function(n,i){i||t.canvas.parentNode.appendChild(n),e.push(n)}};jsPlumbUtil.extend(d,jsPlumb.jsPlumbUIComponent,{cleanup:function(){this.bgCanvas&&this.bgCanvas.parentNode.removeChild(this.bgCanvas),this.canvas&&this.canvas.parentNode.removeChild(this.canvas)}});var p=jsPlumb.ConnectorRenderers.vml=function(e){this.strokeNode=null,this.canvas=null,d.apply(this,arguments);var n=this._jsPlumb.instance.connectorClass+(e.cssClass?" "+e.cssClass:"");this.paint=function(i){if(null!==i){this.w=Math.max(this.w,1),this.h=Math.max(this.h,1);for(var s=this.getSegments(),l={path:""},c=[this.x,this.y,this.w,this.h],d=0;d<s.length;d++)l.path+=jsPlumb.Segments.vml.SegmentRenderer.getPath(s[d]),l.path+=" ";if(i.outlineColor){var p=i.outlineWidth||1,f=i.lineWidth+2*p,m={strokeStyle:jsPlumbUtil.convertStyle(i.outlineColor),lineWidth:f};for(var g in t)m[g]=i[g];null==this.bgCanvas?(l["class"]=n,l.coordsize=c[2]*o+","+c[3]*o,this.bgCanvas=a("shape",c,l,e.parent,this._jsPlumb.instance,!0),u(this.bgCanvas,c),this.appendDisplayElement(this.bgCanvas,!0),this.attachListeners(this.bgCanvas,this),this.initOpacityNodes(this.bgCanvas,["stroke"])):(l.coordsize=c[2]*o+","+c[3]*o,u(this.bgCanvas,c),r(this.bgCanvas,l)),h(this.bgCanvas,m,this)}null==this.canvas?(l["class"]=n,l.coordsize=c[2]*o+","+c[3]*o,this.canvas=a("shape",c,l,e.parent,this._jsPlumb.instance,!0),this.appendDisplayElement(this.canvas,!0),this.attachListeners(this.canvas,this),this.initOpacityNodes(this.canvas,["stroke"])):(l.coordsize=c[2]*o+","+c[3]*o,u(this.canvas,c),r(this.canvas,l)),h(this.canvas,i,this,this._jsPlumb.instance)}}};jsPlumbUtil.extend(p,d,{reattachListeners:function(){this.canvas&&this.reattachListenersForElement(this.canvas,this)},setVisible:function(t){this.canvas&&(this.canvas.style.display=t?"block":"none"),this.bgCanvas&&(this.bgCanvas.style.display=t?"block":"none")}});var f=window.VmlEndpoint=function(t){d.apply(this,arguments),this._jsPlumb.vml=null,this.canvas=document.createElement("div"),this.canvas.style.position="absolute",this._jsPlumb.clazz=this._jsPlumb.instance.endpointClass+(t.cssClass?" "+t.cssClass:""),t._jsPlumb.appendElement(this.canvas,t.parent),this.paint=function(t,e){var n={},i=this._jsPlumb.vml;jsPlumbUtil.sizeElement(this.canvas,this.x,this.y,this.w,this.h),null==this._jsPlumb.vml?(n["class"]=this._jsPlumb.clazz,i=this._jsPlumb.vml=this.getVml([0,0,this.w,this.h],n,e,this.canvas,this._jsPlumb.instance),this.attachListeners(i,this),this.appendDisplayElement(i,!0),this.appendDisplayElement(this.canvas,!0),this.initOpacityNodes(i,["fill"])):(u(i,[0,0,this.w,this.h]),r(i,n)),h(i,t,this)}};jsPlumbUtil.extend(f,d,{reattachListeners:function(){this._jsPlumb.vml&&this.reattachListenersForElement(this._jsPlumb.vml,this)}}),jsPlumb.Segments.vml={SegmentRenderer:{getPath:function(t){return{Straight:function(t){var e=t.params;return"m"+l(e.x1)+","+l(e.y1)+" l"+l(e.x2)+","+l(e.y2)+" e"},Bezier:function(t){var e=t.params;return"m"+l(e.x1)+","+l(e.y1)+" c"+l(e.cp1x)+","+l(e.cp1y)+","+l(e.cp2x)+","+l(e.cp2y)+","+l(e.x2)+","+l(e.y2)+" e"},Arc:function(t){var e=t.params,n=Math.min(e.x1,e.x2),i=(Math.max(e.x1,e.x2),Math.min(e.y1,e.y2)),s=(Math.max(e.y1,e.y2),t.anticlockwise?1:0),o=t.anticlockwise?"at ":"wa ",r=function(){if(e.loopback)return"0,0,"+l(2*e.r)+","+l(2*e.r);var o=[null,[function(){return[n,i]},function(){return[n-e.r,i-e.r]}],[function(){return[n-e.r,i]},function(){return[n,i-e.r]}],[function(){return[n-e.r,i-e.r]},function(){return[n,i]}],[function(){return[n,i-e.r]},function(){return[n-e.r,i]}]][t.segment][s]();return l(o[0])+","+l(o[1])+","+l(o[0]+2*e.r)+","+l(o[1]+2*e.r)};return o+" "+r()+","+l(e.x1)+","+l(e.y1)+","+l(e.x2)+","+l(e.y2)+" e"}}[t.type](t)}}},jsPlumb.Endpoints.vml.Dot=function(){jsPlumb.Endpoints.Dot.apply(this,arguments),f.apply(this,arguments),this.getVml=function(t,e,n,i,s){return a("oval",t,e,i,s)}},jsPlumbUtil.extend(jsPlumb.Endpoints.vml.Dot,f),jsPlumb.Endpoints.vml.Rectangle=function(){jsPlumb.Endpoints.Rectangle.apply(this,arguments),f.apply(this,arguments),this.getVml=function(t,e,n,i,s){return a("rect",t,e,i,s)}},jsPlumbUtil.extend(jsPlumb.Endpoints.vml.Rectangle,f),jsPlumb.Endpoints.vml.Image=jsPlumb.Endpoints.Image,jsPlumb.Endpoints.vml.Blank=jsPlumb.Endpoints.Blank,jsPlumb.Overlays.vml.Label=jsPlumb.Overlays.Label,jsPlumb.Overlays.vml.Custom=jsPlumb.Overlays.Custom;var m=function(t,e){t.apply(this,e),d.apply(this,e);var n=this;this.canvas=null,this.isAppendedAtTopLevel=!0;var i=function(t){return"m "+l(t.hxy.x)+","+l(t.hxy.y)+" l "+l(t.tail[0].x)+","+l(t.tail[0].y)+" "+l(t.cxy.x)+","+l(t.cxy.y)+" "+l(t.tail[1].x)+","+l(t.tail[1].y)+" x e"};this.paint=function(t,s){if(t.component.canvas&&s){var l={},c=t.d,h=t.component;t.strokeStyle&&(l.stroked="true",l.strokecolor=jsPlumbUtil.convertStyle(t.strokeStyle,!0)),t.lineWidth&&(l.strokeweight=t.lineWidth+"px"),t.fillStyle&&(l.filled="true",l.fillcolor=t.fillStyle);var d=Math.min(c.hxy.x,c.tail[0].x,c.tail[1].x,c.cxy.x),p=Math.min(c.hxy.y,c.tail[0].y,c.tail[1].y,c.cxy.y),f=Math.max(c.hxy.x,c.tail[0].x,c.tail[1].x,c.cxy.x),m=Math.max(c.hxy.y,c.tail[0].y,c.tail[1].y,c.cxy.y),g=Math.abs(f-d),v=Math.abs(m-p),b=[d,p,g,v];if(l.path=i(c),l.coordsize=h.w*o+","+h.h*o,b[0]=h.x,b[1]=h.y,b[2]=h.w,b[3]=h.h,null==n.canvas){var y=h._jsPlumb.overlayClass||"",P=e&&1==e.length?e[0].cssClass||"":"";l["class"]=P+" "+y,n.canvas=a("shape",b,l,h.canvas.parentNode,h._jsPlumb.instance,!0),h.appendDisplayElement(n.canvas,!0),n.attachListeners(n.canvas,h),n.attachListeners(n.canvas,n)}else u(n.canvas,b),r(n.canvas,l)}},this.reattachListeners=function(){this.canvas&&this.reattachListenersForElement(n.canvas,this)},this.cleanup=function(){null!=this.canvas&&this._jsPlumb.instance.removeElement(this.canvas)}};jsPlumbUtil.extend(m,[d,jsPlumb.Overlays.AbstractOverlay],{setVisible:function(t){this.canvas.style.display=t?"block":"none"}}),jsPlumb.Overlays.vml.Arrow=function(){m.apply(this,[jsPlumb.Overlays.Arrow,arguments])},jsPlumbUtil.extend(jsPlumb.Overlays.vml.Arrow,[jsPlumb.Overlays.Arrow,m]),jsPlumb.Overlays.vml.PlainArrow=function(){m.apply(this,[jsPlumb.Overlays.PlainArrow,arguments])},jsPlumbUtil.extend(jsPlumb.Overlays.vml.PlainArrow,[jsPlumb.Overlays.PlainArrow,m]),jsPlumb.Overlays.vml.Diamond=function(){m.apply(this,[jsPlumb.Overlays.Diamond,arguments])},jsPlumbUtil.extend(jsPlumb.Overlays.vml.Diamond,[jsPlumb.Overlays.Diamond,m])}(),function(t){var e=function(e){return t("string"==typeof e?"#"+e:e)};t.extend(jsPlumbInstance.prototype,{getDOMElement:function(t){return null==t?null:"string"==typeof t?document.getElementById(t):t.context||null!=t.length?t[0]:t},getElementObject:e,removeElement:function(t){e(t).remove()},doAnimate:function(t,e,n){t.animate(e,n)},getSelector:function(n,i){return 2==arguments.length?e(n).find(i):t(n)},destroyDraggable:function(e){t(e).data("draggable")&&t(e).draggable("destroy")},destroyDroppable:function(e){t(e).data("droppable")&&t(e).droppable("destroy")},initDraggable:function(e,n,i){n=n||{},e=t(e),n.start=jsPlumbUtil.wrap(n.start,function(){t("body").addClass(this.dragSelectClass)},!1),n.stop=jsPlumbUtil.wrap(n.stop,function(){t("body").removeClass(this.dragSelectClass)}),n.doNotRemoveHelper||(n.helper=null),i&&(n.scope=n.scope||jsPlumb.Defaults.Scope),e.draggable(n)},initDroppable:function(e,n){n.scope=n.scope||jsPlumb.Defaults.Scope,t(e).droppable(n)},isAlreadyDraggable:function(e){return t(e).hasClass("ui-draggable")},isDragSupported:function(e){return t(e).draggable},isDropSupported:function(e){return t(e).droppable},getDragObject:function(t){return t[1].helper||t[1].draggable},getDragScope:function(e){return t(e).draggable("option","scope")},getDropEvent:function(t){return t[0]},getDropScope:function(e){return t(e).droppable("option","scope")},getUIPosition:function(t,e,n){var i;if(e=e||1,1==t.length)i={left:t[0].pageX,top:t[0].pageY};else{var s=t[1],o=s.position;i=o||s.absolutePosition,n||(s.position.left/=e,s.position.top/=e)}return{left:i.left,top:i.top}},isDragFilterSupported:function(){return!0},setDragFilter:function(e,n){jsPlumb.isAlreadyDraggable(e)&&t(e).draggable("option","cancel",n)},setElementDraggable:function(e,n){t(e).draggable("option","disabled",!n)},setDragScope:function(e,n){t(e).draggable("option","scope",n)},dragEvents:{start:"start",stop:"stop",drag:"drag",step:"step",over:"over",out:"out",drop:"drop",complete:"complete"},animEvents:{step:"step",complete:"complete"},trigger:function(t,n,i){var s=jQuery._data(e(t)[0],"handle");s(i)},getOriginalEvent:function(t){return t.originalEvent},on:function(t){t=e(t);var n=[];n.push.apply(n,arguments),t.on.apply(t,n.slice(1))},off:function(t){t=e(t);var n=[];n.push.apply(n,arguments),t.off.apply(t,n.slice(1))}}),t(document).ready(jsPlumb.init)}(jQuery),define("lib/jsPlumb",function(t){return function(){var e;return e||t.jsPlumb}}(this)),define("ui/shared",[],function(){return{}}),define("ui/toast",[],function(){function t(){var t;return t=a,a+=1,t}function e(t){return function(){var e,n,i;if(o[t]&&(o[t]=void 0),u)for(n=$("#toasts .toast"),e=0;e<n.length;e+=1)i=n.eq(e),i.data().id===t&&u(i)}}var n,i,s,o,r,a,u;return o=[],a=0,u=void 0,r=function(e,n){var i;return i=t(),o.push({str:e,seconds:n,id:i}),i},n=function(t,n){var i;i=r(t,n),this.close=e(i)},n.init=function(){function e(){var t,e,n;e=["","-o-","-ms-","-moz-","-webkit-"],n=void 0;for(t in e)if(t=e[t],n=a.css(t+"transition"))break;return void 0===n?(console.error("could not read any transition lengths. What's your browser?"),.2):Number(n.replace(/^[^0-9]*([0-9.]+)s.*$/,"$1"))}var a,l;$("body").append('<div id="toasts"><div class="hidden" style="display:none;">ERROR</div></div>'),"fixed"!==$("#toasts").css("position")?(console.error("Toast: stylesheet not found"),r=function(e){return console.error("Toast: "+e),t()}):(a=$("#toasts .hidden"),s=e(),a.addClass("toast"),i=e(),(i!=Number(i)||!isFinite(i)||isNaN(i))&&(console.error("fadein: not a valid number: "+i),a.show()),(s!=Number(s)||!isFinite(s)||isNaN(s))&&(console.error("fadeout: not a valid number: "+s),a.show()),r=function(e,s){var o,r;return s=s||n.SHORT,o=$("#toasts"),r=$("<div></div>"),"string"==typeof e?r.text(e):r.append(e),o.append(r),r.after($("<br>")),window.setTimeout(function(){r.addClass("toast")},10),s>0&&window.setTimeout(function(){u(r)},1e3*(s+i)),l=t(),r.data().id=l,l},u=function(t){t.removeClass("toast"),window.setTimeout(function(){t.next().remove(),t.remove()},1e3*s)}),o.forEach(function(t){t&&new n(t.str,t.seconds)},this)},n.SHORT=2,n.LONG=5,n.INFINITE=-1,n}),define("ui/strings",[],function(){var t;return t={autosaveoff:"Automatisches  Speichern aus",autosaveon:"Automatisches Speichern an",autoupdateoff:"Automatische Aktualisierung aus",autoupdateon:"Automatische Aktualisierung an",clearstorage:"Lokal gespeicherte Daten lschen? Smtliche Turnierdaten gehen damit verloren!",confirmleave:"Das Turnier kann nicht gespeichert werden. Fenster trotzdem schlieen?",upvote:"",downvote:"",byevote:"",fileabort:"Lesen abgebrochen",fileerror:"Lesefehler",filenotfound:"Datei wurde nicht gefunden",filenotreadable:"Datei ist nicht lesbar",gamefinished:"Spiel beendet",invalidresult:"Ungltiges Ergebnis",loaded:"Turnier geladen",loadfailed:"Ladevorgang fehlgeschlagen. Lade neu...",newtournament:"Neues Turnier begonnen",notimplemented:"Funktion noch nicht verfgbar",pageload:"Seite geladen",pointchangeaborted:"nderung verworfen",pointchangeapplied:"nderung gespeichert",toolatetournamentfinished:"Turnier ist schon beendet. Korrektur hat keinen Einfluss auf Rangfolge.",rankingupdate:"Ranking wurde berechnet",roundfailed:"Auslosung fehlgeschlagen",roundfinished:"%s. Runde abgeschlossen",roundstarted:"%s. Runde ausgelost",roundrunning:"Runde %s luft",registrationclosed:"Registrierung geschlossen",saved:"gespeichert",savefailed:"Speichern fehlgeschlagen",startfailed:"Auslosung fehlgeschlagen. Zu wenige Teams?",teamadded:"Team %s registriert",notenoughteams:"Zu wenige Teams",player:"Spieler",teamhead1:"#,Spieler",teamhead2:'#,"Spieler 1","Spieler 2"',teamhead3:'#,"Spieler 1","Spieler 2","Spieler 3"',rankhead1:"Rang,Team,Spieler,Siege,BH,FBH,Netto,Lose",rankhead2:'Rang,Team,"Spieler 1","Spieler 2",Siege,BH,FBH,Netto,Lose',rankhead3:'Rang,Team,"Spieler 1","Spieler 2","Spieler 3",Siege,BH,FBH,Netto,Lose',correctionhead:'"Team 1","Team 2","P1 vorher","P2 vorher","P1 nachher","P2 nachher"',histhead1:'Runde,"Teamno. 1","Spieler 1","Teamno. 2","Spieler 1",P1,P2',histhead2:'Runde,"Teamno. 1","Spieler 1","Spieler 2","Teamno. 2","Spieler 1","Spieler 2",P1,P2',histhead3:'Runde,"Teamno. 1","Spieler 1","Spieler 2","Spieler 3","Teamno. 2","Spieler 1","Spieler 2","Spieler 3",P1,P2',namechanged:"Umbenannt: %s",namechangeaborted:"Name verworfen",teamsnotempty:"Spieler wurden schon eingetragen",emptyname:"N.N.",differentteamsizes:"Teams haben unterschiedliche Gre",invalidteamsize:"Unzulssige Spielerzahl pro Team",alltabsreloaded:"Alle Tabs neu geladen",modsvariableadded:"window.mods erstellt",tournamentfinished:"Turnier beendet",autocompleteloaded:"Spielernamen geladen",autocompletereloadfailed:"Konnte Spielernamen nicht laden",fileempty:"Datei ist leer",teamdeleted:"Anmeldung %s gelscht",nofilereader:"Dieser Browser kann keine Speicherstnde laden!",nojson:"Dieser Browser kann keine Speicherstnde erstellen!",nostorage:"Dieser Browser kann keine Spielstnde speichern!",updatedownloading:"Neue Version wird geladen...",updatefailed:"Fehler beim Download der neuen Version",updateavailable:"Neu laden fr neue Version",dev:"Entwicklerversion",rc:"Versionsvorschau",reset:"Gespeicherte Daten gelscht",defaultnameswiss:"Schweizer System",defaultnameko:"KO-Turnier",defaultnamepoule:"Poule-System",defaultnameroundtournament:"Rundenturnier",defaultnamesupermelee:"Supermelee",offlineconfirmexit:"Der Browser hat keine Internetverbindung und die Seite liegt nicht im Cache. Wenn sie die Seite jetzt schlieen, kann das Programm nur mit bestehender Internetverbindung wieder gestartet werden.",winstatustrue:"S",winstatusfalse:"N",winstatusundefined:"",nomanifest:"Offline-Modus deaktiviert: Kein Manifest",tournamentalreadyfinished:"Turnier ist schon beendet",gamesstillrunning:"Es gibt noch offene Spiele",tournamentstarted:"Turnier gestartet",tabupdateerror:"Fehler bei Aktualisierung vom %s-Tab",tab_teams:"Mannschaften",tab_new:"Turniersysteme",tab_games:"Offene Spiele",tab_ranking:"Platzierungen",tab_history:"Spielverlauf",tab_debug:"Debugging Console",tab_settings:"Optionen und Einstellungen",tab_about:"ber...",nodata:"Keine Daten"}}),define("ui/options",[],function(){var t,e;return t={},e={playernameurl:"https://boulesdb.appspot.com/json",maxteamsize:3,maxpoints:15,dbname:"boulestournament",dbplayername:"players",roundtries:20,teamsize:3},t.toBlob=function(){return JSON.stringify(t)},t.fromBlob=function(e){var n,i;n=JSON.parse(e);for(i in t)"function"!=typeof t[i]&&delete t[i];for(i in n)"function"!=typeof n[i]&&(t[i]=n[i])},t.reset=function(){t.fromBlob(JSON.stringify(e))},t.reset(),t}),define("ui/team",["./options","./strings","./shared"],function(t,e,n){var i,s;return s=[],i={},i.create=function(t){var e;return e={},e.names=t.slice(),e.id=s.length,s.push(e),e},i.get=function(t){return s[t]},i.erase=function(t){var e;if("number"==typeof t&&t>=0&&t<s.length){s.splice(t,1);for(e in s)s[e].id=Number(e)}},i.prepareTournament=function(t){s.forEach(function(e,n){t.addPlayer(n)})},i.count=function(){return s.length},i.size=function(){return console.error("use Team.count() instead of Team.size()"),i.count()},i.toCSV=function(){var n;return n=[e["teamhead"+t.teamsize]],s.forEach(function(e){var i,s;for(i=[e.id+1],s=0;s<t.teamsize;s+=1)i.push(e.names[s]?'"'+e.names[s].replace(/"/g,'""')+'"':'"%% %%"');n.push(i.join(","))}),n.join("\r\n")},i.toBlob=function(){return JSON.stringify(s)},i.fromBlob=function(t){s=JSON.parse(t)},i.reset=function(){s=[]},n.Team=i,i}),define("ui/tournaments",["../backend/swisstournament","../backend/kotournament","./team","./shared"],function(t,e,n,i){function s(n,i){var s;if(s=void 0,!n)return void 0;switch(n){case"swiss":s=new t;break;case"ko":s=new e;break;default:console.error("undefined tournament type: "+n)}return i&&s.fromBlob(i),s}var o,r;return o={},r=[],o.getStartRank=function(t,e){var n,i,s;if(void 0==t)s=0,i=void 0;else{if(void 0===r[t])return void console.error("tournamentid not defined: "+t);i=e?t:r[t].parent,s=void 0==i?0:o.getStartRank(i)}for(n in r)r[n].parent==i&&(e||void 0===t||t>n)&&(s+=r[n].teams.length);return s},o.numTeamsLeft=function(t){var e,i;if(void 0===t)e=n.count();else{if(void 0===r[t])return console.error("tournament id not defined: "+t),0;e=r[t].teams.length}for(i in r)r[i].parent==t&&(e-=r[i].teams.length);return e},o.addTournament=function(t,e,n){var a,u,l,c,h;if(l=[],a=s(t),!a)return void 0;if(c=o.getStartRank(n,!0),e>o.numTeamsLeft(n))return void console.error("you want too many teams in your tournament");for(h=i.GlobalRanking.get(),console.log(c),u=0;e>u;u+=1)l.push(h[u+c].teamid),a.addPlayer(h[u+c].teamid);return r.push({name:t,type:t,tournament:a,teams:l,parent:n,finalranking:void 0}),a},o.removeTournament=function(t){var e;return e=r[t],e&&e.tournament?(r[t].finalranking=e.tournament.getRanking(),r[t].tournament=void 0,!0):void console.error("tournament already removed?")},o.getParent=function(t){return r[t]&&r[t].parent},o.getRankingOrder=function(){var t,e,n,i,s;for(t=[void 0];t.length;){for(i=t.shift(),s=[],n=0;n<r.length;n+=1)r[n].parent==i&&(t.indexOf(n)>-1&&console.error("already visited: "+n),s.push(n),t.push(n));if(e)for(n=e.indexOf(i),-1===n&&console.error("parent id not found in index");s.length;)e.splice(n,0,s.pop());else e=s}return e},o.numTournaments=function(){return r.length},o.setName=function(t,e){r[t].name=e},o.getName=function(t){return r[t]&&r[t].name},o.getType=function(t){return r[t]&&r[t].type},o.getTeams=function(t){return r[t]&&r[t].teams},o.getRanking=function(t){var e;return e=r[t],e?e.tournament&&e.tournament.getRanking()||e.finalranking:void console.error("tournamentid doesnt exist: "+t)},o.getTournament=function(t){return r[t]?r[t].tournament:void 0},o.getTournamentID=function(t){var e;for(e=0;e<r.length;e+=1)if(r[e].tournament&&r[e].tournament==t)return e;return void 0},o.isRunning=function(t){return r[t]&&void 0!=r[t].tournament},o.endTournament=function(t){var e,n;return e=r[t],e.tournament?0!=e.tournament.getGames().length?void console.error("cannot remove tournament #"+t+": there are still open games"):(n=e.tournament.end())?(e.tournament=void 0,!0):void console.error("cannot remove tournament #"+t+": tournament can not be ended"):void console.error("cannot remove tournament #"+t+": invalid index")},o.toBlob=function(){var t,e,n;for(t=[],e=0;e<r.length;e+=1)n=r[e],t[e]=[n.type,n.name,n.tournament&&n.tournament.toBlob(),n.teams,n.finalranking,n.parent];return JSON.stringify(t)},o.fromBlob=function(t){var e,n,i;for(e=JSON.parse(t),o.reset(),r=[],n=0;n<e.length;n+=1)i=e[n],r.push({type:i[0],name:i[1],tournament:i[2]&&s(i[0],i[2]),teams:i[3],finalranking:i[4],parent:i[5]})},o.reset=function(){r=[]},i.Tournaments=o,o}),define("ui/history",["./shared","./tournaments"],function(t){function e(t,e){return e&&!i[t]&&(i[t]={votes:[],games:[],corrections:[]}),i[t]}var n,i;return i=[],n={addResult:function(t,n,i,s,o,r,a){var u;return r=r||0,a=a||0,(u=e(t,!0))?(u.games.push([n,i,s,o,r,a]),!0):!1},addCorrection:function(t,n,i){var s,o;if(n=n.slice(0),i=i.slice(0),s=e(t),!s)return!1;for(o in s.games)if(o=s.games[o],!(n[0]!=o[0]||n[1]!=o[1]||n[2]!=o[2]||n[3]!=o[3]||n[4]&&n[4]!=o[4]||n[5]&&n[5]!=o[5])){o[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[3],o[4]=i[4]||0,o[5]=i[5]||0;break}return n[4]=n[4]||0,n[5]=n[5]||0,i[4]=i[4]||0,i[5]=i[5]||0,s.corrections.push([n,i]),!0},addVote:function(t,n,i,s){var o;return(o=e(t,!0))?(o.votes.push([n,i,s]),!0):!1},numGames:function(t){var n;return n=e(t),n?n.games.length:void 0},getVotes:function(t){var n;return n=e(t),n?n.votes:void 0},numCorrections:function(t){var n;return n=e(t),n?n.corrections.length:void 0},numRounds:function(t){var n;return n=e(t),n?1+Math.max(Math.max.apply(this,n.games.map(function(t){return t[4]})),Math.max.apply(this,n.votes.map(function(t){return t[2]}))):void 0},getGame:function(t,n){var i;return i=e(t),i?i.games[n]:void 0},getGames:function(t){var n;return n=e(t),n?n.games:void 0},getRound:function(t,n){var i,s,o;if(i=e(t),!i)return void 0;o=[];for(s in i.games)s=i.games[s],s[4]===n&&o.push(s);return o},findGames:function(t,n,i){var s,o,r;if(s=e(t),!s)return void 0;r=[];for(o in s.games)o=s.games[o],(o[0]===n&&o[1]===i||o[0]===i&&o[1]===n)&&r.push(o);return r},getCorrection:function(t,n){var i;return i=e(t),i?i.corrections[n]:void 0},getCorrections:function(t){var n;return n=e(t),n?n.corrections:void 0},numTournaments:function(){return i.length},reset:function(){i=[]},toCSV:function(){var e,i,s,o,r,a,u,l,c,h,d,p;for(e=[],d=t.Team,p=t.Tournaments,i=0;i<n.numTournaments();i+=1)for(o=n.numRounds(i),r=n.getVotes(i),s=0;o>s;s+=1){if(l=n.getRound(i,s),l&&l.length){e.push("#"+p.getName(i)+" Runde "+(s+1)+" Spiele,"),e.push("No1,No2,Name1_1,Name1_2,Name1_3,Name2_1,Name2_2,Name2_3,Points1,Points2");for(u in l)u=l[u],c=[],c.push(u[0]+1),c.push(u[1]+1),h=d.get(u[0]).names,c.push('"'+(h[0]||"").replace('"','""')+'"'),c.push('"'+(h[1]||"").replace('"','""')+'"'),c.push('"'+(h[2]||"").replace('"','""')+'"'),h=d.get(u[1]).names,c.push('"'+(h[0]||"").replace('"','""')+'"'),c.push('"'+(h[1]||"").replace('"','""')+'"'),c.push('"'+(h[2]||"").replace('"','""')+'"'),c.push(u[2]),c.push(u[3]),e.push(c.join(","))}firstvote=!0;for(a in r)if(a=r[a],a[2]===s){switch(firstvote&&(firstvote=!1,e.push("#"+p.getName(i)+" Runde "+(s+1)+" Lose,"),e.push("No,Name1,Name2,Name3,Typ")),h=d.get(a[1]).names,c=[],c.push(a[1]+1),c.push('"'+(h[0]||"").replace('"','""')+'"'),c.push('"'+(h[1]||"").replace('"','""')+'"'),c.push('"'+(h[2]||"").replace('"','""')+'"'),a[0]){case n.BYE:c.push("frei");break;case n.DOWNVOTE:c.push("hoch");break;case n.UPVOTE:c.push("runter");break;default:c.push(void 0)}e.push(c.join(","))}}return e.join("\r\n")},toBlob:function(){return JSON.stringify(i)},fromBlob:function(t){i=JSON.parse(t)}},n.BYE=0,n.UPVOTE=1,n.DOWNVOTE=-1,n}),define("ui/tabs",["./options"],function(t){var e;return e=function(e,n,i){var s;return s={tabs:[],keys:[],opts:[],updateOpts:void 0,hide:void 0,show:void 0,valid:void 0},this.updateOpts=function(){s.updateOpts()},this.hide=function(t){s.display(t,!1)},this.show=function(t){s.display(t,!0)},this.focus=function(t){s.focus(t)},this.valid=function(){s.openValidTab()},n=n||"images/%s.png",$(function(o){function r(){var t,e,n;n=location.hash.replace(/^#/,""),"debug"!==n&&(t=a.indexOf(n),(i&&-1===t||!f[t])&&(e=f.indexOf(!0),-1===e||(location.hash="#"+a[e])))}var a,u,l,c,h,d,p,f;a=s.tabs,u=s.keys,l=s.opts,d={},p={},f=[],o(e).each(function(t,e){var n,i,s,r;r=o(e),n=r.attr("id"),i=r.attr("accesskey"),s=r.attr("data-tabimgopt"),n&&(a.push(n),u.push(i),i&&r.removeAttr("accesskey"),l.push(s),f.push(!0))}),c=o("<div></div>"),c.addClass("tabs"),a.forEach(function(e,i){var s;s=o("<a>"),s.attr("href","#"+e),s.attr("tabindex","-1"),l[i]?s.attr("data-img",n.replace("%s",e+t[l[i]])):s.attr("data-img",n.replace("%s",e)),c.append(s)},this),a.forEach(function(t){var e,n;e=o("#"+t),n=c.clone(),n.find("a[href=#"+t+"]").addClass("open"),e.prepend(n),p[t]=n},this),o("#tabs").on("click",".tabs a",function(t){var e;return e=o(this).attr("href"),location.hash=e,window.scrollTo(0,0),t.preventDefault(),!1}),h=o("body"),u.forEach(function(t,e){var n=o("<a>");n.attr("href","#"+a[e]),n.attr("tabindex","-1"),n.attr("accesskey",t),h.append(n),d[a[e]]=n}),o(window).on("hashchange",function(){return"#reset"!==location.hash&&(window.scrollTo(0,0),r()),!0}),s.updateOpts=function(){l.forEach(function(e,i){var s;s=a[i],e&&o(".tabs a[href=#"+s+"][data-img]").attr("data-img",n.replace("%s",s+t[e]))})},s.display=function(t,e){var n,i;if("boolean"==typeof e&&(i=a.indexOf(t),-1!==i)){for(n in p)p[n].find("a[href=#"+t+"]").css("display",e?"":"none");d[t]&&(e?d[t].attr("accesskey",u[i]):d[t].removeAttr("accesskey")),f[i]=e,r()}},s.focus=function(t){var e,n;e=a.indexOf(t),-1!==e&&(n=location.hash.replace(/^#/,""),n!==t&&"debug"!==n&&f[e]&&(window.location.hash="#"+t),r())},s.openValidTab=r}),this}}),define("ui/tabshandle",["./tabs"],function(t){return new t("#tabs > div","%s",!0)}),define("ui/opts",["../backend/options"],function(t){var e;return e=t}),define("ui/tab",["./opts","./toast","./strings"],function(t,e,n){return{Interface:{reset:function(){return!0},update:function(){return!0}},createTab:function(i,s,o,r){var a,u;return void 0===r&&(r={}),u=!1,a={reset:function(){try{s()}catch(t){console.error(t.stack)}},update:function(t){t&&(u=!1),u||(u=!0,window.setTimeout(function(){try{o()}catch(t){console.error(t.stack),new e(n.tabupdateerror.replace("%s",n["tab_"+i]))}u=!1},1))},getOptions:function(){return t.getOptions({options:r})},setOptions:function(e){return t.setOptions({options:r},e)?(r._changed&&r._changed(),!0):!1}}},Extends:[t.Interface]}}),define("ui/interfaces/emitter",[],function(){function t(){this.listeners=[]}return t.prototype.emit=function(t){var e,n,i;i=!1;for(e in this.listeners)n=this.listeners[e],n["on"+t]&&(n["on"+t].call(n,this,t),i=!0);return i},t.prototype.registerListener=function(t){return this.unregisterListener(t),this.listeners.push(t),this},t.prototype.unregisterListener=function(t){var e;return e=this.listeners.indexOf(t),-1!==e&&this.listeners.splice(e,1),this},t}),define("ui/interfaces/model",["lib/extend","./emitter"],function(t,e){function n(){n.superconstructor.call(this)}return t(n,e),n}),define("ui/interfaces/view",["./model"],function(t){function e(e,n){this.model=e||new t,this.$view=n,this.model.registerListener(this)}return e.prototype.reset=function(){},e.prototype.update=function(){},e.prototype.hide=function(){this.$view.hide()},e.prototype.show=function(){this.$view.show()},e.prototype.detach=function(){this.$view.detach()},e.prototype.getElem=function(){return this.$view},e}),define("ui/interfaces/controller",[],function(){function t(t){this.model=t.model,this.view=t}return t}),define("ui/boxcontroller",["lib/extend","./interfaces/controller"],function(t,e){function n(t){var e;n.superconstructor.call(this,t),e=this.model,this.view.getElem().on("click","> h3:first-child",function(){e.emit("toggle")})}return t(n,e),n}),define("ui/boxview",["lib/extend","./interfaces/view","./boxcontroller"],function(t,e,n){function i(t){var e,n,i,s;for(s=!t.hasClass("collapsed"),n=t.find("a, button, input, select, textarea"),e=0;e<n.length;e+=1)i=n.eq(e),s?(void 0===i.data().tabindex?i.removeAttr("tabindex"):i.attr("tabindex",i.data().tabindex),delete i.data().tabindex):(i.data().tabindex=i.attr("tabindex"),i.attr("tabindex",-1))}function s(t){s.superconstructor.call(this,void 0,t),this.$view.hasClass("collapsed")&&i(this.$view.css("height",0)),new n(this)
}var s;return t(s,e),s.prototype.reset=function(){i(this.$view.removeClass("collapsed").css("height","").css("transition",""))},s.prototype.update=function(){var t;t=this.$view,t.hasClass("collapsed")?targetheight=0:(oldheight=t.height(),t.css("transition",""),t.css("height",""),t[0].offsetHeight,targetheight=t.height(),t.css("height",oldheight),t[0].offsetHeight),t.css("height",t.height()),t.css("transition","height 0.5s"),t[0].offsetHeight,t.css("height",targetheight),i(t),setTimeout(function(){t.css("transition",""),t.hasClass("collapsed")||t.css("height","")},500)},s.prototype.ontoggle=function(){this.$view.toggleClass("collapsed"),this.update()},s}),define("ui/tab_ranking",["./tournaments","./team","./toast","./strings","./options","./tabshandle","./tab","./history","./shared","./boxview"],function(t,e,n,i,s,o,r,a,u,l){function c(){var t,e;for(P={},P.$box=w.find("div.box.tpl"),P.$box.detach(),P.$box.removeClass("tpl"),P.$boxname=P.$box.find(">h3"),P.rank={},P.rank.$table=P.$box.find("table.ranking"),P.rank.$table.detach(),P.rank.$row=P.rank.$table.find(".line"),P.rank.$row.detach(),e=P.rank.$row.find("td"),P.rank.$fields=[],t=0;t<e.length;t+=1)P.rank.$fields[t]=e.eq(t);for(P.correction={},P.correction.$container=P.$box.find(".corrections"),P.correction.$container.detach(),P.correction.$correction=P.correction.$container.find(".corr"),P.correction.$correction.detach(),P.correction.$points=[],e=P.correction.$correction.find(".points span"),t=0;t<e.length;t+=1)P.correction.$points[t]=e.eq(t);for(P.correction.$teamnos=[],e=P.correction.$correction.find(".teamno"),t=0;t<e.length;t+=1)P.correction.$teamnos[t]=e.eq(t);h()}function h(){var t;for(P.rank.$table.find("th:nth-child(3)").attr("colspan",s.teamsize),t=0;t<s.maxteamsize;t+=1)t<s.teamsize?P.rank.$fields[t+2]&&P.rank.$fields[t+2].css("display",""):P.rank.$fields[t+2]&&P.rank.$fields[t+2].css("display","none")}function d(){return w?(console.error("tab_ranking: $tab already exists:"),void console.error(w)):(w=$("#ranking"),void c())}function p(t,n){var o,r,a,u;for(o=n.ids[t],r=e.get(o),P.rank.$fields[0].text(n.place[t]+1),P.rank.$fields[1].text(r.id+1),u=0;u<s.teamsize;u+=1)P.rank.$fields[u+2].text(r.names[u]);if(P.rank.$fields[5].text(n.games?n.games[t]:""),P.rank.$fields[6].text(n.wins?n.wins[t]:""),P.rank.$fields[7].text(n.buchholz?n.buchholz[t]:""),P.rank.$fields[8].text(n.finebuchholz?n.finebuchholz[t]:""),P.rank.$fields[9].text(n.netto?n.netto[t]:""),a=[],n.upvote)for(u=0;u<n.upvote[t];++u)a.push(i.upvote);if(n.downvote)for(u=0;u<n.downvote[t];++u)a.push(i.downvote);if(n.byevote)for(u=0;u<n.byevote[t];++u)a.push(i.byevote);return P.rank.$fields[10].text(a.join("")),P.rank.$row.clone()}function f(e,n){var i,s,o,r;if(o=P.rank.$table.clone(),i=t.getRanking(e),i.round<=0)return!1;for(s=0;s<i.ids.length;s+=1)o.append(p(s,i));return r=i.ids.length>0,r&&n.append(o),r}function m(t,e){var n,i,s,o;return i=!0,n=a.getCorrections(t),void 0===n||0===n.length?!1:(s=P.correction.$container.clone(),o=s.find(".correctionstable"),n.forEach(function(t){var e;e=t[0][0],P.correction.$teamnos[0].text(e+1),e=t[0][1],P.correction.$teamnos[1].text(e+1),P.correction.$points[0].text(t[0][2]),P.correction.$points[1].text(t[0][3]),P.correction.$points[2].text(t[1][2]),P.correction.$points[3].text(t[1][3]),o.append(P.correction.$correction.clone()),i=!1}),i||e.append(s),!i)}function g(){w||d(),w.find(".box").remove(),h()}function v(){var e,n,i,s;for(e=!0,g(),n=0;n<t.numTournaments();n+=1)i=!1,P.$boxname.text(t.getName(n)),s=P.$box.clone(),f(n,s)&&(e=!1,i=!0),m(n,s)&&(e=!1,i=!0),i&&(w.append(s),t.isRunning(n)||s.addClass("collapsed"),new l(s));e?o.hide("ranking"):o.show("ranking")}function b(){v()===!0}var y,P,w,j;return j=!1,y=r.createTab("ranking",g,b),u.Tab_Ranking=y,y}),function(t){if(t.URL=t.URL||t.webkitURL,t.Blob&&t.URL)try{return void new Blob}catch(e){}var n=t.BlobBuilder||t.WebKitBlobBuilder||t.MozBlobBuilder||function(t){var e=function(t){return Object.prototype.toString.call(t).match(/^\[object\s(.*)\]$/)[1]},n=function(){this.data=[]},i=function(t,e,n){this.data=t,this.size=t.length,this.type=e,this.encoding=n},s=n.prototype,o=i.prototype,r=t.FileReaderSync,a=function(t){this.code=this[this.name=t]},u="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),l=u.length,c=t.URL||t.webkitURL||t,h=c.createObjectURL,d=c.revokeObjectURL,p=c,f=t.btoa,m=t.atob,g=t.ArrayBuffer,v=t.Uint8Array,b=/^[\w-]+:\/*\[?[\w\.:-]+\]?(?::[0-9]+)?/;for(i.fake=o.fake=!0;l--;)a.prototype[u[l]]=l+1;return c.createObjectURL||(p=t.URL=function(t){var e,n=document.createElementNS("http://www.w3.org/1999/xhtml","a");return n.href=t,"origin"in n||("data:"===n.protocol.toLowerCase()?n.origin=null:(e=t.match(b),n.origin=e&&e[1])),n}),p.createObjectURL=function(t){var e,n=t.type;return null===n&&(n="application/octet-stream"),t instanceof i?(e="data:"+n,"base64"===t.encoding?e+";base64,"+t.data:"URI"===t.encoding?e+","+decodeURIComponent(t.data):f?e+";base64,"+f(t.data):e+","+encodeURIComponent(t.data)):h?h.call(c,t):void 0},p.revokeObjectURL=function(t){"data:"!==t.substring(0,5)&&d&&d.call(c,t)},s.append=function(t){var n=this.data;if(v&&(t instanceof g||t instanceof v)){for(var s="",o=new v(t),u=0,l=o.length;l>u;u++)s+=String.fromCharCode(o[u]);n.push(s)}else if("Blob"===e(t)||"File"===e(t)){if(!r)throw new a("NOT_READABLE_ERR");var c=new r;n.push(c.readAsBinaryString(t))}else t instanceof i?"base64"===t.encoding&&m?n.push(m(t.data)):"URI"===t.encoding?n.push(decodeURIComponent(t.data)):"raw"===t.encoding&&n.push(t.data):("string"!=typeof t&&(t+=""),n.push(unescape(encodeURIComponent(t))))},s.getBlob=function(t){return arguments.length||(t=null),new i(this.data.join(""),t,"raw")},s.toString=function(){return"[object BlobBuilder]"},o.slice=function(t,e,n){var s=arguments.length;return 3>s&&(n=null),new i(this.data.slice(t,s>1?e:this.data.length),n,this.encoding)},o.toString=function(){return"[object Blob]"},o.close=function(){this.size=0,delete this.data},n}(t);t.Blob=function(t,e){var i=e?e.type||"":"",s=new n;if(t)for(var o=0,r=t.length;r>o;o++)s.append(t[o]);return s.getBlob(i)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content||this),define("lib/Blob",function(t){return function(){var e;return e||t.Blob}}(this)),window.Modernizr=function(t,e,n){function i(t){f.cssText=t}function s(t,e){return typeof t===e}function o(){l.inputtypes=function(t){for(var i,s,o,r=0,a=t.length;a>r;r++)m.setAttribute("type",s=t[r]),i="text"!==m.type,i&&(m.value=g,m.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(s)&&m.style.WebkitAppearance!==n?(h.appendChild(m),o=e.defaultView,i=o.getComputedStyle&&"textfield"!==o.getComputedStyle(m,null).WebkitAppearance&&0!==m.offsetHeight,h.removeChild(m)):/^(search|tel)$/.test(s)||(i=/^(url|email)$/.test(s)?m.checkValidity&&m.checkValidity()===!1:m.value!=g)),b[t[r]]=!!i;return b}("search tel url email datetime date month week time datetime-local number range color".split(" "))}var r,a,u="2.8.2",l={},c=!0,h=e.documentElement,d="modernizr",p=e.createElement(d),f=p.style,m=e.createElement("input"),g=":)",v=({}.toString,{}),b={},y=[],P=y.slice,w=function(){function t(t,o){o=o||e.createElement(i[t]||"div"),t="on"+t;var r=t in o;return r||(o.setAttribute||(o=e.createElement("div")),o.setAttribute&&o.removeAttribute&&(o.setAttribute(t,""),r=s(o[t],"function"),s(o[t],"undefined")||(o[t]=n),o.removeAttribute(t))),o=null,r}var i={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return t}(),j={}.hasOwnProperty;a=s(j,"undefined")||s(j.call,"undefined")?function(t,e){return e in t&&s(t.constructor.prototype[e],"undefined")}:function(t,e){return j.call(t,e)},Function.prototype.bind||(Function.prototype.bind=function(t){var e=this;if("function"!=typeof e)throw new TypeError;var n=P.call(arguments,1),i=function(){if(this instanceof i){var s=function(){};s.prototype=e.prototype;var o=new s,r=e.apply(o,n.concat(P.call(arguments)));return Object(r)===r?r:o}return e.apply(t,n.concat(P.call(arguments)))};return i}),v.postmessage=function(){return!!t.postMessage},v.hashchange=function(){return w("hashchange",t)&&(e.documentMode===n||e.documentMode>7)},v.localstorage=function(){try{return localStorage.setItem(d,d),localStorage.removeItem(d),!0}catch(t){return!1}},v.webworkers=function(){return!!t.Worker};for(var x in v)a(v,x)&&(r=x.toLowerCase(),l[r]=v[x](),y.push((l[r]?"":"no-")+r));return l.input||o(),l.addTest=function(t,e){if("object"==typeof t)for(var i in t)a(t,i)&&l.addTest(i,t[i]);else{if(t=t.toLowerCase(),l[t]!==n)return l;e="function"==typeof e?e():e,"undefined"!=typeof c&&c&&(h.className+=" "+(e?"":"no-")+t),l[t]=e}return l},i(""),p=m=null,function(t,e){function n(t,e){var n=t.createElement("p"),i=t.getElementsByTagName("head")[0]||t.documentElement;return n.innerHTML="x<style>"+e+"</style>",i.insertBefore(n.lastChild,i.firstChild)}function i(){var t=b.elements;return"string"==typeof t?t.split(" "):t}function s(t){var e=v[t[m]];return e||(e={},g++,t[m]=g,v[g]=e),e}function o(t,n,i){if(n||(n=e),c)return n.createElement(t);i||(i=s(n));var o;return o=i.cache[t]?i.cache[t].cloneNode():f.test(t)?(i.cache[t]=i.createElem(t)).cloneNode():i.createElem(t),!o.canHaveChildren||p.test(t)||o.tagUrn?o:i.frag.appendChild(o)}function r(t,n){if(t||(t=e),c)return t.createDocumentFragment();n=n||s(t);for(var o=n.frag.cloneNode(),r=0,a=i(),u=a.length;u>r;r++)o.createElement(a[r]);return o}function a(t,e){e.cache||(e.cache={},e.createElem=t.createElement,e.createFrag=t.createDocumentFragment,e.frag=e.createFrag()),t.createElement=function(n){return b.shivMethods?o(n,t,e):e.createElem(n)},t.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+i().join().replace(/[\w\-]+/g,function(t){return e.createElem(t),e.frag.createElement(t),'c("'+t+'")'})+");return n}")(b,e.frag)}function u(t){t||(t=e);var i=s(t);return b.shivCSS&&!l&&!i.hasCSS&&(i.hasCSS=!!n(t,"article,aside,dialog,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}mark{background:#FF0;color:#000}template{display:none}")),c||a(t,i),t}var l,c,h="3.7.0",d=t.html5||{},p=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,f=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,m="_html5shiv",g=0,v={};!function(){try{var t=e.createElement("a");t.innerHTML="<xyz></xyz>",l="hidden"in t,c=1==t.childNodes.length||function(){e.createElement("a");var t=e.createDocumentFragment();return"undefined"==typeof t.cloneNode||"undefined"==typeof t.createDocumentFragment||"undefined"==typeof t.createElement}()}catch(n){l=!0,c=!0}}();var b={elements:d.elements||"abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video",version:h,shivCSS:d.shivCSS!==!1,supportsUnknownElements:c,shivMethods:d.shivMethods!==!1,type:"default",shivDocument:u,createElement:o,createDocumentFragment:r};t.html5=b,u(e)}(this,e),l._version=u,l.hasEvent=w,h.className=h.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(c?" js "+y.join(" "):""),l}(this,this.document),function(t,e,n){function i(t){return"[object Function]"==g.call(t)}function s(t){return"string"==typeof t}function o(){}function r(t){return!t||"loaded"==t||"complete"==t||"uninitialized"==t}function a(){var t=v.shift();b=1,t?t.t?f(function(){("c"==t.t?d.injectCss:d.injectJs)(t.s,0,t.a,t.x,t.e,1)},0):(t(),a()):b=0}function u(t,n,i,s,o,u,l){function c(e){if(!p&&r(h.readyState)&&(y.r=p=1,!b&&a(),h.onload=h.onreadystatechange=null,e)){"img"!=t&&f(function(){w.removeChild(h)},50);for(var i in S[n])S[n].hasOwnProperty(i)&&S[n][i].onload()}}var l=l||d.errorTimeout,h=e.createElement(t),p=0,g=0,y={t:i,s:n,e:o,a:u,x:l};1===S[n]&&(g=1,S[n]=[]),"object"==t?h.data=n:(h.src=n,h.type=t),h.width=h.height="0",h.onerror=h.onload=h.onreadystatechange=function(){c.call(this,g)},v.splice(s,0,y),"img"!=t&&(g||2===S[n]?(w.insertBefore(h,P?null:m),f(c,l)):S[n].push(h))}function l(t,e,n,i,o){return b=0,e=e||"j",s(t)?u("c"==e?x:j,t,e,this.i++,n,i,o):(v.splice(this.i++,0,t),1==v.length&&a()),this}function c(){var t=d;return t.loader={load:l,i:0},t}var h,d,p=e.documentElement,f=t.setTimeout,m=e.getElementsByTagName("script")[0],g={}.toString,v=[],b=0,y="MozAppearance"in p.style,P=y&&!!e.createRange().compareNode,w=P?p:m.parentNode,p=t.opera&&"[object Opera]"==g.call(t.opera),p=!!e.attachEvent&&!p,j=y?"object":p?"script":"img",x=p?"script":j,E=Array.isArray||function(t){return"[object Array]"==g.call(t)},C=[],S={},_={timeout:function(t,e){return e.length&&(t.timeout=e[0]),t}};d=function(t){function e(t){var e,n,i,t=t.split("!"),s=C.length,o=t.pop(),r=t.length,o={url:o,origUrl:o,prefixes:t};for(n=0;r>n;n++)i=t[n].split("="),(e=_[i.shift()])&&(o=e(o,i));for(n=0;s>n;n++)o=C[n](o);return o}function r(t,s,o,r,a){var u=e(t),l=u.autoCallback;u.url.split(".").pop().split("?").shift(),u.bypass||(s&&(s=i(s)?s:s[t]||s[r]||s[t.split("/").pop().split("?")[0]]),u.instead?u.instead(t,s,o,r,a):(S[u.url]?u.noexec=!0:S[u.url]=1,o.load(u.url,u.forceCSS||!u.forceJS&&"css"==u.url.split(".").pop().split("?").shift()?"c":n,u.noexec,u.attrs,u.timeout),(i(s)||i(l))&&o.load(function(){c(),s&&s(u.origUrl,a,r),l&&l(u.origUrl,a,r),S[u.url]=2})))}function a(t,e){function n(t,n){if(t){if(s(t))n||(h=function(){var t=[].slice.call(arguments);d.apply(this,t),p()}),r(t,h,e,0,l);else if(Object(t)===t)for(u in a=function(){var e,n=0;for(e in t)t.hasOwnProperty(e)&&n++;return n}(),t)t.hasOwnProperty(u)&&(!n&&!--a&&(i(h)?h=function(){var t=[].slice.call(arguments);d.apply(this,t),p()}:h[u]=function(t){return function(){var e=[].slice.call(arguments);t&&t.apply(this,e),p()}}(d[u])),r(t[u],h,e,u,l))}else!n&&p()}var a,u,l=!!t.test,c=t.load||t.both,h=t.callback||o,d=h,p=t.complete||o;n(l?t.yep:t.nope,!!c),c&&n(c)}var u,l,h=this.yepnope.loader;if(s(t))r(t,0,h,0);else if(E(t))for(u=0;u<t.length;u++)l=t[u],s(l)?r(l,0,h,0):E(l)?d(l):Object(l)===l&&a(l,h);else Object(t)===t&&a(t,h)},d.addPrefix=function(t,e){_[t]=e},d.addFilter=function(t){C.push(t)},d.errorTimeout=1e4,null==e.readyState&&e.addEventListener&&(e.readyState="loading",e.addEventListener("DOMContentLoaded",h=function(){e.removeEventListener("DOMContentLoaded",h,0),e.readyState="complete"},0)),t.yepnope=c(),t.yepnope.executeStack=a,t.yepnope.injectJs=function(t,n,i,s,u,l){var c,h,p=e.createElement("script"),s=s||d.errorTimeout;p.src=t;for(h in i)p.setAttribute(h,i[h]);n=l?a:n||o,p.onreadystatechange=p.onload=function(){!c&&r(p.readyState)&&(c=1,n(),p.onload=p.onreadystatechange=null)},f(function(){c||(c=1,n(1))},s),u?p.onload():m.parentNode.insertBefore(p,m)},t.yepnope.injectCss=function(t,n,i,s,r,u){var l,s=e.createElement("link"),n=u?a:n||o;s.href=t,s.rel="stylesheet",s.type="text/css";for(l in i)s.setAttribute(l,i[l]);r||(m.parentNode.insertBefore(s,m),f(n,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))},Modernizr.addTest("adownload","download"in document.createElement("a")),Modernizr.addTest("filereader",function(){return!!(window.File&&window.FileList&&window.FileReader)}),Modernizr.addTest("json",!!window.JSON&&!!JSON.parse),define("lib/modernizr",["lib/Blob"],function(t){return function(){var e;return e||t.Modernizr}}(this)),define("ui/storage",["./options","./shared","lib/modernizr"],function(t,e,n){function i(t){var e,n;return(e=r[t])?(console.log("blobbing "+t),(n=e.toBlob())?(console.log("storing "+t),window.localStorage.setItem(t,n),window.localStorage.getItem(t)!==n):!0):!0}function s(t){var e,n;return(e=r[t])?(n=window.localStorage.getItem(t))?void e.fromBlob(n):!0:(console.error("localStorage."+t+" doesn't exist"),!0)}var o,r,a;return o={},r={},a={},o.clear=function(t){if(void 0===t)for(t in r)o.clear(t);else r[t]&&(r[t].reset&&r[t].reset(),window.localStorage.removeItem(t))},o.store=function(){var t;for(t in r)1==a[t]||(a[t]=!0,window.setTimeout(function(t){i(t)&&console.error("Error when storing "+t),a[t]=!1},1,t));return!0},o.restore=function(){var t,e;e=!1;for(t in r)s(t)&&(e=!0,console.warn("Could not read key '"+t+"' from localStorage (yet)"));return!e},o.enable=function(){o.disable(),n.localstorage&&(r[t.dbname]=e.State,r[t.dbplayername]=e.Players)},o.disable=function(){r={}},o.changed=function(){e.Tab_Settings.reset(),o.store()},e.Storage=o,o}),define("ui/tab_history",["./toast","./strings","./history","./tournaments","./tab_ranking","../backend/game","./storage","./tabshandle","./tab","./team","./options","./shared","lib/jsPlumb","./boxview"],function(t,e,n,i,s,o,r,a,u,l,c,h,d,p){function f(t){var e;return e=l.get(t),e?e.names.join("<br>"):void 0}function m(t,e){Y.game.$teamnos[0].text(t[0]+1),Y.game.$teamnos[1].text(t[1]+1),Y.game.$names[0].html(f(t[0])),Y.game.$names[1].html(f(t[1])),Y.game.$correct.text(t[2]+":"+t[3]),e.append(Y.game.$game.clone())}function g(t,e){Y.bye.$teamno.text(t+1),Y.bye.$names.html(f(t)),e.append(Y.bye.$bye.clone())}function v(t){return t%1===0}function b(t,e){return v(t)&&v(e)&&!isNaN(t)&&!isNaN(e)&&t!==e&&t>=0&&e>=0}function y(){var t;t=K.text().split(":").map(function(t){return Number(t)}),Y.chpoints.$inputs[0].val(t[0]),Y.chpoints.$inputs[1].val(t[1]),K.after(Y.chpoints.$chpoints),K.detach(),Y.chpoints.$inputs[0].focus()}function P(){return void 0===K?void 0:(Y.chpoints.$chpoints.after(K),Y.chpoints.$chpoints.detach(),K=void 0,void new t(e.pointchangeaborted))}function w(){var a,u,l,c,h,d,p,f,m,g,y,w,j;if(void 0===K)return void 0;if(w=Y.chpoints.$chpoints.parents(".box"),!w.length)return void console.error("$box not found");if(j=w.data("tournamentid"),void 0===j)return void console.error("cannot find tournamentid of $box");if(h=K.text().split(":").map(function(t){return Number(t)}),a=h[0],u=h[1],l=Number(Y.chpoints.$inputs[0].val()),c=Number(Y.chpoints.$inputs[1].val()),!b(a,u)||!b(l,c))return new t(e.invalidresult),P(),void W.update();if(a===l&&u===c)return void P();if(Q?($teams=Y.chpoints.$chpoints.parents(".team").find(".number"),d=Number($teams.text()),p=Number(Y.chpoints.$chpoints.prev().text())):($teams=Y.chpoints.$chpoints.parents(".game").find(".number"),d=Number($($teams[0]).text()),p=Number($($teams[1]).text())),!v(d)||!v(p)||isNaN(d)||isNaN(p))return new t(e.invalidresult),P(),void W.update();if(d-=1,p-=1,f=n.findGames(j,d,p),void 0===f||0===f.length)return new t(e.invalidresult),P(),void W.update();if(1!==f.length)return console.error("History.findGames() result contains more than 1 match"),P(),void W.update();if(f=f[0],d===f[1]&&(g=l,l=c,c=g,g=a,a=u,u=g),f[2]!==a||f[3]!==u)return new t(e.invalidresult),P(),void W.update();if(m=new o(f[0],f[1]),i.isRunning(j)){if(!i.getTournament(j).correct(m,[a,u],[l,c]))return console.error("could not apply correction"),void new t(e.invalidresult)}else new t(e.toolatetournamentfinished,t.LONG);y=f.slice(0),y[2]=l,y[3]=c,n.addCorrection(j,f,y),s.update(),K.text(l+":"+c),Y.chpoints.$chpoints.after(K),Y.chpoints.$chpoints.detach(),K=void 0,r.changed(),W.update(),new t(e.pointchangeapplied)}function j(){function t(){i.prop("checked")?G.addClass("maxwidth"):G.removeClass("maxwidth")}function e(){s.prop("checked")?(G.removeClass("hidenames"),i.removeAttr("disabled")):(G.addClass("hidenames"),i.attr("disabled","disabled"))}function n(){Q=o.prop("checked")}var i,s,o;i=G.find(".options .maxwidth"),i.click(t),t(),s=G.find(".options .shownames"),s.click(e),e(),o=G.find(".options .progress"),o.click(function(){n(),W.update()}),n()}function x(){K=void 0,G.on("click",".team .correct",function(){return P(),K=$(this),y(),!1}),Y.chpoints.$chpoints.submit(function(t){return w(),t.preventDefault(),!1}),Y.chpoints.$chpoints.find(".points").keydown(function(t){return 13===t.which?(Y.chpoints.$chpoints.find("button.change").click(),t.preventDefault(),!1):27===t.which?(Y.chpoints.$chpoints.find("button.abort").click(),t.preventDefault(),!1):void 0}),Y.chpoints.$chpoints.find("button.abort").click(function(t){return P(),t.preventDefault(),!1})}function E(){var t,e;if(Y)return console.error("tab_history: template already exists:"),void console.error(Y);for(Y={},Y.$container=G.find(".box.tpl"),Y.$container.detach(),Y.$container.removeClass("tpl"),Y.kotree={},Y.kotree.$container=Y.$container.find(".kotree"),Y.kotree.$container.detach(),Y.kotree.$game=Y.kotree.$container.find(".game"),Y.kotree.$game.detach(),Y.kotree.$names=Y.kotree.$game.find(".names"),Y.kotree.$teamno=Y.kotree.$game.find(".number"),Y.kotree.$points=Y.kotree.$game.find(".points"),Y.progresstable={},Y.progresstable.$container=Y.$container.find("table.progresstable"),Y.progresstable.$container.detach(),Y.progresstable.$nameheader=Y.progresstable.$container.find("th.names"),Y.progresstable.$gameheader=Y.progresstable.$container.find("th.game"),Y.progresstable.$gameheader.detach(),Y.progresstable.$resultheader=Y.progresstable.$container.find("th.result"),Y.progresstable.$resultheader.detach(),Y.progresstable.$team=Y.progresstable.$container.find(".team"),Y.progresstable.$team.detach(),Y.progresstable.$teamno=Y.progresstable.$team.find(".number"),Y.progresstable.$names=Y.progresstable.$team.find(".names"),Y.progresstable.$game=Y.progresstable.$team.find("td.game"),Y.progresstable.$game.detach(),Y.progresstable.$result=Y.progresstable.$team.find("td.result"),Y.progresstable.$result.detach(),Y.game={},Y.$gamescontainer=Y.$container.find("table.gamestable"),Y.$gamescontainer.detach(),Y.game.$game=Y.$gamescontainer.find(".game.tpl"),Y.game.$game.detach(),Y.game.$game.removeClass("tpl"),Y.game.$teamnos=[],e=Y.game.$game.find(".number"),t=0;t<e.length;t+=1)Y.game.$teamnos[t]=e.eq(t);for(Y.game.$names=[],e=Y.game.$game.find(".names"),t=0;t<e.length;t+=1)Y.game.$names[t]=e.eq(t);for(Y.game.$correct=Y.game.$game.find(".correct"),Y.chpoints={},Y.chpoints.$chpoints=Y.game.$game.find(".chpoints"),Y.chpoints.$chpoints.detach(),Y.chpoints.$inputs=[],e=Y.chpoints.$chpoints.find("input"),t=0;t<e.length;t+=1)Y.chpoints.$inputs[t]=e.eq(t);Y.chpoints.$savebutton=Y.chpoints.$chpoints.find("button"),Y.bye={},Y.bye.$bye=Y.$gamescontainer.find(".bye.tpl"),Y.bye.$bye.detach(),Y.bye.$bye.removeClass("tpl"),Y.bye.$teamno=Y.bye.$bye.find(".number"),Y.bye.$names=Y.bye.$bye.find(".names")}function C(){X=0}function S(){return G?(console.error("tab_history: $tab already exists:"),void console.error(G)):(G=$("#history"),C(),E(),x(),void j())}function _(t){var e,s,o,r,a,u,t,l,c;for(u=n.getVotes(t),s=n.numRounds(t),e=0;s>e;e+=1)l=Y.$container.clone(),l.find(">h3:first-child").text(i.getName(t)+" - Runde "+(e+1)),c=Y.$gamescontainer.clone(),l.append(c),o=void 0,u.map(function(t){var i;t[0]==n.BYE&&t[2]==e&&(i=t[1],void 0!==i&&(g(i,c),a=!1))}),n.getRound(t,e).map(function(t){m(t,c),a=!1}),a||(G.append(l),l.data("tournamentid",t),i.isRunning(t)||l.addClass("collapsed"),new p(l),r=!1);return!r}function k(t){return!jQuery.isArray(t)&&t-parseFloat(t)+1>=0}function D(t){function s(t,e,n,i,s){o[e]||(o[e]=[]),k(n)&&(n+=1),o[e][t]={opponent:n,points:i+":"+s,won:i==s?void 0:i>s}}var o,r,a;return o=[],n.getVotes(t)&&n.getVotes(t).map(function(t){t[0]===n.BYE&&s(t[2],t[1],e.byevote,13,7)}),n.getGames(t)&&n.getGames(t).map(function(t){s(t[4],t[0],t[1],t[2],t[3]),s(t[4],t[1],t[0],t[3],t[2])}),a=i.getTournament(t),a&&(r=i.getRanking(t).round-1,a.getGames().map(function(t){s(r,t.teams[0][0],t.teams[1][0],"",""),s(r,t.teams[1][0],t.teams[0][0],"","")})),o}function A(t){var e,n;return n=[],(e=i.getRanking(t))?(e.ids.map(function(t,i){n[t]=[e.wins[i],e.buchholz[i],e.finebuchholz[i],e.netto[i],e.place[i]+1]}),n):void console.error("no ranking returned")}function I(t){var s,o,r,a,u,h,d,f;for(a=Math.max(n.numRounds(t)||0,i.getRanking(t).round||0),Y.progresstable.$nameheader.removeClass("hidden"),f=c.teamsize;3>f;f+=1)Y.progresstable.$nameheader.eq(f).addClass("hidden");for(u=Y.$container.clone(),u.find(">h3:first-child").text(i.getName(t)+" - Fortschrittstabelle"),h=Y.progresstable.$container.clone(),f=0;a>f;f+=1)Y.progresstable.$gameheader.find(".roundno").text(f+1),h.find("th:last-child").after(Y.progresstable.$gameheader.clone());for(h.find("th:last-child").after(Y.progresstable.$resultheader.clone()),s=D(t),teamranks=A(t),s.length!=teamranks.length&&console.error("teamgames.length != teamranks.length: "+s.length+"!="+teamranks.length),Y.progresstable.$names.removeClass("hidden"),o=0;o<s.length;o+=1)if(void 0!==o){for(r=l.get(o),Y.progresstable.$teamno.text(o+1),f=0;3>f;f+=1)r.names[f]?Y.progresstable.$names.eq(f).text(r.names[f]):Y.progresstable.$names.eq(f).addClass("hidden");d=Y.progresstable.$team.clone(),s[o]&&s[o].map(function(t){var n;n=Y.progresstable.$game.clone(),n.eq(0).text(t.opponent),n.eq(1).text(t.points),t.opponent===e.byevote&&n.eq(1).removeClass("correct editable"),n.eq(2).text(e["winstatus"+t.won]),d.append(n)}),teamranks[o].map(function(t,e){Y.progresstable.$result.eq(e).text(t)}),d.append(Y.progresstable.$result.clone()),h.append(d)}return u.data("tournamentid",t),u.append(h),G.append(u),i.isRunning(t)||u.addClass("collapsed"),new p(u),a>0}function O(t){return Math.floor(Math.log(t+1)/Math.LN2)}function T(t){return Math.floor((t-1)/2)}function M(t){return N(t)-1}function N(t){return 1<<t}function R(t,e){var e,n,i,s;return i=1,s=15,n=O(t),i+(e-n)*s}function L(t,e){var e,n,i,s;return i=1,s=5,n=O(t),firstid=M(n),i+s*Math.pow(2,e-n-1)+s*Math.floor(.5*Math.pow(2,e-n+1))*(t-firstid)}function U(t,e){var n,i,s;return s=O(e),void 0!==t.t1||void 0!==t.t2||O(t.id)!==s?(Y.kotree.$teamno.eq(0).text(void 0===t.t1?"":t.t1+1),Y.kotree.$teamno.eq(1).text(void 0===t.t2?"":t.t2+1),Y.kotree.$names.text(""),void 0!==t.t1&&Y.kotree.$names.eq(0).text(l.get(t.t1).names.join(", ")),void 0!==t.t2&&Y.kotree.$names.eq(1).text(l.get(t.t2).names.join(", ")),Y.kotree.$points.text(t.p1+":"+t.p2),n=R(t.id,s),i=L(t.id,s),Y.kotree.$game.clone().css("left",n+"em").css("top",i+"em")):void 0}function B(t){var e,s,o,r,a,u,l,c,h;for("#history"!==window.location.hash&&(Z=!0),e=[],n.numRounds(t)&&n.getGames(t).map(function(t){e.push({id:t[5],t1:t[0],t2:t[1],p1:t[2],p2:t[3]})}),i.isRunning(t)&&i.getTournament(t).getGames().map(function(t){e.push({id:t.id,t1:t.teams[0][0],t2:t.teams[1][0],p1:"",p2:""})}),e.sort(function(t,e){return t.id-e.id}),s=0;s<e.length;s+=1)e[s].id>s&&e.splice(s,0,{id:s,t1:void 0,t2:void 0,p1:"",p2:""});if(i.isRunning(t)&&i.getTournament(t).gameid.map(function(n,s){n>=0&&void 0===e[n].t1&&(e[n].t1=i.getTournament(t).players.at(s))}),!e.length)return!1;for(o=Y.$container.clone(),o.find(">h3:first-child").text(i.getName(t)+" - KO-Baum"),$tree=Y.kotree.$container.clone(),s=0;s<e.length;s+=1)r=e[s],a=U(r,e.length-1),a&&(r.$box=a,$tree.append(a));for(o.append($tree),G.append(o),l=d.getInstance(),s=0;s<e.length;s+=1)a=e[s].$box,a&&z(a,l);for(c=R(0,O(e.length-1))+14.5,h=L(e.length-1,O(e.length-1))+4,$tree.css("width",c+"em"),$tree.css("height",h+"em"),s=e.length-1;s>=0;s-=1)u=T(e[s].id),u>=0&&F(e[s].$box,e[u].$box,l);return i.isRunning(t)||o.addClass("collapsed"),new p(o),e.length>0}function z(t,e){t&&(t.data("rightendpoint",e.addEndpoint(t.get(0),{endpoint:"Blank",anchor:"Right",maxConnections:5},void 0)),t.data("leftendpoint",e.addEndpoint(t.get(0),{endpoint:"Blank",anchor:"Left",maxConnections:5},void 0)))}function F(t,e,n){t&&e&&n.connect({source:t.data("rightendpoint"),target:e.data("leftendpoint"),paintStyle:{lineWidth:2,strokeStyle:"black"},connector:["Flowchart",{curviness:20,width:1},void 0]},void 0)}function H(){var t,e,s,o,r,a;for(t=!0,displaytype=Q?o:r,a=Math.max(n.numTournaments()||0,i.numTournaments()||0),e=0;a>e;e+=1){switch(i.getType(e)){case"swiss":s=I;break;case"ko":s=B;break;default:s=_}Q||(s=_),s(e)&&(t=!1)}return!t}function V(){G||S(),P(),G.find(".box").remove(),X=0}function q(){W.reset(),H()?a.show("history"):a.hide("history")}var W,G,Y,X,K,J,Q,Z;return J=!1,Z=!1,Q=!0,W=u.createTab("history",V,q),h.Tab_History=W,W}),define("ui/players",["./shared"],function(t){function e(t){return t.replace(/^\s*|\s*$|\n|\r/g,"").replace(/\s\s*/g," ")}function n(){t.Autocomplete.update()}var i,s,o;return o="Erik Lorenz",s=[o],i={},i.fromString=function(t){var r,a;r=t.split("\n");for(a in r)r[a]=e(r[a]).replace(/^#.*/,"");for(a=r.length-1;a>=0;a-=1)0===r[a].length&&r.splice(a,1);r.sort(),s=r,i.insert(o),n()},i.toString=function(){return s.join("\n")},i.fromBlob=function(t){var e=JSON.parse(t);e&&(e.sort(),s=e,i.insert(o),n())},i.toBlob=function(){return JSON.stringify(s)},i.clear=function(){s=[o],n()},i.reset=i.clear,i.get=function(){return s.slice()},i.insert=function(t){t=e(t),"string"==typeof t&&t.length>0?-1===s.indexOf(t)&&(s.push(t),s.sort(),n()):console.error("ui/players.js: name is no string: "+t)},i.erase=function(t){var i;t=e(t),"string"==typeof t&&t.length>0&&(i=s.indexOf(t),-1!==i&&t!==o&&(s.splice(i,1),n()))},t.Players=i,i}),!function(t){var e={isMsie:function(){return/(msie|trident)/i.test(navigator.userAgent)?navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]:!1},isBlankString:function(t){return!t||/^\s*$/.test(t)},escapeRegExChars:function(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t},isArray:t.isArray,isFunction:t.isFunction,isObject:t.isPlainObject,isUndefined:function(t){return"undefined"==typeof t},bind:t.proxy,each:function(e,n){function i(t,e){return n(e,t)}t.each(e,i)},map:t.map,filter:t.grep,every:function(e,n){var i=!0;return e?(t.each(e,function(t,s){return(i=n.call(null,s,t,e))?void 0:!1}),!!i):i},some:function(e,n){var i=!1;return e?(t.each(e,function(t,s){return(i=n.call(null,s,t,e))?!1:void 0}),!!i):i},mixin:t.extend,getUniqueId:function(){var t=0;return function(){return t++}}(),templatify:function(e){function n(){return String(e)}return t.isFunction(e)?e:n},defer:function(t){setTimeout(t,0)},debounce:function(t,e,n){var i,s;return function(){var o,r,a=this,u=arguments;return o=function(){i=null,n||(s=t.apply(a,u))},r=n&&!i,clearTimeout(i),i=setTimeout(o,e),r&&(s=t.apply(a,u)),s}},throttle:function(t,e){var n,i,s,o,r,a;return r=0,a=function(){r=new Date,s=null,o=t.apply(n,i)},function(){var u=new Date,l=e-(u-r);return n=this,i=arguments,0>=l?(clearTimeout(s),s=null,r=u,o=t.apply(n,i)):s||(s=setTimeout(a,l)),o}},noop:function(){}},n="0.10.2",i=function(){function t(t){return t.split(/\s+/)}function e(t){return t.split(/\W+/)}function n(t){return function(e){return function(n){return t(n[e])}}}return{nonword:e,whitespace:t,obj:{nonword:n(e),whitespace:n(t)}}}(),s=function(){function t(t){this.maxSize=t||100,this.size=0,this.hash={},this.list=new n}function n(){this.head=this.tail=null}function i(t,e){this.key=t,this.val=e,this.prev=this.next=null}return e.mixin(t.prototype,{set:function(t,e){var n,s=this.list.tail;this.size>=this.maxSize&&(this.list.remove(s),delete this.hash[s.key]),(n=this.hash[t])?(n.val=e,this.list.moveToFront(n)):(n=new i(t,e),this.list.add(n),this.hash[t]=n,this.size++)},get:function(t){var e=this.hash[t];return e?(this.list.moveToFront(e),e.val):void 0}}),e.mixin(n.prototype,{add:function(t){this.head&&(t.next=this.head,this.head.prev=t),this.head=t,this.tail=this.tail||t},remove:function(t){t.prev?t.prev.next=t.next:this.head=t.next,t.next?t.next.prev=t.prev:this.tail=t.prev},moveToFront:function(t){this.remove(t),this.add(t)}}),t}(),o=function(){function t(t){this.prefix=["__",t,"__"].join(""),this.ttlKey="__ttl__",this.keyMatcher=new RegExp("^"+this.prefix)}function n(){return(new Date).getTime()}function i(t){return JSON.stringify(e.isUndefined(t)?null:t)}function s(t){return JSON.parse(t)}var o,r;try{o=window.localStorage,o.setItem("~~~","!"),o.removeItem("~~~")}catch(a){o=null}return r=o&&window.JSON?{_prefix:function(t){return this.prefix+t},_ttlKey:function(t){return this._prefix(t)+this.ttlKey},get:function(t){return this.isExpired(t)&&this.remove(t),s(o.getItem(this._prefix(t)))},set:function(t,s,r){return e.isNumber(r)?o.setItem(this._ttlKey(t),i(n()+r)):o.removeItem(this._ttlKey(t)),o.setItem(this._prefix(t),i(s))
},remove:function(t){return o.removeItem(this._ttlKey(t)),o.removeItem(this._prefix(t)),this},clear:function(){var t,e,n=[],i=o.length;for(t=0;i>t;t++)(e=o.key(t)).match(this.keyMatcher)&&n.push(e.replace(this.keyMatcher,""));for(t=n.length;t--;)this.remove(n[t]);return this},isExpired:function(t){var i=s(o.getItem(this._ttlKey(t)));return e.isNumber(i)&&n()>i?!0:!1}}:{get:e.noop,set:e.noop,remove:e.noop,clear:e.noop,isExpired:e.noop},e.mixin(t.prototype,r),t}(),r=function(){function n(e){e=e||{},this._send=e.transport?i(e.transport):t.ajax,this._get=e.rateLimiter?e.rateLimiter(this._get):this._get}function i(n){return function(i,s){function o(t){e.defer(function(){a.resolve(t)})}function r(t){e.defer(function(){a.reject(t)})}var a=t.Deferred();return n(i,s,o,r),a}}var o=0,r={},a=6,u=new s(10);return n.setMaxPendingRequests=function(t){a=t},n.resetCache=function(){u=new s(10)},e.mixin(n.prototype,{_get:function(t,e,n){function i(e){n&&n(null,e),u.set(t,e)}function s(){n&&n(!0)}function l(){o--,delete r[t],h.onDeckRequestArgs&&(h._get.apply(h,h.onDeckRequestArgs),h.onDeckRequestArgs=null)}var c,h=this;(c=r[t])?c.done(i).fail(s):a>o?(o++,r[t]=this._send(t,e).done(i).fail(s).always(l)):this.onDeckRequestArgs=[].slice.call(arguments,0)},get:function(t,n,i){var s;return e.isFunction(n)&&(i=n,n={}),(s=u.get(t))?e.defer(function(){i&&i(null,s)}):this._get(t,n,i),!!s}}),n}(),a=function(){function n(e){e=e||{},e.datumTokenizer&&e.queryTokenizer||t.error("datumTokenizer and queryTokenizer are both required"),this.datumTokenizer=e.datumTokenizer,this.queryTokenizer=e.queryTokenizer,this.reset()}function i(t){return t=e.filter(t,function(t){return!!t}),t=e.map(t,function(t){return t.toLowerCase()})}function s(){return{ids:[],children:{}}}function o(t){for(var e={},n=[],i=0;i<t.length;i++)e[t[i]]||(e[t[i]]=!0,n.push(t[i]));return n}function r(t,e){function n(t,e){return t-e}var i=0,s=0,o=[];for(t=t.sort(n),e=e.sort(n);i<t.length&&s<e.length;)t[i]<e[s]?i++:t[i]>e[s]?s++:(o.push(t[i]),i++,s++);return o}return e.mixin(n.prototype,{bootstrap:function(t){this.datums=t.datums,this.trie=t.trie},add:function(t){var n=this;t=e.isArray(t)?t:[t],e.each(t,function(t){var o,r;o=n.datums.push(t)-1,r=i(n.datumTokenizer(t)),e.each(r,function(t){var e,i,r;for(e=n.trie,i=t.split("");r=i.shift();)e=e.children[r]||(e.children[r]=s()),e.ids.push(o)})})},get:function(t){var n,s,a=this;return n=i(this.queryTokenizer(t)),e.each(n,function(t){var e,n,i,o;if(s&&0===s.length)return!1;for(e=a.trie,n=t.split("");e&&(i=n.shift());)e=e.children[i];return e&&0===n.length?(o=e.ids.slice(0),void(s=s?r(s,o):o)):(s=[],!1)}),s?e.map(o(s),function(t){return a.datums[t]}):[]},reset:function(){this.datums=[],this.trie=s()},serialize:function(){return{datums:this.datums,trie:this.trie}}}),n}(),u=function(){function i(t){return t.local||null}function s(i){var s,o;return o={url:null,thumbprint:"",ttl:864e5,filter:null,ajax:{}},(s=i.prefetch||null)&&(s=e.isString(s)?{url:s}:s,s=e.mixin(o,s),s.thumbprint=n+s.thumbprint,s.ajax.type=s.ajax.type||"GET",s.ajax.dataType=s.ajax.dataType||"json",!s.url&&t.error("prefetch requires url to be set")),s}function o(n){function i(t){return function(n){return e.debounce(n,t)}}function s(t){return function(n){return e.throttle(n,t)}}var o,r;return r={url:null,wildcard:"%QUERY",replace:null,rateLimitBy:"debounce",rateLimitWait:300,send:null,filter:null,ajax:{}},(o=n.remote||null)&&(o=e.isString(o)?{url:o}:o,o=e.mixin(r,o),o.rateLimiter=/^throttle$/i.test(o.rateLimitBy)?s(o.rateLimitWait):i(o.rateLimitWait),o.ajax.type=o.ajax.type||"GET",o.ajax.dataType=o.ajax.dataType||"json",delete o.rateLimitBy,delete o.rateLimitWait,!o.url&&t.error("remote requires url to be set")),o}return{local:i,prefetch:s,remote:o}}();!function(n){function s(e){e&&(e.local||e.prefetch||e.remote)||t.error("one of local, prefetch, or remote is required"),this.limit=e.limit||5,this.sorter=l(e.sorter),this.dupDetector=e.dupDetector||c,this.local=u.local(e),this.prefetch=u.prefetch(e),this.remote=u.remote(e),this.cacheKey=this.prefetch?this.prefetch.cacheKey||this.prefetch.url:null,this.index=new a({datumTokenizer:e.datumTokenizer,queryTokenizer:e.queryTokenizer}),this.storage=this.cacheKey?new o(this.cacheKey):null}function l(t){function n(e){return e.sort(t)}function i(t){return t}return e.isFunction(t)?n:i}function c(){return!1}var h,d;return h=n.Bloodhound,d={data:"data",protocol:"protocol",thumbprint:"thumbprint"},n.Bloodhound=s,s.noConflict=function(){return n.Bloodhound=h,s},s.tokenizers=i,e.mixin(s.prototype,{_loadPrefetch:function(e){function n(t){o.clear(),o.add(e.filter?e.filter(t):t),o._saveToStorage(o.index.serialize(),e.thumbprint,e.ttl)}var i,s,o=this;return(i=this._readFromStorage(e.thumbprint))?(this.index.bootstrap(i),s=t.Deferred().resolve()):s=t.ajax(e.url,e.ajax).done(n),s},_getFromRemote:function(t,e){function n(t,n){e(t?[]:o.remote.filter?o.remote.filter(n):n)}var i,s,o=this;return t=t||"",s=encodeURIComponent(t),i=this.remote.replace?this.remote.replace(this.remote.url,t):this.remote.url.replace(this.remote.wildcard,s),this.transport.get(i,this.remote.ajax,n)},_saveToStorage:function(t,e,n){this.storage&&(this.storage.set(d.data,t,n),this.storage.set(d.protocol,location.protocol,n),this.storage.set(d.thumbprint,e,n))},_readFromStorage:function(t){var e,n={};return this.storage&&(n.data=this.storage.get(d.data),n.protocol=this.storage.get(d.protocol),n.thumbprint=this.storage.get(d.thumbprint)),e=n.thumbprint!==t||n.protocol!==location.protocol,n.data&&!e?n.data:null},_initialize:function(){function n(){s.add(e.isFunction(o)?o():o)}var i,s=this,o=this.local;return i=this.prefetch?this._loadPrefetch(this.prefetch):t.Deferred().resolve(),o&&i.done(n),this.transport=this.remote?new r(this.remote):null,this.initPromise=i.promise()},initialize:function(t){return!this.initPromise||t?this._initialize():this.initPromise},add:function(t){this.index.add(t)},get:function(t,n){function i(t){var i=o.slice(0);e.each(t,function(t){var n;return n=e.some(i,function(e){return s.dupDetector(t,e)}),!n&&i.push(t),i.length<s.limit}),n&&n(s.sorter(i))}var s=this,o=[],r=!1;o=this.index.get(t),o=this.sorter(o).slice(0,this.limit),o.length<this.limit&&this.transport&&(r=this._getFromRemote(t,i)),r||(o.length>0||!this.transport)&&n&&n(o)},clear:function(){this.index.reset()},clearPrefetchCache:function(){this.storage&&this.storage.clear()},clearRemoteCache:function(){this.transport&&r.resetCache()},ttAdapter:function(){return e.bind(this.get,this)}}),s}(this);var l={wrapper:'<span class="twitter-typeahead"></span>',dropdown:'<span class="tt-dropdown-menu"></span>',dataset:'<div class="tt-dataset-%CLASS%"></div>',suggestions:'<span class="tt-suggestions"></span>',suggestion:'<div class="tt-suggestion"></div>'},c={wrapper:{position:"relative",display:"inline-block"},hint:{position:"absolute",top:"0",left:"0",borderColor:"transparent",boxShadow:"none"},input:{position:"relative",verticalAlign:"top",backgroundColor:"transparent"},inputWithNoHint:{position:"relative",verticalAlign:"top"},dropdown:{position:"absolute",top:"100%",left:"0",zIndex:"100",display:"none"},suggestions:{display:"block"},suggestion:{whiteSpace:"nowrap",cursor:"pointer"},suggestionChild:{whiteSpace:"normal"},ltr:{left:"0",right:"auto"},rtl:{left:"auto",right:" 0"}};e.isMsie()&&e.mixin(c.input,{backgroundImage:"url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)"}),e.isMsie()&&e.isMsie()<=7&&e.mixin(c.input,{marginTop:"-1px"});var h=function(){function n(e){e&&e.el||t.error("EventBus initialized without el"),this.$el=t(e.el)}var i="typeahead:";return e.mixin(n.prototype,{trigger:function(t){var e=[].slice.call(arguments,1);this.$el.trigger(i+t,e)}}),n}(),d=function(){function t(t,e,n,i){var s;if(!n)return this;for(e=e.split(u),n=i?a(n,i):n,this._callbacks=this._callbacks||{};s=e.shift();)this._callbacks[s]=this._callbacks[s]||{sync:[],async:[]},this._callbacks[s][t].push(n);return this}function e(e,n,i){return t.call(this,"async",e,n,i)}function n(e,n,i){return t.call(this,"sync",e,n,i)}function i(t){var e;if(!this._callbacks)return this;for(t=t.split(u);e=t.shift();)delete this._callbacks[e];return this}function s(t){var e,n,i,s,r;if(!this._callbacks)return this;for(t=t.split(u),i=[].slice.call(arguments,1);(e=t.shift())&&(n=this._callbacks[e]);)s=o(n.sync,this,[e].concat(i)),r=o(n.async,this,[e].concat(i)),s()&&l(r);return this}function o(t,e,n){function i(){for(var i,s=0;!i&&s<t.length;s+=1)i=t[s].apply(e,n)===!1;return!i}return i}function r(){var t;return t=window.setImmediate?function(t){setImmediate(function(){t()})}:function(t){setTimeout(function(){t()},0)}}function a(t,e){return t.bind?t.bind(e):function(){t.apply(e,[].slice.call(arguments,0))}}var u=/\s+/,l=r();return{onSync:n,onAsync:e,off:i,trigger:s}}(),p=function(t){function n(t,n,i){for(var s,o=[],r=0;r<t.length;r++)o.push(e.escapeRegExChars(t[r]));return s=i?"\\b("+o.join("|")+")\\b":"("+o.join("|")+")",n?new RegExp(s):new RegExp(s,"i")}var i={node:null,pattern:null,tagName:"strong",className:null,wordsOnly:!1,caseSensitive:!1};return function(s){function o(e){var n,i;return(n=a.exec(e.data))&&(wrapperNode=t.createElement(s.tagName),s.className&&(wrapperNode.className=s.className),i=e.splitText(n.index),i.splitText(n[0].length),wrapperNode.appendChild(i.cloneNode(!0)),e.parentNode.replaceChild(wrapperNode,i)),!!n}function r(t,e){for(var n,i=3,s=0;s<t.childNodes.length;s++)n=t.childNodes[s],n.nodeType===i?s+=e(n)?1:0:r(n,e)}var a;s=e.mixin({},i,s),s.node&&s.pattern&&(s.pattern=e.isArray(s.pattern)?s.pattern:[s.pattern],a=n(s.pattern,s.caseSensitive,s.wordsOnly),r(s.node,o))}}(window.document),f=function(){function n(n){var s,o,a,u,l=this;n=n||{},n.input||t.error("input is missing"),s=e.bind(this._onBlur,this),o=e.bind(this._onFocus,this),a=e.bind(this._onKeydown,this),u=e.bind(this._onInput,this),this.$hint=t(n.hint),this.$input=t(n.input).on("blur.tt",s).on("focus.tt",o).on("keydown.tt",a),0===this.$hint.length&&(this.setHint=this.getHint=this.clearHint=this.clearHintIfInvalid=e.noop),e.isMsie()?this.$input.on("keydown.tt keypress.tt cut.tt paste.tt",function(t){r[t.which||t.keyCode]||e.defer(e.bind(l._onInput,l,t))}):this.$input.on("input.tt",u),this.query=this.$input.val(),this.$overflowHelper=i(this.$input)}function i(e){return t('<pre aria-hidden="true"></pre>').css({position:"absolute",visibility:"hidden",whiteSpace:"pre",fontFamily:e.css("font-family"),fontSize:e.css("font-size"),fontStyle:e.css("font-style"),fontVariant:e.css("font-variant"),fontWeight:e.css("font-weight"),wordSpacing:e.css("word-spacing"),letterSpacing:e.css("letter-spacing"),textIndent:e.css("text-indent"),textRendering:e.css("text-rendering"),textTransform:e.css("text-transform")}).insertAfter(e)}function s(t,e){return n.normalizeQuery(t)===n.normalizeQuery(e)}function o(t){return t.altKey||t.ctrlKey||t.metaKey||t.shiftKey}var r;return r={9:"tab",27:"esc",37:"left",39:"right",13:"enter",38:"up",40:"down"},n.normalizeQuery=function(t){return(t||"").replace(/^\s*/g,"").replace(/\s{2,}/g," ")},e.mixin(n.prototype,d,{_onBlur:function(){this.resetInputValue(),this.trigger("blurred")},_onFocus:function(){this.trigger("focused")},_onKeydown:function(t){var e=r[t.which||t.keyCode];this._managePreventDefault(e,t),e&&this._shouldTrigger(e,t)&&this.trigger(e+"Keyed",t)},_onInput:function(){this._checkInputValue()},_managePreventDefault:function(t,e){var n,i,s;switch(t){case"tab":i=this.getHint(),s=this.getInputValue(),n=i&&i!==s&&!o(e);break;case"up":case"down":n=!o(e);break;default:n=!1}n&&e.preventDefault()},_shouldTrigger:function(t,e){var n;switch(t){case"tab":n=!o(e);break;default:n=!0}return n},_checkInputValue:function(){var t,e,n;t=this.getInputValue(),e=s(t,this.query),n=e?this.query.length!==t.length:!1,e?n&&this.trigger("whitespaceChanged",this.query):this.trigger("queryChanged",this.query=t)},focus:function(){this.$input.focus()},blur:function(){this.$input.blur()},getQuery:function(){return this.query},setQuery:function(t){this.query=t},getInputValue:function(){return this.$input.val()},setInputValue:function(t,e){this.$input.val(t),e?this.clearHint():this._checkInputValue()},resetInputValue:function(){this.setInputValue(this.query,!0)},getHint:function(){return this.$hint.val()},setHint:function(t){this.$hint.val(t)},clearHint:function(){this.setHint("")},clearHintIfInvalid:function(){var t,e,n,i;t=this.getInputValue(),e=this.getHint(),n=t!==e&&0===e.indexOf(t),i=""!==t&&n&&!this.hasOverflow(),!i&&this.clearHint()},getLanguageDirection:function(){return(this.$input.css("direction")||"ltr").toLowerCase()},hasOverflow:function(){var t=this.$input.width()-2;return this.$overflowHelper.text(this.getInputValue()),this.$overflowHelper.width()>=t},isCursorAtEnd:function(){var t,n,i;return t=this.$input.val().length,n=this.$input[0].selectionStart,e.isNumber(n)?n===t:document.selection?(i=document.selection.createRange(),i.moveStart("character",-t),t===i.text.length):!0},destroy:function(){this.$hint.off(".tt"),this.$input.off(".tt"),this.$hint=this.$input=this.$overflowHelper=null}}),n}(),m=function(){function n(n){n=n||{},n.templates=n.templates||{},n.source||t.error("missing source"),n.name&&!o(n.name)&&t.error("invalid dataset name: "+n.name),this.query=null,this.highlight=!!n.highlight,this.name=n.name||e.getUniqueId(),this.source=n.source,this.displayFn=i(n.display||n.displayKey),this.templates=s(n.templates,this.displayFn),this.$el=t(l.dataset.replace("%CLASS%",this.name))}function i(t){function n(e){return e[t]}return t=t||"value",e.isFunction(t)?t:n}function s(t,n){function i(t){return"<p>"+n(t)+"</p>"}return{empty:t.empty&&e.templatify(t.empty),header:t.header&&e.templatify(t.header),footer:t.footer&&e.templatify(t.footer),suggestion:t.suggestion||i}}function o(t){return/^[_a-zA-Z0-9-]+$/.test(t)}var r="ttDataset",a="ttValue",u="ttDatum";return n.extractDatasetName=function(e){return t(e).data(r)},n.extractValue=function(e){return t(e).data(a)},n.extractDatum=function(e){return t(e).data(u)},e.mixin(n.prototype,d,{_render:function(n,i){function s(){return m.templates.empty({query:n,isEmpty:!0})}function o(){function s(e){var n;return n=t(l.suggestion).append(m.templates.suggestion(e)).data(r,m.name).data(a,m.displayFn(e)).data(u,e),n.children().each(function(){t(this).css(c.suggestionChild)}),n}var o,h;return o=t(l.suggestions).css(c.suggestions),h=e.map(i,s),o.append.apply(o,h),m.highlight&&p({node:o[0],pattern:n}),o}function h(){return m.templates.header({query:n,isEmpty:!f})}function d(){return m.templates.footer({query:n,isEmpty:!f})}if(this.$el){var f,m=this;this.$el.empty(),f=i&&i.length,!f&&this.templates.empty?this.$el.html(s()).prepend(m.templates.header?h():null).append(m.templates.footer?d():null):f&&this.$el.html(o()).prepend(m.templates.header?h():null).append(m.templates.footer?d():null),this.trigger("rendered")}},getRoot:function(){return this.$el},update:function(t){function e(e){n.canceled||t!==n.query||n._render(t,e)}var n=this;this.query=t,this.canceled=!1,this.source(t,e)},cancel:function(){this.canceled=!0},clear:function(){this.cancel(),this.$el.empty(),this.trigger("rendered")},isEmpty:function(){return this.$el.is(":empty")},destroy:function(){this.$el=null}}),n}(),g=function(){function n(n){var s,o,r,a=this;n=n||{},n.menu||t.error("menu is required"),this.isOpen=!1,this.isEmpty=!0,this.datasets=e.map(n.datasets,i),s=e.bind(this._onSuggestionClick,this),o=e.bind(this._onSuggestionMouseEnter,this),r=e.bind(this._onSuggestionMouseLeave,this),this.$menu=t(n.menu).on("click.tt",".tt-suggestion",s).on("mouseenter.tt",".tt-suggestion",o).on("mouseleave.tt",".tt-suggestion",r),e.each(this.datasets,function(t){a.$menu.append(t.getRoot()),t.onSync("rendered",a._onRendered,a)})}function i(t){return new m(t)}return e.mixin(n.prototype,d,{_onSuggestionClick:function(e){this.trigger("suggestionClicked",t(e.currentTarget))},_onSuggestionMouseEnter:function(e){this._removeCursor(),this._setCursor(t(e.currentTarget),!0)},_onSuggestionMouseLeave:function(){this._removeCursor()},_onRendered:function(){function t(t){return t.isEmpty()}this.isEmpty=e.every(this.datasets,t),this.isEmpty?this._hide():this.isOpen&&this._show(),this.trigger("datasetRendered")},_hide:function(){this.$menu.hide()},_show:function(){this.$menu.css("display","block")},_getSuggestions:function(){return this.$menu.find(".tt-suggestion")},_getCursor:function(){return this.$menu.find(".tt-cursor").first()},_setCursor:function(t,e){t.first().addClass("tt-cursor"),!e&&this.trigger("cursorMoved")},_removeCursor:function(){this._getCursor().removeClass("tt-cursor")},_moveCursor:function(t){var e,n,i,s;if(this.isOpen){if(n=this._getCursor(),e=this._getSuggestions(),this._removeCursor(),i=e.index(n)+t,i=(i+1)%(e.length+1)-1,-1===i)return void this.trigger("cursorRemoved");-1>i&&(i=e.length-1),this._setCursor(s=e.eq(i)),this._ensureVisible(s)}},_ensureVisible:function(t){var e,n,i,s;e=t.position().top,n=e+t.outerHeight(!0),i=this.$menu.scrollTop(),s=this.$menu.height()+parseInt(this.$menu.css("paddingTop"),10)+parseInt(this.$menu.css("paddingBottom"),10),0>e?this.$menu.scrollTop(i+e):n>s&&this.$menu.scrollTop(i+(n-s))},close:function(){this.isOpen&&(this.isOpen=!1,this._removeCursor(),this._hide(),this.trigger("closed"))},open:function(){this.isOpen||(this.isOpen=!0,!this.isEmpty&&this._show(),this.trigger("opened"))},setLanguageDirection:function(t){this.$menu.css("ltr"===t?c.ltr:c.rtl)},moveCursorUp:function(){this._moveCursor(-1)},moveCursorDown:function(){this._moveCursor(1)},getDatumForSuggestion:function(t){var e=null;return t.length&&(e={raw:m.extractDatum(t),value:m.extractValue(t),datasetName:m.extractDatasetName(t)}),e},getDatumForCursor:function(){return this.getDatumForSuggestion(this._getCursor().first())},getDatumForTopSuggestion:function(){return this.getDatumForSuggestion(this._getSuggestions().first())},update:function(t){function n(e){e.update(t)}e.each(this.datasets,n)},empty:function(){function t(t){t.clear()}e.each(this.datasets,t),this.isEmpty=!0},isVisible:function(){return this.isOpen&&!this.isEmpty},destroy:function(){function t(t){t.destroy()}this.$menu.off(".tt"),this.$menu=null,e.each(this.datasets,t)}}),n}(),v=function(){function n(n){var s,o,r;n=n||{},n.input||t.error("missing input"),this.isActivated=!1,this.autoselect=!!n.autoselect,this.minLength=e.isNumber(n.minLength)?n.minLength:1,this.$node=i(n.input,n.withHint),s=this.$node.find(".tt-dropdown-menu"),o=this.$node.find(".tt-input"),r=this.$node.find(".tt-hint"),o.on("blur.tt",function(t){var n,i,r;n=document.activeElement,i=s.is(n),r=s.has(n).length>0,e.isMsie()&&(i||r)&&(t.preventDefault(),t.stopImmediatePropagation(),e.defer(function(){o.focus()}))}),s.on("mousedown.tt",function(t){t.preventDefault()}),this.eventBus=n.eventBus||new h({el:o}),this.dropdown=new g({menu:s,datasets:n.datasets}).onSync("suggestionClicked",this._onSuggestionClicked,this).onSync("cursorMoved",this._onCursorMoved,this).onSync("cursorRemoved",this._onCursorRemoved,this).onSync("opened",this._onOpened,this).onSync("closed",this._onClosed,this).onAsync("datasetRendered",this._onDatasetRendered,this),this.input=new f({input:o,hint:r}).onSync("focused",this._onFocused,this).onSync("blurred",this._onBlurred,this).onSync("enterKeyed",this._onEnterKeyed,this).onSync("tabKeyed",this._onTabKeyed,this).onSync("escKeyed",this._onEscKeyed,this).onSync("upKeyed",this._onUpKeyed,this).onSync("downKeyed",this._onDownKeyed,this).onSync("leftKeyed",this._onLeftKeyed,this).onSync("rightKeyed",this._onRightKeyed,this).onSync("queryChanged",this._onQueryChanged,this).onSync("whitespaceChanged",this._onWhitespaceChanged,this),this._setLanguageDirection()}function i(e,n){var i,o,a,u;i=t(e),o=t(l.wrapper).css(c.wrapper),a=t(l.dropdown).css(c.dropdown),u=i.clone().css(c.hint).css(s(i)),u.val("").removeData().addClass("tt-hint").removeAttr("id name placeholder").prop("disabled",!0).attr({autocomplete:"off",spellcheck:"false"}),i.data(r,{dir:i.attr("dir"),autocomplete:i.attr("autocomplete"),spellcheck:i.attr("spellcheck"),style:i.attr("style")}),i.addClass("tt-input").attr({autocomplete:"off",spellcheck:!1}).css(n?c.input:c.inputWithNoHint);try{!i.attr("dir")&&i.attr("dir","auto")}catch(h){}return i.wrap(o).parent().prepend(n?u:null).append(a)}function s(t){return{backgroundAttachment:t.css("background-attachment"),backgroundClip:t.css("background-clip"),backgroundColor:t.css("background-color"),backgroundImage:t.css("background-image"),backgroundOrigin:t.css("background-origin"),backgroundPosition:t.css("background-position"),backgroundRepeat:t.css("background-repeat"),backgroundSize:t.css("background-size")}}function o(t){var n=t.find(".tt-input");e.each(n.data(r),function(t,i){e.isUndefined(t)?n.removeAttr(i):n.attr(i,t)}),n.detach().removeData(r).removeClass("tt-input").insertAfter(t),t.remove()}var r="ttAttrs";return e.mixin(n.prototype,{_onSuggestionClicked:function(t,e){var n;(n=this.dropdown.getDatumForSuggestion(e))&&this._select(n)},_onCursorMoved:function(){var t=this.dropdown.getDatumForCursor();this.input.setInputValue(t.value,!0),this.eventBus.trigger("cursorchanged",t.raw,t.datasetName)},_onCursorRemoved:function(){this.input.resetInputValue(),this._updateHint()},_onDatasetRendered:function(){this._updateHint()},_onOpened:function(){this._updateHint(),this.eventBus.trigger("opened")},_onClosed:function(){this.input.clearHint(),this.eventBus.trigger("closed")},_onFocused:function(){this.isActivated=!0,this.dropdown.open()},_onBlurred:function(){this.isActivated=!1,this.dropdown.empty(),this.dropdown.close()},_onEnterKeyed:function(t,e){var n,i;n=this.dropdown.getDatumForCursor(),i=this.dropdown.getDatumForTopSuggestion(),n?(this._select(n),e.preventDefault()):this.autoselect&&i&&(this._select(i),e.preventDefault())},_onTabKeyed:function(t,e){var n;(n=this.dropdown.getDatumForCursor())?(this._select(n),e.preventDefault()):this._autocomplete(!0)},_onEscKeyed:function(){this.dropdown.close(),this.input.resetInputValue()},_onUpKeyed:function(){var t=this.input.getQuery();this.dropdown.isEmpty&&t.length>=this.minLength?this.dropdown.update(t):this.dropdown.moveCursorUp(),this.dropdown.open()},_onDownKeyed:function(){var t=this.input.getQuery();this.dropdown.isEmpty&&t.length>=this.minLength?this.dropdown.update(t):this.dropdown.moveCursorDown(),this.dropdown.open()},_onLeftKeyed:function(){"rtl"===this.dir&&this._autocomplete()},_onRightKeyed:function(){"ltr"===this.dir&&this._autocomplete()},_onQueryChanged:function(t,e){this.input.clearHintIfInvalid(),e.length>=this.minLength?this.dropdown.update(e):this.dropdown.empty(),this.dropdown.open(),this._setLanguageDirection()},_onWhitespaceChanged:function(){this._updateHint(),this.dropdown.open()},_setLanguageDirection:function(){var t;this.dir!==(t=this.input.getLanguageDirection())&&(this.dir=t,this.$node.css("direction",t),this.dropdown.setLanguageDirection(t))},_updateHint:function(){var t,n,i,s,o,r;t=this.dropdown.getDatumForTopSuggestion(),t&&this.dropdown.isVisible()&&!this.input.hasOverflow()?(n=this.input.getInputValue(),i=f.normalizeQuery(n),s=e.escapeRegExChars(i),o=new RegExp("^(?:"+s+")(.+$)","i"),r=o.exec(t.value),r?this.input.setHint(n+r[1]):this.input.clearHint()):this.input.clearHint()},_autocomplete:function(t){var e,n,i,s;e=this.input.getHint(),n=this.input.getQuery(),i=t||this.input.isCursorAtEnd(),e&&n!==e&&i&&(s=this.dropdown.getDatumForTopSuggestion(),s&&this.input.setInputValue(s.value),this.eventBus.trigger("autocompleted",s.raw,s.datasetName))},_select:function(t){this.input.setQuery(t.value),this.input.setInputValue(t.value,!0),this._setLanguageDirection(),this.eventBus.trigger("selected",t.raw,t.datasetName),this.dropdown.close(),e.defer(e.bind(this.dropdown.empty,this.dropdown))},open:function(){this.dropdown.open()},close:function(){this.dropdown.close()},setVal:function(t){this.isActivated?this.input.setInputValue(t):(this.input.setQuery(t),this.input.setInputValue(t,!0)),this._setLanguageDirection()},getVal:function(){return this.input.getQuery()},destroy:function(){this.input.destroy(),this.dropdown.destroy(),o(this.$node),this.$node=null}}),n}();!function(){var n,i,s;n=t.fn.typeahead,i="ttTypeahead",s={initialize:function(n,s){function o(){var o,r,a=t(this);e.each(s,function(t){t.highlight=!!n.highlight}),r=new v({input:a,eventBus:o=new h({el:a}),withHint:e.isUndefined(n.hint)?!0:!!n.hint,minLength:n.minLength,autoselect:n.autoselect,datasets:s}),a.data(i,r)}return s=e.isArray(s)?s:[].slice.call(arguments,1),n=n||{},this.each(o)},open:function(){function e(){var e,n=t(this);(e=n.data(i))&&e.open()}return this.each(e)},close:function(){function e(){var e,n=t(this);(e=n.data(i))&&e.close()}return this.each(e)},val:function(e){function n(){var n,s=t(this);(n=s.data(i))&&n.setVal(e)}function s(t){var e,n;return(e=t.data(i))&&(n=e.getVal()),n}return arguments.length?this.each(n):s(this.first())},destroy:function(){function e(){var e,n=t(this);(e=n.data(i))&&(e.destroy(),n.removeData(i))}return this.each(e)}},t.fn.typeahead=function(t){return s[t]?s[t].apply(this,[].slice.call(arguments,1)):s.initialize.apply(this,arguments)},t.fn.typeahead.noConflict=function(){return t.fn.typeahead=n,this}}()}(window.jQuery),define("lib/typeahead",function(){}),define("ui/autocomplete",["./players","./shared","lib/typeahead"],function(t,e){var n,i;return n={},$(function(e){i=e("#teams input.playername"),n.clear=function(){i.typeahead("val","")},n.reset=function(){i.typeahead("destroy")},n.update=function(){n.reset(),names=t.get(),names=names.map(function(t){return{val:t.trim()}});var e=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("val"),queryTokenizer:Bloodhound.tokenizers.whitespace,local:names});e.initialize(),i.typeahead({hint:!0,highlight:!0},{name:"names",displayKey:"val",source:e.ttAdapter()})}}),e.Autocomplete=n,n}),define("ui/tab_teams",["./team","./toast","./strings","./tab_ranking","./storage","./autocomplete","./options","./tab","./tabshandle","./shared"],function(t,n,i,s,o,r,a,u,l,c){function h(t){return t.replace(/^\s*|\s*$/g,"").replace(/\s\s*/g," ")}function d(){z.find(".numteams").text(t.count())}function p(e){var s;return q.allowRegistrations?(s=e.prevAll(".team").length,t.erase(s),c.Tab_New.update(),o.changed(),B.reset(),B.update(),void new n(i.teamdeleted.replace("%s",s+1))):void new n(i.registrationclosed)}function f(){Y=z.find("button.delete"),Y.on("click",function(t){return z.toggleClass("deletion"),t.preventDefault(),!1}),$("body").on("click","#teams.deletion",function(t){var e;return e=$(t.target),e.hasClass("team")||(e=e.parents(".team")),e.hasClass("team")&&p(e),z.removeClass("deletion"),t.preventDefault(),!1})}function m(){return z.hasClass("deletion")}function g(){0===t.count()?Y.addClass("hidden"):Y.removeClass("hidden")}function v(){G=z.find(".teamsize"),G.find("button").on("click",function(t){var e,n;return m()?(t.preventDefault(),!1):(n=$(this),"BUTTON"!==n.prop("tagName")&&(n=n.parents("button")),e=Number(n.val()),a.teamsize=e,l.updateOpts(),c.Alltabs.reset(),c.Alltabs.update(),t.preventDefault(),!1)})}function b(){G.find("button").removeClass("selected"),G.find("button[value="+a.teamsize+"]").addClass("selected"),G.show()}function y(){var t,e,n,i,s,o;if(F)return console.error("tab_teams: template already exists: "),void console.error(F);for(e=z.find(".team.tpl"),e.detach(),e.removeClass("tpl"),i=[],t=e.find(".name"),o=0;o<a.maxteamsize;o+=1)i[o]=t.eq(o);n=e.find(".teamno"),s=e.find(".chname"),s.detach(),F={$tpl:e,$teamno:n,$names:i,$chname:s},_()}function P(e){var s,r,u,d,p,f;if(0!==t.count())return void new n(i.teamsnotempty);if(!q.allowRegistrations)return void new n(i.registrationclosed);for(stripregex=/(^\s+|\s+$)/g,s=e.split("\n"),f=s.length-1;f>=0;f-=1)s[f]=h(s[f]),s[f]=s[f].replace(/(, ?"([^,"])*)""/g,"$1%DBQUOTE%"),s[f]=s[f].replace(/(, ?"([^,"])*),/g,"$1%COMMA%"),s[f]=s[f].replace(/ *, */g,","),s[f]=s[f].replace(/^([0-9]+,)?"([^"]*)","([^"]*)","([^"]*)"$/,"$2,$3,$4"),s[f]=s[f].replace(/^([0-9]+,)?"([^"]*)","([^"]*)"$/,"$2,$3"),s[f]=s[f].replace(/^([0-9]+,)?"([^"]*)"$/,"$2"),s[f]=s[f].replace(/^#.*/,""),0===s[f].length&&s.splice(f,1);d=-1;for(u in s){s[u]=s[u].split(","),u=s[u];for(r in u)u[r]=h(u[r]).replace("%COMMA%",","),u[r]=h(u[r]).replace("%DBQUOTE%",'"'),0===u[r].length&&(u[r]=i.emptyname);if(d!==u.length){if(-1!==d)return void new n(i.differentteamsizes);d=u.length}}switch(d){case 1:case 2:case 3:a.teamsize=d,l.updateOpts(),c.Alltabs.reset(),c.Alltabs.update();break;default:return void new n(i.invalidteamsize)}for(u in s)u=s[u],p=t.create(u),M(p);return N(),o.changed(),!0}function w(){W.find("input").val("")}function j(t){switch(t.target.error.code){case t.target.error.NOT_FOUND_ERR:new n(i.filenotfound);break;case t.target.error.NOT_READABLE_ERR:new n(i.filenotreadable);break;case t.target.error.ABORT_ERR:break;default:new n(i.fileerror)}w()}function x(t){var e;e=t.target.result,P(e)&&new n(i.loaded),w()}function E(){new n(i.fileabort),w()}function C(){W=z.find(".load"),W.find("input").change(function(t){var e=new FileReader;e.onerror=j,e.onabort=E,e.onload=x,e.readAsBinaryString(t.target.files[0])})}function S(){W.show()}function _(){var t,e;for(r.reset(),e=F.$names,t=0;t<a.maxteamsize;t+=1)t<a.teamsize?(e[t].prev("br").css("display",""),e[t].css("display","")):(e[t].prev("br").css("display","none"),e[t].css("display","none"))}function k(){function e(){var t,e;for(t=[],e=0;e<a.teamsize;e+=1)t.push(h(H.$names[e].val()));for(e=0;e<a.teamsize;e+=1)if(""===t[e])return void 0;for(e=0;e<a.teamsize;e+=1)H.$names[e].val("");return r.clear(),t}function s(){var t;for(t=0;t<a.teamsize;t+=1)if(""===h(H.$names[t].val())){H.$names[t].focus();break}}function u(){var r,a;return q.allowRegistrations?(r=e(),void 0!==r?(a=t.create(r),new n(i.teamadded.replace("%s",a.id+1)),M(a),N(),H.$names[0].focus(),o.changed()):s(),!1):void new n(i.registrationclosed)}var l,c,d,p;if(H)return console.error("tab_teams: newteam is already defined:"),void console.error(H);for(p=z.find("#newteam"),c=p.find("input.playername"),d=[],l=0;l<a.maxteamsize;l+=1)d[l]=c.eq(l);H={$form:p,$names:d},p.submit(u),D()}function D(){var t,e;for(e=H.$names,t=0;t<a.maxteamsize;t+=1)t<a.teamsize?(e[t].prev("br").css("display",""),e[t].css("display","")):(e[t].prev("br").css("display","none"),e[t].css("display","none"))}function A(){function t(){return m()?(e.preventDefault(),!1):void(n.prop("checked")?z.addClass("maxwidth"):z.removeClass("maxwidth"))}var n;n=z.find(".options .maxwidth"),n.click(t),t()}function I(){function r(t){F.$chname.val(t.text()),t.text(""),t.append(F.$chname),F.$chname.focus()}function u(e){var n,i,r,u,l,d;for(n=e.prevAll(".team").length,i=t.get(n),r=e.find(".name"),l=0;l<a.teamsize;l+=1)d=h(r.eq(l).text()),d?i.names[l]=d:r.eq(l).text(i.names[l]);u=c.Tab_Games,c.Tab_New.update(),u.update(),s.update(),o.changed()}function l(){F.$chname.val(""),F.$chname.blur()}function d(){var t,e,s,o;o=F.$chname.parents(),e=o.eq(0),F.$chname.detach(),t=h(F.$chname.val()),e.text(t),s=o.eq(2),u(s),new n(/^\s*$/.test(F.$chname.val())?i.namechangeaborted:i.namechanged.replace("%s",t))}z.on("click",".team .name",function(){var t;return m()?(e.preventDefault(),!1):(t=$(this),void r(t))}),F.$chname.blur(d),F.$chname.keyup(function(t){return 13===t.which?(F.$chname.blur(),t.preventDefault(),!1):27===t.which?(l(),t.preventDefault(),!1):void 0}),F.$chname.click(function(t){return m()?(t.preventDefault(),!1):(t.preventDefault(),!1)})}function O(){return z?(console.error("tab_teams: $tab is already defined:"),void console.error(z)):(z=$("#teams"),y(),k(),A(),I(),C(),v(),f(),void(V=H.$form))}function T(){q.allowRegistrations=!0}function M(t){var e;for(e=0;e<a.teamsize;e+=1)F.$names[e].text(t.names[e]);F.$teamno.text(t.id+1),V.before(F.$tpl.clone())}function N(){t.count()>0&&(W.hide(),G.hide(),g(),d(),c.Tab_New.update())}function R(){q.allowRegistrations?z.removeClass("noreg"):z.addClass("noreg")}function L(){z||O(),z.find(".team").remove(),r.reset(),T(),R(),g(),b(),_(),D(),S(),d(),r.update()
}function U(){var e,n;for(B.reset(),n=t.count(),e=0;n>e;e+=1)M(t.get(e));N()}var B,z,F,H,V,q,W,G,Y,X;return X=!1,z=void 0,q={allowRegistrations:!0,_changed:function(){R()}},B=u.createTab("teams",L,U,q),c.Tab_Teams=B,B}),define("ui/tab_games",["./team","./toast","./strings","./tab_teams","./tab_ranking","./history","./tab_history","./storage","./options","./tab","./tabshandle","./tournaments","./shared","./boxview"],function(t,e,n,i,s,o,r,a,u,l,c,h,d,p){function f(t){return t%1===0}function m(){var t,e,n,i;return M.game?(console.error("tab_games: template.game is already defined:"),void console.error(M.game)):(t=M.$box.find(".game"),t.detach(),e=[],i=t.find(".names"),e[0]=i.eq(0),e[1]=i.eq(1),i=t.find(".teamno"),n=[i.eq(0),i.eq(1)],$anchor=T.find(".votes").eq(0),T.on("change",".game input",function(){var t=$(this).parent().find("button");void 0===x($(this).parents(".game"))?(t.attr("disabled","disabled"),t.attr("tabindex","-1")):(t.removeAttr("disabled"),t.removeAttr("tabindex"))}),T.on("submit",".game",function(t){return E.call(this),t.preventDefault(),!1}),void(M.game={$form:t,$names:e,$teamnos:n}))}function g(){var t,e,n,i;return M.vote?(console.error("tab_games: template.vote is already defined:"),void console.error(M.vote)):(e=M.$box.find(".votes"),e.detach(),t=e.find(".vote"),t.detach(),n=t.find(".names"),i=t.find(".teamno"),void(M.vote={$container:e,$vote:t,$names:n,$teamno:i}))}function v(){return M?(console.error("tab_games: template is already defined:"),void console.error(M)):(M={},M.$box=T.find(".box.tpl"),M.$box.detach(),M.$box.removeClass("tpl"),M.$boxname=M.$box.find(">h3"),m(),void g())}function b(e,n,i){var s,o,r;s=t.get(e.teams[0][0]),o=t.get(e.teams[1][0]),M.game.$names[0].html(s.names.join("<br>")),M.game.$names[1].html(o.names.join("<br>")),M.game.$teamnos[0].text(s.id+1),M.game.$teamnos[1].text(o.id+1),r=M.game.$form.clone(),i.append(r),R[n]||(R[n]=[]),R[n].push(r),N[n]||(N[n]=[]),N[n].push(e)}function y(){T.find(".box").remove(),R=[],L=[],N=[]}function P(){var t,e,n,i,s,o;for(y(),s=!0,t=0;t<h.numTournaments();t+=1)h.isRunning(t)&&(e=h.getTournament(t),o=h.getRanking(t).round,M.$boxname.text(h.getName(t)+" - Runde "+o),n=M.$box.clone(),new p(n),i=!1,e.getGames().forEach(function(e){b(e,t,n),s=!1,i=!0}),_(e,n),i&&(n.data("tournamentid",t),T.append(n),L[t]=n));return!s}function w(){var t,e;for(e=!0,t=0;t<N.length;t+=1)if(N[t]&&N[t].length>0){e=!1;break}e?c.hide("games"):c.show("games")}function j(t){var e;return t?(e=t.parents(".box"),1!==e.length?void console.error("cannot find $box of $game"):e.data("tournamentid")):void 0}function x(t){var e,n,i,o;if(i={index:-1,points:[]},o=j(t),void 0===o)return void 0;for(n=0;n<R[o].length;n+=1)if(R[o][n].data()===t.data()){i.index=n;break}if(e=t.find(".points"),-1===i.index)return P(),void s.update();for(n=0;2>n;n+=1)if(i.points[n]=Number($(e[n]).val()),isNaN(i.points[n])||!f(i.points[n])||i.points[n]<0||i.points[n]>u.maxpoints)return void 0;return i.points[0]===i.points[1]?void 0:i}function E(){var t,i,u,l,p,f,m;return p=j($(this)),void 0===p?!1:h.isRunning(p)?(f=h.getTournament(p),t=x($(this)),void 0===t?(new e(n.invalidresult,e.LONG),!1):(u=t.index,l=t.points,m=N[p][u].id,void 0===f.finishGame(N[p][u],l)?(P(),s.update(),new e(n.invalidresult,e.LONG),!1):(round=h.getRanking(p).round,i=o.addResult(p,N[p][u].teams[0][0],N[p][u].teams[1][0],l[0],l[1],round-1,m),r.update(),l[0]>l[1]&&new e(n.gamefinished),N.length!==R.length?(console.error("games != $games"),P(),s.update(),new e(n.invalidresult,e.LONG),!1):(0===N[p].length&&(y(),w(),new e(n.roundfinished.replace("%s",h.getRanking(p).round))),a.changed(),s.update(),d.Tab_New.update(),0===N.length&&c.focus("new"),O.update(),!1)))):(console.error("tournament isn't running anymore, but player wants to finish a game"),!1)}function C(e){var n;return n=t.get(e),M.vote.$teamno.text(n.id+1),M.vote.$names.html(n.names.join("<br>")),M.vote.$vote.clone()}function S(t){var e,n,i;for(n=h.getRanking(h.getTournamentID(t)),e={up:[],down:[],bye:[]},i=0;i<n.ids.length;i+=1)n.roundupvote&&n.roundupvote[i]&&e.up.push(n.ids[i]),n.rounddownvote&&n.rounddownvote[i]&&e.down.push(n.ids[i]),n.roundbyevote&&n.roundbyevote[i]&&e.bye.push(n.ids[i]);return e}function _(t,e){var n,i,s,o;return o=!1,n=S(t),s=M.vote.$container.clone(),i={up:s.find(".up"),down:s.find(".down"),bye:s.find(".bye")},n.up&&0!==n.up.length?(i.up.show(),n.up.forEach(function(t){void 0!==t&&(i.up.append(C(t)),o=!0)})):i.up.hide(),n.down&&0!==n.down.length?(i.down.show(),n.down.forEach(function(t){void 0!==t&&(i.down.append(C(t)),o=!0)})):i.down.hide(),n.bye&&0!==n.bye.length?(i.bye.show(),n.bye.forEach(function(t){void 0!==t&&(i.bye.append(C(t)),o=!0)})):i.bye.hide(),o&&e.append(s),o}function k(){function t(){n.prop("checked")?T.addClass("maxwidth"):T.removeClass("maxwidth")}function e(){i.prop("checked")?(T.removeClass("hidenames"),n.removeAttr("disabled")):(T.addClass("hidenames"),n.attr("disabled","disabled"))}var n,i;n=T.find(".options .maxwidth"),n.click(t),t(),i=T.find(".options .shownames"),i.click(e),e()}function D(){return T?(console.error("tab_games: $tab is already defined:"),void console.error(T)):(T=$("#games"),v(),void k())}function A(){T||D(),y()}function I(){O.reset(),P(),w()}var O,T,M,N,R,L;return updatepending=!1,R=[],L=[],N=[],O=l.createTab("games",A,I),d.Tab_Games=O,O}),define("ui/globalranking",["./tournaments","./team","./shared"],function(t,e,n){function i(){var n,i,s,o;for(i=[],n=t.getRankingOrder();i.length<e.count();)s=i.length,i.push({rankoftournament:t.numTournaments(),tournamentid:void 0,teamid:s});for(s=n.length-1;s>=0;s-=1)o=n[s],t.getTeams(o).map(function(t){i[t]={rankoftournament:s,tournamentid:o,teamid:t}});return i}function s(e){var n,i,s,o;for(s=t.numTournaments(),i=0;s>i;i+=1)for(tournamentranking=t.getRanking(i),n=0;n<tournamentranking.ids.length;n+=1)o=tournamentranking.ids[n],e[o].tournamentid===i&&(e[o].tournamentrank=tournamentranking.place[n]);return e}function o(){function t(t,e){return t.rankoftournament-e.rankoftournament||t.tournamentrank-e.tournamentrank}function e(e,n){return t(e,n)||e.teamid-n.teamid}var n,o,r;if(n=i(),n=s(n),n.sort(e),n[0])for(r=n[0].tournamentid,o=0;o<n.length;o+=1)r!==n[o].tournamentid||void 0===n[o].tournamentid?(r=n[o].tournamentid,n[o].globalrank=o):n[o].globalrank=o>0&&(n[o].tournamentrank||0)===(n[o-1].tournamentrank||0)?n[o-1].globalrank:o;return n}var r;return r={get:o},n.GlobalRanking=r,r}),define("ui/data/swissperms",[],function(){var t={strict:{up:{up:!1,down:!1,bye:!1},down:{up:!1,down:!1,bye:!1},bye:{up:!1,down:!1,bye:!1}},none:{up:{up:!0,down:!0,bye:!0},down:{up:!0,down:!0,bye:!0},bye:{up:!0,down:!0,bye:!0}},updown:{up:{up:!1,down:!1,bye:!0},down:{up:!1,down:!1,bye:!0},bye:{up:!0,down:!0,bye:!1}},pvo:{up:{up:!1,down:!0,bye:!0},down:{up:!0,down:!1,bye:!0},bye:{up:!0,down:!0,bye:!1}},relaxed:{up:{up:!1,down:!0,bye:!0},down:{up:!0,down:!1,bye:!0},bye:{up:!0,down:!0,bye:!0}},nice:{up:{up:!1,down:!0,bye:!0},down:{up:!0,down:!1,bye:!1},bye:{up:!0,down:!1,bye:!1}},custom:void 0};return t}),define("ui/tab_new",["./tab","./options","./tabshandle","./toast","./team","./strings","./tab_games","./tab_ranking","./tab_history","./history","./storage","../backend/tournament","./tournaments","./globalranking","./shared","./data/swissperms","./boxview"],function(t,e,n,i,s,o,r,a,u,l,c,h,d,p,f,m,g){function v(t){var e,n,i;for(n=d.getRanking(d.getTournamentID(t)),e={up:[],down:[],bye:[]},i=0;i<n.ids.length;i+=1)n.roundupvote[i]&&e.up.push(n.ids[i]),n.rounddownvote[i]&&e.down.push(n.ids[i]),n.roundbyevote[i]&&e.bye.push(n.ids[i]);return e}function b(){ee={team:{}},ee.team.$container=Z.find(".team.tpl"),ee.team.$container.detach(),ee.team.$container.removeClass("tpl"),ee.team.$rank=ee.team.$container.find(".rank"),ee.team.$tournamentrank=ee.team.$container.find(".tournamentrank"),ee.team.$teamno=ee.team.$container.find(".teamno"),ee.team.$names=ee.team.$container.find(".names"),ee.$system=ee.team.$container.find(".system"),ee.$system.detach(),ee.$removesystem=ee.$system.find(".removesystem"),ee.$removesystem.detach(),ee.$anchor=Z.find("table.playertable"),ee.system={},ee.system.$swiss=Z.find(".swiss.tpl").detach().find("> *"),ee.system.$ko=Z.find(".ko.tpl").detach().find("> *"),ee.system.$newsystem=Z.find(".newsystem.tpl").detach().find("> *"),ee.$chname=ee.system.$newsystem.find(".chname"),ee.$chname.detach()}function y(){function t(t){ee.$chname.val(t.text()),t.text(""),t.append(ee.$chname),ee.$chname.focus()}function e(){var t,e,n,s,r;return e=ee.$chname.parent(".name"),t=e.parent("h3"),n=t.parent(".system"),0===e.length||0===t.length||0===n.length?void console.error("cannot find required DOM elements"):(s=n.data("tournamentid"),r=ee.$chname.val(),ee.$chname.detach(),!r||/^\s*$/.test(r)||d.getName(s)===r?(e.text(d.getName(s)),void new i(o.namechangeaborted)):(n.find(".name").text(r),d.setName(s,r),c.changed(),f.Tab_Games.update(),f.Tab_Ranking.update(),f.Tab_History.update(),void new i(o.namechanged.replace("%s",r))))}function n(){ee.$chname.val(""),ee.$chname.blur()}Z.on("click",".system > h3:first-child.editable",function(){t($(this).find(".name"))}),ee.$chname.blur(e),ee.$chname.keyup(function(t){return 13===t.which?(ee.$chname.blur(),t.preventDefault(),!1):27===t.which?(n(),t.preventDefault(),!1):void 0}),ee.$chname.click(function(t){return t.preventDefault(),!1})}function P(){Z.on("click",".system .removesystem button",function(){var t,e,n,s;return t=$(this).parents(".system"),e=t.data("tournamentid"),d.isRunning(e)?(n=d.getTournament(e))?(s=n.getGames(),s&&s.length?void new i(o.gamesstillrunning):d.removeTournament(e)?(Q.update(),c.changed(),new i(o.tournamentfinished),!0):void console.error("something's wrong")):void console.error("tournament running, but there's no tournament object!"):void new i(o.tournamentalreadyfinished)})}function w(){Z.find(".team").remove()}function j(){Z.find(".system").remove()}function x(){var t,e,n;for(n=!1,t=p.get(),e=0;e<t.length;e+=1)if(t[e].globalrank!==t[e].tournamentrank){n=!0;break}for(e=0;e<t.length;e+=1)ee.team.$rank.text(t[e].globalrank+1),ee.team.$tournamentrank.text(n&&t[e].tournamentrank?t[e].tournamentrank+1:""),ee.team.$teamno.text(t[e].teamid+1),ee.team.$names.text(s.get(t[e].teamid).names.join(", ")),ee.$anchor.append(ee.team.$container.clone())}function E(t,e){var n,i;switch(i=void 0!==e&&d.getTournament(e),i?i.getState():h.STATE.FAILURE){case h.STATE.PREPARING:n="preparing";break;case h.STATE.RUNNING:n="running";break;case h.STATE.FINISHED:n="finished";break;case h.STATE.FAILURE:default:n="failure"}t.removeClass("preparing running finished failure").addClass(n)}function C(t){var e,n,i;return e=d.getStartRank(t,!d.isRunning(t)),e>=s.count()?void 0:(n=e+S(t)-1,i=ee.$anchor.find(".team"),{first:i.eq(e),last:i.eq(n)})}function S(t){return d.numTeamsLeft(t)}function _(t){var e,n,i,s,o;return(e=C(t))?(n=e.first,void 0===n?void 0:(s=S(t),i=e.last,1!==n.length?void console.error("cannot find anchor for tournament id "+t):s?(o=ee.$system.clone(),o.attr("rowspan",s),n.append(o),n.addClass("firstrow"),i.addClass("lastrow"),o):void 0)):void 0}function k(t,e){var n,s;return d.isRunning(e)?(s=d.getTournament(e),n=t.find(".mode"),W(n,s),n.change(function(){q(n,s)}),void t.find("button").click(function(){s.start()?(new i(o.tournamentstarted),c.store(),r.update(),Q.update(),u.update(),a.update()):new i(o.roundfailed)})):void console.error("system box for a finished KO tournament")}function D(t){ne=t}function A(t,e){var n;switch(n=d.getTournament(e).getType(),t.append(ee.system["$"+n].clone()),t.addClass(n),n){case"swiss":R(t,e);break;case"ko":k(t,e);break;default:return void console.error("unsupported tournament type: "+n)}return L(t),t}function I(t){return Number(t.attr("rowspan"))<2?(t.css("padding",0),void t.text(o.notenoughteams)):(t.append(ee.system.$newsystem.clone()),t.addClass("newsystem"),N(t),t)}function O(t){var e;e=t.data("tournamentid"),$title=t.find(">h3"),void 0!==e&&($title.addClass("editable"),t.append(ee.$removesystem.clone()),t.find(".name").text(d.getName(e))),t.append($title.clone().removeClass("editable"))}function T(){var t,e,n,i;if(s.count()<2)return void 0;for(i=d.getRankingOrder(),n=0;n<i.length;n+=1)e=i[n],t=_(e),t&&(t.data("tournamentid",e),d.isRunning(e)?(A(t,e),E(t,e)):I(t),O(t),ne===e&&(t.find(">h3").click(),ne=void 0));t=_(void 0),t&&(I(t),O(t))}function M(t,e,n){var i,s;return(i=d.addTournament(t,e,n))?(s=d.getTournamentID(i),d.setName(s,o["defaultname"+t]),c.store(),Q.update(),void D(s)):(console.error("cannot create tournament of type "+t),void Q.update())}function N(t){function e(){return Number(n.val())}var n,i,s;s=t.data("tournamentid"),n=t.find("input.numteams"),i=t.attr("rowspan"),n.attr("max",i),n.val(i),t.find("button.swiss").click(function(){M("swiss",e(),s)}),t.find("button.ko").click(function(){M("ko",e(),s)})}function R(t,e){var n,s,h,p;return s=d.getRanking(e).round,t.find(".round").text(s),t.find(".nextround").text(s+1),d.isRunning(e)?(p=d.getTournament(e),n=t.find(".mode"),V(n,p),n.change(function(){H(n,p)}),h=F(t),h.preset.change(function(){U(h.preset.val(),h),z(h,p)}),B(h,p),h.all.click(function(){var t;t=$(this),t.toggleClass("forbidden"),h.preset.val("custom"),z(h,p)}),void t.find("button").click(function(){var t,e;if(p.start()){for(e=d.getRanking(d.getTournamentID(p)).round,t=v(p).bye;t.length>0;)l.addVote(0,l.BYE,t.shift(),e-1);new i(o.roundstarted.replace("%s",e)),c.store(),r.update(),Q.update(),u.update(),a.update()}else new i(o.roundfailed)})):void 0}function L(t){t.find("div.box").each(function(){var t;t=$(this),new g(t)})}function U(t,e){var n;n=m[t],void 0!==n&&(e.all.removeClass("forbidden"),!n.up.up&&e.up.up.addClass("forbidden"),!n.up.down&&e.up.down.addClass("forbidden"),!n.up.bye&&e.up.bye.addClass("forbidden"),!n.down.up&&e.down.up.addClass("forbidden"),!n.down.down&&e.down.down.addClass("forbidden"),!n.down.bye&&e.down.bye.addClass("forbidden"),!n.bye.up&&e.bye.up.addClass("forbidden"),!n.bye.down&&e.bye.down.addClass("forbidden"),!n.bye.bye&&e.bye.bye.addClass("forbidden"))}function B(t,e){var n;n=e.getOptions().permissions,t.all.removeClass("forbidden"),!n.up.up&&t.up.up.addClass("forbidden"),!n.up.down&&t.down.up.addClass("forbidden"),!n.up.bye&&t.bye.up.addClass("forbidden"),!n.down.up&&t.up.down.addClass("forbidden"),!n.down.down&&t.down.down.addClass("forbidden"),!n.down.bye&&t.bye.down.addClass("forbidden"),!n.bye.up&&t.up.bye.addClass("forbidden"),!n.bye.down&&t.down.bye.addClass("forbidden"),!n.bye.bye&&t.bye.bye.addClass("forbidden")}function z(t,e){var n,i;n=e.getOptions(),i=n.permissions,i.up.up=!t.up.up.hasClass("forbidden"),i.up.down=!t.down.up.hasClass("forbidden"),i.up.bye=!t.bye.up.hasClass("forbidden"),i.down.up=!t.up.down.hasClass("forbidden"),i.down.down=!t.down.down.hasClass("forbidden"),i.down.bye=!t.bye.down.hasClass("forbidden"),i.bye.up=!t.up.bye.hasClass("forbidden"),i.bye.down=!t.down.bye.hasClass("forbidden"),i.bye.bye=!t.bye.bye.hasClass("forbidden"),n.permissions=i,e.setOptions(n)}function F(t){var e,n;return e=t.find(".votepermissions"),n={all:e.find(".perm"),up:{up:e.find(".up .up"),down:e.find(".up .down"),bye:e.find(".up .bye")},down:{up:e.find(".down .up"),down:e.find(".down .down"),bye:e.find(".down .bye")},bye:{up:e.find(".bye .up"),down:e.find(".bye .down"),bye:e.find(".bye .bye")},preset:t.find("select.preset")}}function H(t,e){var n,i;i=t.val(),n=e.getOptions(),n.mode=i,e.setOptions(n)}function V(t,e){var n;n=e.getOptions().mode,t.val(n)}function q(t,e){var n,i;i=t.val(),n=e.getOptions(),n.firstround=i,e.setOptions(n)}function W(t,e){var n;n=e.getOptions().firstround,t.val(n)}function G(){function t(){n.prop("checked")?Z.addClass("maxwidth"):Z.removeClass("maxwidth")}function e(){i.prop("checked")?(Z.removeClass("hidenames"),n.removeAttr("disabled")):(Z.addClass("hidenames"),n.attr("disabled","disabled"))}var n,i;n=Z.find(".options .maxwidth"),n.click(t),t(),i=Z.find(".options .shownames"),i.click(e),e()}function Y(){return Z?(console.error("tab_new: $tab already exists:"),void console.error(Z)):(Z=$("#new"),b(),y(),P(),void G())}function X(){Z||Y(),j(),w()}function K(){var t,e;e=f.Tab_Teams,t=e.getOptions(),t.allowRegistrations=!1,e.setOptions(t)}function J(){X(),s.count()<2?n.hide("new"):(n.show("new"),0!==d.numTournaments()&&K()),x(),T()}var Q,Z,te,ee,ne;return te=!1,Z=void 0,ne=void 0,Q=t.createTab("new",X,J),f.Tab_New=Q,Q}),define("ui/debug",["./toast","./strings"],function(t,e){var n;return n={stackTrace:function(){var t,e;t=new Error("dummy"),e=t.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"),console.log(e)},isDevVersion:void 0},$(function(i){n.isDevVersion=/%version%/.test(i("head title").text().toLowerCase()),n.isDevVersion&&new t(e.dev,t.INFINITE)}),n}),define("ui/tab_debug",["./tabshandle","./tab","./toast","../backend/random","./options","./strings","./debug","./tournaments","./team","./history","./shared"],function(t,e,n,i,s,o,r,a,u,l,c){function h(){var t,e,n,i,s;for(t=_.find(".allimages"),e=$("img"),images={},n=0;n<e.length;n+=1)i=e.eq(n).attr("src"),/^(https?:\/\/)?images/.test(i)&&(images[i]=!0);for(e=$("[data-img]"),n=0;n<e.length;n+=1)i=e.eq(n).attr("data-img"),images["images/"+i]=!0;for(e=$('input[type="image"]'),n=0;n<e.length;n+=1)i=e.eq(n).attr("src"),/^(https?:\/\/)?images/.test(i)&&(images[i]=!0);s=[];for(i in images)/^(images\/)?sprite(.png)?$/.test(i)||s.push(i);for(s.sort(),n=0;n<s.length;n+=1)i=s[n],t.append($("<div>").attr("data-img",i.replace(/^images\//,"").replace(/\.png$/,"")))}function d(){var t,e,n,i;for(n=I.nextInt(6)+3,t="",t+=I.pick(A),i=0;n>i;i++)t+=I.pick(D);for(n=I.nextInt(6)+3,e="",e+=I.pick(A),i=0;n>i;i++)e+=I.pick(D);return t+" "+e}function p(){c.Alltabs.update(!0),new n(o.alltabsreloaded)}function f(){var t,e,i,s,r,a,u;if(void 0===window.mods){if(i=require.s.contexts._.defined,!i)return void console.error("require.s.contexts._.defined is undefined");u=window.mods={};for(t in i)for(e=t.split("/"),s=u,r=0;r<e.length;++r)a=e[r],r>=e.length-1?s[a]=i[t]:(void 0===s[a]&&(s[a]={}),s=s[a]);new n(o.modsvariableadded)}}function m(){var t,e,i,s;t=c.Storage,e=c.Alltabs,i=c.State,s=c.Tab_Settings,t.enable(),t.clear(),e.reset(),i.reset(),e.update(),new n(o.newtournament)}function g(){var t,e,i,s,r,a;if(e=c.Tab_Teams,!e.getOptions().allowRegistrations)return void new n(o.registrationclosed);for(t=Number(k.register.$num.val()),s=$("#newteam"),r=s.find(".playername"),i=0;t>i;++i){for(a=0;a<r.length;++a)$(r[a]).val(d());s.submit()}}function v(){var t,e;return e=c.Tab_Games,t=$("#new .newsystem button.swiss").eq(0),1===t.length?(t.click(),window.setTimeout(v,1),!1):(t=$("#new .swiss button").eq(0),1!==t.length?(new n(o.notenoughteams+"?"),!1):t.parents(".running").length?(new n(o.roundrunning.replace(/%s/g,"")),!1):void t.click())}function b(t,e){var n,i,s,o,r,a,u,l,c;if(void 0===t)l=$("#games");else for(u=$("#games .box"),c=0;c<u.length;c+=1)u.eq(c).data("tournamentid")===t&&(l=u.eq(c));if(!l)return void 0;for(i=l.find(".game .finish .points"),n=l.find(".game .finish button"),0===e&&(e=-1),e=e||void 0,e&&(a=(new Date).getTime()+e),s=0;s<n.length&&(I.nextInt(2)?(o=13-I.nextInt(2),r=I.nextInt(o)):(r=13-I.nextInt(2),o=I.nextInt(r)),i.eq(2*s).val(o),i.eq(2*s+1).val(r),n.eq(s).removeAttr("disabled").click(),!(e&&(new Date).getTime()>=a));s+=1);}function y(){var t,e;if(0===a.numTournaments())return v(),void setTimeout(y,1);for(starttime=new Date,t=0;t<a.numTournaments();t+=1)a.isRunning(t)&&(e=a.getTournament(t),1!=e.getState()&&(v(t)||v(t)||v(t)),1==e.getState()?(b(t,1e3),window.setTimeout(y,1)):new n(o.tournamentfinished,n.LONG))}function P(t){var e,i,s,r,h,d;if(e=2,i=u.count(),e>i)return void new n(o.notenoughteams);if(s=I.nextInt(i-e+1)+e,r=a.addTournament(t),!r)return void console.error("tournament type not accepted");for(d=a.getTournamentID(r),a.setName(d,t+" Sidetournament ID"+d),h=a.getTeams(d);h.length<u.count();)h.push(h.length);for(;(s-=1)>=0;)r.addPlayer(I.pickAndRemove(h));r.start(),a.getRanking(d).byevote[0]&&l.addVote(d,0,a.getRanking(d).ids[0],0),c.Storage.store(),p(),new n(o.roundstarted.replace("%s",1))}function w(){return k?(console.error("tab_debug: form is already defined:"),void console.error(k)):(k={register:{$form:_.find(".register"),$num:_.find(".register .num"),$submit:_.find(".register .submit"),$delete:_.find(".register .delete")},games:{$form:_.find(".tournament"),$startRound:_.find(".tournament .start"),$finishRound:_.find(".tournament .round"),$playTournament:_.find(".tournament .all")},phases:{$form:_.find(".phases"),$sideTournamentSwiss:_.find(".phases .sidetournamentswiss")},script:{$form:_.find(".script"),$loadmods:_.find(".script .loadmods"),$updatetabs:_.find(".script .updatetabs")}},k.register.$form.submit(function(t){return g(),t.preventDefault(),!1}),k.register.$delete.click(function(t){return m(),t.preventDefault(),!1}),k.games.$startRound.click(function(t){return v(),t.preventDefault(),!1}),k.games.$finishRound.click(function(t){return b(),t.preventDefault(),!1}),k.games.$playTournament.click(function(t){return y(),t.preventDefault(),!1}),k.phases.$sideTournamentSwiss.click(function(t){return P("swiss"),t.preventDefault(),!1}),k.script.$loadmods.click(function(t){return f(),t.preventDefault(),!1}),k.script.$updatetabs.click(function(t){return p(),t.preventDefault(),!1}),void j())}function j(){}function x(){r.isDevVersion?f():(t.hide("debug"),$(".devonly").remove())}function E(){return _?(console.error("tab_debug: $tab is already defined:"),void console.error(_)):(_=$("#debug"),w(),h(),void x())}function C(){_||E(),j()}var S,_,k,D,A,I;return I=new i,D=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","","","",""],A=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","","",""],S=e.createTab("debug",C,C)}),define("ui/ranking",["./team","./strings","./options","./tournaments"],function(t,e,n,i){var s;return s={toCSV:function(){var s,o,r,a,u,l,c,h;for(s=[],c=0;c<i.numTournaments();c+=1)if(h=i.getTournament(c),name=i.getName(c),o=i.getRanking(c),!(o.round<=0)){for(s.push("#"+i.getName(c)+" Ranking,"),s.push(e["rankhead"+n.teamsize]),l=function(i){var s,r,a,u,l;for(s=[],r=o.ids[i],a=t.get(r),s.push(o.place[i]+1),s.push(a.id+1),l=0;l<n.teamsize;l+=1)s.push(a.names[l]?'"'+a.names[l].replace(/"/g,'""')+'"':'"%% %%"');return s.push(o.wins?o.wins[i]:'""'),s.push(o.buchholz?o.buchholz[i]:'""'),s.push(o.finebuchholz?o.finebuchholz[i]:'""'),s.push(o.netto?o.netto[i]:'""'),u=[],o.roundupvote&&o.roundupvote[i]&&u.push(e.upvote),o.rounddownvote&&o.rounddownvote[i]&&u.push(e.downvote),o.roundbyevote&&o.roundbyevote[i]&&u.push(e.byevote),s.push('"'+u.join(",")+'"'),s.join(",")},a=o.ids.length,r=0;a>r;r+=1)s.push(l(r));u=h?h.getCorrections():void 0,void 0!==u&&0!==u.length&&(s.push("#"+i.getName(c)+" Korrekturen,"),s.push(e.correctionhead),l=function(t){var e,n;return n=[],e=t.game.teams[0][0],n.push(e+1),e=t.game.teams[1][0],n.push(e+1),n.push(t.oldpoints[0]),n.push(t.oldpoints[1]),n.push(t.newpoints[0]),n.push(t.newpoints[1]),n.join(",")},u.forEach(function(t){s.push(l(t))}))}return s.join("\r\n")}}}),define("ui/state",["./options","./tabshandle","./team","./history","./tournaments","./tab_teams","./tab_games","./tab_ranking","./tab_history","./tab_new","./shared"],function(t,e,n,i,s,o,r,a,u,l,c){var h;return h={toBlob:function(){return JSON.stringify({options:t.toBlob(),team:n.toBlob(),history:i.toBlob(),tournaments:s.toBlob()})},fromBlob:function(c){var h;return c?(h=JSON.parse(c),h.options&&(t.fromBlob(h.options),e.updateOpts()),n.fromBlob(h.team),i.fromBlob(h.history),s.fromBlob(h.tournaments),o.update(),l.update(),r.update(),u.update(),a.update(),!0):void 0},reset:function(){n.reset(),i.reset(),s.reset(),t.reset(),e.updateOpts()}},c.State=h,h}),define("ui/tab_settings",["./tab","lib/FileSaver","lib/Blob","./toast","./strings","./team","./history","./ranking","./state","./storage","./options","./players","./tabshandle","./shared"],function(t,e,n,i,s,o,r,a,u,l,c,h,d,p){function f(){N.csv={},N.csv.$buttons=M.find(".csv button"),N.csv.$buttons.click(function(){var t=$(this);"IMG"===t.prop("tagName")&&(t=t.parent()),m(t)})}function m(t){var u,l;if(u=[],t.hasClass("teams")&&u.push(o.toCSV()),t.hasClass("ranking")&&u.push(a.toCSV()),t.hasClass("history")&&u.push(r.toCSV()),u=u.join('\r\n""\r\n'),0===u.length)return void new i(s.nodata);try{l=new n([u],{type:"application/csv"}),e(l,"boules.csv")}catch(c){console.error("Blobbing failed"),new i(s.savefailed)}}function g(){N.load={},N.load.$file=M.find(".load input.file"),N.load.$file.change(function(t){var e=new FileReader;e.onerror=b,e.onabort=P,e.onload=y,e.readAsText(t.target.files[0])})}function v(){M.find(".load .selected").removeClass("selected"),N.load.$file.val("")}function b(t){switch(t.target.error.code){case t.target.error.NOT_FOUND_ERR:new i(s.filenotfound);break;case t.target.error.NOT_READABLE_ERR:new i(s.filenotreadable);break;case t.target.error.ABORT_ERR:break;default:new i(s.fileerror,i.LONG)}}function y(t){var e,n;e=t.target.result,l.enable(),l.clear(c.dbname);try{u.fromBlob(e)&&(l.changed(),D(),new i(s.loaded),d.focus("teams"))}catch(o){new i(s.loadfailed,i.LONG),l.enable(),l.clear(c.dbname),n=p.Alltabs,n.reset(),u.reset(),n.update(),new i(s.newtournament),d.focus("teams")}}function P(){new i(s.fileabort)}function w(){$.get(c.playernameurl,void 0,function(t){if(0===t.length)new i(s.fileempty);else try{h.fromBlob(t),l.store(),new i(s.autocompleteloaded)}catch(e){console.error(e),h.reset(),l.store(),new i(s.autocompletereloadfailed,i.LONG)}},"text").fail(function(){console.error("could not read "+c.playernameurl+". Is this a local installation?"),new i(s.autocompletereloadfailed,i.LONG)})}function j(){N.autocomplete={},N.autocomplete.$button=M.find(".autocomplete button"),N.autocomplete.$file=M.find(".autocomplete input.file"),N.autocomplete.$button.click(function(){var t=$(this);"BUTTON"!==t.prop("tagName")&&(t=t.parents("button")),w()}),N.autocomplete.$file.change(function(t){var e=new FileReader;e.onerror=E,e.onabort=S,e.onload=C,e.readAsText(t.target.files[0])}),window.setTimeout(w,1e3)}function x(){N.autocomplete.$file.val("")}function E(t){switch(t.target.error.code){case t.target.error.NOT_FOUND_ERR:new i(s.filenotfound);break;case t.target.error.NOT_READABLE_ERR:new i(s.filenotreadable);break;case t.target.error.ABORT_ERR:break;default:new i(s.fileerror)}}function C(t){var e;e=t.target.result,h.fromString(e),l.store(),new i(s.autocompleteloaded)}function S(){new i(s.fileabort)}function _(){var t,e;window.localStorage&&(t=window.localStorage[c.dbplayername],e=t?t.length/1048576:0,N.local.$playermeter.val(e.toString()),t=window.localStorage[c.dbname],e=t?t.length/1048576:0,N.local.$tournamentmeter.val(e.toString()))}function k(){N.local={},N.local.$savebutton=M.find(".local button.save"),N.local.$clearbutton=M.find(".local button.clear"),N.local.$playermeter=M.find(".local .playerstoragemeter"),N.local.$tournamentmeter=M.find(".local .tournamentstoragemeter"),N.local.$savebutton.click(function(t){return l.enable(),new i(l.store()?s.saved:s.savefailed),D(),t.preventDefault(),!1}),N.local.$clearbutton.click(function(t){var e;return confirm(s.clearstorage)&&(l.enable(),l.clear(c.dbname),e=p.Alltabs,e.reset(),u.reset(),e.update(),new i(s.newtournament),d.focus("teams"),D()),t.preventDefault(),!1})}function D(){l.enable()}function A(){return M?(console.error("tab_settings: $tab is already defined:"),void console.error(M)):(M=$("#settings"),f(),g(),j(),void k())}function I(){M||A(),v(),x(),D(),_()}function O(){I(),_()}var T,M,N,R;return R=!1,N={},T=t.createTab("settings",I,O),p.Tab_Settings=T,T}),define("ui/alltabs",["./shared","./tab_history","./tab_ranking","./tab_new","./tab_teams","./tab_games","./tab_debug","./tab_settings"],function(t){var e,n,i;for(n=[],e=1;e<arguments.length;e+=1)arguments[e]?n[e]=arguments[e]:(console.error("alltabs: argument id "+e+" has invalid value: "),console.error(arguments[e]));return i={reset:function(){var t;for(t in n)n[t].reset()},update:function(t){for(e in n)n[e].update(t)},getOptions:function(){return{}},setOptions:function(){}},t.Alltabs=i,i}),define("ui/backgroundscripts/save",["lib/Blob","../state","../toast","../strings","lib/FileSaver"],function(t,e,n,i,s){return void $(function(o){o("#tabs").on("click","button.save",function(){var o,r;try{o=e.toBlob();try{r=new t([o],{type:"application/json"}),s(r,"boules.json")}catch(a){console.error(a),new n(i.savefailed)}}catch(u){console.error("State.toBlob failed"),console.error(u.stack),new n(i.savefailed)}})})}),define("ui/backgroundscripts/print",[],function(){return void $(function(t){t("#tabs").on("click","button.print",function(){window.print()})})}),define("ui/backgroundscripts/reset",["../toast","../strings"],function(t,e){function n(){return"#reset"===location.hash?(console.log("clearing localstorage"),localStorage.clear(),new t(e.reset,t.LONG),location.hash="#debug",!0):!1}$(window).on("hashchange",function(){n()&&location.reload()}),n()}),define("ui/backgroundscripts/box",["../boxview"],function(t){$(function(e){e("#tabs div.box").each(function(){new t(e(this))})})}),define("ui/update",["./strings","./toast","./debug"],function(t,e,n){function i(){downloadToast&&(downloadToast.close(),downloadToast=void 0)}function s(s){s?r.isCached=!0:(r.isCached=!1,n.isDevVersion||(console.error("no cache manifest found!"),new e(t.nomanifest,e.INFINITE))),i()}function o(){switch(a.status){case a.OBSOLETE:case a.UNCACHED:s(!1);break;case a.UPDATEREADY:s(!0),new e(t.updateavailable,e.INFINITE),console.warn("boulesprog application cache updated");case a.IDLE:s(!0);break;case a.CHECKING:break;case a.DOWNLOADING:downloadToast||(downloadToast=new e(t.updatedownloading,e.INFINITE));break;default:console.error("unhandled appCache status: "+a.status),s(!1)}}var r,a;return downloadToast=void 0,r=function(){o();try{a.update()}catch(t){console.error(t)}},r.prototype={},a=window.applicationCache,a.addEventListener("error",o),a.addEventListener("downloading",o),a.addEventListener("progress",o),a.addEventListener("cached",o),a.addEventListener("noupdate",o),a.addEventListener("updateready",o),r}),define("ui/backgroundscripts/online",["../strings","../update"],function(t,e){var n;return n=function(){return navigator.onLine},$(window).on("beforeunload",function(i){var s=t.offlineconfirmexit;return n()||e.isCached?void 0:(i&&(i.returnValue=s),s)}),n}),define("ui/backgroundscripts/updatetab",["../shared"],function(t){function e(t){return"Tab_"+t.charAt(0).toUpperCase()+t.slice(1)}return void $(function(n){n("#tabs").on("click","button.reloadtab",function(){var i,s;i=n(this).parents("#tabs > div").attr("id"),s=t[e(i)],s?s.update():console.error("reloadtab: Tab does not exist: "+i)})})}),define("ui/backgroundscripts/featuredetect",["lib/modernizr","../strings","../toast"],function(t,e,n){var i;return i={},$(function(i){function s(){window.onbeforeunload=function(){return e.confirmleave}}t.adownload||i(".noadownload").show(),t.filereader||(i(".nofilereader").show(),i(".filereader").detach(),new n(e.nofilereader,n.LONG)),t.json||(i(".nojson").show(),i(".json").detach(),new n(e.nojson,n.LONG),s()),t.localstorage||(i(".nostorage").show(),i(".storage").detach(),new n(e.nostorage,n.LONG),s())}),i}),define("ui/csver",[],function(){var t={Interface:{toCSV:function(){}}};return t}),define("ui/listmodel",["lib/extend","./interfaces/model"],function(t,e){function n(){n.superconstructor.call(this)}return t(n,e),n.prototype.getItem=function(t){return{text:"Item #"+t}},n.prototype.numItems=function(){return 5},n}),define("ui/listview",["lib/extend","./interfaces/view","./boxcontroller"],function(t,e){function n(t,e){n.superconstructor.call(this,e,t)}var n;return t(n,e),n.prototype.reset=function(){this.$view.empty()},n.prototype.update=function(){var t,e;for(this.reset(),t=this.$view,e=0;e<this.model.numItems();e+=1)t.append(this.createItem(e))
},n.prototype.createItem=function(t){var e;return e=$("<div>").text(this.model.getItem(t).text)},n.prototype.onupdate=function(){this.update()},n}),define("ui/splash",[],function(){var t;return t={hide:function(){console.error("Splash.hide() called before pageload")},loading:function(){console.error("Splash.loading() called before pageload")}},$(function(e){function n(t){i.removeClass(),i.addClass(t)}var i;i=e("#splash"),n("starting"),t.loading=function(){n("restoring")},t.update=function(){n("update"),e("#tabs").show()},t.hide=function(){n("ready"),e("body").removeClass("splash"),setTimeout(function(){i.addClass("hidden")},1e3)},t.error=function(){n("error")}}),t}),define("ui/tablemodel",["lib/extend","./interfaces/model"],function(t,e){function n(){n.superconstructor.call(this)}return t(n,e),n.prototype.getCell=function(t,e){return t+","+e},n.prototype.numRows=function(){return 5},n.prototype.numCols=function(){return 5},n.prototype.getColTitle=function(t){return"Row "+t},n}),define("ui/tableview",["lib/extend","./interfaces/view","./boxcontroller"],function(t,e){function n(t){return void 0===t?"":t}function i(t,e){i.superconstructor.call(this,e,t)}var i;return t(i,e),i.prototype.reset=function(){this.$view.empty()},i.prototype.update=function(){var t,e;for(t=this.$view,this.reset(),t.append(this.createTitleRow()),e=0;e<this.model.numRows();e+=1)t.append(this.createRow(e))},i.prototype.createTitleRow=function(){var t,e,i;for(e=$("<tr>"),t=0;t<this.model.numCols();t+=1)i=$("<th>").text(n(this.model.getColTitle(t))),e.append(i);return e},i.prototype.createRow=function(t){var e,i,s;for(i=$("<tr>"),e=0;e<this.model.numCols();e+=1)s=$("<td>").text(n(this.model.getCell(t,e))),i.append(s);return i},i.prototype.onupdate=function(){this.update()},i}),require.config({shim:{"lib/modernizr":{deps:["lib/Blob"],exports:"Modernizr"},"lib/Blob":{exports:"Blob"},"lib/typeahead":{},"lib/jsPlumb":{exports:"jsPlumb"},"lib/qunit":{exports:"QUnit",init:function(){QUnit.config.autoload=!1,QUnit.config.autostart=!1}}}}),define(["backend/blobber","backend/buchholzranking","backend/correction","backend/finebuchholzranking","backend/fullmatrix","backend/game","backend/halfmatrix","backend/kotournament","backend/map","backend/matrix","backend/nettoranking","backend/options","backend/random","backend/ranking","backend/result","backend/rleblobber","backend/swisstournament","backend/tournament","backend/vector","lib/extend","lib/FileSaver","lib/implements","lib/jsPlumb","ui/alltabs","ui/autocomplete","ui/backgroundscripts/save","ui/backgroundscripts/print","ui/backgroundscripts/reset","ui/backgroundscripts/box","ui/backgroundscripts/online","ui/backgroundscripts/updatetab","ui/backgroundscripts/featuredetect","ui/boxcontroller","ui/boxview","ui/csver","ui/data/swissperms","ui/debug","ui/globalranking","ui/history","ui/interfaces/emitter","ui/interfaces/model","ui/interfaces/controller","ui/interfaces/view","ui/listmodel","ui/listview","ui/options","ui/opts","ui/players","ui/ranking","ui/shared","ui/splash","ui/state","ui/storage","ui/strings","ui/tab_debug","ui/tab_games","ui/tab_history","ui/tab","ui/tablemodel","ui/tableview","ui/tab_new","ui/tab_ranking","ui/tab_settings","ui/tabshandle","ui/tabs","ui/tab_teams","ui/team","ui/toast","ui/tournaments","ui/update"]);